from aiohttp import web

import asyncio
import logging
import os
import random
import re
import json
from datetime import datetime, timedelta
from contextlib import asynccontextmanager
from typing import Optional, List, Tuple, Dict

import aiosqlite
from aiogram import Bot, Dispatcher, F
from aiogram.filters import CommandStart, Command
from aiogram.types import (
    Message, CallbackQuery,
    InlineKeyboardMarkup, InlineKeyboardButton,
    ReplyKeyboardMarkup, KeyboardButton,
    FSInputFile,
)
from aiogram.fsm.state import StatesGroup, State
from aiogram.fsm.context import FSMContext

# =========================
# ĞĞĞ¡Ğ¢Ğ ĞĞ™ĞšĞ˜ (Ñ‡ĞµÑ€ĞµĞ· ENV â€” Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ Ğ´Ğ»Ñ GitHub/Render)
# =========================
BOT_TOKEN = os.getenv("BOT_TOKEN", "PASTE_NEW_TOKEN_HERE")
ADMIN_ID = int(os.getenv("ADMIN_ID", "0"))

# Ğ®ĞšĞ°ÑÑĞ° â€” API Ñ‡ĞµÑ€ĞµĞ· REST (shop_id + secret_key Ğ¸Ğ· Ğ»Ğ¸Ñ‡Ğ½Ğ¾Ğ³Ğ¾ ĞºĞ°Ğ±Ğ¸Ğ½ĞµÑ‚Ğ° yukassa.ru)
YUKASSA_SHOP_ID  = os.getenv("YUKASSA_SHOP_ID", "")
YUKASSA_SECRET   = os.getenv("YUKASSA_SECRET", "")

# ĞŸÑƒĞ±Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ğ¹ URL Ğ±Ğ¾Ñ‚Ğ° (Render/ngrok) Ğ´Ğ»Ñ return_url Ğ¿Ğ¾ÑĞ»Ğµ Ğ¾Ğ¿Ğ»Ğ°Ñ‚Ñ‹
BOT_PUBLIC_URL = os.getenv("BOT_PUBLIC_URL", "https://t.me/")  # https://t.me/your_bot

DB_PATH = os.getenv("DB_PATH", "bot.db")
WELCOME_IMAGE = os.getenv("WELCOME_IMAGE", "media/welcome.jpg")
OPENAI_API_KEY = os.getenv("OPENAI_API_KEY", "")

# Ğ¢ĞĞ Ğ˜Ğ¤Ğ«
TARIFFS = {
    "trial": {"title": "ĞŸÑ€Ğ¾Ğ±Ğ½Ñ‹Ğ¹ (3 Ğ´Ğ½Ñ)", "days": 3,  "price": 99},
    "t1":    {"title": "1 Ğ¼ĞµÑÑÑ†",         "days": 30, "price": 399},
    "t3":    {"title": "3 Ğ¼ĞµÑÑÑ†Ğ°",        "days": 90, "price": 899},
    "life":  {"title": "ĞĞ°Ğ²ÑĞµĞ³Ğ´Ğ°",        "days": None, "price": 1990},
}

# ĞŸĞ¾Ğ»Ğ½Ñ‹Ğ¹ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿ (Ğ¿Ğ¸Ñ‚Ğ°Ğ½Ğ¸Ğµ + Ğ²ÑĞµ Ñ†ĞµĞ»Ğ¸ + ÑĞ¼ĞµĞ½Ğ° Ğ¿Ñ€Ğ¾Ğ³Ñ€Ğ°Ğ¼Ğ¼Ñ‹) Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ½Ğ° t3 Ğ¸ life
FULL_ACCESS_TARIFFS = {"t3", "life"}

TG_SAFE_MSG_LEN = 3800

MIN_DAYS = 3
MAX_DAYS = 5

logging.basicConfig(level=logging.INFO)
logger = logging.getLogger("trainer_bot")


# =========================
# FSM
# =========================
class PaymentFlow(StatesGroup):
    choose_tariff = State()
    waiting_receipt = State()


class DiaryFlow(StatesGroup):
    choosing_exercise = State()
    enter_sets = State()


class MeasureFlow(StatesGroup):
    choose_type = State()
    enter_value = State()


class PostFlow(StatesGroup):
    waiting_content = State()
    waiting_confirm = State()


class ProfileWizard(StatesGroup):
    goal = State()
    sex = State()
    age = State()
    height = State()
    weight = State()
    place = State()
    exp = State()
    freq = State()
    meals = State()
    limits = State()


class ProfileFieldEdit(StatesGroup):
    """Ğ ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¾Ğ´Ğ½Ğ¾Ğ³Ğ¾ ĞºĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½Ğ¾Ğ³Ğ¾ Ğ¿Ğ¾Ğ»Ñ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»Ñ."""
    age = State()
    height = State()
    weight = State()
    limits = State()


class FoodPhotoFlow(StatesGroup):
    """FSM Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ´ÑÑ‡Ñ‘Ñ‚Ğ° ĞºĞ°Ğ»Ğ¾Ñ€Ğ¸Ğ¹ Ğ¿Ğ¾ Ñ„Ğ¾Ñ‚Ğ¾."""
    waiting_photo = State()
    confirm_items = State()
    edit_item_grams = State()


# =========================
# âœ… Ğ¢Ğ•Ğ¥ĞĞ˜ĞšĞ˜ Ğ’Ğ«ĞŸĞĞ›ĞĞ•ĞĞ˜Ğ¯
# =========================
TECH = {
    "squat": {
        "title": "ĞŸÑ€Ğ¸ÑĞµĞ´",
        "img": "media/tech/squat.jpg",
        "text": (
            "ğŸ“š ĞŸÑ€Ğ¸ÑĞµĞ´ (Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ Ğ¸ ÑÑ„Ñ„ĞµĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾)\n\n"
            "âœ… ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ°\n"
            "â€¢ Ğ¡Ñ‚Ğ¾Ğ¿Ñ‹: ÑˆĞ¸Ñ€Ğ¸Ğ½Ğ° Ğ¿Ğ»ĞµÑ‡, Ğ½Ğ¾ÑĞºĞ¸ ÑĞ»ĞµĞ³ĞºĞ° Ğ½Ğ°Ñ€ÑƒĞ¶Ñƒ.\n"
            "â€¢ ĞšĞ¾Ñ€Ğ¿ÑƒÑ: Ğ²Ğ´Ğ¾Ñ… Â«Ğ² Ğ¶Ğ¸Ğ²Ğ¾Ñ‚Â», Ğ¿Ñ€ĞµÑÑ Ğ² Ñ‚Ğ¾Ğ½ÑƒÑĞµ.\n\n"
            "âœ… ĞšĞ°Ğº Ğ´ĞµĞ»Ğ°Ñ‚ÑŒ\n"
            "1) Ğ£Ğ²Ğ¾Ğ´Ğ¸ Ñ‚Ğ°Ğ· Ğ½Ğ°Ğ·Ğ°Ğ´ Ğ¸ Ğ²Ğ½Ğ¸Ğ· Ğ¾Ğ´Ğ½Ğ¾Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ğ¾.\n"
            "2) ĞšĞ¾Ğ»ĞµĞ½Ğ¸ Ğ¸Ğ´ÑƒÑ‚ Ğ¿Ğ¾ Ğ»Ğ¸Ğ½Ğ¸Ğ¸ Ğ½Ğ¾ÑĞºĞ¾Ğ² (Ğ½Ğµ Ğ·Ğ°Ğ²Ğ°Ğ»Ğ¸Ğ²Ğ°ÑÑ‚ÑÑ Ğ²Ğ½ÑƒÑ‚Ñ€ÑŒ).\n"
            "3) Ğ¡Ğ¿Ğ¸Ğ½Ğ° Ñ€Ğ¾Ğ²Ğ½Ğ°Ñ, Ğ²ĞµÑ Ğ½Ğ° Ğ¿ÑÑ‚ĞºĞµ/ÑĞµÑ€ĞµĞ´Ğ¸Ğ½Ğµ ÑÑ‚Ğ¾Ğ¿Ñ‹.\n"
            "4) Ğ’Ğ½Ğ¸Ğ·Ñƒ â€” ĞºĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»ÑŒ, Ğ±ĞµĞ· Â«Ğ¿Ñ€Ğ¾Ğ²Ğ°Ğ»Ğ°Â».\n"
            "5) Ğ’ÑÑ‚Ğ°Ğ²Ğ°Ğ¹, Ñ‚Ğ¾Ğ»ĞºĞ°Ñ Ğ¿Ğ¾Ğ» Ğ½Ğ¾Ğ³Ğ°Ğ¼Ğ¸ (ĞºĞ¾Ğ»ĞµĞ½Ğ¸ Ğ½Ğµ Â«Ğ·Ğ°Ğ¼ĞºĞ¾Ğ¼Â»).\n\n"
            "âš ï¸ Ğ§Ğ°ÑÑ‚Ñ‹Ğµ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸\n"
            "â€¢ ĞšĞ¾Ğ»ĞµĞ½Ğ¸ Ğ²Ğ½ÑƒÑ‚Ñ€ÑŒ â†’ ÑĞ½Ğ¸Ğ·ÑŒ Ğ²ĞµÑ, Ğ´ÑƒĞ¼Ğ°Ğ¹ Â«Ñ€Ğ°Ğ·Ğ´Ğ²Ğ¸Ğ³Ğ°Ñ Ğ¿Ğ¾Ğ»Â».\n"
            "â€¢ ĞŸÑÑ‚ĞºĞ¸ Ğ¾Ñ‚Ñ€Ñ‹Ğ²Ğ°ÑÑ‚ÑÑ â†’ Ñ‡ÑƒÑ‚ÑŒ ÑˆĞ¸Ñ€Ğµ ÑÑ‚Ğ¾Ğ¹ĞºĞ°/Ğ¼ĞµĞ½ÑŒÑˆĞµ Ğ³Ğ»ÑƒĞ±Ğ¸Ğ½Ğ°.\n"
            "â€¢ ĞŸĞ¾ÑÑĞ½Ğ¸Ñ†Ğ° Ğ¾ĞºÑ€ÑƒĞ³Ğ»ÑĞµÑ‚ÑÑ â†’ Ğ¼ĞµĞ½ÑŒÑˆĞµ Ğ³Ğ»ÑƒĞ±Ğ¸Ğ½Ğ°, ÑĞ¸Ğ»ÑŒĞ½ĞµĞµ ĞºĞ¾Ñ€Ğ¿ÑƒÑ.\n\n"
            "ğŸ’¡ ĞŸĞ¾Ğ´ÑĞºĞ°Ğ·ĞºĞ°\n"
            "Ğ•ÑĞ»Ğ¸ Ğ´Ğ¸ÑĞºĞ¾Ğ¼Ñ„Ğ¾Ñ€Ñ‚ Ğ² ĞºĞ¾Ğ»ĞµĞ½ÑÑ…/ÑĞ¿Ğ¸Ğ½Ğµ â€” Ğ´ĞµĞ»Ğ°Ğ¹ Ğ²Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚: Ğ³Ğ¾Ğ±Ğ»ĞµÑ‚-Ğ¿Ñ€Ğ¸ÑĞµĞ´ Ğ¸Ğ»Ğ¸ Ğ¶Ğ¸Ğ¼ Ğ½Ğ¾Ğ³Ğ°Ğ¼Ğ¸."
        )
    },
    "bench": {
        "title": "Ğ–Ğ¸Ğ¼ Ğ»Ñ‘Ğ¶Ğ°",
        "img": "media/tech/bench.jpg",
        "text": (
            "ğŸ“š Ğ–Ğ¸Ğ¼ Ğ»Ñ‘Ğ¶Ğ° (Ğ³Ñ€ÑƒĞ´ÑŒ + Ñ‚Ñ€Ğ¸Ñ†ĞµĞ¿Ñ, Ğ±ĞµĞ· Ğ±Ğ¾Ğ»Ğ¸ Ğ² Ğ¿Ğ»ĞµÑ‡Ğ°Ñ…)\n\n"
            "âœ… ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ°\n"
            "â€¢ Ğ›Ğ¾Ğ¿Ğ°Ñ‚ĞºĞ¸: ÑĞ²Ñ‘Ğ» Ğ¸ Ğ¿Ñ€Ğ¸Ğ¶Ğ°Ğ» Ğº Ğ»Ğ°Ğ²ĞºĞµ.\n"
            "â€¢ Ğ¡Ñ‚Ğ¾Ğ¿Ñ‹: ÑƒÑÑ‚Ğ¾Ğ¹Ñ‡Ğ¸Ğ²Ğ¾ Ğ½Ğ° Ğ¿Ğ¾Ğ»Ñƒ.\n"
            "â€¢ Ğ¥Ğ²Ğ°Ñ‚: Ñ‚Ğ°Ğº, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ²Ğ½Ğ¸Ğ·Ñƒ Ğ¿Ñ€ĞµĞ´Ğ¿Ğ»ĞµÑ‡ÑŒÑ Ğ±Ñ‹Ğ»Ğ¸ Ğ¿Ğ¾Ñ‡Ñ‚Ğ¸ Ğ²ĞµÑ€Ñ‚Ğ¸ĞºĞ°Ğ»ÑŒĞ½Ñ‹.\n\n"
            "âœ… ĞšĞ°Ğº Ğ´ĞµĞ»Ğ°Ñ‚ÑŒ\n"
            "1) Ğ¡Ğ½Ğ¸Ğ¼Ğ¸ ÑˆÑ‚Ğ°Ğ½Ğ³Ñƒ, ÑƒĞ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°Ğ¹ Ğ»Ğ¾Ğ¿Ğ°Ñ‚ĞºĞ¸ ÑĞ²ĞµĞ´Ñ‘Ğ½Ğ½Ñ‹Ğ¼Ğ¸.\n"
            "2) ĞĞ¿ÑƒÑĞºĞ°Ğ¹ Ğº Ğ½Ğ¸Ğ¶Ğ½ĞµĞ¹ Ñ‡Ğ°ÑÑ‚Ğ¸ Ğ³Ñ€ÑƒĞ´Ğ¸ Ğ¿Ğ¾Ğ´ ĞºĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»ĞµĞ¼.\n"
            "3) Ğ›Ğ¾ĞºÑ‚Ğ¸ Ğ´ĞµÑ€Ğ¶Ğ¸ ~45Â° Ğº ĞºĞ¾Ñ€Ğ¿ÑƒÑÑƒ (Ğ½Ğµ 90Â° Ğ² ÑÑ‚Ğ¾Ñ€Ğ¾Ğ½Ñ‹).\n"
            "4) Ğ–Ğ¼Ğ¸ Ğ²Ğ²ĞµÑ€Ñ… Ğ¸ Ñ‡ÑƒÑ‚ÑŒ Ğ½Ğ°Ğ·Ğ°Ğ´ (Ğº ÑÑ‚Ğ¾Ğ¹ĞºĞ°Ğ¼), Ğ±ĞµĞ· Ñ€Ñ‹Ğ²ĞºĞ°.\n\n"
            "âš ï¸ Ğ§Ğ°ÑÑ‚Ñ‹Ğµ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸\n"
            "â€¢ ĞŸĞ»ĞµÑ‡Ğ¸ Â«Ğ²Ğ¿ĞµÑ€Ñ‘Ğ´Â» â†’ ÑĞ½Ğ¾Ğ²Ğ° ÑĞ²ĞµĞ´Ğ¸ Ğ»Ğ¾Ğ¿Ğ°Ñ‚ĞºĞ¸.\n"
            "â€¢ ĞÑ‚Ğ±Ğ¸Ğ² Ğ¾Ñ‚ Ğ³Ñ€ÑƒĞ´Ğ¸ â†’ Ğ·Ğ°Ğ¼ĞµĞ´Ğ»Ğ¸ Ğ½ĞµĞ³Ğ°Ñ‚Ğ¸Ğ².\n"
            "â€¢ Ğ¡Ğ»Ğ¸ÑˆĞºĞ¾Ğ¼ ÑˆĞ¸Ñ€Ğ¾ĞºĞ¸Ğ¹ Ñ…Ğ²Ğ°Ñ‚ â†’ Ğ¿Ğ»ĞµÑ‡Ğ¸ Ñ‡Ğ°Ñ‰Ğµ Ğ±Ğ¾Ğ»ÑÑ‚.\n\n"
            "ğŸ’¡ ĞŸĞ¾Ğ´ÑĞºĞ°Ğ·ĞºĞ°\n"
            "Ğ•ÑĞ»Ğ¸ Ğ¿Ğ»ĞµÑ‡Ğ¾ ĞºĞ°Ğ¿Ñ€Ğ¸Ğ·Ğ½Ğ¸Ñ‡Ğ°ĞµÑ‚ â€” Ğ¿Ğ¾Ğ¿Ñ€Ğ¾Ğ±ÑƒĞ¹ Ğ¶Ğ¸Ğ¼ Ğ³Ğ°Ğ½Ñ‚ĞµĞ»ĞµĞ¹ Ğ¸Ğ»Ğ¸ Ñ‚Ñ€ĞµĞ½Ğ°Ğ¶Ñ‘Ñ€."
        )
    },
    "row": {
        "title": "ĞÑ‚Ğ¶Ğ¸Ğ¼Ğ°Ğ½Ğ¸Ñ",
        "img": "media/tech/pushup.jpg",
        "text": (
            "ğŸ“š ĞÑ‚Ğ¶Ğ¸Ğ¼Ğ°Ğ½Ğ¸Ñ (ĞºĞ¾Ñ€Ğ¿ÑƒÑ + Ğ³Ñ€ÑƒĞ´ÑŒ, Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ğ¾)\n\n"
            "âœ… ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ°\n"
            "â€¢ Ğ›Ğ°Ğ´Ğ¾Ğ½Ğ¸ Ğ¿Ğ¾Ğ´ Ğ¿Ğ»ĞµÑ‡Ğ°Ğ¼Ğ¸ (Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ñ‡ÑƒÑ‚ÑŒ ÑˆĞ¸Ñ€Ğµ).\n"
            "â€¢ ĞšĞ¾Ñ€Ğ¿ÑƒÑ Â«Ğ´Ğ¾ÑĞºĞ¾Ğ¹Â»: Ğ¿Ñ€ĞµÑÑ + ÑĞ³Ğ¾Ğ´Ğ¸Ñ†Ñ‹ Ğ²ĞºĞ»ÑÑ‡ĞµĞ½Ñ‹.\n\n"
            "âœ… ĞšĞ°Ğº Ğ´ĞµĞ»Ğ°Ñ‚ÑŒ\n"
            "1) ĞĞ¿ÑƒÑĞºĞ°Ğ¹ÑÑ, ÑĞ¾Ñ…Ñ€Ğ°Ğ½ÑÑ Ğ¿Ñ€ÑĞ¼ÑƒÑ Ğ»Ğ¸Ğ½Ğ¸Ñ Ñ‚ĞµĞ»Ğ°.\n"
            "2) Ğ›Ğ¾ĞºÑ‚Ğ¸ Ğ¸Ğ´ÑƒÑ‚ Ğ½Ğ°Ğ·Ğ°Ğ´ Ğ¿Ğ¾Ğ´ ÑƒĞ³Ğ»Ğ¾Ğ¼ (Ğ½Ğµ Ñ€Ğ°Ğ·Ğ²Ğ¾Ğ´Ğ¸ Ğ² ÑÑ‚Ğ¾Ñ€Ğ¾Ğ½Ñ‹).\n"
            "3) Ğ’Ğ½Ğ¸Ğ·Ñƒ â€” ĞºĞ¾Ñ€Ğ¾Ñ‚ĞºĞ°Ñ Ğ¿Ğ°ÑƒĞ·Ğ°, Ğ·Ğ°Ñ‚ĞµĞ¼ Ğ²Ñ‹Ğ¶Ğ¸Ğ¼Ğ°Ğ¹ Ğ¿Ğ¾Ğ».\n\n"
            "âš ï¸ Ğ§Ğ°ÑÑ‚Ñ‹Ğµ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸\n"
            "â€¢ ĞŸÑ€Ğ¾Ğ²Ğ°Ğ» Ğ² Ğ¿Ğ¾ÑÑĞ½Ğ¸Ñ†Ğµ â†’ Ğ½Ğ°Ğ¿Ñ€ÑĞ³Ğ¸ Ğ¿Ñ€ĞµÑÑ/ÑĞ³Ğ¾Ğ´Ğ¸Ñ†Ñ‹.\n"
            "â€¢ Ğ“Ğ¾Ğ»Ğ¾Ğ²Ğ° Ğ²Ğ½Ğ¸Ğ· â†’ ÑĞ¼Ğ¾Ñ‚Ñ€Ğ¸ Ñ‡ÑƒÑ‚ÑŒ Ğ²Ğ¿ĞµÑ€ĞµĞ´.\n\n"
            "ğŸ’¡ Ğ£Ğ¿Ñ€Ğ¾Ñ‰ĞµĞ½Ğ¸Ğµ/ÑƒÑĞ»Ğ¾Ğ¶Ğ½ĞµĞ½Ğ¸Ğµ\n"
            "â€¢ Ğ›ĞµĞ³Ñ‡Ğµ: Ğ¾Ñ‚ Ğ»Ğ°Ğ²ĞºĞ¸/ÑÑ‚Ğ¾Ğ»Ğ°.\n"
            "â€¢ Ğ¢ÑĞ¶ĞµĞ»ĞµĞµ: Ğ½Ğ¾Ğ³Ğ¸ Ğ½Ğ° Ğ¾Ğ¿Ğ¾Ñ€Ñƒ Ğ¸Ğ»Ğ¸ Ğ¿Ğ°ÑƒĞ·Ğ° 1â€“2 ÑĞµĞº Ğ²Ğ½Ğ¸Ğ·Ñƒ."
        )
    },
    "latpulldown": {
        "title": "Ğ’ĞµÑ€Ñ…Ğ½Ğ¸Ğ¹ Ğ±Ğ»Ğ¾Ğº",
        "img": "media/tech/latpulldown.jpg",
        "text": (
            "ğŸ“š Ğ¢ÑĞ³Ğ° Ğ²ĞµÑ€Ñ…Ğ½ĞµĞ³Ğ¾ Ğ±Ğ»Ğ¾ĞºĞ° (ÑĞ¿Ğ¸Ğ½Ğ°, Ğ½Ğµ Ğ±Ğ¸Ñ†ĞµĞ¿Ñ)\n\n"
            "âœ… ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ°\n"
            "â€¢ Ğ¡ÑĞ´ÑŒ ÑƒÑÑ‚Ğ¾Ğ¹Ñ‡Ğ¸Ğ²Ğ¾, Ğ³Ñ€ÑƒĞ´ÑŒ Â«Ğ²Ğ¿ĞµÑ€Ñ‘Ğ´Â», Ğ¿Ğ»ĞµÑ‡Ğ¸ Ğ¾Ğ¿ÑƒÑÑ‚Ğ¸ Ğ²Ğ½Ğ¸Ğ·.\n\n"
            "âœ… ĞšĞ°Ğº Ğ´ĞµĞ»Ğ°Ñ‚ÑŒ\n"
            "1) ĞĞ°Ñ‡Ğ½Ğ¸ Ğ´Ğ²Ğ¸Ğ¶ĞµĞ½Ğ¸Ğµ Ğ»Ğ¾Ğ¿Ğ°Ñ‚ĞºĞ°Ğ¼Ğ¸: Ğ²Ğ½Ğ¸Ğ·/Ğº ĞºĞ°Ñ€Ğ¼Ğ°Ğ½Ğ°Ğ¼.\n"
            "2) Ğ¢ÑĞ½Ğ¸ Ğ»Ğ¾ĞºÑ‚Ğ¸ Ğ²Ğ½Ğ¸Ğ· Ğ¸ Ğ½Ğ°Ğ·Ğ°Ğ´.\n"
            "3) Ğ“Ñ€Ğ¸Ñ„ Ğº Ğ²ĞµÑ€Ñ…Ğ½ĞµĞ¹ Ñ‡Ğ°ÑÑ‚Ğ¸ Ğ³Ñ€ÑƒĞ´Ğ¸ (Ğ±ĞµĞ· Ñ€Ğ°ÑĞºĞ°Ñ‡ĞºĞ¸).\n"
            "4) Ğ’Ğ²ĞµÑ€Ñ… â€” Ğ¼ĞµĞ´Ğ»ĞµĞ½Ğ½Ğ¾, Ğ´Ğ¾ Ñ€Ğ°ÑÑ‚ÑĞ¶ĞµĞ½Ğ¸Ñ ÑˆĞ¸Ñ€Ğ¾Ñ‡Ğ°Ğ¹ÑˆĞ¸Ñ….\n\n"
            "âš ï¸ Ğ§Ğ°ÑÑ‚Ñ‹Ğµ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸\n"
            "â€¢ Ğ¢ÑĞ½ĞµÑˆÑŒ Ñ€ÑƒĞºĞ°Ğ¼Ğ¸ â†’ Ğ´ÑƒĞ¼Ğ°Ğ¹ Â«Ğ»Ğ¾ĞºÑ‚Ğ¸ Ğ²Ğ½Ğ¸Ğ·Â».\n"
            "â€¢ Ğ Ğ°ÑĞºĞ°Ñ‡ĞºĞ° ĞºĞ¾Ñ€Ğ¿ÑƒÑĞ¾Ğ¼ â†’ ÑĞ½Ğ¸Ğ·ÑŒ Ğ²ĞµÑ.\n\n"
            "ğŸ’¡ ĞŸĞ¾Ğ´ÑĞºĞ°Ğ·ĞºĞ°\n"
            "Ğ•ÑĞ»Ğ¸ Ğ½Ğµ Ñ‡ÑƒĞ²ÑÑ‚Ğ²ÑƒĞµÑˆÑŒ ÑĞ¿Ğ¸Ğ½Ñƒ â€” ÑĞ´ĞµĞ»Ğ°Ğ¹ Ğ¿Ğ°ÑƒĞ·Ñƒ 1 ÑĞµĞº Ğ²Ğ½Ğ¸Ğ·Ñƒ."
        )
    },
    "pullup": {
        "title": "ĞŸĞ¾Ğ´Ñ‚ÑĞ³Ğ¸Ğ²Ğ°Ğ½Ğ¸Ñ",
        "img": "media/tech/pullup.jpg",
        "text": (
            "ğŸ“š ĞŸĞ¾Ğ´Ñ‚ÑĞ³Ğ¸Ğ²Ğ°Ğ½Ğ¸Ñ (Ñ‡Ğ¸ÑÑ‚Ğ¾, Ğ±ĞµĞ· Ñ‡Ğ¸Ñ‚Ğ¸Ğ½Ğ³Ğ°)\n\n"
            "âœ… ĞšĞ°Ğº Ğ´ĞµĞ»Ğ°Ñ‚ÑŒ\n"
            "1) Ğ¡Ñ‚Ğ°Ñ€Ñ‚: Ğ¿Ğ»ĞµÑ‡Ğ¸ Ğ²Ğ½Ğ¸Ğ· (Ğ¾Ñ‚ ÑƒÑˆĞµĞ¹), Ğ»Ğ¾Ğ¿Ğ°Ñ‚ĞºĞ¸ Ğ²ĞºĞ»ÑÑ‡Ğ¸Ğ»Ğ¸ÑÑŒ.\n"
            "2) Ğ¢ÑĞ½Ğ¸ Ğ»Ğ¾ĞºÑ‚Ğ¸ Ğº Ñ€Ñ‘Ğ±Ñ€Ğ°Ğ¼, Ğ³Ñ€ÑƒĞ´ÑŒ Ğº Ğ¿ĞµÑ€ĞµĞºĞ»Ğ°Ğ´Ğ¸Ğ½Ğµ.\n"
            "3) Ğ’Ğ²ĞµÑ€Ñ… Ğ±ĞµĞ· Ñ€Ñ‹Ğ²ĞºĞ°, Ğ²Ğ½Ğ¸Ğ· â€” Ğ¼ĞµĞ´Ğ»ĞµĞ½Ğ½Ğ¾ 2â€“3 ÑĞµĞº.\n\n"
            "âš ï¸ Ğ§Ğ°ÑÑ‚Ñ‹Ğµ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸\n"
            "â€¢ Ğ”Ñ‘Ñ€Ğ³Ğ°ĞµÑˆÑŒÑÑ ĞºĞ¾Ñ€Ğ¿ÑƒÑĞ¾Ğ¼ â†’ Ğ´ĞµĞ»Ğ°Ğ¹ Ğ¼ĞµĞ´Ğ»ĞµĞ½Ğ½ĞµĞµ/Ñ€ĞµĞ·Ğ¸Ğ½ĞºĞ°.\n"
            "â€¢ ĞŸĞ»ĞµÑ‡Ğ¸ Ğ²Ğ²ĞµÑ€Ñ… â†’ ÑĞ½Ğ°Ñ‡Ğ°Ğ»Ğ° Ğ»Ğ¾Ğ¿Ğ°Ñ‚ĞºĞ¸ Ğ²Ğ½Ğ¸Ğ·.\n\n"
            "ğŸ’¡ Ğ•ÑĞ»Ğ¸ Ğ¿Ğ¾ĞºĞ° Ñ‚ÑĞ¶ĞµĞ»Ğ¾\n"
            "Ğ ĞµĞ·Ğ¸Ğ½ĞºĞ°/Ğ³Ñ€Ğ°Ğ²Ğ¸Ñ‚Ñ€Ğ¾Ğ½ Ğ¸Ğ»Ğ¸ Ğ½ĞµĞ³Ğ°Ñ‚Ğ¸Ğ²Ñ‹: Ğ·Ğ°Ğ¿Ñ€Ñ‹Ğ³Ğ½ÑƒĞ» â€” Ğ¼ĞµĞ´Ğ»ĞµĞ½Ğ½Ğ¾ Ğ¾Ğ¿ÑƒÑÑ‚Ğ¸Ğ»ÑÑ."
        )
    },
    "rdl": {
        "title": "Ğ ÑƒĞ¼Ñ‹Ğ½ÑĞºĞ°Ñ Ñ‚ÑĞ³Ğ°",
        "img": "media/tech/rdl.jpg",
        "text": (
            "ğŸ“š Ğ ÑƒĞ¼Ñ‹Ğ½ÑĞºĞ°Ñ Ñ‚ÑĞ³Ğ° (Ğ·Ğ°Ğ´Ğ½ÑÑ Ğ¿Ğ¾Ğ²ĞµÑ€Ñ…Ğ½Ğ¾ÑÑ‚ÑŒ Ğ±ĞµĞ´Ñ€Ğ°)\n\n"
            "âœ… ĞšĞ°Ğº Ğ´ĞµĞ»Ğ°Ñ‚ÑŒ\n"
            "1) ĞšĞ¾Ğ»ĞµĞ½Ğ¸ ÑĞ»ĞµĞ³ĞºĞ° ÑĞ¾Ğ³Ğ½ÑƒÑ‚Ñ‹ Ğ¸ Ğ¿Ğ¾Ñ‡Ñ‚Ğ¸ Ğ½Ğµ Ğ¼ĞµĞ½ÑÑÑ‚ÑÑ.\n"
            "2) Ğ”Ğ²Ğ¸Ğ¶ĞµĞ½Ğ¸Ğµ â€” Ñ‚Ğ°Ğ· Ğ½Ğ°Ğ·Ğ°Ğ´, ÑĞ¿Ğ¸Ğ½Ğ° Ñ€Ğ¾Ğ²Ğ½Ğ°Ñ.\n"
            "3) Ğ¡Ğ½Ğ°Ñ€ÑĞ´ Ğ¸Ğ´Ñ‘Ñ‚ Ğ±Ğ»Ğ¸Ğ·ĞºĞ¾ Ğº Ğ½Ğ¾Ğ³Ğ°Ğ¼.\n"
            "4) ĞĞ¿ÑƒÑĞºĞ°Ğ¹ÑÑ Ğ´Ğ¾ ÑĞ¸Ğ»ÑŒĞ½Ğ¾Ğ³Ğ¾ Ğ½Ğ°Ñ‚ÑĞ¶ĞµĞ½Ğ¸Ñ Ğ² Ğ±Ñ‘Ğ´Ñ€Ğ°Ñ….\n"
            "5) Ğ’Ğ²ĞµÑ€Ñ… â€” Ñ‚Ğ°Ğ· Ğ²Ğ¿ĞµÑ€Ñ‘Ğ´, Ğ±ĞµĞ· Ğ¿ĞµÑ€ĞµĞ³Ğ¸Ğ±Ğ° Ğ¿Ğ¾ÑÑĞ½Ğ¸Ñ†Ñ‹.\n\n"
            "âš ï¸ Ğ§Ğ°ÑÑ‚Ñ‹Ğµ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸\n"
            "â€¢ ĞšÑ€ÑƒĞ³Ğ»Ğ°Ñ ÑĞ¿Ğ¸Ğ½Ğ° â†’ ÑƒĞºĞ¾Ñ€Ğ¾Ñ‚Ğ¸ Ğ°Ğ¼Ğ¿Ğ»Ğ¸Ñ‚ÑƒĞ´Ñƒ.\n"
            "â€¢ ĞŸÑ€ĞµĞ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ÑÑ Ğ² Ğ¿Ñ€Ğ¸ÑĞµĞ´ â†’ Ğ¼ĞµĞ½ÑŒÑˆĞµ ÑĞ³Ğ¸Ğ±Ğ°Ğ¹ ĞºĞ¾Ğ»ĞµĞ½Ğ¸.\n\n"
            "ğŸ’¡ ĞŸĞ¾Ğ´ÑĞºĞ°Ğ·ĞºĞ°\n"
            "Ğ§ÑƒĞ²ÑÑ‚Ğ²ÑƒĞµÑˆÑŒ Ğ±Ñ‘Ğ´Ñ€Ğ°/ÑĞ³Ğ¾Ğ´Ğ¸Ñ†Ñ‹ â€” Ğ²ÑÑ‘ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ğ¾. Ğ•ÑĞ»Ğ¸ Ğ¿Ğ¾ÑÑĞ½Ğ¸Ñ†Ñƒ â€” ÑĞ½Ğ¸Ğ·ÑŒ Ğ²ĞµÑ."
        )
    },
    "ohp": {
        "title": "Ğ–Ğ¸Ğ¼ Ğ²Ğ²ĞµÑ€Ñ…",
        "img": "media/tech/ohp.jpg",
        "text": (
            "ğŸ“š Ğ–Ğ¸Ğ¼ Ğ²Ğ²ĞµÑ€Ñ… (Ğ¿Ğ»ĞµÑ‡Ğ¸, Ğ±ĞµĞ· Ğ»Ğ¾Ğ¼Ğ°Ğ½Ğ¸Ñ Ğ¿Ğ¾ÑÑĞ½Ğ¸Ñ†Ñ‹)\n\n"
            "âœ… ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ°\n"
            "â€¢ ĞŸÑ€ĞµÑÑ Ğ½Ğ°Ğ¿Ñ€ÑĞ³, Ñ€Ñ‘Ğ±Ñ€Ğ° Â«Ğ²Ğ½Ğ¸Ğ·Â».\n"
            "â€¢ Ğ¯Ğ³Ğ¾Ğ´Ğ¸Ñ†Ñ‹ Ğ²ĞºĞ»ÑÑ‡ĞµĞ½Ñ‹ â€” ĞºĞ¾Ñ€Ğ¿ÑƒÑ ÑÑ‚Ğ°Ğ±Ğ¸Ğ»ĞµĞ½.\n\n"
            "âœ… ĞšĞ°Ğº Ğ´ĞµĞ»Ğ°Ñ‚ÑŒ\n"
            "1) Ğ–Ğ¼Ğ¸ Ğ²Ğ²ĞµÑ€Ñ… Ğ¸ Ñ‡ÑƒÑ‚ÑŒ Ğ½Ğ°Ğ·Ğ°Ğ´ (ÑˆÑ‚Ğ°Ğ½Ğ³Ğ° Ğ±Ğ»Ğ¸Ğ·ĞºĞ¾ Ğº Ğ»Ğ¸Ñ†Ñƒ).\n"
            "2) Ğ’Ğ²ĞµÑ€Ñ…Ñƒ Ğ³Ğ¾Ğ»Ğ¾Ğ²Ğ° Â«Ğ² Ğ¾ĞºĞ½Ğ¾Â» Ğ¿Ğ¾Ğ´ ÑĞ½Ğ°Ñ€ÑĞ´.\n"
            "3) Ğ’Ğ½Ğ¸Ğ· â€” Ğ¼ĞµĞ´Ğ»ĞµĞ½Ğ½Ğ¾, Ğ² ĞºĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»ÑŒ.\n\n"
            "âš ï¸ Ğ§Ğ°ÑÑ‚Ñ‹Ğµ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸\n"
            "â€¢ ĞŸÑ€Ğ¾Ğ³Ğ¸Ğ± Ğ² Ğ¿Ğ¾ÑÑĞ½Ğ¸Ñ†Ğµ â†’ ÑĞ½Ğ¸Ğ·ÑŒ Ğ²ĞµÑ, ÑĞ¸Ğ»ÑŒĞ½ĞµĞµ ĞºĞ¾Ñ€Ğ¿ÑƒÑ.\n"
            "â€¢ Ğ›Ğ¾ĞºÑ‚Ğ¸ ÑƒĞµÑ…Ğ°Ğ»Ğ¸ Ğ½Ğ°Ğ·Ğ°Ğ´ â†’ Ğ´ĞµÑ€Ğ¶Ğ¸ Ğ¿Ğ¾Ğ´ Ğ³Ñ€Ğ¸Ñ„Ğ¾Ğ¼.\n\n"
            "ğŸ’¡ Ğ•ÑĞ»Ğ¸ Ğ¿Ğ»ĞµÑ‡Ğ¾ Ğ±Ğ¾Ğ»Ğ¸Ñ‚\n"
            "Ğ£Ğ¼ĞµĞ½ÑŒÑˆĞ¸ Ğ°Ğ¼Ğ¿Ğ»Ğ¸Ñ‚ÑƒĞ´Ñƒ, Ğ¿Ğ¾Ğ¿Ñ€Ğ¾Ğ±ÑƒĞ¹ Ğ³Ğ°Ğ½Ñ‚ĞµĞ»Ğ¸ Ğ¸Ğ»Ğ¸ Ğ¶Ğ¸Ğ¼ Ğ² Ñ‚Ñ€ĞµĞ½Ğ°Ğ¶Ñ‘Ñ€Ğµ."
        )
    },
    "lateralraise": {
        "title": "Ğ Ğ°Ğ·Ğ²ĞµĞ´ĞµĞ½Ğ¸Ñ Ğ² ÑÑ‚Ğ¾Ñ€Ğ¾Ğ½Ñ‹",
        "img": "media/tech/lateralraise.jpg",
        "text": (
            "ğŸ“š Ğ Ğ°Ğ·Ğ²ĞµĞ´ĞµĞ½Ğ¸Ñ Ğ² ÑÑ‚Ğ¾Ñ€Ğ¾Ğ½Ñ‹ (ÑÑ€ĞµĞ´Ğ½ÑÑ Ğ´ĞµĞ»ÑŒÑ‚Ğ°)\n\n"
            "âœ… ĞšĞ°Ğº Ğ´ĞµĞ»Ğ°Ñ‚ÑŒ\n"
            "1) ĞŸĞ»ĞµÑ‡Ğ¸ Ğ²Ğ½Ğ¸Ğ·, ĞºĞ¾Ñ€Ğ¿ÑƒÑ ÑÑ‚Ğ°Ğ±Ğ¸Ğ»ĞµĞ½.\n"
            "2) Ğ›Ğ¾ĞºĞ¾Ñ‚ÑŒ ÑĞ»ĞµĞ³ĞºĞ° ÑĞ¾Ğ³Ğ½ÑƒÑ‚ Ğ¸ Ñ„Ğ¸ĞºÑĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½.\n"
            "3) ĞŸĞ¾Ğ´Ğ½Ğ¸Ğ¼Ğ°Ğ¹ Ğ´Ğ¾ ÑƒÑ€Ğ¾Ğ²Ğ½Ñ Ğ¿Ğ»ĞµÑ‡.\n"
            "4) Ğ’Ğ½Ğ¸Ğ· â€” Ğ¼ĞµĞ´Ğ»ĞµĞ½Ğ½Ğ¾ 2â€“3 ÑĞµĞº.\n\n"
            "âš ï¸ Ğ§Ğ°ÑÑ‚Ñ‹Ğµ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸\n"
            "â€¢ ĞœĞ°Ñ…Ğ¸ ĞºĞ¾Ñ€Ğ¿ÑƒÑĞ¾Ğ¼ â†’ ÑĞ½Ğ¸Ğ·ÑŒ Ğ²ĞµÑ.\n"
            "â€¢ ĞŸĞ¾Ğ´Ğ½Ğ¸Ğ¼Ğ°ĞµÑˆÑŒ ĞºĞ¸ÑÑ‚ÑŒÑ â†’ Ğ´ÑƒĞ¼Ğ°Ğ¹ Â«Ğ»Ğ¾ĞºĞ¾Ñ‚ÑŒ Ğ²ĞµĞ´Ñ‘Ñ‚Â».\n\n"
            "ğŸ’¡ ĞŸĞ¾Ğ´ÑĞºĞ°Ğ·ĞºĞ°\n"
            "Ğ›ÑƒÑ‡ÑˆĞµ Ğ»ĞµĞ³Ñ‡Ğµ, Ğ½Ğ¾ Ñ‡Ğ¸ÑÑ‚Ğ¾ â€” Ñ‚ÑƒÑ‚ Ñ‚ĞµÑ…Ğ½Ğ¸ĞºĞ° Ñ€ĞµÑˆĞ°ĞµÑ‚."
        )
    },
    "biceps": {
        "title": "Ğ‘Ğ¸Ñ†ĞµĞ¿Ñ ÑĞ³Ğ¸Ğ±Ğ°Ğ½Ğ¸Ñ",
        "img": "media/tech/biceps.jpg",
        "text": (
            "ğŸ“š Ğ¡Ğ³Ğ¸Ğ±Ğ°Ğ½Ğ¸Ñ Ğ½Ğ° Ğ±Ğ¸Ñ†ĞµĞ¿Ñ (Ğ±ĞµĞ· Ñ€Ğ°ÑĞºĞ°Ñ‡ĞºĞ¸)\n\n"
            "âœ… ĞšĞ°Ğº Ğ´ĞµĞ»Ğ°Ñ‚ÑŒ\n"
            "1) Ğ›Ğ¾ĞºÑ‚Ğ¸ Ğ¿Ñ€Ğ¸Ğ¶Ğ°Ñ‚Ñ‹ Ğº ĞºĞ¾Ñ€Ğ¿ÑƒÑÑƒ Ğ¸ Ğ½Ğµ Ğ³ÑƒĞ»ÑÑÑ‚.\n"
            "2) ĞŸĞ¾Ğ´Ğ½Ğ¸Ğ¼Ğ°Ğ¹ Ğ´Ğ¾ Ğ¿Ğ¸ĞºĞ°, Ğ±ĞµĞ· Ñ€Ñ‹Ğ²ĞºĞ¾Ğ².\n"
            "3) Ğ’Ğ½Ğ¸Ğ· â€” Ğ¼ĞµĞ´Ğ»ĞµĞ½Ğ½Ğ¾, Ğ½Ğµ Ğ±Ñ€Ğ¾ÑĞ°Ğ¹.\n\n"
            "âš ï¸ Ğ§Ğ°ÑÑ‚Ñ‹Ğµ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸\n"
            "â€¢ Ğ Ğ°ÑĞºĞ°Ñ‡ĞºĞ° ÑĞ¿Ğ¸Ğ½Ğ¾Ğ¹ â†’ ÑĞ»Ğ¸ÑˆĞºĞ¾Ğ¼ Ñ‚ÑĞ¶ĞµĞ»Ğ¾.\n"
            "â€¢ Ğ›Ğ¾ĞºÑ‚Ğ¸ ÑƒĞµĞ·Ğ¶Ğ°ÑÑ‚ Ğ²Ğ¿ĞµÑ€Ñ‘Ğ´ â†’ Ğ½Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° ÑƒÑ…Ğ¾Ğ´Ğ¸Ñ‚.\n\n"
            "ğŸ’¡ ĞŸĞ¾Ğ´ÑĞºĞ°Ğ·ĞºĞ°\n"
            "Ğ¥Ğ¾Ñ‡ĞµÑˆÑŒ Ñ€Ğ¾ÑÑ‚ â€” ĞºĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»Ğ¸Ñ€ÑƒĞ¹ Ğ½ĞµĞ³Ğ°Ñ‚Ğ¸Ğ² Ğ¸ Ğ½Ğµ Ğ³Ğ¾Ğ½Ğ¸ÑÑŒ Ğ·Ğ° Ğ²ĞµÑĞ¾Ğ¼."
        )
    },
    "triceps": {
        "title": "Ğ¢Ñ€Ğ¸Ñ†ĞµĞ¿Ñ Ğ½Ğ° Ğ±Ğ»Ğ¾ĞºĞµ",
        "img": "media/tech/triceps.jpg",
        "text": (
            "ğŸ“š Ğ Ğ°Ğ·Ğ³Ğ¸Ğ±Ğ°Ğ½Ğ¸Ñ Ğ½Ğ° Ğ±Ğ»Ğ¾ĞºĞµ (Ñ‚Ñ€Ğ¸Ñ†ĞµĞ¿Ñ)\n\n"
            "âœ… ĞšĞ°Ğº Ğ´ĞµĞ»Ğ°Ñ‚ÑŒ\n"
            "1) Ğ›Ğ¾ĞºÑ‚Ğ¸ Ğ¿Ñ€Ğ¸Ğ¶Ğ°Ñ‚Ñ‹ Ğº ĞºĞ¾Ñ€Ğ¿ÑƒÑÑƒ.\n"
            "2) Ğ Ğ°Ğ·Ğ³Ğ¸Ğ±Ğ°Ğ¹ Ğ´Ğ¾ ĞºĞ¾Ğ½Ñ†Ğ° Ğ±ĞµĞ· Ğ±Ğ¾Ğ»Ğ¸.\n"
            "3) Ğ’Ğ²ĞµÑ€Ñ… â€” Ğ¼ĞµĞ´Ğ»ĞµĞ½Ğ½Ğ¾, Ğ¿Ğ¾Ğ´ ĞºĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»ĞµĞ¼.\n\n"
            "âš ï¸ Ğ§Ğ°ÑÑ‚Ñ‹Ğµ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸\n"
            "â€¢ Ğ›Ğ¾ĞºÑ‚Ğ¸ Â«Ğ³ÑƒĞ»ÑÑÑ‚Â» â†’ ÑĞ½Ğ¸Ğ·ÑŒ Ğ²ĞµÑ.\n"
            "â€¢ Ğ‘Ñ€Ğ¾ÑĞ°ĞµÑˆÑŒ Ğ²Ğ²ĞµÑ€Ñ… â†’ Ñ‚ĞµÑ€ÑĞµÑˆÑŒ Ğ½Ğ°Ğ³Ñ€ÑƒĞ·ĞºÑƒ.\n\n"
            "ğŸ’¡ Ğ•ÑĞ»Ğ¸ Ğ»Ğ¾ĞºĞ¾Ñ‚ÑŒ Ğ½Ğ¾ĞµÑ‚\n"
            "Ğ£Ğ¼ĞµĞ½ÑŒÑˆĞ¸ Ğ²ĞµÑ Ğ¸ Ğ´ĞµĞ»Ğ°Ğ¹ Ğ¼ÑĞ³Ñ‡Ğµ, Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ¾Ğ´Ğ½Ğ¾Ğ¹ Ñ€ÑƒĞºĞ¾Ğ¹."
        )
    },
    "legpress": {
        "title": "Ğ–Ğ¸Ğ¼ Ğ½Ğ¾Ğ³Ğ°Ğ¼Ğ¸",
        "img": "media/tech/legpress.jpg",
        "text": (
            "ğŸ“š Ğ–Ğ¸Ğ¼ Ğ½Ğ¾Ğ³Ğ°Ğ¼Ğ¸ (Ğ½Ğ¾Ğ³Ğ¸, Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾)\n\n"
            "âœ… ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ°\n"
            "â€¢ ĞŸĞ¾ÑÑĞ½Ğ¸Ñ†Ğ° Ğ¿Ñ€Ğ¸Ğ¶Ğ°Ñ‚Ğ°, Ñ‚Ğ°Ğ· Ğ½Ğµ Ğ¾Ñ‚Ñ€Ñ‹Ğ²Ğ°Ğ¹.\n"
            "â€¢ Ğ¡Ñ‚Ğ¾Ğ¿Ñ‹ Ñ‚Ğ°Ğº, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ ĞºĞ¾Ğ»ĞµĞ½Ğ¸ ÑˆĞ»Ğ¸ Ğ¿Ğ¾ Ğ»Ğ¸Ğ½Ğ¸Ğ¸ Ğ½Ğ¾ÑĞºĞ¾Ğ².\n\n"
            "âœ… ĞšĞ°Ğº Ğ´ĞµĞ»Ğ°Ñ‚ÑŒ\n"
            "1) ĞĞ¿ÑƒÑĞºĞ°Ğ¹ Ğ¿Ğ»Ğ°Ñ‚Ñ„Ğ¾Ñ€Ğ¼Ñƒ Ğ´Ğ¾ ĞºĞ¾Ğ¼Ñ„Ğ¾Ñ€Ñ‚Ğ½Ğ¾Ğ¹ Ğ³Ğ»ÑƒĞ±Ğ¸Ğ½Ñ‹.\n"
            "2) Ğ’Ğ½Ğ¸Ğ·Ñƒ â€” ĞºĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»ÑŒ, Ğ±ĞµĞ· Â«ÑĞºĞ»Ğ°Ğ´Ñ‹Ğ²Ğ°Ğ½Ğ¸ÑÂ» Ñ‚Ğ°Ğ·Ğ°.\n"
            "3) Ğ–Ğ¼Ğ¸ Ğ²Ğ²ĞµÑ€Ñ…, Ğ½Ğ¾ Ğ½Ğµ Ğ²Ñ‹Ğ¿Ñ€ÑĞ¼Ğ»ÑĞ¹ ĞºĞ¾Ğ»ĞµĞ½Ğ¸ Ğ² Â«Ğ·Ğ°Ğ¼Ğ¾ĞºÂ».\n\n"
            "âš ï¸ Ğ§Ğ°ÑÑ‚Ñ‹Ğµ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸\n"
            "â€¢ Ğ¢Ğ°Ğ· Ğ¾Ñ‚Ñ€Ñ‹Ğ²Ğ°ĞµÑ‚ÑÑ â†’ ÑĞ»Ğ¸ÑˆĞºĞ¾Ğ¼ Ğ³Ğ»ÑƒĞ±Ğ¾ĞºĞ¾.\n"
            "â€¢ ĞšĞ¾Ğ»ĞµĞ½Ğ¸ Ğ²Ğ½ÑƒÑ‚Ñ€ÑŒ â†’ ÑĞ»ĞµĞ´Ğ¸ Ğ·Ğ° Ñ‚Ñ€Ğ°ĞµĞºÑ‚Ğ¾Ñ€Ğ¸ĞµĞ¹.\n\n"
            "ğŸ’¡ ĞŸĞ¾Ğ´ÑĞºĞ°Ğ·ĞºĞ°\n"
            "Ğ›ÑƒÑ‡ÑˆĞµ Ğ¸Ğ´ĞµĞ°Ğ»ÑŒĞ½Ğ°Ñ Ñ‚ĞµÑ…Ğ½Ğ¸ĞºĞ°, Ñ‡ĞµĞ¼ Ñ€ĞµĞºĞ¾Ñ€Ğ´Ğ½Ñ‹Ğ¹ Ğ²ĞµÑ."
        )
    },
    # âœ… ĞĞ¾Ğ²Ñ‹Ğµ Ñ‚ĞµÑ…Ğ½Ğ¸ĞºĞ¸ Ğ´Ğ»Ñ ÑƒĞ¿Ñ€Ğ°Ğ¶Ğ½ĞµĞ½Ğ¸Ğ¹ Ğ±ĞµĞ· Ğ¿Ğ¾ĞºÑ€Ñ‹Ñ‚Ğ¸Ñ
    "hinge": {
        "title": "Ğ¯Ğ³Ğ¾Ğ´Ğ¸Ñ‡Ğ½Ñ‹Ğ¹ Ğ¼Ğ¾ÑÑ‚",
        "img": "media/tech/rdl.jpg",
        "text": (
            "ğŸ“š Ğ¯Ğ³Ğ¾Ğ´Ğ¸Ñ‡Ğ½Ñ‹Ğ¹ Ğ¼Ğ¾ÑÑ‚ (ÑĞ³Ğ¾Ğ´Ğ¸Ñ†Ñ‹ + Ğ·Ğ°Ğ´Ğ½ÑÑ Ğ¿Ğ¾Ğ²ĞµÑ€Ñ…Ğ½Ğ¾ÑÑ‚ÑŒ Ğ±ĞµĞ´Ñ€Ğ°)\n\n"
            "âœ… ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ°\n"
            "â€¢ Ğ›ÑĞ³ÑŒ Ğ½Ğ° ÑĞ¿Ğ¸Ğ½Ñƒ, ĞºĞ¾Ğ»ĞµĞ½Ğ¸ ÑĞ¾Ğ³Ğ½ÑƒÑ‚Ñ‹, ÑÑ‚Ğ¾Ğ¿Ñ‹ Ğ½Ğ° ÑˆĞ¸Ñ€Ğ¸Ğ½Ğµ Ğ±Ñ‘Ğ´ĞµÑ€.\n"
            "â€¢ ĞŸÑÑ‚ĞºĞ¸ Ğ¿Ğ¾Ğ´ ĞºĞ¾Ğ»ĞµĞ½ÑĞ¼Ğ¸ Ğ¸Ğ»Ğ¸ Ñ‡ÑƒÑ‚ÑŒ Ğ´Ğ°Ğ»ÑŒÑˆĞµ.\n\n"
            "âœ… ĞšĞ°Ğº Ğ´ĞµĞ»Ğ°Ñ‚ÑŒ\n"
            "1) ĞĞ°Ğ¿Ñ€ÑĞ³Ğ¸ ÑĞ³Ğ¾Ğ´Ğ¸Ñ†Ñ‹ Ğ¸ Ğ¿Ğ¾Ğ´Ğ½Ğ¸Ğ¼Ğ°Ğ¹ Ñ‚Ğ°Ğ· Ğ²Ğ²ĞµÑ€Ñ….\n"
            "2) Ğ’ Ğ²ĞµÑ€Ñ…Ğ½ĞµĞ¹ Ñ‚Ğ¾Ñ‡ĞºĞµ â€” Ğ¿Ğ°ÑƒĞ·Ğ° 1â€“2 ÑĞµĞº, ÑĞ¾Ğ¶Ğ¼Ğ¸ ÑĞ³Ğ¾Ğ´Ğ¸Ñ†Ñ‹.\n"
            "3) ĞĞ¿ÑƒÑĞºĞ°Ğ¹ Ğ¼ĞµĞ´Ğ»ĞµĞ½Ğ½Ğ¾, Ğ½Ğµ ĞºĞ°ÑĞ°ÑÑÑŒ Ğ¿Ğ¾Ğ»Ğ° Ğ¿Ğ¾Ğ»Ğ½Ğ¾ÑÑ‚ÑŒÑ.\n\n"
            "âš ï¸ Ğ§Ğ°ÑÑ‚Ñ‹Ğµ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸\n"
            "â€¢ ĞŸĞ¾ÑÑĞ½Ğ¸Ñ†Ğ° Ğ¿Ñ€Ğ¾Ğ³Ğ¸Ğ±Ğ°ĞµÑ‚ÑÑ â†’ Ğ¼ĞµĞ½ÑŒÑˆĞµ Ğ²Ñ‹ÑĞ¾Ñ‚Ñƒ Ğ¿Ğ¾Ğ´ÑŠÑ‘Ğ¼Ğ°.\n"
            "â€¢ ĞšĞ¾Ğ»ĞµĞ½Ğ¸ Ñ€Ğ°Ğ·ÑŠĞµĞ·Ğ¶Ğ°ÑÑ‚ÑÑ â†’ Ğ´ĞµÑ€Ğ¶Ğ¸ Ğ¸Ñ… Ğ½Ğ°Ğ´ Ğ½Ğ¾ÑĞºĞ°Ğ¼Ğ¸.\n\n"
            "ğŸ’¡ Ğ£ÑĞ»Ğ¾Ğ¶Ğ½ĞµĞ½Ğ¸Ğµ\n"
            "ĞĞ´Ğ½Ğ° Ğ½Ğ¾Ğ³Ğ° Ğ½Ğ° Ğ²ĞµÑÑƒ, Ğ¸Ğ»Ğ¸ Ğ¾Ñ‚ÑĞ³Ğ¾Ñ‰ĞµĞ½Ğ¸Ğµ Ğ½Ğ° Ğ±Ñ‘Ğ´Ñ€Ğ°."
        )
    },
    "core": {
        "title": "ĞŸĞ»Ğ°Ğ½ĞºĞ°",
        "img": "media/tech/squat.jpg",
        "text": (
            "ğŸ“š ĞŸĞ»Ğ°Ğ½ĞºĞ° (ĞºĞ¾Ñ€ â€” ÑÑ‚Ğ°Ğ±Ğ¸Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ)\n\n"
            "âœ… ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ°\n"
            "â€¢ Ğ£Ğ¿Ğ¾Ñ€ Ğ½Ğ° Ğ¿Ñ€ĞµĞ´Ğ¿Ğ»ĞµÑ‡ÑŒÑ (Ğ¸Ğ»Ğ¸ Ğ»Ğ°Ğ´Ğ¾Ğ½Ğ¸), Ñ‚ĞµĞ»Ğ¾ â€” Ğ¿Ñ€ÑĞ¼Ğ°Ñ Ğ»Ğ¸Ğ½Ğ¸Ñ.\n"
            "â€¢ Ğ›Ğ¾ĞºÑ‚Ğ¸ Ğ¿Ğ¾Ğ´ Ğ¿Ğ»ĞµÑ‡Ğ°Ğ¼Ğ¸, Ğ²Ğ·Ğ³Ğ»ÑĞ´ Ğ² Ğ¿Ğ¾Ğ».\n\n"
            "âœ… ĞšĞ°Ğº Ğ´ĞµĞ»Ğ°Ñ‚ÑŒ\n"
            "1) ĞĞ°Ğ¿Ñ€ÑĞ³Ğ¸ Ğ¿Ñ€ĞµÑÑ, ÑĞ³Ğ¾Ğ´Ğ¸Ñ†Ñ‹, ĞºĞ²Ğ°Ğ´Ñ€Ğ¸Ñ†ĞµĞ¿ÑÑ‹ Ğ¾Ğ´Ğ½Ğ¾Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ğ¾.\n"
            "2) ĞĞµ Ğ´Ğ°Ğ²Ğ°Ğ¹ Ñ‚Ğ°Ğ·Ñƒ Ğ¿Ñ€Ğ¾Ğ²Ğ°Ğ»Ğ¸Ğ²Ğ°Ñ‚ÑŒÑÑ Ğ¸Ğ»Ğ¸ Ğ·Ğ°Ğ´Ğ¸Ñ€Ğ°Ñ‚ÑŒÑÑ.\n"
            "3) Ğ”Ñ‹ÑˆĞ¸ Ñ€Ğ°Ğ²Ğ½Ğ¾Ğ¼ĞµÑ€Ğ½Ğ¾, Ğ½Ğµ Ğ·Ğ°Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°Ğ¹ Ğ´Ñ‹Ñ…Ğ°Ğ½Ğ¸Ğµ.\n\n"
            "âš ï¸ Ğ§Ğ°ÑÑ‚Ñ‹Ğµ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸\n"
            "â€¢ Ğ¢Ğ°Ğ· Ğ²Ğ²ĞµÑ€Ñ… â†’ ÑĞ½Ğ¸Ğ·ÑŒ Ğ²Ñ€ĞµĞ¼Ñ, Ğ´ĞµÑ€Ğ¶Ğ¸ Ñ€Ğ¾Ğ²Ğ½Ğ¾.\n"
            "â€¢ ĞŸĞ¾ÑÑĞ½Ğ¸Ñ†Ğ° Ğ¿Ñ€Ğ¾Ğ³Ğ¸Ğ±Ğ°ĞµÑ‚ÑÑ â†’ Ğ½Ğ°Ğ¿Ñ€ÑĞ³Ğ¸ Ğ¿Ñ€ĞµÑÑ ÑĞ¸Ğ»ÑŒĞ½ĞµĞµ.\n\n"
            "ğŸ’¡ ĞŸÑ€Ğ¾Ğ³Ñ€ĞµÑÑĞ¸Ñ\n"
            "ĞĞ°Ñ‡Ğ½Ğ¸ Ñ 20 ÑĞµĞº, Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞ¹ Ğ¿Ğ¾ 5â€“10 ÑĞµĞº ĞºĞ°Ğ¶Ğ´ÑƒÑ Ğ½ĞµĞ´ĞµĞ»Ñ."
        )
    },
    "calves": {
        "title": "ĞŸĞ¾Ğ´ÑŠÑ‘Ğ¼Ñ‹ Ğ½Ğ° Ğ½Ğ¾ÑĞºĞ¸",
        "img": "media/tech/squat.jpg",
        "text": (
            "ğŸ“š ĞŸĞ¾Ğ´ÑŠÑ‘Ğ¼Ñ‹ Ğ½Ğ° Ğ½Ğ¾ÑĞºĞ¸ (Ğ¸ĞºÑ€Ñ‹)\n\n"
            "âœ… ĞšĞ°Ğº Ğ´ĞµĞ»Ğ°Ñ‚ÑŒ\n"
            "1) Ğ’ÑÑ‚Ğ°Ğ½ÑŒ Ğ½Ğ° ĞºÑ€Ğ°Ğ¹ ÑÑ‚ÑƒĞ¿ĞµĞ½Ğ¸ (Ğ¸Ğ»Ğ¸ Ñ€Ğ¾Ğ²Ğ½Ñ‹Ğ¹ Ğ¿Ğ¾Ğ»).\n"
            "2) ĞŸĞ¾Ğ´Ğ½Ğ¸Ğ¼Ğ°Ğ¹ÑÑ Ğ½Ğ° Ğ½Ğ¾ÑĞºĞ¸ Ğ¼Ğ°ĞºÑĞ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ğ¾ Ğ²Ñ‹ÑĞ¾ĞºĞ¾.\n"
            "3) ĞŸĞ°ÑƒĞ·Ğ° Ğ²Ğ²ĞµÑ€Ñ…Ñƒ 1 ÑĞµĞº, Ğ¾Ğ¿ÑƒÑĞºĞ°Ğ¹ÑÑ Ğ¼ĞµĞ´Ğ»ĞµĞ½Ğ½Ğ¾ (2â€“3 ÑĞµĞº).\n\n"
            "âš ï¸ Ğ§Ğ°ÑÑ‚Ñ‹Ğµ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸\n"
            "â€¢ Ğ¡Ğ»Ğ¸ÑˆĞºĞ¾Ğ¼ Ğ±Ñ‹ÑÑ‚Ñ€Ğ¾ â†’ Ğ½ĞµÑ‚ Ğ½Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸ Ğ½Ğ° Ğ¸ĞºÑ€Ñ‹.\n"
            "â€¢ ĞĞµ Ğ¿Ğ¾Ğ»Ğ½Ğ°Ñ Ğ°Ğ¼Ğ¿Ğ»Ğ¸Ñ‚ÑƒĞ´Ğ° â†’ Ğ¼ĞµĞ½ÑŒÑˆĞµ ÑÑ„Ñ„ĞµĞºÑ‚.\n\n"
            "ğŸ’¡ ĞŸĞ¾Ğ´ÑĞºĞ°Ğ·ĞºĞ°\n"
            "Ğ˜ĞºÑ€Ñ‹ Ğ²Ñ‹Ğ½Ğ¾ÑĞ»Ğ¸Ğ²Ñ‹Ğµ â€” Ğ´ĞµĞ»Ğ°Ğ¹ 15â€“25 Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€Ğ¾Ğ² Ğ¸Ğ»Ğ¸ Ğ´Ğ¾Ğ±Ğ°Ğ²ÑŒ Ğ²ĞµÑ."
        )
    },
    "goblet": {
        "title": "Ğ“Ğ¾Ğ±Ğ»ĞµÑ‚-Ğ¿Ñ€Ğ¸ÑĞµĞ´",
        "img": "media/tech/squat.jpg",
        "text": (
            "ğŸ“š Ğ“Ğ¾Ğ±Ğ»ĞµÑ‚-Ğ¿Ñ€Ğ¸ÑĞµĞ´ (Ğ½Ğ¾Ğ³Ğ¸ + ĞºĞ¾Ñ€Ğ¿ÑƒÑ)\n\n"
            "âœ… ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ°\n"
            "â€¢ Ğ”ĞµÑ€Ğ¶Ğ¸ Ğ³Ğ°Ğ½Ñ‚ĞµĞ»ÑŒ/Ğ³Ğ¸Ñ€Ñ Ñƒ Ğ³Ñ€ÑƒĞ´Ğ¸ Ğ´Ğ²ÑƒĞ¼Ñ Ñ€ÑƒĞºĞ°Ğ¼Ğ¸.\n"
            "â€¢ Ğ¡Ñ‚Ğ¾Ğ¿Ñ‹ Ñ‡ÑƒÑ‚ÑŒ ÑˆĞ¸Ñ€Ğµ Ğ¿Ğ»ĞµÑ‡, Ğ½Ğ¾ÑĞºĞ¸ Ğ½Ğ°Ñ€ÑƒĞ¶Ñƒ.\n\n"
            "âœ… ĞšĞ°Ğº Ğ´ĞµĞ»Ğ°Ñ‚ÑŒ\n"
            "1) ĞŸÑ€Ğ¸ÑĞµĞ´Ğ°Ğ¹ Ğ³Ğ»ÑƒĞ±Ğ¾ĞºĞ¾, Ğ»Ğ¾ĞºÑ‚Ğ¸ Ğ´Ğ°Ğ²ÑÑ‚ Ğ½Ğ° ĞºĞ¾Ğ»ĞµĞ½Ğ¸ Ğ¸Ğ·Ğ½ÑƒÑ‚Ñ€Ğ¸.\n"
            "2) Ğ¡Ğ¿Ğ¸Ğ½Ğ° Ğ¿Ñ€ÑĞ¼Ğ°Ñ, Ğ³Ñ€ÑƒĞ´ÑŒ ÑĞ¼Ğ¾Ñ‚Ñ€Ğ¸Ñ‚ Ğ²Ğ¿ĞµÑ€Ñ‘Ğ´.\n"
            "3) Ğ’ÑÑ‚Ğ°Ğ²Ğ°Ğ¹, Ğ²Ñ‹Ñ‚Ğ°Ğ»ĞºĞ¸Ğ²Ğ°Ñ Ğ¿Ğ¾Ğ» Ğ½Ğ¾Ğ³Ğ°Ğ¼Ğ¸.\n\n"
            "âš ï¸ Ğ§Ğ°ÑÑ‚Ñ‹Ğµ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸\n"
            "â€¢ ĞĞ°ĞºĞ»Ğ¾Ğ½ Ğ²Ğ¿ĞµÑ€Ñ‘Ğ´ â†’ Ğ¿Ğ¾Ğ´Ğ½Ğ¸Ğ¼Ğ¸ Ğ²ĞµÑ Ğ²Ñ‹ÑˆĞµ, Ğº Ğ³Ñ€ÑƒĞ´Ğ¸.\n"
            "â€¢ ĞŸÑÑ‚ĞºĞ¸ Ğ¾Ñ‚Ñ€Ñ‹Ğ²Ğ°ÑÑ‚ÑÑ â†’ Ñ‡ÑƒÑ‚ÑŒ ÑˆĞ¸Ñ€Ğµ ÑÑ‚Ğ¾Ğ¹ĞºĞ°.\n\n"
            "ğŸ’¡ ĞŸĞ»ÑÑ\n"
            "ĞÑ‚Ğ»Ğ¸Ñ‡Ğ½Ğ°Ñ Ğ°Ğ»ÑŒÑ‚ĞµÑ€Ğ½Ğ°Ñ‚Ğ¸Ğ²Ğ° Ğ¾Ğ±Ñ‹Ñ‡Ğ½Ğ¾Ğ¼Ñƒ Ğ¿Ñ€Ğ¸ÑĞµĞ´Ñƒ â€” Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½ĞµĞµ Ğ´Ğ»Ñ ÑĞ¿Ğ¸Ğ½Ñ‹."
        )
    },
    "lunge": {
        "title": "Ğ’Ñ‹Ğ¿Ğ°Ğ´Ñ‹",
        "img": "media/tech/squat.jpg",
        "text": (
            "ğŸ“š Ğ’Ñ‹Ğ¿Ğ°Ğ´Ñ‹ (Ğ½Ğ¾Ğ³Ğ¸ + ÑĞ³Ğ¾Ğ´Ğ¸Ñ†Ñ‹)\n\n"
            "âœ… ĞšĞ°Ğº Ğ´ĞµĞ»Ğ°Ñ‚ÑŒ\n"
            "1) Ğ¨Ğ°Ğ³ Ğ²Ğ¿ĞµÑ€Ñ‘Ğ´ â€” ÑˆĞ¸Ñ€Ğ¾ĞºĞ¸Ğ¹, ĞºĞ¾Ğ»ĞµĞ½Ğ¾ Ğ½Ğµ Ğ²Ñ‹Ñ…Ğ¾Ğ´Ğ¸Ñ‚ Ğ·Ğ° Ğ½Ğ¾ÑĞ¾Ğº.\n"
            "2) Ğ—Ğ°Ğ´Ğ½ĞµĞµ ĞºĞ¾Ğ»ĞµĞ½Ğ¾ Ğ¾Ğ¿ÑƒÑĞºĞ°ĞµÑ‚ÑÑ Ğ¿Ğ¾Ñ‡Ñ‚Ğ¸ Ğ´Ğ¾ Ğ¿Ğ¾Ğ»Ğ°.\n"
            "3) ĞÑ‚Ñ‚Ğ¾Ğ»ĞºĞ½Ğ¸ÑÑŒ Ğ¿ĞµÑ€ĞµĞ´Ğ½ĞµĞ¹ Ğ½Ğ¾Ğ³Ğ¾Ğ¹ Ğ¸ Ğ²ĞµÑ€Ğ½Ğ¸ÑÑŒ.\n\n"
            "âš ï¸ Ğ§Ğ°ÑÑ‚Ñ‹Ğµ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸\n"
            "â€¢ ĞŸĞµÑ€ĞµĞ´Ğ½ĞµĞµ ĞºĞ¾Ğ»ĞµĞ½Ğ¾ Ğ·Ğ°Ğ²Ğ°Ğ»Ğ¸Ğ²Ğ°ĞµÑ‚ÑÑ Ğ²Ğ½ÑƒÑ‚Ñ€ÑŒ â†’ ÑĞ»ĞµĞ´Ğ¸ Ğ·Ğ° Ğ½Ğ¸Ğ¼.\n"
            "â€¢ ĞšĞ¾Ñ€Ğ¿ÑƒÑ Ğ¿Ğ°Ğ´Ğ°ĞµÑ‚ Ğ²Ğ¿ĞµÑ€Ñ‘Ğ´ â†’ Ğ´ĞµÑ€Ğ¶Ğ¸ Ğ³Ñ€ÑƒĞ´ÑŒ Ğ¿Ñ€ÑĞ¼Ğ¾.\n\n"
            "ğŸ’¡ Ğ’Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚Ñ‹\n"
            "Ğ¡Ñ‚Ğ°Ñ‚Ğ¸Ñ‡Ğ½Ñ‹Ğµ (Ğ½Ğ° Ğ¼ĞµÑÑ‚Ğµ), Ğ¾Ğ±Ñ€Ğ°Ñ‚Ğ½Ñ‹Ğµ (ÑˆĞ°Ğ³ Ğ½Ğ°Ğ·Ğ°Ğ´), Ğ±Ğ¾Ğ»Ğ³Ğ°Ñ€ÑĞºĞ¸Ğµ (Ğ½Ğ¾Ğ³Ğ° ÑĞ·Ğ°Ğ´Ğ¸ Ğ½Ğ° ÑĞºĞ°Ğ¼ÑŒĞµ)."
        )
    },
    "hyperext": {
        "title": "Ğ“Ğ¸Ğ¿ĞµÑ€ÑĞºÑÑ‚ĞµĞ½Ğ·Ğ¸Ñ",
        "img": "media/tech/rdl.jpg",
        "text": (
            "ğŸ“š Ğ“Ğ¸Ğ¿ĞµÑ€ÑĞºÑÑ‚ĞµĞ½Ğ·Ğ¸Ñ (Ğ¿Ğ¾ÑÑĞ½Ğ¸Ñ†Ğ° + ÑĞ³Ğ¾Ğ´Ğ¸Ñ†Ñ‹)\n\n"
            "âœ… ĞšĞ°Ğº Ğ´ĞµĞ»Ğ°Ñ‚ÑŒ\n"
            "1) Ğ—Ğ°Ñ„Ğ¸ĞºÑĞ¸Ñ€ÑƒĞ¹ Ğ½Ğ¾Ğ³Ğ¸, Ğ¾Ğ¿ÑƒÑÑ‚Ğ¸ÑÑŒ Ğ¿Ğ°Ñ€Ğ°Ğ»Ğ»ĞµĞ»ÑŒĞ½Ğ¾ Ğ¿Ğ¾Ğ»Ñƒ.\n"
            "2) ĞŸĞ¾Ğ´Ğ½Ğ¸Ğ¼Ğ°Ğ¹ÑÑ Ğ´Ğ¾ Ğ¿Ñ€ÑĞ¼Ğ¾Ğ¹ Ğ»Ğ¸Ğ½Ğ¸Ğ¸ Ñ‚ĞµĞ»Ğ° (Ğ½Ğµ Ğ¿ĞµÑ€ĞµĞ³Ğ¸Ğ±Ğ°Ğ¹ÑÑ!).\n"
            "3) ĞŸĞ°ÑƒĞ·Ğ° Ğ²Ğ²ĞµÑ€Ñ…Ñƒ â€” ÑĞ¾Ğ¶Ğ¼Ğ¸ ÑĞ³Ğ¾Ğ´Ğ¸Ñ†Ñ‹.\n\n"
            "âš ï¸ Ğ§Ğ°ÑÑ‚Ñ‹Ğµ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸\n"
            "â€¢ ĞŸĞµÑ€ĞµÑ€Ğ°Ğ·Ğ³Ğ¸Ğ±Ğ°Ğ½Ğ¸Ğµ Ğ¿Ğ¾ÑÑĞ½Ğ¸Ñ†Ñ‹ â†’ Ğ¾ÑÑ‚Ğ°Ğ½Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°Ğ¹ÑÑ Ğ½Ğ° Ğ¿Ñ€ÑĞ¼Ğ¾Ğ¹ Ğ»Ğ¸Ğ½Ğ¸Ğ¸.\n"
            "â€¢ Ğ ÑƒĞºĞ¸ Ñ‚ÑĞ½ÑƒÑ‚ ÑˆĞµÑ â†’ Ğ´ĞµÑ€Ğ¶Ğ¸ Ğ¸Ñ… Ñƒ Ğ³Ñ€ÑƒĞ´Ğ¸ Ğ¸Ğ»Ğ¸ Ğ·Ğ° Ğ³Ğ¾Ğ»Ğ¾Ğ²Ğ¾Ğ¹ Ğ±ĞµĞ· ÑƒÑĞ¸Ğ»Ğ¸Ñ.\n\n"
            "ğŸ’¡ ĞŸĞ¾Ğ´ÑĞºĞ°Ğ·ĞºĞ°\n"
            "Ğ§ÑƒĞ²ÑÑ‚Ğ²ÑƒĞµÑˆÑŒ ÑĞ³Ğ¾Ğ´Ğ¸Ñ†Ñ‹ Ğ±Ğ¾Ğ»ÑŒÑˆĞµ, Ñ‡ĞµĞ¼ Ğ¿Ğ¾ÑÑĞ½Ğ¸Ñ†Ñƒ? Ğ—Ğ½Ğ°Ñ‡Ğ¸Ñ‚, Ğ´ĞµĞ»Ğ°ĞµÑˆÑŒ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ğ¾."
        )
    },
    "legcurl": {
        "title": "Ğ¡Ğ³Ğ¸Ğ±Ğ°Ğ½Ğ¸Ñ Ğ½Ğ¾Ğ³",
        "img": "media/tech/rdl.jpg",
        "text": (
            "ğŸ“š Ğ¡Ğ³Ğ¸Ğ±Ğ°Ğ½Ğ¸Ñ Ğ½Ğ¾Ğ³ (Ğ±Ğ¸Ñ†ĞµĞ¿Ñ Ğ±ĞµĞ´Ñ€Ğ°)\n\n"
            "âœ… ĞšĞ°Ğº Ğ´ĞµĞ»Ğ°Ñ‚ÑŒ\n"
            "1) Ğ›ĞµÑ‡ÑŒ Ğ½Ğ° Ñ‚Ñ€ĞµĞ½Ğ°Ğ¶Ñ‘Ñ€, Ğ¾ÑÑŒ Ğ²Ñ€Ğ°Ñ‰ĞµĞ½Ğ¸Ñ â€” Ğ¿Ğ¾Ğ´ ĞºĞ¾Ğ»ĞµĞ½ÑĞ¼Ğ¸.\n"
            "2) Ğ¡Ğ³Ğ¸Ğ±Ğ°Ğ¹ Ğ½Ğ¾Ğ³Ğ¸ Ğ´Ğ¾ Ğ¼Ğ°ĞºÑĞ¸Ğ¼ÑƒĞ¼Ğ°, Ğ¿Ğ°ÑƒĞ·Ğ° 1 ÑĞµĞº.\n"
            "3) ĞĞ¿ÑƒÑĞºĞ°Ğ¹ Ğ¼ĞµĞ´Ğ»ĞµĞ½Ğ½Ğ¾ (2â€“3 ÑĞµĞº).\n\n"
            "âš ï¸ Ğ§Ğ°ÑÑ‚Ñ‹Ğµ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸\n"
            "â€¢ Ğ¢Ğ°Ğ· Ğ¾Ñ‚Ñ€Ñ‹Ğ²Ğ°ĞµÑ‚ÑÑ â†’ ÑĞ½Ğ¸Ğ·ÑŒ Ğ²ĞµÑ.\n"
            "â€¢ Ğ¡Ğ»Ğ¸ÑˆĞºĞ¾Ğ¼ Ğ±Ñ‹ÑÑ‚Ñ€Ğ¾ â†’ Ğ½ĞµÑ‚ Ğ½Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸ Ğ½Ğ° Ğ±Ğ¸Ñ†ĞµĞ¿Ñ Ğ±ĞµĞ´Ñ€Ğ°.\n\n"
            "ğŸ’¡ ĞŸĞ¾Ğ´ÑĞºĞ°Ğ·ĞºĞ°\n"
            "ĞĞ¾ÑĞºĞ¸ Ğ½Ğ° ÑĞµĞ±Ñ â€” Ğ½ĞµĞ¼Ğ½Ğ¾Ğ³Ğ¾ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ¸Ñ€ÑƒĞµÑ‚ Ğ¸ĞºÑ€Ñ‹, Ğ¾Ñ‚ ÑĞµĞ±Ñ â€” Ñ‡Ğ¸Ñ‰Ğµ Ğ±Ğ¸Ñ†ĞµĞ¿Ñ Ğ±ĞµĞ´Ñ€Ğ°."
        )
    },
    "rowtrain": {
        "title": "Ğ¢ÑĞ³Ğ° Ğ³Ğ¾Ñ€Ğ¸Ğ·Ğ¾Ğ½Ñ‚Ğ°Ğ»ÑŒĞ½Ğ¾Ğ³Ğ¾ Ğ±Ğ»Ğ¾ĞºĞ°",
        "img": "media/tech/latpulldown.jpg",
        "text": (
            "ğŸ“š Ğ¢ÑĞ³Ğ° Ğ³Ğ¾Ñ€Ğ¸Ğ·Ğ¾Ğ½Ñ‚Ğ°Ğ»ÑŒĞ½Ğ¾Ğ³Ğ¾ Ğ±Ğ»Ğ¾ĞºĞ° (ÑĞµÑ€ĞµĞ´Ğ¸Ğ½Ğ° ÑĞ¿Ğ¸Ğ½Ñ‹)\n\n"
            "âœ… ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ°\n"
            "â€¢ Ğ¡ÑĞ´ÑŒ, Ğ½Ğ¾Ğ³Ğ¸ ÑĞ¾Ğ³Ğ½ÑƒÑ‚Ñ‹, ÑĞ¿Ğ¸Ğ½Ğ° Ğ¿Ñ€ÑĞ¼Ğ°Ñ, Ğ½Ğµ Ğ¾ĞºÑ€ÑƒĞ³Ğ»ĞµĞ½Ğ°.\n\n"
            "âœ… ĞšĞ°Ğº Ğ´ĞµĞ»Ğ°Ñ‚ÑŒ\n"
            "1) ĞĞ°Ñ‡Ğ½Ğ¸ Ñ‚ÑĞ³Ñƒ Ñ Ğ»Ğ¾Ğ¿Ğ°Ñ‚Ğ¾Ğº: ÑĞ²ĞµĞ´Ğ¸ Ğ¸Ñ… Ğ²Ğ¼ĞµÑÑ‚Ğµ.\n"
            "2) Ğ¢ÑĞ½Ğ¸ Ğº Ğ¿Ğ¾ÑÑÑƒ, Ğ»Ğ¾ĞºÑ‚Ğ¸ Ğ±Ğ»Ğ¸Ğ·ĞºĞ¾ Ğº Ñ‚ĞµĞ»Ñƒ.\n"
            "3) ĞŸĞ°ÑƒĞ·Ğ° 1 ÑĞµĞº Ğ² ĞºĞ¾Ğ½Ñ†Ğµ, Ğ·Ğ°Ñ‚ĞµĞ¼ Ğ¼ĞµĞ´Ğ»ĞµĞ½Ğ½Ğ¾ Ğ²Ğ¿ĞµÑ€Ñ‘Ğ´.\n\n"
            "âš ï¸ Ğ§Ğ°ÑÑ‚Ñ‹Ğµ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸\n"
            "â€¢ Ğ Ğ°ÑĞºĞ°Ñ‡ĞºĞ° ĞºĞ¾Ñ€Ğ¿ÑƒÑĞ¾Ğ¼ â†’ ÑĞ½Ğ¸Ğ·ÑŒ Ğ²ĞµÑ.\n"
            "â€¢ Ğ¢ÑĞ½ĞµÑˆÑŒ Ñ€ÑƒĞºĞ°Ğ¼Ğ¸ â†’ Ğ´ÑƒĞ¼Ğ°Ğ¹ Â«ÑĞ²Ğ¾Ğ¶Ñƒ Ğ»Ğ¾Ğ¿Ğ°Ñ‚ĞºĞ¸Â».\n\n"
            "ğŸ’¡ ĞŸĞ¾Ğ´ÑĞºĞ°Ğ·ĞºĞ°\n"
            "ĞĞµĞ¹Ñ‚Ñ€Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ñ…Ğ²Ğ°Ñ‚ (Ğ»Ğ°Ğ´Ğ¾Ğ½Ğ¸ Ğ´Ñ€ÑƒĞ³ Ğº Ğ´Ñ€ÑƒĞ³Ñƒ) â€” ĞºĞ¾Ğ¼Ñ„Ğ¾Ñ€Ñ‚Ğ½ĞµĞµ Ğ´Ğ»Ñ Ğ¿Ğ»ĞµÑ‡."
        )
    },
    "dumbbell_row": {
        "title": "Ğ¢ÑĞ³Ğ° Ğ³Ğ°Ğ½Ñ‚ĞµĞ»Ğ¸",
        "img": "media/tech/latpulldown.jpg",
        "text": (
            "ğŸ“š Ğ¢ÑĞ³Ğ° Ğ³Ğ°Ğ½Ñ‚ĞµĞ»Ğ¸ Ğ¾Ğ´Ğ½Ğ¾Ğ¹ Ñ€ÑƒĞºĞ¾Ğ¹ (ÑĞ¿Ğ¸Ğ½Ğ°)\n\n"
            "âœ… ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ°\n"
            "â€¢ Ğ£Ğ¿Ñ€Ğ¸ÑÑŒ ĞºĞ¾Ğ»ĞµĞ½Ğ¾Ğ¼ Ğ¸ Ñ€ÑƒĞºĞ¾Ğ¹ Ğ² ÑĞºĞ°Ğ¼ÑŒÑ, ÑĞ¿Ğ¸Ğ½Ğ° Ğ¿Ğ°Ñ€Ğ°Ğ»Ğ»ĞµĞ»ÑŒĞ½Ğ° Ğ¿Ğ¾Ğ»Ñƒ.\n\n"
            "âœ… ĞšĞ°Ğº Ğ´ĞµĞ»Ğ°Ñ‚ÑŒ\n"
            "1) Ğ¢ÑĞ½Ğ¸ Ğ³Ğ°Ğ½Ñ‚ĞµĞ»ÑŒ Ğº Ğ¿Ğ¾ÑÑÑƒ, Ğ»Ğ¾ĞºĞ¾Ñ‚ÑŒ Ğ²Ğ´Ğ¾Ğ»ÑŒ Ñ‚ĞµĞ»Ğ°.\n"
            "2) Ğ’ Ğ²ĞµÑ€Ñ…Ğ½ĞµĞ¹ Ñ‚Ğ¾Ñ‡ĞºĞµ â€” Ğ»Ğ¾Ğ¿Ğ°Ñ‚ĞºĞ° ÑĞ²ĞµĞ´ĞµĞ½Ğ°, Ğ¿Ğ°ÑƒĞ·Ğ°.\n"
            "3) ĞĞ¿ÑƒÑĞºĞ°Ğ¹ Ğ¼ĞµĞ´Ğ»ĞµĞ½Ğ½Ğ¾ Ğ´Ğ¾ Ğ¿Ğ¾Ğ»Ğ½Ğ¾Ğ³Ğ¾ Ñ€Ğ°ÑÑ‚ÑĞ¶ĞµĞ½Ğ¸Ñ.\n\n"
            "âš ï¸ Ğ§Ğ°ÑÑ‚Ñ‹Ğµ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸\n"
            "â€¢ Ğ Ğ¾Ñ‚Ğ°Ñ†Ğ¸Ñ ĞºĞ¾Ñ€Ğ¿ÑƒÑĞ° â†’ Ğ·Ğ°Ñ„Ğ¸ĞºÑĞ¸Ñ€ÑƒĞ¹ ĞºĞ¾Ñ€Ğ¿ÑƒÑ.\n"
            "â€¢ Ğ¢ÑĞ½ĞµÑˆÑŒ Ğ²Ğ²ĞµÑ€Ñ…, Ğ° Ğ½Ğµ Ğº Ğ¿Ğ¾ÑÑÑƒ â†’ Ğ¼ĞµĞ½ÑĞ¹ Ñ‚Ñ€Ğ°ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ñ.\n\n"
            "ğŸ’¡ ĞŸĞ¾Ğ´ÑĞºĞ°Ğ·ĞºĞ°\n"
            "ĞÑ‚Ğ»Ğ¸Ñ‡Ğ½Ğ¾Ğµ ÑƒĞ¿Ñ€Ğ°Ğ¶Ğ½ĞµĞ½Ğ¸Ğµ Ğ´Ğ»Ñ Ğ°ÑĞ¸Ğ¼Ğ¼ĞµÑ‚Ñ€Ğ¸Ğ¹ â€” ĞºĞ°Ğ¶Ğ´Ğ°Ñ ÑÑ‚Ğ¾Ñ€Ğ¾Ğ½Ğ° Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚ Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½Ğ¾."
        )
    },
    "band_row": {
        "title": "Ğ¢ÑĞ³Ğ° Ñ€ĞµĞ·Ğ¸Ğ½ĞºĞ¸",
        "img": "media/tech/latpulldown.jpg",
        "text": (
            "ğŸ“š Ğ¢ÑĞ³Ğ° Ñ€ĞµĞ·Ğ¸Ğ½ĞºĞ¸ Ğº Ğ¿Ğ¾ÑÑÑƒ (ÑĞ¿Ğ¸Ğ½Ğ° Ğ´Ğ¾Ğ¼Ğ°)\n\n"
            "âœ… ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ°\n"
            "â€¢ Ğ—Ğ°Ñ†ĞµĞ¿Ğ¸ Ñ€ĞµĞ·Ğ¸Ğ½ĞºÑƒ Ğ·Ğ° Ğ´Ğ²ĞµÑ€ÑŒ Ğ¸Ğ»Ğ¸ ÑÑ‚Ğ¾Ğ¹ĞºÑƒ Ğ½Ğ° ÑƒÑ€Ğ¾Ğ²Ğ½Ğµ Ğ¿Ğ¾ÑÑĞ°.\n"
            "â€¢ Ğ’ÑÑ‚Ğ°Ğ½ÑŒ Ñ€Ğ¾Ğ²Ğ½Ğ¾, Ğ»Ñ‘Ğ³ĞºĞ¸Ğ¹ Ğ½Ğ°ĞºĞ»Ğ¾Ğ½ Ğ²Ğ¿ĞµÑ€Ñ‘Ğ´.\n\n"
            "âœ… ĞšĞ°Ğº Ğ´ĞµĞ»Ğ°Ñ‚ÑŒ\n"
            "1) Ğ¢ÑĞ½Ğ¸ Ğ»Ğ¾ĞºÑ‚Ğ¸ Ğ½Ğ°Ğ·Ğ°Ğ´ Ğ¸ Ğº Ñ‚ĞµĞ»Ñƒ.\n"
            "2) Ğ¡Ğ²ĞµĞ´Ğ¸ Ğ»Ğ¾Ğ¿Ğ°Ñ‚ĞºĞ¸ Ğ² ĞºĞ¾Ğ½Ñ†Ğµ Ğ´Ğ²Ğ¸Ğ¶ĞµĞ½Ğ¸Ñ.\n"
            "3) ĞœĞµĞ´Ğ»ĞµĞ½Ğ½Ğ¾ Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°Ğ¹ÑÑ Ğ²Ğ¿ĞµÑ€Ñ‘Ğ´.\n\n"
            "âš ï¸ Ğ§Ğ°ÑÑ‚Ñ‹Ğµ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸\n"
            "â€¢ Ğ¢ÑĞ½ĞµÑˆÑŒ Ñ€ÑƒĞºĞ°Ğ¼Ğ¸ â†’ Ğ´ÑƒĞ¼Ğ°Ğ¹ Â«Ğ»Ğ¾ĞºÑ‚Ğ¸ Ğ½Ğ°Ğ·Ğ°Ğ´Â».\n"
            "â€¢ ĞšĞ¾Ñ€Ğ¿ÑƒÑ ÑƒÑ…Ğ¾Ğ´Ğ¸Ñ‚ Ğ½Ğ°Ğ·Ğ°Ğ´ â†’ Ğ´ĞµÑ€Ğ¶Ğ¸ ĞµĞ³Ğ¾ Ğ½ĞµĞ¿Ğ¾Ğ´Ğ²Ğ¸Ğ¶Ğ½Ñ‹Ğ¼.\n\n"
            "ğŸ’¡ ĞŸĞ¾Ğ´ÑĞºĞ°Ğ·ĞºĞ°\n"
            "Ğ’Ñ‹Ğ±Ğ¸Ñ€Ğ°Ğ¹ Ñ€ĞµĞ·Ğ¸Ğ½ĞºÑƒ, Ğ³Ğ´Ğµ 12â€“15 Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€Ğ¾Ğ² â€” Ñ‚ÑĞ¶ĞµĞ»Ğ¾, Ğ½Ğ¾ Ñ‚ĞµÑ…Ğ½Ğ¸ĞºĞ° Ğ½Ğµ Ğ»Ğ¾Ğ¼Ğ°ĞµÑ‚ÑÑ."
        )
    },
    "pike_pushup": {
        "title": "ĞŸĞ°Ğ¹Ğº-Ğ¾Ñ‚Ğ¶Ğ¸Ğ¼Ğ°Ğ½Ğ¸Ñ",
        "img": "media/tech/ohp.jpg",
        "text": (
            "ğŸ“š ĞŸĞ°Ğ¹Ğº-Ğ¾Ñ‚Ğ¶Ğ¸Ğ¼Ğ°Ğ½Ğ¸Ñ (Ğ¿Ğ»ĞµÑ‡Ğ¸ + Ñ‚Ñ€Ğ¸Ñ†ĞµĞ¿Ñ)\n\n"
            "âœ… ĞšĞ°Ğº Ğ´ĞµĞ»Ğ°Ñ‚ÑŒ\n"
            "1) Ğ’ÑÑ‚Ğ°Ğ½ÑŒ Ğ² Ğ¿Ğ¾Ğ·Ñƒ Ğ¿ĞµÑ€ĞµĞ²Ñ‘Ñ€Ğ½ÑƒÑ‚Ğ¾Ğ¹ V: Ñ‚Ğ°Ğ· Ğ²Ñ‹ÑĞ¾ĞºĞ¾, Ñ€ÑƒĞºĞ¸ Ğ¸ Ğ½Ğ¾Ğ³Ğ¸ Ğ¿Ñ€ÑĞ¼Ñ‹Ğµ.\n"
            "2) ĞĞ¿ÑƒÑĞºĞ°Ğ¹ Ğ³Ğ¾Ğ»Ğ¾Ğ²Ñƒ Ğº Ğ¿Ğ¾Ğ»Ñƒ, ÑĞ³Ğ¸Ğ±Ğ°Ñ Ğ»Ğ¾ĞºÑ‚Ğ¸.\n"
            "3) ĞÑ‚Ğ¾Ğ¶Ğ¼Ğ¸ÑÑŒ Ğ¾Ğ±Ñ€Ğ°Ñ‚Ğ½Ğ¾, Ğ½Ğµ Ğ¾Ğ¿ÑƒÑĞºĞ°Ñ Ñ‚Ğ°Ğ·.\n\n"
            "âš ï¸ Ğ§Ğ°ÑÑ‚Ñ‹Ğµ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸\n"
            "â€¢ Ğ¢Ğ°Ğ· Ğ¿Ñ€Ğ¾Ğ²Ğ°Ğ»Ğ¸Ğ²Ğ°ĞµÑ‚ÑÑ Ğ²Ğ½Ğ¸Ğ· â€” ÑÑ‚Ğ¾ ÑƒĞ¶Ğµ Ğ¾Ğ±Ñ‹Ñ‡Ğ½Ğ¾Ğµ Ğ¾Ñ‚Ğ¶Ğ¸Ğ¼Ğ°Ğ½Ğ¸Ğµ.\n"
            "â€¢ Ğ¡Ğ»Ğ¸ÑˆĞºĞ¾Ğ¼ ÑƒĞ·ĞºĞ¸Ğ¹ ÑƒĞ³Ğ¾Ğ» â†’ Ğ¿Ğ¾Ğ´Ğ½Ğ¸Ğ¼Ğ¸ Ñ‚Ğ°Ğ· Ğ²Ñ‹ÑˆĞµ.\n\n"
            "ğŸ’¡ ĞŸÑ€Ğ¾Ğ³Ñ€ĞµÑÑĞ¸Ñ\n"
            "ĞĞ¾Ğ³Ğ¸ Ğ½Ğ° Ğ²Ğ¾Ğ·Ğ²Ñ‹ÑˆĞµĞ½Ğ¸Ğµ â†’ Ğ±Ğ¾Ğ»ÑŒÑˆĞµ Ğ½Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸ Ğ½Ğ° Ğ¿Ğ»ĞµÑ‡Ğ¸."
        )
    },
    "band_ohp": {
        "title": "Ğ–Ğ¸Ğ¼ Ñ€ĞµĞ·Ğ¸Ğ½ĞºĞ¸ Ğ²Ğ²ĞµÑ€Ñ…",
        "img": "media/tech/ohp.jpg",
        "text": (
            "ğŸ“š Ğ–Ğ¸Ğ¼ Ñ€ĞµĞ·Ğ¸Ğ½ĞºĞ¸ Ğ²Ğ²ĞµÑ€Ñ… (Ğ¿Ğ»ĞµÑ‡Ğ¸ Ğ´Ğ¾Ğ¼Ğ°)\n\n"
            "âœ… ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ°\n"
            "â€¢ Ğ’ÑÑ‚Ğ°Ğ½ÑŒ Ğ½Ğ° Ñ€ĞµĞ·Ğ¸Ğ½ĞºÑƒ, Ğ´ĞµÑ€Ğ¶Ğ¸ ĞµÑ‘ Ğ½Ğ° ÑƒÑ€Ğ¾Ğ²Ğ½Ğµ Ğ¿Ğ»ĞµÑ‡ Ñ…Ğ²Ğ°Ñ‚Ğ¾Ğ¼ ÑĞ²ĞµÑ€Ñ…Ñƒ.\n\n"
            "âœ… ĞšĞ°Ğº Ğ´ĞµĞ»Ğ°Ñ‚ÑŒ\n"
            "1) Ğ–Ğ¼Ğ¸ Ñ€ĞµĞ·Ğ¸Ğ½ĞºÑƒ Ğ²ĞµÑ€Ñ‚Ğ¸ĞºĞ°Ğ»ÑŒĞ½Ğ¾ Ğ²Ğ²ĞµÑ€Ñ… Ğ´Ğ¾ Ğ²Ñ‹Ğ¿Ñ€ÑĞ¼Ğ»ĞµĞ½Ğ¸Ñ Ñ€ÑƒĞº.\n"
            "2) ĞŸÑ€ĞµÑÑ Ğ½Ğ°Ğ¿Ñ€ÑĞ¶Ñ‘Ğ½, Ğ½Ğµ Ğ¿Ñ€Ğ¾Ğ³Ğ¸Ğ±Ğ°Ğ¹ÑÑ Ğ² Ğ¿Ğ¾ÑÑĞ½Ğ¸Ñ†Ğµ.\n"
            "3) ĞœĞµĞ´Ğ»ĞµĞ½Ğ½Ğ¾ Ğ¾Ğ¿ÑƒÑĞºĞ°Ğ¹ Ğº Ğ¿Ğ»ĞµÑ‡Ğ°Ğ¼.\n\n"
            "âš ï¸ Ğ§Ğ°ÑÑ‚Ñ‹Ğµ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸\n"
            "â€¢ ĞŸÑ€Ğ¾Ğ³Ğ¸Ğ± Ğ¿Ğ¾ÑÑĞ½Ğ¸Ñ†Ñ‹ â†’ Ğ½Ğ°Ğ¿Ñ€ÑĞ³Ğ¸ ĞºĞ¾Ñ€Ğ¿ÑƒÑ.\n"
            "â€¢ Ğ›Ğ¾ĞºÑ‚Ğ¸ ÑƒÑ…Ğ¾Ğ´ÑÑ‚ Ğ²Ğ¿ĞµÑ€Ñ‘Ğ´ â†’ Ğ´ĞµÑ€Ğ¶Ğ¸ Ğ¸Ñ… Ğ¿Ğ¾Ğ´ Ğ·Ğ°Ğ¿ÑÑÑ‚ÑŒÑĞ¼Ğ¸.\n\n"
            "ğŸ’¡ ĞŸĞ¾Ğ´ÑĞºĞ°Ğ·ĞºĞ°\n"
            "ĞœĞ¾Ğ¶Ğ½Ğ¾ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ÑÑ‚ÑŒ ÑĞ¸Ğ´Ñ Ğ´Ğ»Ñ Ğ±Ğ¾Ğ»ÑŒÑˆĞµĞ¹ ÑÑ‚Ğ°Ğ±Ğ¸Ğ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸."
        )
    },
    "band_pull": {
        "title": "Ğ¢ÑĞ³Ğ° Ñ€ĞµĞ·Ğ¸Ğ½ĞºĞ¸ ÑĞ²ĞµÑ€Ñ…Ñƒ",
        "img": "media/tech/latpulldown.jpg",
        "text": (
            "ğŸ“š Ğ¢ÑĞ³Ğ° Ñ€ĞµĞ·Ğ¸Ğ½ĞºĞ¸ ÑĞ²ĞµÑ€Ñ…Ñƒ (ÑĞ¿Ğ¸Ğ½Ğ° Ğ´Ğ¾Ğ¼Ğ°)\n\n"
            "âœ… ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ°\n"
            "â€¢ Ğ—Ğ°Ñ†ĞµĞ¿Ğ¸ Ñ€ĞµĞ·Ğ¸Ğ½ĞºÑƒ Ğ·Ğ° Ğ²ĞµÑ€Ñ…Ğ½ÑÑ Ñ‚Ğ¾Ñ‡ĞºÑƒ (Ğ´Ğ²ĞµÑ€ÑŒ, Ñ‚ÑƒÑ€Ğ½Ğ¸Ğº).\n"
            "â€¢ Ğ¡ÑĞ´ÑŒ Ğ¸Ğ»Ğ¸ Ğ²ÑÑ‚Ğ°Ğ½ÑŒ, ÑĞ¿Ğ¸Ğ½Ğ° Ğ¿Ñ€ÑĞ¼Ğ°Ñ.\n\n"
            "âœ… ĞšĞ°Ğº Ğ´ĞµĞ»Ğ°Ñ‚ÑŒ\n"
            "1) ĞĞ°Ñ‡Ğ½Ğ¸ Ñ Ğ»Ğ¾Ğ¿Ğ°Ñ‚Ğ¾Ğº: Ğ¿Ğ¾Ñ‚ÑĞ½Ğ¸ Ğ¸Ñ… Ğ²Ğ½Ğ¸Ğ· Ğº ĞºĞ°Ñ€Ğ¼Ğ°Ğ½Ğ°Ğ¼.\n"
            "2) Ğ¢ÑĞ½Ğ¸ Ğ»Ğ¾ĞºÑ‚Ğ¸ Ğ²Ğ½Ğ¸Ğ· Ğ¸ Ğ½Ğ°Ğ·Ğ°Ğ´.\n"
            "3) Ğ ĞµĞ·Ğ¸Ğ½ĞºĞ° Ğº Ğ²ĞµÑ€Ñ…Ğ½ĞµĞ¹ Ñ‡Ğ°ÑÑ‚Ğ¸ Ğ³Ñ€ÑƒĞ´Ğ¸, Ğ¿Ğ°ÑƒĞ·Ğ°.\n"
            "4) ĞœĞµĞ´Ğ»ĞµĞ½Ğ½Ğ¾ Ğ²ĞµÑ€Ğ½Ğ¸ÑÑŒ Ğ²Ğ²ĞµÑ€Ñ….\n\n"
            "âš ï¸ Ğ§Ğ°ÑÑ‚Ñ‹Ğµ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸\n"
            "â€¢ Ğ¢ÑĞ½ĞµÑˆÑŒ Ñ€ÑƒĞºĞ°Ğ¼Ğ¸ â†’ Ğ»Ğ¾Ğ¿Ğ°Ñ‚ĞºĞ¸ Ğ²ĞµĞ´ÑƒÑ‚ Ğ´Ğ²Ğ¸Ğ¶ĞµĞ½Ğ¸Ğµ.\n"
            "â€¢ Ğ Ğ°ÑĞºĞ°Ñ‡ĞºĞ° â†’ Ğ·Ğ°Ñ„Ğ¸ĞºÑĞ¸Ñ€ÑƒĞ¹ ĞºĞ¾Ñ€Ğ¿ÑƒÑ.\n\n"
            "ğŸ’¡ ĞŸĞ¾Ğ´ÑĞºĞ°Ğ·ĞºĞ°\n"
            "ĞÑ‚Ğ»Ğ¸Ñ‡Ğ½Ğ°Ñ Ğ·Ğ°Ğ¼ĞµĞ½Ğ° Ğ²ĞµÑ€Ñ…Ğ½ĞµĞ¼Ñƒ Ğ±Ğ»Ğ¾ĞºÑƒ Ğ´Ğ»Ñ Ğ´Ğ¾Ğ¼Ğ°ÑˆĞ½Ğ¸Ñ… Ñ‚Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²Ğ¾Ğº."
        )
    },
    "good_morning": {
        "title": "Good Morning",
        "img": "media/tech/rdl.jpg",
        "text": (
            "ğŸ“š Good Morning (Ğ¿Ğ¾ÑÑĞ½Ğ¸Ñ†Ğ° + Ğ·Ğ°Ğ´Ğ½ÑÑ Ğ¿Ğ¾Ğ²ĞµÑ€Ñ…Ğ½Ğ¾ÑÑ‚ÑŒ Ğ±ĞµĞ´Ñ€Ğ°)\n\n"
            "âœ… ĞšĞ°Ğº Ğ´ĞµĞ»Ğ°Ñ‚ÑŒ\n"
            "1) ĞĞ¾Ğ³Ğ¸ Ğ½Ğ° ÑˆĞ¸Ñ€Ğ¸Ğ½Ğµ Ğ¿Ğ»ĞµÑ‡, Ñ€ÑƒĞºĞ¸ Ğ·Ğ° Ğ³Ğ¾Ğ»Ğ¾Ğ²Ğ¾Ğ¹.\n"
            "2) ĞĞµĞ±Ğ¾Ğ»ÑŒÑˆĞ¾Ğ¹ ÑĞ³Ğ¸Ğ± Ğ² ĞºĞ¾Ğ»ĞµĞ½ÑÑ…, Ğ½Ğ°ĞºĞ»Ğ¾Ğ½ Ğ²Ğ¿ĞµÑ€Ñ‘Ğ´ Ñ Ğ¿Ñ€ÑĞ¼Ğ¾Ğ¹ ÑĞ¿Ğ¸Ğ½Ğ¾Ğ¹.\n"
            "3) ĞĞ°ĞºĞ»Ğ¾Ğ½ÑĞ¹ÑÑ Ğ´Ğ¾ Ğ¿Ğ°Ñ€Ğ°Ğ»Ğ»ĞµĞ»Ğ¸ Ñ Ğ¿Ğ¾Ğ»Ğ¾Ğ¼ (Ğ¸Ğ»Ğ¸ Ğ´Ğ¾ Ğ½Ğ°Ñ‚ÑĞ¶ĞµĞ½Ğ¸Ñ Ğ² Ğ±Ñ‘Ğ´Ñ€Ğ°Ñ…).\n"
            "4) Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°Ğ¹ÑÑ, Ğ²Ñ‹Ñ‚Ğ°Ğ»ĞºĞ¸Ğ²Ğ°Ñ Ñ‚Ğ°Ğ· Ğ²Ğ¿ĞµÑ€Ñ‘Ğ´.\n\n"
            "âš ï¸ Ğ§Ğ°ÑÑ‚Ñ‹Ğµ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸\n"
            "â€¢ Ğ¡Ğ¿Ğ¸Ğ½Ğ° Ğ¾ĞºÑ€ÑƒĞ³Ğ»ÑĞµÑ‚ÑÑ â†’ ÑĞ´ĞµĞ»Ğ°Ğ¹ Ğ°Ğ¼Ğ¿Ğ»Ğ¸Ñ‚ÑƒĞ´Ñƒ Ğ¼ĞµĞ½ÑŒÑˆĞµ.\n"
            "â€¢ Ğ¡Ğ»Ğ¸ÑˆĞºĞ¾Ğ¼ Ñ‚ÑĞ¶ĞµĞ»Ğ¾ â†’ Ğ½Ğ°Ñ‡Ğ½Ğ¸ ÑĞ¾Ğ²ÑĞµĞ¼ Ğ±ĞµĞ· Ğ²ĞµÑĞ°.\n\n"
            "ğŸ’¡ Ğ’Ğ°Ğ¶Ğ½Ğ¾\n"
            "ĞÑ‡ĞµĞ½ÑŒ Ğ»Ñ‘Ğ³ĞºĞ¾Ğµ ÑƒĞ¿Ñ€Ğ°Ğ¶Ğ½ĞµĞ½Ğ¸Ğµ Ğ¿Ğ¾ Ğ²ĞµÑÑƒ â€” Ğ·Ğ´ĞµÑÑŒ Ğ²Ğ°Ğ¶Ğ½Ğ° Ñ‚ĞµÑ…Ğ½Ğ¸ĞºĞ°, Ğ½Ğµ Ğ½Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ°."
        )
    },
    "face_pull": {
        "title": "Face Pull",
        "img": "media/tech/lateralraise.jpg",
        "text": (
            "ğŸ“š Face Pull / Ğ¢ÑĞ³Ğ° Ğº Ğ»Ğ¸Ñ†Ñƒ (Ğ·Ğ°Ğ´Ğ½ÑÑ Ğ´ĞµĞ»ÑŒÑ‚Ğ° + Ñ€Ğ¾Ñ‚Ğ°Ñ‚Ğ¾Ñ€Ñ‹)\n\n"
            "âœ… ĞšĞ°Ğº Ğ´ĞµĞ»Ğ°Ñ‚ÑŒ\n"
            "1) Ğ‘Ğ»Ğ¾Ğº/Ñ€ĞµĞ·Ğ¸Ğ½ĞºĞ° Ğ½Ğ° ÑƒÑ€Ğ¾Ğ²Ğ½Ğµ Ğ»Ğ¸Ñ†Ğ° Ğ¸Ğ»Ğ¸ Ñ‡ÑƒÑ‚ÑŒ Ğ²Ñ‹ÑˆĞµ.\n"
            "2) Ğ¢ÑĞ½Ğ¸ Ğº Ğ»Ğ¸Ñ†Ñƒ, Ğ»Ğ¾ĞºÑ‚Ğ¸ Ğ²Ñ‹ÑˆĞµ Ğ¿Ğ»ĞµÑ‡.\n"
            "3) Ğ’ ĞºĞ¾Ğ½Ñ†Ğµ Ñ€Ğ°Ğ·Ğ²ĞµĞ´Ğ¸ Ñ€ÑƒĞºĞ¸, ĞºĞ°Ğº Ğ±ÑƒĞ´Ñ‚Ğ¾ Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµÑˆÑŒ Â«Ğ´Ğ²Ğ¾Ğ¹Ğ½Ğ¾Ğ¹ Ğ±Ğ¸Ñ†ĞµĞ¿ÑÂ».\n"
            "4) ĞœĞµĞ´Ğ»ĞµĞ½Ğ½Ğ¾ Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°Ğ¹ÑÑ.\n\n"
            "âš ï¸ Ğ§Ğ°ÑÑ‚Ñ‹Ğµ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸\n"
            "â€¢ Ğ›Ğ¾ĞºÑ‚Ğ¸ Ğ½Ğ¸Ğ¶Ğµ Ğ¿Ğ»ĞµÑ‡ â†’ Ğ½Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° ÑƒÑ…Ğ¾Ğ´Ğ¸Ñ‚ ÑĞ¾ ÑÑ€ĞµĞ´Ğ½ĞµĞ¹ Ğ´ĞµĞ»ÑŒÑ‚Ñ‹.\n"
            "â€¢ Ğ Ğ°ÑĞºĞ°Ñ‡ĞºĞ° ĞºĞ¾Ñ€Ğ¿ÑƒÑĞ¾Ğ¼ â†’ ÑĞ½Ğ¸Ğ·ÑŒ Ğ²ĞµÑ.\n\n"
            "ğŸ’¡ ĞŸĞ¾Ğ´ÑĞºĞ°Ğ·ĞºĞ°\n"
            "ĞÑ‚Ğ»Ğ¸Ñ‡Ğ½Ğ°Ñ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»Ğ°ĞºÑ‚Ğ¸ĞºĞ° Ñ‚Ñ€Ğ°Ğ²Ğ¼ Ğ¿Ğ»ĞµÑ‡Ğ° â€” Ğ´ĞµĞ»Ğ°Ğ¹ Ñ€ĞµĞ³ÑƒĞ»ÑÑ€Ğ½Ğ¾."
        )
    },
    "rear_delt": {
        "title": "Ğ—Ğ°Ğ´Ğ½ÑÑ Ğ´ĞµĞ»ÑŒÑ‚Ğ°",
        "img": "media/tech/lateralraise.jpg",
        "text": (
            "ğŸ“š Ğ—Ğ°Ğ´Ğ½ÑÑ Ğ´ĞµĞ»ÑŒÑ‚Ğ° (Ğ³Ğ°Ğ½Ñ‚ĞµĞ»Ğ¸ Ğ¸Ğ»Ğ¸ Ñ‚Ñ€ĞµĞ½Ğ°Ğ¶Ñ‘Ñ€)\n\n"
            "âœ… ĞšĞ°Ğº Ğ´ĞµĞ»Ğ°Ñ‚ÑŒ (Ğ³Ğ°Ğ½Ñ‚ĞµĞ»Ğ¸ Ğ² Ğ½Ğ°ĞºĞ»Ğ¾Ğ½Ğµ)\n"
            "1) ĞĞ°ĞºĞ»Ğ¾Ğ½ ĞºĞ¾Ñ€Ğ¿ÑƒÑĞ° 45â€“90Â°, Ğ³Ğ°Ğ½Ñ‚ĞµĞ»Ğ¸ ÑĞ²Ğ¸ÑĞ°ÑÑ‚ Ğ²Ğ½Ğ¸Ğ·.\n"
            "2) Ğ Ğ°Ğ·Ğ²Ğ¾Ğ´Ğ¸ Ñ€ÑƒĞºĞ¸ Ğ² ÑÑ‚Ğ¾Ñ€Ğ¾Ğ½Ñ‹, Ğ»Ğ¾ĞºÑ‚Ğ¸ ÑĞ»ĞµĞ³ĞºĞ° ÑĞ¾Ğ³Ğ½ÑƒÑ‚Ñ‹.\n"
            "3) Ğ’ Ğ²ĞµÑ€Ñ…Ğ½ĞµĞ¹ Ñ‚Ğ¾Ñ‡ĞºĞµ â€” Ğ¿Ğ°ÑƒĞ·Ğ°, Ğ»Ğ¾Ğ¿Ğ°Ñ‚ĞºĞ¸ ÑĞ²ĞµĞ´ĞµĞ½Ñ‹.\n"
            "4) ĞœĞµĞ´Ğ»ĞµĞ½Ğ½Ğ¾ Ğ²Ğ½Ğ¸Ğ·.\n\n"
            "âš ï¸ Ğ§Ğ°ÑÑ‚Ñ‹Ğµ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸\n"
            "â€¢ ĞŸĞ¾Ğ´Ğ½Ğ¸Ğ¼Ğ°ĞµÑˆÑŒ Ğ¿Ğ»ĞµÑ‡Ğ¸ Ğº ÑƒÑˆĞ°Ğ¼ â†’ Ñ€Ğ°ÑÑĞ»Ğ°Ğ±ÑŒ Ğ¸Ñ… Ğ²Ğ½Ğ¸Ğ·.\n"
            "â€¢ Ğ¡Ğ»Ğ¸ÑˆĞºĞ¾Ğ¼ Ñ‚ÑĞ¶ĞµĞ»Ğ¾ â†’ Ğ½ĞµÑ‚ ĞºĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»Ñ Ğ² Ğ·Ğ°Ğ´Ğ½ĞµĞ¹ Ğ´ĞµĞ»ÑŒÑ‚Ğµ.\n\n"
            "ğŸ’¡ ĞŸĞ¾Ğ´ÑĞºĞ°Ğ·ĞºĞ°\n"
            "Ğ’ĞµÑ Ğ¼ĞµĞ½ÑŒÑˆĞµ, Ñ‡ĞµĞ¼ ĞºĞ°Ğ¶ĞµÑ‚ÑÑ Ğ½ÑƒĞ¶Ğ½Ñ‹Ğ¼ â€” Ğ·Ğ°Ğ´Ğ½ÑÑ Ğ´ĞµĞ»ÑŒÑ‚Ğ° Ğ¼Ğ°Ğ»ĞµĞ½ÑŒĞºĞ°Ñ Ğ¼Ñ‹ÑˆÑ†Ğ°."
        )
    },
    "hammer": {
        "title": "ĞœĞ¾Ğ»Ğ¾Ñ‚ĞºĞ¸",
        "img": "media/tech/biceps.jpg",
        "text": (
            "ğŸ“š ĞœĞ¾Ğ»Ğ¾Ñ‚ĞºĞ¸ (Ğ±Ğ¸Ñ†ĞµĞ¿Ñ + Ğ±Ñ€Ğ°Ñ…Ğ¸Ğ°Ğ»Ğ¸Ñ)\n\n"
            "âœ… ĞšĞ°Ğº Ğ´ĞµĞ»Ğ°Ñ‚ÑŒ\n"
            "1) Ğ”ĞµÑ€Ğ¶Ğ¸ Ğ³Ğ°Ğ½Ñ‚ĞµĞ»Ğ¸ Ğ½ĞµĞ¹Ñ‚Ñ€Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¼ Ñ…Ğ²Ğ°Ñ‚Ğ¾Ğ¼ (Ğ»Ğ°Ğ´Ğ¾Ğ½Ğ¸ Ğ´Ñ€ÑƒĞ³ Ğº Ğ´Ñ€ÑƒĞ³Ñƒ).\n"
            "2) Ğ¡Ğ³Ğ¸Ğ±Ğ°Ğ¹ Ğ´Ğ¾ Ğ¿Ğ¸ĞºĞ°, Ğ»Ğ¾ĞºÑ‚Ğ¸ Ñƒ ĞºĞ¾Ñ€Ğ¿ÑƒÑĞ°.\n"
            "3) ĞœĞµĞ´Ğ»ĞµĞ½Ğ½Ğ¾ Ğ¾Ğ¿ÑƒÑĞºĞ°Ğ¹, Ğ¿Ğ¾Ğ»Ğ½Ğ°Ñ Ğ°Ğ¼Ğ¿Ğ»Ğ¸Ñ‚ÑƒĞ´Ğ°.\n\n"
            "âš ï¸ Ğ§Ğ°ÑÑ‚Ñ‹Ğµ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸\n"
            "â€¢ Ğ Ğ°ÑĞºĞ°Ñ‡ĞºĞ° ĞºĞ¾Ñ€Ğ¿ÑƒÑĞ¾Ğ¼ â†’ ÑĞ½Ğ¸Ğ·ÑŒ Ğ²ĞµÑ.\n"
            "â€¢ Ğ›Ğ¾ĞºÑ‚Ğ¸ ÑƒĞµĞ·Ğ¶Ğ°ÑÑ‚ Ğ²Ğ¿ĞµÑ€Ñ‘Ğ´ â†’ Ğ·Ğ°Ñ„Ğ¸ĞºÑĞ¸Ñ€ÑƒĞ¹ Ğ¸Ñ… Ñƒ Ğ±Ñ‘Ğ´ĞµÑ€.\n\n"
            "ğŸ’¡ ĞŸĞ¾Ğ´ÑĞºĞ°Ğ·ĞºĞ°\n"
            "ĞœĞ¾Ğ»Ğ¾Ñ‚ĞºĞ¸ Ğ»ÑƒÑ‡ÑˆĞµ Ğ¿Ñ€Ğ¾Ñ€Ğ°Ğ±Ğ°Ñ‚Ñ‹Ğ²Ğ°ÑÑ‚ Ğ±Ñ€Ğ°Ñ…Ğ¸Ğ°Ğ»Ğ¸Ñ â€” Ğ´ĞµĞ»Ğ°ĞµÑ‚ Ñ€ÑƒĞºÑƒ Ğ²Ğ¸Ğ·ÑƒĞ°Ğ»ÑŒĞ½Ğ¾ Ñ‚Ğ¾Ğ»Ñ‰Ğµ."
        )
    },
    "triceps_oh": {
        "title": "Ğ Ğ°Ğ·Ğ³Ğ¸Ğ±Ğ°Ğ½Ğ¸Ğµ Ñ‚Ñ€Ğ¸Ñ†ĞµĞ¿ÑĞ° Ğ¸Ğ·-Ğ·Ğ° Ğ³Ğ¾Ğ»Ğ¾Ğ²Ñ‹",
        "img": "media/tech/triceps.jpg",
        "text": (
            "ğŸ“š Ğ Ğ°Ğ·Ğ³Ğ¸Ğ±Ğ°Ğ½Ğ¸Ğµ Ñ‚Ñ€Ğ¸Ñ†ĞµĞ¿ÑĞ° Ğ¸Ğ·-Ğ·Ğ° Ğ³Ğ¾Ğ»Ğ¾Ğ²Ñ‹ (Ğ´Ğ»Ğ¸Ğ½Ğ½Ğ°Ñ Ğ³Ğ¾Ğ»Ğ¾Ğ²ĞºĞ°)\n\n"
            "âœ… ĞšĞ°Ğº Ğ´ĞµĞ»Ğ°Ñ‚ÑŒ\n"
            "1) Ğ”ĞµÑ€Ğ¶Ğ¸ Ğ³Ğ°Ğ½Ñ‚ĞµĞ»ÑŒ Ğ´Ğ²ÑƒĞ¼Ñ Ñ€ÑƒĞºĞ°Ğ¼Ğ¸, Ğ¿Ğ¾Ğ´Ğ½Ğ¸Ğ¼Ğ¸ Ğ½Ğ°Ğ´ Ğ³Ğ¾Ğ»Ğ¾Ğ²Ğ¾Ğ¹.\n"
            "2) ĞĞ¿ÑƒÑÑ‚Ğ¸ Ğ·Ğ° Ğ³Ğ¾Ğ»Ğ¾Ğ²Ñƒ, Ğ»Ğ¾ĞºÑ‚Ğ¸ ÑĞ¼Ğ¾Ñ‚Ñ€ÑÑ‚ Ğ²Ğ²ĞµÑ€Ñ….\n"
            "3) Ğ Ğ°Ğ·Ğ³Ğ¸Ğ±Ğ°Ğ¹ Ğ´Ğ¾ Ğ¿Ñ€ÑĞ¼Ñ‹Ñ… Ñ€ÑƒĞº, Ğ¼ĞµĞ´Ğ»ĞµĞ½Ğ½Ğ¾ Ğ¾Ğ¿ÑƒÑĞºĞ°Ğ¹.\n\n"
            "âš ï¸ Ğ§Ğ°ÑÑ‚Ñ‹Ğµ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸\n"
            "â€¢ Ğ›Ğ¾ĞºÑ‚Ğ¸ Ñ€Ğ°ÑÑ…Ğ¾Ğ´ÑÑ‚ÑÑ Ğ² ÑÑ‚Ğ¾Ñ€Ğ¾Ğ½Ñ‹ â†’ Ğ´ĞµÑ€Ğ¶Ğ¸ Ğ¸Ñ… ÑƒĞ·ĞºĞ¾.\n"
            "â€¢ Ğ¨ĞµÑ Ğ½Ğ°Ğ¿Ñ€ÑĞ³Ğ°ĞµÑ‚ÑÑ â†’ Ñ€Ğ°ÑÑĞ»Ğ°Ğ±ÑŒ Ğ³Ğ¾Ğ»Ğ¾Ğ²Ñƒ Ğ²Ğ¿ĞµÑ€Ñ‘Ğ´.\n\n"
            "ğŸ’¡ ĞŸĞ¾Ğ´ÑĞºĞ°Ğ·ĞºĞ°\n"
            "Ğ”Ğ»Ğ¸Ğ½Ğ½Ğ°Ñ Ğ³Ğ¾Ğ»Ğ¾Ğ²ĞºĞ° Ñ‚Ñ€Ğ¸Ñ†ĞµĞ¿ÑĞ° Ğ»ÑƒÑ‡ÑˆĞµ Ñ€Ğ°ÑÑ‚ÑĞ³Ğ¸Ğ²Ğ°ĞµÑ‚ÑÑ â€” Ğ´ĞµĞ»Ğ°ĞµÑ‚ Ñ€ÑƒĞºÑƒ Â«Ğ¾Ğ±ÑŠÑ‘Ğ¼Ğ½ĞµĞµÂ»."
        )
    },
    "narrow_pushup": {
        "title": "ĞÑ‚Ğ¶Ğ¸Ğ¼Ğ°Ğ½Ğ¸Ñ ÑƒĞ·ĞºĞ¸Ğµ",
        "img": "media/tech/triceps.jpg",
        "text": (
            "ğŸ“š Ğ£Ğ·ĞºĞ¸Ğµ Ğ¾Ñ‚Ğ¶Ğ¸Ğ¼Ğ°Ğ½Ğ¸Ñ (Ñ‚Ñ€Ğ¸Ñ†ĞµĞ¿Ñ)\n\n"
            "âœ… ĞšĞ°Ğº Ğ´ĞµĞ»Ğ°Ñ‚ÑŒ\n"
            "1) Ğ›Ğ°Ğ´Ğ¾Ğ½Ğ¸ Ğ¿Ğ¾Ğ´ Ğ³Ñ€ÑƒĞ´ÑŒÑ, Ğ±Ğ»Ğ¸Ğ·ĞºĞ¾ Ğ´Ñ€ÑƒĞ³ Ğº Ğ´Ñ€ÑƒĞ³Ñƒ (Ğ¸Ğ»Ğ¸ Ñ‚Ñ€ĞµÑƒĞ³Ğ¾Ğ»ÑŒĞ½Ğ¸ĞºĞ¾Ğ¼).\n"
            "2) Ğ¢ĞµĞ»Ğ¾ â€” Ğ¿Ñ€ÑĞ¼Ğ°Ñ Ğ»Ğ¸Ğ½Ğ¸Ñ, Ğ¿Ñ€ĞµÑÑ Ğ²ĞºĞ»ÑÑ‡Ñ‘Ğ½.\n"
            "3) ĞĞ¿ÑƒÑĞºĞ°Ğ¹ÑÑ, Ğ»Ğ¾ĞºÑ‚Ğ¸ Ğ¸Ğ´ÑƒÑ‚ Ğ½Ğ°Ğ·Ğ°Ğ´ Ğ²Ğ´Ğ¾Ğ»ÑŒ Ñ‚ĞµĞ»Ğ°.\n"
            "4) Ğ’Ñ‹Ğ¶Ğ¸Ğ¼Ğ°Ğ¹, Ñ„Ğ¾ĞºÑƒÑ Ğ½Ğ° Ñ‚Ñ€Ğ¸Ñ†ĞµĞ¿Ñ.\n\n"
            "âš ï¸ Ğ§Ğ°ÑÑ‚Ñ‹Ğµ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸\n"
            "â€¢ Ğ›Ğ¾ĞºÑ‚Ğ¸ Ğ² ÑÑ‚Ğ¾Ñ€Ğ¾Ğ½Ñ‹ â†’ ÑÑ‚Ğ¾ ÑƒĞ¶Ğµ Ğ¾Ğ±Ñ‹Ñ‡Ğ½Ñ‹Ğµ Ğ¾Ñ‚Ğ¶Ğ¸Ğ¼Ğ°Ğ½Ğ¸Ñ.\n"
            "â€¢ Ğ¢Ğ°Ğ· Ğ¿Ñ€Ğ¾Ğ²Ğ¸ÑĞ°ĞµÑ‚ â†’ Ğ½Ğ°Ğ¿Ñ€ÑĞ³Ğ¸ Ğ¿Ñ€ĞµÑÑ Ğ¸ ÑĞ³Ğ¾Ğ´Ğ¸Ñ†Ñ‹.\n\n"
            "ğŸ’¡ ĞŸĞ¾Ğ´ÑĞºĞ°Ğ·ĞºĞ°\n"
            "Ğ§ĞµĞ¼ ÑƒĞ¶Ğµ Ñ…Ğ²Ğ°Ñ‚, Ñ‚ĞµĞ¼ Ğ±Ğ¾Ğ»ÑŒÑˆĞµ Ğ½Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸ Ğ½Ğ° Ñ‚Ñ€Ğ¸Ñ†ĞµĞ¿Ñ â€” Ğ½Ğ¾ Ğ½Ğµ Ğ¿ĞµÑ€ĞµÑƒÑĞµÑ€Ğ´ÑÑ‚Ğ²ÑƒĞ¹."
        )
    },
    "hack_squat": {
        "title": "Ğ¥Ğ°ĞºĞº-Ğ¿Ñ€Ğ¸ÑĞµĞ´",
        "img": "media/tech/squat.jpg",
        "text": (
            "ğŸ“š Ğ¥Ğ°ĞºĞº-Ğ¿Ñ€Ğ¸ÑĞµĞ´ (ĞºĞ²Ğ°Ğ´Ñ€Ğ¸Ñ†ĞµĞ¿Ñ)\n\n"
            "âœ… ĞšĞ°Ğº Ğ´ĞµĞ»Ğ°Ñ‚ÑŒ\n"
            "1) Ğ’ Ñ‚Ñ€ĞµĞ½Ğ°Ğ¶Ñ‘Ñ€Ğµ: ÑĞ¿Ğ¸Ğ½Ğ° Ğ¿Ñ€Ğ¸Ğ¶Ğ°Ñ‚Ğ° Ğº Ğ¿Ğ¾Ğ´ÑƒÑˆĞºĞµ, ÑÑ‚Ğ¾Ğ¿Ñ‹ Ğ½Ğ° Ğ¿Ğ»Ğ°Ñ‚Ñ„Ğ¾Ñ€Ğ¼Ğµ.\n"
            "2) ĞĞ¿ÑƒÑĞºĞ°Ğ¹ Ğ¿Ğ»Ğ°Ñ‚Ñ„Ğ¾Ñ€Ğ¼Ñƒ Ğ´Ğ¾ 90Â° Ğ² ĞºĞ¾Ğ»ĞµĞ½ÑÑ… Ğ¸Ğ»Ğ¸ Ğ½Ğ¸Ğ¶Ğµ.\n"
            "3) Ğ–Ğ¼Ğ¸ Ğ²Ğ²ĞµÑ€Ñ… Ğ±ĞµĞ· Â«Ğ·Ğ°Ğ¼ĞºĞ°Â» Ğ² ĞºĞ¾Ğ»ĞµĞ½ÑÑ….\n\n"
            "âš ï¸ Ğ§Ğ°ÑÑ‚Ñ‹Ğµ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸\n"
            "â€¢ ĞŸĞ¾ÑÑĞ½Ğ¸Ñ†Ğ° Ğ¾Ñ‚Ñ€Ñ‹Ğ²Ğ°ĞµÑ‚ÑÑ Ğ¾Ñ‚ Ğ¿Ğ¾Ğ´ÑƒÑˆĞºĞ¸ â†’ ÑĞ½Ğ¸Ğ·ÑŒ Ğ°Ğ¼Ğ¿Ğ»Ğ¸Ñ‚ÑƒĞ´Ñƒ.\n"
            "â€¢ ĞšĞ¾Ğ»ĞµĞ½Ğ¸ Ğ²Ğ½ÑƒÑ‚Ñ€ÑŒ â†’ ÑĞ»ĞµĞ´Ğ¸ Ğ·Ğ° Ñ‚Ñ€Ğ°ĞµĞºÑ‚Ğ¾Ñ€Ğ¸ĞµĞ¹.\n\n"
            "ğŸ’¡ ĞŸĞ¾Ğ´ÑĞºĞ°Ğ·ĞºĞ°\n"
            "Ğ¡Ñ‚Ğ¾Ğ¿Ñ‹ Ğ²Ñ‹ÑˆĞµ = Ğ±Ğ¾Ğ»ÑŒÑˆĞµ Ğ½Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸ Ğ½Ğ° ÑĞ³Ğ¾Ğ´Ğ¸Ñ†Ñ‹. ĞĞ¸Ğ¶Ğµ = Ğ±Ğ¾Ğ»ÑŒÑˆĞµ Ğ½Ğ° ĞºĞ²Ğ°Ğ´Ñ€Ğ¸Ñ†ĞµĞ¿Ñ."
        )
    },
    "bulgarian": {
        "title": "Ğ‘Ğ¾Ğ»Ğ³Ğ°Ñ€ÑĞºĞ¸Ğµ Ğ²Ñ‹Ğ¿Ğ°Ğ´Ñ‹",
        "img": "media/tech/squat.jpg",
        "text": (
            "ğŸ“š Ğ‘Ğ¾Ğ»Ğ³Ğ°Ñ€ÑĞºĞ¸Ğµ Ğ²Ñ‹Ğ¿Ğ°Ğ´Ñ‹ (Ğ½Ğ¾Ğ³Ğ¸ + ÑĞ³Ğ¾Ğ´Ğ¸Ñ†Ñ‹)\n\n"
            "âœ… ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ°\n"
            "â€¢ Ğ—Ğ°Ğ´Ğ½ÑÑ Ğ½Ğ¾Ğ³Ğ° Ğ½Ğ° ÑĞºĞ°Ğ¼ÑŒĞµ, Ğ¿ĞµÑ€ĞµĞ´Ğ½ÑÑ â€” Ğ½Ğ° ÑˆĞ°Ğ³ Ğ²Ğ¿ĞµÑ€Ñ‘Ğ´.\n\n"
            "âœ… ĞšĞ°Ğº Ğ´ĞµĞ»Ğ°Ñ‚ÑŒ\n"
            "1) ĞĞ¿ÑƒÑĞºĞ°Ğ¹ÑÑ Ğ²ĞµÑ€Ñ‚Ğ¸ĞºĞ°Ğ»ÑŒĞ½Ğ¾, Ğ·Ğ°Ğ´Ğ½ĞµĞµ ĞºĞ¾Ğ»ĞµĞ½Ğ¾ Ğº Ğ¿Ğ¾Ğ»Ñƒ.\n"
            "2) ĞŸĞµÑ€ĞµĞ´Ğ½ĞµĞµ ĞºĞ¾Ğ»ĞµĞ½Ğ¾ Ğ½Ğµ Ğ²Ñ‹Ñ…Ğ¾Ğ´Ğ¸Ñ‚ Ğ·Ğ° Ğ½Ğ¾ÑĞ¾Ğº.\n"
            "3) Ğ’Ñ‹Ñ‚Ğ°Ğ»ĞºĞ¸Ğ²Ğ°Ğ¹ÑÑ Ğ¿ĞµÑ€ĞµĞ´Ğ½ĞµĞ¹ Ğ½Ğ¾Ğ³Ğ¾Ğ¹ Ğ²Ğ²ĞµÑ€Ñ….\n\n"
            "âš ï¸ Ğ§Ğ°ÑÑ‚Ñ‹Ğµ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸\n"
            "â€¢ Ğ¨Ğ°Ğ³ ÑĞ»Ğ¸ÑˆĞºĞ¾Ğ¼ ĞºĞ¾Ñ€Ğ¾Ñ‚ĞºĞ¸Ğ¹ â†’ ĞºĞ¾Ğ»ĞµĞ½Ğ½Ñ‹Ğ¹ ÑÑƒÑÑ‚Ğ°Ğ² Ğ¿ĞµÑ€ĞµĞ³Ñ€ÑƒĞ¶Ğ°ĞµÑ‚ÑÑ.\n"
            "â€¢ ĞšĞ¾Ñ€Ğ¿ÑƒÑ Ğ·Ğ°Ğ²Ğ°Ğ»Ğ¸Ğ²Ğ°ĞµÑ‚ÑÑ â†’ Ğ´ĞµÑ€Ğ¶Ğ¸ Ğ³Ñ€ÑƒĞ´ÑŒ Ğ²ĞµÑ€Ñ‚Ğ¸ĞºĞ°Ğ»ÑŒĞ½Ğ¾.\n\n"
            "ğŸ’¡ ĞŸĞ¾Ğ´ÑĞºĞ°Ğ·ĞºĞ°\n"
            "Ğ¢ÑĞ¶ĞµĞ»ĞµĞµ Ğ¾Ğ±Ñ‹Ñ‡Ğ½Ñ‹Ñ… Ğ¿Ñ€Ğ¸ÑĞµĞ´Ğ°Ğ½Ğ¸Ğ¹ â€” Ğ½Ğ°Ñ‡Ğ½Ğ¸ Ğ±ĞµĞ· Ğ²ĞµÑĞ°."
        )
    },
    "deadlift": {
        "title": "Ğ¡Ñ‚Ğ°Ğ½Ğ¾Ğ²Ğ°Ñ Ñ‚ÑĞ³Ğ°",
        "img": "media/tech/rdl.jpg",
        "text": (
            "ğŸ“š Ğ¡Ñ‚Ğ°Ğ½Ğ¾Ğ²Ğ°Ñ Ñ‚ÑĞ³Ğ° (Ğ±Ğ°Ğ·Ğ¾Ğ²Ğ¾Ğµ ÑƒĞ¿Ñ€Ğ°Ğ¶Ğ½ĞµĞ½Ğ¸Ğµ)\n\n"
            "âœ… ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ°\n"
            "â€¢ Ğ¡Ñ‚Ğ¾Ğ¿Ñ‹ Ğ½Ğ° ÑˆĞ¸Ñ€Ğ¸Ğ½Ğµ Ğ±Ñ‘Ğ´ĞµÑ€, Ğ½Ğ¾ÑĞºĞ¸ Ñ‡ÑƒÑ‚ÑŒ Ğ½Ğ°Ñ€ÑƒĞ¶Ñƒ.\n"
            "â€¢ Ğ“Ñ€Ğ¸Ñ„ Ğ½Ğ°Ğ´ ÑĞµÑ€ĞµĞ´Ğ¸Ğ½Ğ¾Ğ¹ ÑÑ‚Ğ¾Ğ¿Ñ‹, Ñ…Ğ²Ğ°Ñ‚ Ñ‡ÑƒÑ‚ÑŒ ÑˆĞ¸Ñ€Ğµ Ğ±Ñ‘Ğ´ĞµÑ€.\n"
            "â€¢ Ğ›Ğ¾Ğ¿Ğ°Ñ‚ĞºĞ¸ Ğ¾Ğ¿ÑƒÑÑ‚Ğ¸ Ğ²Ğ½Ğ¸Ğ· Ğ¸ Ğ½Ğ°Ğ·Ğ°Ğ´.\n\n"
            "âœ… ĞšĞ°Ğº Ğ´ĞµĞ»Ğ°Ñ‚ÑŒ\n"
            "1) Ğ’Ğ´Ğ¾Ñ…, Ğ½Ğ°Ğ¿Ñ€ÑĞ³Ğ¸ ĞºĞ¾Ñ€Ğ¿ÑƒÑ â€” Â«Ğ¶Ğ¸Ğ²Ğ¾Ñ‚ Ğ² Ñ‚Ğ¾Ğ½ÑƒÑĞµÂ».\n"
            "2) Ğ¢Ğ¾Ğ»ĞºĞ°Ğ¹ Ğ¿Ğ¾Ğ» Ğ½Ğ¾Ğ³Ğ°Ğ¼Ğ¸, Ğ¾Ğ´Ğ½Ğ¾Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ğ¾ Ñ€Ğ°Ğ·Ğ³Ğ¸Ğ±Ğ°Ñ ÑĞ¿Ğ¸Ğ½Ñƒ.\n"
            "3) Ğ“Ñ€Ğ¸Ñ„ Ğ¸Ğ´Ñ‘Ñ‚ ÑÑ‚Ñ€Ğ¾Ğ³Ğ¾ Ğ²ĞµÑ€Ñ‚Ğ¸ĞºĞ°Ğ»ÑŒĞ½Ğ¾, Ğ±Ğ»Ğ¸Ğ·ĞºĞ¾ Ğº Ğ½Ğ¾Ğ³Ğ°Ğ¼.\n"
            "4) ĞĞ°Ğ²ĞµÑ€Ñ…Ñƒ â€” Ğ±Ñ‘Ğ´Ñ€Ğ° Ğ²Ğ¿ĞµÑ€Ñ‘Ğ´, Ğ±ĞµĞ· Ğ¿ĞµÑ€ĞµĞ³Ğ¸Ğ±Ğ° Ğ¿Ğ¾ÑÑĞ½Ğ¸Ñ†Ñ‹.\n"
            "5) ĞĞ¿ÑƒÑĞºĞ°Ğ¹ Ñ‚Ğ°Ğº Ğ¶Ğµ Ğ¿Ğ¾Ğ´ ĞºĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»ĞµĞ¼.\n\n"
            "âš ï¸ Ğ§Ğ°ÑÑ‚Ñ‹Ğµ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸\n"
            "â€¢ ĞĞºÑ€ÑƒĞ³Ğ»ĞµĞ½Ğ¸Ğµ Ğ¿Ğ¾ÑÑĞ½Ğ¸Ñ†Ñ‹ â†’ ÑĞ½Ğ¸Ğ·ÑŒ Ğ²ĞµÑ.\n"
            "â€¢ Ğ“Ñ€Ğ¸Ñ„ Ğ¾Ñ‚Ñ…Ğ¾Ğ´Ğ¸Ñ‚ Ğ¾Ñ‚ Ğ½Ğ¾Ğ³ â†’ Ñ‚ÑĞ½Ğ¸ Ğº ÑĞµĞ±Ğµ.\n"
            "â€¢ Ğ Ñ‹Ğ²Ğ¾Ğº Ñ Ğ¿Ğ¾Ğ»Ğ° â†’ Ğ¿Ğ»Ğ°Ğ²Ğ½Ñ‹Ğ¹ ÑÑ‚Ğ°Ñ€Ñ‚ Ñ ĞºĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»ĞµĞ¼.\n\n"
            "ğŸ’¡ Ğ’Ğ°Ğ¶Ğ½Ğ¾\n"
            "ĞĞ°Ñ‡Ğ¸Ğ½Ğ°Ğ¹ Ñ Ğ»Ñ‘Ğ³ĞºĞ¾Ğ³Ğ¾ Ğ²ĞµÑĞ° Ğ¸ Ğ¸Ğ´ĞµĞ°Ğ»ÑŒĞ½Ğ¾Ğ¹ Ñ‚ĞµÑ…Ğ½Ğ¸ĞºĞ¸."
        )
    },
    "barbell_row": {
        "title": "Ğ¢ÑĞ³Ğ° ÑˆÑ‚Ğ°Ğ½Ğ³Ğ¸ Ğ² Ğ½Ğ°ĞºĞ»Ğ¾Ğ½Ğµ",
        "img": "media/tech/latpulldown.jpg",
        "text": (
            "ğŸ“š Ğ¢ÑĞ³Ğ° ÑˆÑ‚Ğ°Ğ½Ğ³Ğ¸ Ğ² Ğ½Ğ°ĞºĞ»Ğ¾Ğ½Ğµ (ÑĞµÑ€ĞµĞ´Ğ¸Ğ½Ğ° ÑĞ¿Ğ¸Ğ½Ñ‹)\n\n"
            "âœ… ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ°\n"
            "â€¢ ĞĞ°ĞºĞ»Ğ¾Ğ½ 45Â°, ÑĞ¿Ğ¸Ğ½Ğ° Ğ¿Ñ€ÑĞ¼Ğ°Ñ, ÑˆÑ‚Ğ°Ğ½Ğ³Ğ° Ğ¿Ğ¾Ğ´ Ğ¿Ğ»ĞµÑ‡Ğ°Ğ¼Ğ¸.\n"
            "â€¢ Ğ¥Ğ²Ğ°Ñ‚ Ğ½ĞµĞ¼Ğ½Ğ¾Ğ³Ğ¾ ÑˆĞ¸Ñ€Ğµ Ğ¿Ğ»ĞµÑ‡ (Ğ¿Ñ€ÑĞ¼Ğ¾Ğ¹ Ğ¸Ğ»Ğ¸ Ğ¾Ğ±Ñ€Ğ°Ñ‚Ğ½Ñ‹Ğ¹).\n\n"
            "âœ… ĞšĞ°Ğº Ğ´ĞµĞ»Ğ°Ñ‚ÑŒ\n"
            "1) Ğ¢ÑĞ½Ğ¸ ÑˆÑ‚Ğ°Ğ½Ğ³Ñƒ Ğº Ğ¿Ğ¾ÑÑÑƒ, Ğ½Ğ°Ñ‡Ğ¸Ğ½Ğ°Ğ¹ Ñ Ğ»Ğ¾Ğ¿Ğ°Ñ‚Ğ¾Ğº.\n"
            "2) Ğ›Ğ¾ĞºÑ‚Ğ¸ Ğ¸Ğ´ÑƒÑ‚ Ğ²Ğ´Ğ¾Ğ»ÑŒ Ñ‚ĞµĞ»Ğ° Ğ½Ğ°Ğ·Ğ°Ğ´.\n"
            "3) ĞŸĞ°ÑƒĞ·Ğ° 1 ÑĞµĞº â€” Ğ»Ğ¾Ğ¿Ğ°Ñ‚ĞºĞ¸ ÑĞ²ĞµĞ´ĞµĞ½Ñ‹.\n"
            "4) ĞœĞµĞ´Ğ»ĞµĞ½Ğ½Ğ¾ Ğ¾Ğ¿ÑƒÑĞºĞ°Ğ¹ Ğ´Ğ¾ Ğ²Ñ‹Ğ¿Ñ€ÑĞ¼Ğ»ĞµĞ½Ğ¸Ñ Ñ€ÑƒĞº.\n\n"
            "âš ï¸ Ğ§Ğ°ÑÑ‚Ñ‹Ğµ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸\n"
            "â€¢ Ğ Ğ°ÑĞºĞ°Ñ‡ĞºĞ° ĞºĞ¾Ñ€Ğ¿ÑƒÑĞ¾Ğ¼ â†’ ÑĞ½Ğ¸Ğ·ÑŒ Ğ²ĞµÑ.\n"
            "â€¢ Ğ¢ÑĞ½ĞµÑˆÑŒ Ñ€ÑƒĞºĞ°Ğ¼Ğ¸ â†’ Ğ´ÑƒĞ¼Ğ°Ğ¹ Â«Ğ»Ğ¾ĞºÑ‚Ğ¸ Ğ½Ğ°Ğ·Ğ°Ğ´Â».\n\n"
            "ğŸ’¡ ĞŸĞ¾Ğ´ÑĞºĞ°Ğ·ĞºĞ°\n"
            "ĞĞ´Ğ½Ğ¾ Ğ¸Ğ· Ğ»ÑƒÑ‡ÑˆĞ¸Ñ… ÑƒĞ¿Ñ€Ğ°Ğ¶Ğ½ĞµĞ½Ğ¸Ğ¹ Ğ´Ğ»Ñ Ñ‚Ğ¾Ğ»Ñ‰Ğ¸Ğ½Ñ‹ ÑĞ¿Ğ¸Ğ½Ñ‹."
        )
    },
    "incline_press": {
        "title": "Ğ–Ğ¸Ğ¼ Ğ¿Ğ¾Ğ´ ÑƒĞ³Ğ»Ğ¾Ğ¼ (incline)",
        "img": "media/tech/bench.jpg",
        "text": (
            "ğŸ“š Ğ–Ğ¸Ğ¼ Ğ¿Ğ¾Ğ´ ÑƒĞ³Ğ»Ğ¾Ğ¼ (Ğ²ĞµÑ€Ñ… Ğ³Ñ€ÑƒĞ´Ğ¸ + Ğ¿ĞµÑ€ĞµĞ´Ğ½ÑÑ Ğ´ĞµĞ»ÑŒÑ‚Ğ°)\n\n"
            "âœ… ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ°\n"
            "â€¢ Ğ¡ĞºĞ°Ğ¼ÑŒÑ 30â€“45Â°, Ğ»Ğ¾Ğ¿Ğ°Ñ‚ĞºĞ¸ ÑĞ²ĞµĞ´ĞµĞ½Ñ‹ Ğ¸ Ğ¿Ñ€Ğ¸Ğ¶Ğ°Ñ‚Ñ‹.\n\n"
            "âœ… ĞšĞ°Ğº Ğ´ĞµĞ»Ğ°Ñ‚ÑŒ\n"
            "1) ĞĞ¿ÑƒÑĞºĞ°Ğ¹ Ğ³Ñ€Ğ¸Ñ„/Ğ³Ğ°Ğ½Ñ‚ĞµĞ»Ğ¸ Ğº Ğ²ĞµÑ€Ñ…Ğ½ĞµĞ¹ Ñ‡Ğ°ÑÑ‚Ğ¸ Ğ³Ñ€ÑƒĞ´Ğ¸.\n"
            "2) Ğ›Ğ¾ĞºÑ‚Ğ¸ ~45Â° Ğº ĞºĞ¾Ñ€Ğ¿ÑƒÑÑƒ.\n"
            "3) Ğ–Ğ¼Ğ¸ Ğ²Ğ²ĞµÑ€Ñ… Ğ¸ Ñ‡ÑƒÑ‚ÑŒ Ğ½Ğ°Ğ·Ğ°Ğ´ (Ğº ÑÑ‚Ğ¾Ğ¹ĞºĞ°Ğ¼).\n\n"
            "âš ï¸ Ğ§Ğ°ÑÑ‚Ñ‹Ğµ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸\n"
            "â€¢ Ğ£Ğ³Ğ¾Ğ» > 60Â° â†’ Ğ½Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° ÑƒÑ…Ğ¾Ğ´Ğ¸Ñ‚ Ğ½Ğ° Ğ¿Ğ»ĞµÑ‡Ğ¸.\n"
            "â€¢ ĞŸĞ»ĞµÑ‡Ğ¸ Ğ²Ğ¿ĞµÑ€Ñ‘Ğ´ â†’ ÑĞ½Ğ¾Ğ²Ğ° ÑĞ²ĞµĞ´Ğ¸ Ğ»Ğ¾Ğ¿Ğ°Ñ‚ĞºĞ¸.\n\n"
            "ğŸ’¡ ĞŸĞ¾Ğ´ÑĞºĞ°Ğ·ĞºĞ°\n"
            "ĞÑ‚Ğ»Ğ¸Ñ‡Ğ½Ğ¾ Ğ¿Ñ€Ğ¾Ñ€Ğ°Ğ±Ğ°Ñ‚Ñ‹Ğ²Ğ°ĞµÑ‚ Ğ²ĞµÑ€Ñ…Ğ½Ğ¸Ğ¹ Ğ¿ÑƒÑ‡Ğ¾Ğº Ğ³Ñ€ÑƒĞ´Ğ¸."
        )
    },
    "ohp_barbell": {
        "title": "Ğ–Ğ¸Ğ¼ ÑˆÑ‚Ğ°Ğ½Ğ³Ğ¸ ÑÑ‚Ğ¾Ñ (OHP)",
        "img": "media/tech/ohp.jpg",
        "text": (
            "ğŸ“š Ğ–Ğ¸Ğ¼ ÑˆÑ‚Ğ°Ğ½Ğ³Ğ¸ ÑÑ‚Ğ¾Ñ â€” Overhead Press\n\n"
            "âœ… ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ°\n"
            "â€¢ Ğ¥Ğ²Ğ°Ñ‚ Ñ‡ÑƒÑ‚ÑŒ ÑˆĞ¸Ñ€Ğµ Ğ¿Ğ»ĞµÑ‡, Ğ»Ğ¾ĞºÑ‚Ğ¸ Ğ½ĞµĞ¼Ğ½Ğ¾Ğ³Ğ¾ Ğ²Ğ¿ĞµÑ€Ñ‘Ğ´.\n"
            "â€¢ ĞŸÑ€ĞµÑÑ Ğ½Ğ°Ğ¿Ñ€ÑĞ¶Ñ‘Ğ½, ÑĞ³Ğ¾Ğ´Ğ¸Ñ†Ñ‹ Ğ²ĞºĞ»ÑÑ‡ĞµĞ½Ñ‹, Ğ½Ğ¾Ğ³Ğ¸ ÑƒÑÑ‚Ğ¾Ğ¹Ñ‡Ğ¸Ğ²Ğ¾.\n\n"
            "âœ… ĞšĞ°Ğº Ğ´ĞµĞ»Ğ°Ñ‚ÑŒ\n"
            "1) Ğ–Ğ¼Ğ¸ ÑˆÑ‚Ğ°Ğ½Ğ³Ñƒ Ğ²ĞµÑ€Ñ‚Ğ¸ĞºĞ°Ğ»ÑŒĞ½Ğ¾ Ğ²Ğ²ĞµÑ€Ñ….\n"
            "2) Ğ’ Ğ²ĞµÑ€Ñ…Ğ½ĞµĞ¹ Ñ‚Ğ¾Ñ‡ĞºĞµ Ğ³Ğ¾Ğ»Ğ¾Ğ²Ğ° Ğ²Ñ‹Ñ…Ğ¾Ğ´Ğ¸Ñ‚ Ğ²Ğ¿ĞµÑ€Ñ‘Ğ´ Â«Ğ² Ğ¾ĞºĞ½Ğ¾Â».\n"
            "3) ĞĞ¿ÑƒÑĞºĞ°Ğ¹ Ğ¼ĞµĞ´Ğ»ĞµĞ½Ğ½Ğ¾ Ğ¿Ğ¾Ğ´ ĞºĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»ĞµĞ¼.\n\n"
            "âš ï¸ Ğ§Ğ°ÑÑ‚Ñ‹Ğµ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸\n"
            "â€¢ ĞŸÑ€Ğ¾Ğ³Ğ¸Ğ± Ğ² Ğ¿Ğ¾ÑÑĞ½Ğ¸Ñ†Ğµ â†’ Ğ½Ğ°Ğ¿Ñ€ÑĞ³Ğ¸ Ğ¿Ñ€ĞµÑÑ.\n"
            "â€¢ Ğ›Ğ¾ĞºÑ‚Ğ¸ ÑƒÑ…Ğ¾Ğ´ÑÑ‚ Ğ½Ğ°Ğ·Ğ°Ğ´ â†’ Ğ´ĞµÑ€Ğ¶Ğ¸ Ğ¸Ñ… Ğ¿Ğ¾Ğ´ Ğ³Ñ€Ğ¸Ñ„Ğ¾Ğ¼.\n\n"
            "ğŸ’¡ Ğ‘Ğ°Ğ·Ğ¾Ğ²Ğ¾Ğµ ÑƒĞ¿Ñ€Ğ°Ğ¶Ğ½ĞµĞ½Ğ¸Ğµ Ğ´Ğ»Ñ Ğ¿Ğ»ĞµÑ‡ â€” Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµÑ‚ ÑˆĞ¸Ñ€Ğ¸Ğ½Ñƒ."
        )
    },
}


def tech_kb():
    rows = [
        [InlineKeyboardButton(text=TECH["squat"]["title"], callback_data="tech:squat"),
         InlineKeyboardButton(text=TECH["bench"]["title"], callback_data="tech:bench")],
        [InlineKeyboardButton(text=TECH["row"]["title"], callback_data="tech:row"),
         InlineKeyboardButton(text=TECH["latpulldown"]["title"], callback_data="tech:latpulldown")],
        [InlineKeyboardButton(text=TECH["pullup"]["title"], callback_data="tech:pullup"),
         InlineKeyboardButton(text=TECH["ohp"]["title"], callback_data="tech:ohp")],
        [InlineKeyboardButton(text=TECH["rdl"]["title"], callback_data="tech:rdl"),
         InlineKeyboardButton(text=TECH["lateralraise"]["title"], callback_data="tech:lateralraise")],
        [InlineKeyboardButton(text=TECH["biceps"]["title"], callback_data="tech:biceps"),
         InlineKeyboardButton(text=TECH["triceps"]["title"], callback_data="tech:triceps")],
        [InlineKeyboardButton(text=TECH["legpress"]["title"], callback_data="tech:legpress"),
         InlineKeyboardButton(text=TECH["hinge"]["title"], callback_data="tech:hinge")],
        [InlineKeyboardButton(text=TECH["core"]["title"], callback_data="tech:core"),
         InlineKeyboardButton(text=TECH["calves"]["title"], callback_data="tech:calves")],
        [InlineKeyboardButton(text=TECH["lunge"]["title"], callback_data="tech:lunge"),
         InlineKeyboardButton(text=TECH["hyperext"]["title"], callback_data="tech:hyperext")],
        [InlineKeyboardButton(text=TECH["face_pull"]["title"], callback_data="tech:face_pull"),
         InlineKeyboardButton(text=TECH["hammer"]["title"], callback_data="tech:hammer")],
        [InlineKeyboardButton(text="â¬…ï¸ ĞĞ°Ğ·Ğ°Ğ´ Ğº Ñ‚Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²ĞºĞ°Ğ¼", callback_data="nav:workouts")],
    ]
    return InlineKeyboardMarkup(inline_keyboard=rows)


def tech_back_kb():
    return InlineKeyboardMarkup(inline_keyboard=[
        [InlineKeyboardButton(text="â¬…ï¸ ĞĞ°Ğ·Ğ°Ğ´ Ğº ÑĞ¿Ğ¸ÑĞºÑƒ", callback_data="tech:list")],
    ])


# =========================
# âœ… ĞŸĞĞ¡Ğ¢ĞĞ¯ĞĞĞĞ¯ ĞšĞ›ĞĞ’Ğ˜ĞĞ¢Ğ£Ğ Ğ (2Ã—2)
# =========================
def control_reply_kb():
    return ReplyKeyboardMarkup(
        keyboard=[
            [KeyboardButton(text="âš™ï¸ ĞŸÑ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ"), KeyboardButton(text="ğŸ  ĞœĞµĞ½Ñ")],
            [KeyboardButton(text="ğŸ’³ ĞĞ¿Ğ»Ğ°Ñ‚Ğ°/Ğ´Ğ¾ÑÑ‚ÑƒĞ¿"), KeyboardButton(text="ğŸ†˜ ĞŸĞ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ°")],
        ],
        resize_keyboard=True,
        one_time_keyboard=False,
        input_field_placeholder="ĞšĞ½Ğ¾Ğ¿ĞºĞ¸ ÑĞ½Ğ¸Ğ·Ñƒ ğŸ‘‡"
    )


# =========================
# âœ… Inline Ğ¼ĞµĞ½Ñ Ñ€Ğ°Ğ·Ğ´ĞµĞ»Ğ¾Ğ²
# =========================
def menu_main_inline_kb():
    return InlineKeyboardMarkup(inline_keyboard=[
        [
            InlineKeyboardButton(text="ğŸ‹ï¸ ĞœĞ¾Ğ¸ Ñ‚Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²ĞºĞ¸", callback_data="nav:workouts"),
            InlineKeyboardButton(text="ğŸ½ ĞœĞ¾Ñ‘ Ğ¿Ğ¸Ñ‚Ğ°Ğ½Ğ¸Ğµ", callback_data="nav:nutrition"),
        ],
        [
            InlineKeyboardButton(text="ğŸ““ Ğ”Ğ½ĞµĞ²Ğ½Ğ¸Ğº", callback_data="nav:diary"),
            InlineKeyboardButton(text="ğŸ“ Ğ—Ğ°Ğ¼ĞµÑ€Ñ‹", callback_data="nav:measures"),
        ],
        [InlineKeyboardButton(text="ğŸ“¸ ĞšĞ°Ğ»Ğ¾Ñ€Ğ¸Ğ¸ Ğ¿Ğ¾ Ñ„Ğ¾Ñ‚Ğ¾", callback_data="food:start")],
        [InlineKeyboardButton(text="ğŸ”¥ Ğ£Ğ»ÑƒÑ‡ÑˆĞ¸Ñ‚ÑŒ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿", callback_data="nav:upgrade")],
        [InlineKeyboardButton(text="â“ ĞÑ‚Ğ²ĞµÑ‚Ñ‹ Ğ½Ğ° Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑÑ‹", callback_data="nav:faq")],
    ])


def simple_back_to_menu_inline_kb():
    return InlineKeyboardMarkup(inline_keyboard=[
        [InlineKeyboardButton(text="ğŸ  ĞœĞµĞ½Ñ", callback_data="nav:menu")],
    ])


# =========================
# âœ… Ğ¢Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²ĞºĞ¸: ĞºĞ½Ğ¾Ğ¿ĞºĞ¸ Ğ´Ğ½ĞµĞ¹
# =========================
def workout_days_kb(freq: int, has_full_access: bool = False):
    freq = max(MIN_DAYS, min(int(freq or 3), MAX_DAYS))
    rows = []
    btns = [InlineKeyboardButton(text=f"ğŸ“… Ğ”ĞµĞ½ÑŒ {i}", callback_data=f"wday:{i}") for i in range(1, freq + 1)]
    for i in range(0, len(btns), 2):
        rows.append(btns[i:i+2])

    rows.append([InlineKeyboardButton(text="ğŸ“Š Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ°", callback_data="wday:stats:0")])
    if has_full_access:
        rows.append([InlineKeyboardButton(text="ğŸ”„ Ğ¡Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ Ğ¿Ñ€Ğ¾Ğ³Ñ€Ğ°Ğ¼Ğ¼Ñƒ", callback_data="p:edit")])
    else:
        rows.append([InlineKeyboardButton(text="ğŸ”¥ ĞÑ‚ĞºÑ€Ñ‹Ñ‚ÑŒ Ğ¿Ğ¾Ğ»Ğ½Ñ‹Ğ¹ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿ (3 Ğ¼ĞµÑ)", callback_data="nav:upgrade")])
    rows.append([InlineKeyboardButton(text="ğŸ  ĞœĞµĞ½Ñ", callback_data="nav:menu")])
    return InlineKeyboardMarkup(inline_keyboard=rows)


# =========================
# Ğ®ĞšĞ°ÑÑĞ°: ĞºĞ½Ğ¾Ğ¿ĞºĞ¸
# =========================
def pay_tariff_kb():
    return InlineKeyboardMarkup(inline_keyboard=[
        [InlineKeyboardButton(text=f"ğŸŸ¢ ĞŸÑ€Ğ¾Ğ±Ğ½Ñ‹Ğ¹ â€” {TARIFFS['trial']['price']}â‚½ (3 Ğ´Ğ½Ñ)", callback_data="tariff:trial")],
        [InlineKeyboardButton(text=f"ğŸŸ© 1 Ğ¼ĞµÑÑÑ† â€” {TARIFFS['t1']['price']}â‚½ (Ğ¿Ğ¾Ğ¿Ñ€Ğ¾Ğ±Ğ¾Ğ²Ğ°Ñ‚ÑŒ)", callback_data="tariff:t1")],
        [InlineKeyboardButton(text=f"ğŸ”¥ 3 Ğ¼ĞµÑÑÑ†Ğ° â€” {TARIFFS['t3']['price']}â‚½ (Ğ»ÑƒÑ‡ÑˆĞ¸Ğ¹ Ğ²Ñ‹Ğ±Ğ¾Ñ€)", callback_data="tariff:t3")],
        [InlineKeyboardButton(text=f"ğŸ† ĞĞ°Ğ²ÑĞµĞ³Ğ´Ğ° â€” {TARIFFS['life']['price']}â‚½", callback_data="tariff:life")],
        [InlineKeyboardButton(text="ğŸ  ĞœĞµĞ½Ñ", callback_data="nav:menu")],
    ])


def admin_review_kb(payment_id: int):
    return InlineKeyboardMarkup(inline_keyboard=[
        [InlineKeyboardButton(text="âœ… ĞŸĞ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ´Ğ¸Ñ‚ÑŒ", callback_data=f"admin_approve:{payment_id}")],
        [InlineKeyboardButton(text="âŒ ĞÑ‚ĞºĞ»Ğ¾Ğ½Ğ¸Ñ‚ÑŒ", callback_data=f"admin_reject:{payment_id}")],
    ])


# =========================
# ĞŸÑ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ
# =========================
TOTAL_PROFILE_STEPS = 10


def _bar(step: int, total: int = TOTAL_PROFILE_STEPS, width: int = 10) -> str:
    step = max(0, min(step, total))
    pct = int(round(step / total * 100)) if total else 0
    filled = int(round(pct / 100 * width))
    filled = max(0, min(filled, width))
    return f"{'â– '*filled}{'â–¡'*(width-filled)} {pct}%"


def _profile_header(step: int) -> str:
    return f"ğŸ§© ĞŸÑ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ {step}/{TOTAL_PROFILE_STEPS}\n{_bar(step)}\n\n"


def profile_done_kb():
    return InlineKeyboardMarkup(inline_keyboard=[
        [InlineKeyboardButton(text="ğŸš€ Ğ¡Ğ¾Ğ±Ñ€Ğ°Ñ‚ÑŒ Ğ¿Ñ€Ğ¾Ğ³Ñ€Ğ°Ğ¼Ğ¼Ñƒ", callback_data="p:build_program")]
    ])


def profile_ready_kb():
    """ĞŸĞ¾ÑĞ»Ğµ Ğ·Ğ°Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ñ/Ğ¿Ñ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€Ğ° Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ğ¾Ğ³Ğ¾ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»Ñ."""
    return InlineKeyboardMarkup(inline_keyboard=[
        [InlineKeyboardButton(text="ğŸš€ Ğ¡Ğ¾Ğ±Ñ€Ğ°Ñ‚ÑŒ Ğ¿Ñ€Ğ¾Ğ³Ñ€Ğ°Ğ¼Ğ¼Ñƒ", callback_data="p:build_program")],
        [InlineKeyboardButton(text="âœï¸ Ğ˜Ğ·Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ", callback_data="p:edit")],
        [InlineKeyboardButton(text="ğŸ  ĞœĞµĞ½Ñ", callback_data="nav:menu")],
    ])


def profile_edit_field_kb(u: dict) -> InlineKeyboardMarkup:
    """ĞœĞµĞ½Ñ Ğ²Ñ‹Ğ±Ğ¾Ñ€Ğ° ĞºĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½Ğ¾Ğ³Ğ¾ Ğ¿Ğ¾Ğ»Ñ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»Ñ Ğ´Ğ»Ñ Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ â€” 2 ÑÑ‚Ğ¾Ğ»Ğ±Ñ†Ğ°."""
    def val(k, fallback="â€”"):
        v = u.get(k)
        return str(v) if v else fallback

    rows = [
        [
            InlineKeyboardButton(text=f"ğŸ¯ Ğ¦ĞµĞ»ÑŒ: {val('goal')}", callback_data="pf:goal"),
            InlineKeyboardButton(text=f"ğŸ‘¤ ĞŸĞ¾Ğ»: {val('sex')}", callback_data="pf:sex"),
        ],
        [
            InlineKeyboardButton(text=f"ğŸ‚ Ğ’Ğ¾Ğ·Ñ€Ğ°ÑÑ‚: {val('age')}", callback_data="pf:age"),
            InlineKeyboardButton(text=f"ğŸ“ Ğ Ğ¾ÑÑ‚: {val('height')} ÑĞ¼", callback_data="pf:height"),
        ],
        [
            InlineKeyboardButton(text=f"âš–ï¸ Ğ’ĞµÑ: {val('weight')} ĞºĞ³", callback_data="pf:weight"),
            InlineKeyboardButton(text=f"ğŸ  ĞœĞµÑÑ‚Ğ¾: {val('place')}", callback_data="pf:place"),
        ],
        [
            InlineKeyboardButton(text=f"ğŸ“ˆ ĞĞ¿Ñ‹Ñ‚: {val('exp')}", callback_data="pf:exp"),
            InlineKeyboardButton(text=f"ğŸ“… Ğ¢Ñ€ĞµĞ½/Ğ½ĞµĞ´: {val('freq')}", callback_data="pf:freq"),
        ],
        [
            InlineKeyboardButton(text=f"ğŸ½ ĞŸÑ€Ğ¸Ñ‘Ğ¼Ğ¾Ğ² ĞµĞ´Ñ‹: {val('meals')}", callback_data="pf:meals"),
            InlineKeyboardButton(text=f"â›”ï¸ ĞĞ³Ñ€Ğ°Ğ½Ğ¸Ñ‡ĞµĞ½Ğ¸Ñ", callback_data="pf:limits"),
        ],
        [InlineKeyboardButton(text="ğŸš€ Ğ¡Ğ³ĞµĞ½ĞµÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ½Ğ¾Ğ²Ñ‹Ğ¹ Ğ¿Ğ»Ğ°Ğ½", callback_data="p:rebuild_plan")],
        [InlineKeyboardButton(text="ğŸ  ĞĞ°Ğ·Ğ°Ğ´", callback_data="nav:menu")],
    ]
    return InlineKeyboardMarkup(inline_keyboard=rows)


def build_program_tariff_kb():
    """Ğ¢Ğ°Ñ€Ğ¸Ñ„Ğ½Ğ°Ñ ĞºĞ½Ğ¾Ğ¿ĞºĞ° Ğ¿Ğ¾ÑĞ»Ğµ Ğ·Ğ°Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ñ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»Ñ."""
    return InlineKeyboardMarkup(inline_keyboard=[
        [InlineKeyboardButton(
            text=f"ğŸŸ¢ ĞŸÑ€Ğ¾Ğ±Ğ½Ñ‹Ğ¹ â€” {TARIFFS['trial']['price']}â‚½ (3 Ğ´Ğ½Ñ)",
            callback_data="tariff:trial"
        )],
        [InlineKeyboardButton(
            text=f"ğŸŸ© ĞœĞµÑÑÑ‡Ğ½Ñ‹Ğ¹ â€” {TARIFFS['t1']['price']}â‚½",
            callback_data="tariff:t1"
        )],
        [InlineKeyboardButton(text="ğŸ  ĞœĞµĞ½Ñ", callback_data="nav:menu")],
    ])


def profile_view_kb():
    return InlineKeyboardMarkup(inline_keyboard=[
        [InlineKeyboardButton(text="ğŸš€ Ğ¡Ğ¾Ğ±Ñ€Ğ°Ñ‚ÑŒ Ğ¿Ñ€Ğ¾Ğ³Ñ€Ğ°Ğ¼Ğ¼Ñƒ", callback_data="p:build_program")],
        [InlineKeyboardButton(text="âœï¸ Ğ˜Ğ·Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ", callback_data="p:edit")],
        [InlineKeyboardButton(text="ğŸ  ĞœĞµĞ½Ñ", callback_data="nav:menu")],
    ])


def kb_goal():
    return InlineKeyboardMarkup(inline_keyboard=[
        [InlineKeyboardButton(text="ğŸ’ª ĞœĞ°ÑÑĞ°", callback_data="p:goal:mass"),
         InlineKeyboardButton(text="ğŸ”¥ Ğ¡ÑƒÑˆĞºĞ°", callback_data="p:goal:cut")],
        [InlineKeyboardButton(text="ğŸ‹ï¸ Ğ¡Ğ¸Ğ»Ğ°", callback_data="p:goal:strength"),
         InlineKeyboardButton(text="ğŸƒ Ğ’Ñ‹Ğ½Ğ¾ÑĞ»Ğ¸Ğ²Ğ¾ÑÑ‚ÑŒ", callback_data="p:goal:endurance")],
    ])


def kb_sex():
    return InlineKeyboardMarkup(inline_keyboard=[
        [InlineKeyboardButton(text="ğŸ‘¨ ĞœÑƒĞ¶Ñ‡Ğ¸Ğ½Ğ°", callback_data="p:sex:m"),
         InlineKeyboardButton(text="ğŸ‘© Ğ–ĞµĞ½Ñ‰Ğ¸Ğ½Ğ°", callback_data="p:sex:f")],
        [InlineKeyboardButton(text="â¬…ï¸ ĞĞ°Ğ·Ğ°Ğ´", callback_data="p:back:goal")],
    ])


def kb_place():
    return InlineKeyboardMarkup(inline_keyboard=[
        [InlineKeyboardButton(text="ğŸ  Ğ”Ğ¾Ğ¼Ğ°", callback_data="p:place:bodyweight"),
         InlineKeyboardButton(text="ğŸ‹ï¸ Ğ’ Ğ·Ğ°Ğ»Ğµ", callback_data="p:place:gym")],
        [InlineKeyboardButton(text="â¬…ï¸ ĞĞ°Ğ·Ğ°Ğ´", callback_data="p:back:weight")],
    ])


def kb_exp():
    return InlineKeyboardMarkup(inline_keyboard=[
        [InlineKeyboardButton(text="0 (Ğ½Ğ¾Ğ²Ğ¸Ñ‡Ğ¾Ğº)", callback_data="p:exp:0")],
        [InlineKeyboardButton(text="1â€“2 Ğ³Ğ¾Ğ´Ğ°", callback_data="p:exp:mid"),
         InlineKeyboardButton(text="2+ Ğ³Ğ¾Ğ´Ğ°", callback_data="p:exp:adv")],
        [InlineKeyboardButton(text="â¬…ï¸ ĞĞ°Ğ·Ğ°Ğ´", callback_data="p:back:place")],
    ])


def kb_freq():
    return InlineKeyboardMarkup(inline_keyboard=[
        [InlineKeyboardButton(text="3Ã—/Ğ½ĞµĞ´", callback_data="p:freq:3"),
         InlineKeyboardButton(text="4Ã—/Ğ½ĞµĞ´", callback_data="p:freq:4")],
        [InlineKeyboardButton(text="5Ã—/Ğ½ĞµĞ´", callback_data="p:freq:5")],
        [InlineKeyboardButton(text="â¬…ï¸ ĞĞ°Ğ·Ğ°Ğ´", callback_data="p:back:exp")],
    ])


def kb_meals():
    return InlineKeyboardMarkup(inline_keyboard=[
        [InlineKeyboardButton(text="3 Ñ€Ğ°Ğ·Ğ°", callback_data="p:meals:3"),
         InlineKeyboardButton(text="4 Ñ€Ğ°Ğ·Ğ°", callback_data="p:meals:4")],
        [InlineKeyboardButton(text="5 Ñ€Ğ°Ğ·", callback_data="p:meals:5")],
        [InlineKeyboardButton(text="â¬…ï¸ ĞĞ°Ğ·Ğ°Ğ´", callback_data="p:back:freq")],
    ])


def kb_text_step(back_to: str):
    return InlineKeyboardMarkup(inline_keyboard=[
        [InlineKeyboardButton(text="â¬…ï¸ ĞĞ°Ğ·Ğ°Ğ´", callback_data=f"p:back:{back_to}")],
    ])


# =========================
# Ğ£Ğ¢Ğ˜Ğ›Ğ˜Ğ¢Ğ«
# =========================
def dumps_plan(plan: dict) -> str:
    return json.dumps(plan, ensure_ascii=False)


def loads_plan(text: str) -> dict:
    try:
        return json.loads(text or "")
    except Exception:
        return {}


def weekday_schedule(freq: int) -> str:
    if freq <= 3:
        return "ĞŸĞ½/Ğ¡Ñ€/ĞŸÑ‚ (Ğ¸Ğ»Ğ¸ Ğ’Ñ‚/Ğ§Ñ‚/Ğ¡Ğ±)"
    if freq == 4:
        return "Ğ’ĞµÑ€Ñ…/ĞĞ¸Ğ· Ã—2 (Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€ ĞŸĞ½/Ğ’Ñ‚/Ğ§Ñ‚/Ğ¡Ğ±)"
    return "PPL + Ğ’ĞµÑ€Ñ…/ĞĞ¸Ğ· (Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€ ĞŸĞ½â€“ĞŸÑ‚)"


def gen_order_code(user_id: int) -> str:
    rnd = random.randint(100, 999)
    return f"TG{str(user_id)[-3:]}{rnd}"


def locked_text() -> str:
    return "ğŸ”’ Ğ”Ğ¾ÑÑ‚ÑƒĞ¿ Ğ¿Ğ¾ÑĞ»Ğµ Ğ¾Ğ¿Ğ»Ğ°Ñ‚Ñ‹.\nĞĞ°Ğ¶Ğ¼Ğ¸ ÑĞ½Ğ¸Ğ·Ñƒ: ğŸ’³ ĞĞ¿Ğ»Ğ°Ñ‚Ğ°/Ğ´Ğ¾ÑÑ‚ÑƒĞ¿"


def exp_level(exp: str) -> str:
    t = (exp or "").strip().lower()
    if t in ("0", "Ğ½Ğ¾Ğ²Ğ¸Ñ‡Ğ¾Ğº", "Ğ½Ğ¾Ğ²", "beginner"):
        return "novice"
    if "2+" in t or "2 +" in t or "2 Ğ³Ğ¾Ğ´Ğ°" in t or "3" in t or "4" in t or "5" in t:
        return "adv"
    return "mid"


def _activity_factor(freq: int, place: str) -> float:
    pl = (place or "").lower()
    is_gym = ("Ğ·Ğ°Ğ»" in pl) or (pl == "gym") or ("gym" in pl)
    f = int(freq or 3)

    if f <= 2:
        return 1.35
    if f == 3:
        return 1.45 if is_gym else 1.40
    if f == 4:
        return 1.55 if is_gym else 1.50
    return 1.65 if is_gym else 1.55


def calc_calories(height_cm: int, weight_kg: float, age: int, sex: str, goal: str, freq: int = 3, place: str = "ÑĞ²Ğ¾Ğ¹ Ğ²ĞµÑ") -> int:
    sx = (sex or "Ğ¼").lower()
    if sx == "Ğ¼":
        bmr = 10 * weight_kg + 6.25 * height_cm - 5 * age + 5
    else:
        bmr = 10 * weight_kg + 6.25 * height_cm - 5 * age - 161

    af = _activity_factor(int(freq or 3), place)
    tdee = bmr * af

    g = (goal or "").lower()
    if "Ğ¼Ğ°Ñ" in g:
        target = tdee * 1.10
    elif "ÑÑƒÑˆ" in g:
        target = tdee * 0.82
    elif "ÑĞ¸Ğ»" in g:
        target = tdee * 1.05
    elif "Ğ²Ñ‹Ğ½Ğ¾Ñ" in g:
        target = tdee * 0.98
    else:
        target = tdee * 1.00

    return int(round(target))


def calc_macros(calories: int, weight_kg: float, goal: str):
    g = (goal or "").lower()

    if "ÑÑƒÑˆ" in g:
        protein = int(round(weight_kg * 2.2))
    elif "Ğ²Ñ‹Ğ½Ğ¾Ñ" in g:
        protein = int(round(weight_kg * 1.7))
    elif "ÑĞ¸Ğ»" in g:
        protein = int(round(weight_kg * 1.9))
    else:
        protein = int(round(weight_kg * 1.8))

    if "Ğ²Ñ‹Ğ½Ğ¾Ñ" in g:
        fat = int(round(weight_kg * 0.7))
    else:
        fat = int(round(weight_kg * 0.8))

    carbs_kcal = max(calories - (protein * 4 + fat * 9), 0)
    carbs = int(round(carbs_kcal / 4))
    return protein, fat, carbs


def suggest_meals_count(calories: int) -> int:
    if calories >= 3200:
        return 5
    if calories >= 2600:
        return 4
    return 3


async def safe_send(message: Message, text: str, reply_markup=None):
    if not text:
        return
    t = text.strip()
    chunks = []
    while len(t) > TG_SAFE_MSG_LEN:
        cut = t.rfind("\n", 0, TG_SAFE_MSG_LEN)
        if cut == -1:
            cut = TG_SAFE_MSG_LEN
        chunks.append(t[:cut].strip())
        t = t[cut:].strip()
    if t:
        chunks.append(t)

    for i, ch in enumerate(chunks):
        await message.answer(ch, reply_markup=reply_markup if i == len(chunks) - 1 else None)


async def try_delete_user_message(bot: Bot, message: Message):
    try:
        await bot.delete_message(chat_id=message.chat.id, message_id=message.message_id)
    except Exception:
        pass


# =========================
# ĞĞĞ¢Ğ˜-Ğ—ĞĞ¡ĞĞ Ğ•ĞĞ˜Ğ• Ğ§ĞĞ¢Ğ
# =========================
async def get_last_bot_msg_id(user_id: int) -> Optional[int]:
    async with db() as conn:
        async with conn.execute("SELECT last_bot_msg_id FROM bot_state WHERE user_id=?", (user_id,)) as cur:
            row = await cur.fetchone()
    if not row:
        return None
    try:
        return int(row[0]) if row[0] is not None else None
    except Exception:
        return None


async def set_last_bot_msg_id(user_id: int, msg_id: int):
    async with db() as conn:
        await conn.execute("""
            INSERT INTO bot_state (user_id, last_bot_msg_id)
            VALUES (?, ?)
            ON CONFLICT(user_id) DO UPDATE SET last_bot_msg_id=excluded.last_bot_msg_id
        """, (user_id, int(msg_id)))
        await conn.commit()


async def get_diary_prompt_msg_id(user_id: int) -> Optional[int]:
    async with db() as conn:
        async with conn.execute("SELECT diary_prompt_msg_id FROM bot_state WHERE user_id=?", (user_id,)) as cur:
            row = await cur.fetchone()
    if not row:
        return None
    try:
        return int(row[0]) if row[0] is not None else None
    except Exception:
        return None


async def set_diary_prompt_msg_id(user_id: int, msg_id: Optional[int]):
    async with db() as conn:
        await conn.execute("""
            INSERT INTO bot_state (user_id, diary_prompt_msg_id)
            VALUES (?, ?)
            ON CONFLICT(user_id) DO UPDATE SET diary_prompt_msg_id=excluded.diary_prompt_msg_id
        """, (user_id, int(msg_id) if msg_id else None))
        await conn.commit()


async def clean_send(bot: Bot, chat_id: int, user_id: int, text: str, reply_markup=None):
    """Ğ£Ğ´Ğ°Ğ»ÑĞµÑ‚ Ğ¿Ñ€ĞµĞ´Ñ‹Ğ´ÑƒÑ‰ĞµĞµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ Ğ±Ğ¾Ñ‚Ğ° Ğ¸ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµÑ‚ Ğ½Ğ¾Ğ²Ğ¾Ğµ â€” Ñ‡Ğ°Ñ‚ Ğ½Ğµ Ğ·Ğ°ÑĞ¾Ñ€ÑĞµÑ‚ÑÑ."""
    last_id = await get_last_bot_msg_id(user_id)
    if last_id:
        try:
            await bot.delete_message(chat_id=chat_id, message_id=last_id)
        except Exception:
            pass
    m = await bot.send_message(chat_id=chat_id, text=text, reply_markup=reply_markup)
    await set_last_bot_msg_id(user_id, m.message_id)
    return m.message_id


async def clean_edit(callback: CallbackQuery, user_id: int, text: str, reply_markup=None):
    """Ğ ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€ÑƒĞµÑ‚ Ñ‚ĞµĞºÑƒÑ‰ĞµĞµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ (ĞµÑĞ»Ğ¸ Ğ½Ğµ ÑƒĞ´Ğ°Ñ‘Ñ‚ÑÑ â€” Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµÑ‚ Ğ½Ğ¾Ğ²Ğ¾Ğµ)."""
    try:
        await callback.message.edit_text(text, reply_markup=reply_markup)
        await set_last_bot_msg_id(user_id, callback.message.message_id)
    except Exception:
        await clean_send(callback.bot, callback.message.chat.id, user_id, text, reply_markup=reply_markup)


# =========================
# DB
# =========================
@asynccontextmanager
async def db():
    conn = await aiosqlite.connect(DB_PATH)
    try:
        await conn.execute("PRAGMA journal_mode=WAL;")
        await conn.execute("PRAGMA synchronous=NORMAL;")
        await conn.execute("PRAGMA foreign_keys=ON;")
        await conn.execute("PRAGMA busy_timeout=5000;")
        yield conn
    finally:
        await conn.close()


async def init_db():
    async with db() as conn:
        await conn.execute("""
        CREATE TABLE IF NOT EXISTS users (
            user_id INTEGER PRIMARY KEY,
            username TEXT,
            goal TEXT,
            sex TEXT,
            age INTEGER,
            height INTEGER,
            weight REAL,
            place TEXT,
            exp TEXT,
            freq INTEGER,
            meals INTEGER,
            limits TEXT,
            state TEXT,
            created_at TEXT
        )
        """)

        for col, typ in [
            ("limits", "TEXT"),
            ("state", "TEXT"),
            ("meals", "INTEGER"),
        ]:
            try:
                await conn.execute(f"ALTER TABLE users ADD COLUMN {col} {typ}")
            except Exception:
                pass

        await conn.execute("""
        CREATE TABLE IF NOT EXISTS access (
            user_id INTEGER PRIMARY KEY,
            paid INTEGER DEFAULT 0,
            tariff TEXT,
            expires_at TEXT,
            paid_at TEXT
        )
        """)
        await conn.execute("""
        CREATE TABLE IF NOT EXISTS payments (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            user_id INTEGER,
            tariff TEXT,
            amount INTEGER,
            last4 TEXT,
            code TEXT,
            status TEXT,
            receipt_file_id TEXT,
            created_at TEXT
        )
        """)

        await conn.execute("""
        CREATE TABLE IF NOT EXISTS workout_plans (
            user_id INTEGER PRIMARY KEY,
            plan_text TEXT,
            plan_json TEXT,
            updated_at TEXT
        )
        """)
        try:
            await conn.execute("ALTER TABLE workout_plans ADD COLUMN plan_json TEXT")
        except Exception:
            pass

        await conn.execute("""
        CREATE TABLE IF NOT EXISTS nutrition_plans (
            user_id INTEGER PRIMARY KEY,
            plan_text TEXT,
            updated_at TEXT
        )
        """)
        await conn.execute("""
        CREATE TABLE IF NOT EXISTS diary_sessions (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            user_id INTEGER,
            session_date TEXT,
            title TEXT,
            created_at TEXT
        )
        """)
        await conn.execute("""
        CREATE TABLE IF NOT EXISTS diary_sets (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            session_id INTEGER,
            exercise TEXT,
            set_no INTEGER,
            weight REAL,
            reps INTEGER
        )
        """)
        await conn.execute("""
        CREATE TABLE IF NOT EXISTS measurements (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            user_id INTEGER,
            mtype TEXT,
            value REAL,
            created_at TEXT
        )
        """)

        await conn.execute("""
        CREATE TABLE IF NOT EXISTS bot_state (
            user_id INTEGER PRIMARY KEY,
            last_bot_msg_id INTEGER,
            diary_prompt_msg_id INTEGER
        )
        """)
        for col, typ in [
            ("diary_prompt_msg_id", "INTEGER"),
        ]:
            try:
                await conn.execute(f"ALTER TABLE bot_state ADD COLUMN {col} {typ}")
            except Exception:
                pass

        await conn.execute("""
        CREATE TABLE IF NOT EXISTS posts (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            admin_id INTEGER,
            post_media_type TEXT,
            post_media_file_id TEXT,
            post_text TEXT,
            status TEXT,
            created_at TEXT
        )
        """)
        await conn.execute("""
        CREATE TABLE IF NOT EXISTS post_sends (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            post_id INTEGER,
            user_id INTEGER,
            status TEXT,
            error TEXT,
            created_at TEXT
        )
        """)
        await conn.execute("""
        CREATE TABLE IF NOT EXISTS workout_completions (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            user_id INTEGER,
            day_num INTEGER,
            completed_date TEXT,
            created_at TEXT
        )
        """)
        await conn.execute("""
        CREATE TABLE IF NOT EXISTS workout_day_progress (
            user_id INTEGER,
            day_num INTEGER,
            done_exercises TEXT,
            PRIMARY KEY (user_id, day_num)
        )
        """)
        await conn.commit()

    await db_init_food()


async def ensure_user(user_id: int, username: str):
    now = datetime.utcnow().isoformat()
    async with db() as conn:
        await conn.execute(
            "INSERT OR IGNORE INTO users (user_id, username, created_at) VALUES (?, ?, ?)",
            (user_id, username or "", now)
        )
        await conn.execute(
            "INSERT OR IGNORE INTO access (user_id, paid, tariff, expires_at, paid_at) VALUES (?, 0, NULL, NULL, NULL)",
            (user_id,)
        )
        await conn.execute(
            "INSERT OR IGNORE INTO bot_state (user_id, last_bot_msg_id, diary_prompt_msg_id) VALUES (?, NULL, NULL)",
            (user_id,)
        )
        await conn.commit()


async def get_user(user_id: int):
    async with db() as conn:
        async with conn.execute("""
            SELECT user_id, username, goal, sex, age, height, weight, place, exp, freq, meals, limits, state
            FROM users WHERE user_id=?
        """, (user_id,)) as cur:
            row = await cur.fetchone()

    if not row:
        return {}
    return {
        "user_id": row[0], "username": row[1], "goal": row[2], "sex": row[3],
        "age": row[4], "height": row[5], "weight": row[6], "place": row[7],
        "exp": row[8], "freq": row[9], "meals": row[10], "limits": row[11], "state": row[12]
    }


async def update_user(user_id: int, **fields):
    if not fields:
        return
    keys, vals = [], []
    for k, v in fields.items():
        keys.append(f"{k}=?")
        vals.append(v)
    vals.append(user_id)
    q = "UPDATE users SET " + ", ".join(keys) + " WHERE user_id=?"
    async with db() as conn:
        await conn.execute(q, tuple(vals))
        await conn.commit()


async def get_access(user_id: int):
    async with db() as conn:
        async with conn.execute(
            "SELECT paid, tariff, expires_at, paid_at FROM access WHERE user_id=?",
            (user_id,)
        ) as cur:
            row = await cur.fetchone()
    if not row:
        return {"paid": 0, "tariff": None, "expires_at": None, "paid_at": None}
    return {"paid": row[0], "tariff": row[1], "expires_at": row[2], "paid_at": row[3]}


async def is_access_active(user_id: int) -> bool:
    a = await get_access(user_id)
    if a["paid"] != 1:
        return False
    if a["tariff"] == "life":
        return True
    if not a["expires_at"]:
        return False
    try:
        exp = datetime.fromisoformat(a["expires_at"])
    except Exception:
        return False
    return datetime.utcnow() < exp


async def is_full_access_active(user_id: int) -> bool:
    """ĞŸĞ¾Ğ»Ğ½Ñ‹Ğ¹ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿: Ñ‚Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²ĞºĞ¸ + Ğ¿Ğ¸Ñ‚Ğ°Ğ½Ğ¸Ğµ (Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¿Ğ»Ğ°Ñ‚Ğ½Ñ‹Ğµ Ñ‚Ğ°Ñ€Ğ¸Ñ„Ñ‹, Ğ½Ğµ Ğ¿Ñ€Ğ¾Ğ±Ğ½Ñ‹Ğ¹)."""
    a = await get_access(user_id)
    if a["paid"] != 1:
        return False
    if not await is_access_active(user_id):
        return False
    return a.get("tariff") in FULL_ACCESS_TARIFFS


async def set_paid_tariff(user_id: int, tariff_code: str):
    t = TARIFFS.get(tariff_code)
    if not t:
        raise ValueError("Unknown tariff")
    now = datetime.utcnow()
    now_iso = now.isoformat()
    expires_at = None if t["days"] is None else (now + timedelta(days=int(t["days"]))).isoformat()

    async with db() as conn:
        await conn.execute(
            "UPDATE access SET paid=1, tariff=?, expires_at=?, paid_at=? WHERE user_id=?",
            (tariff_code, expires_at, now_iso, user_id)
        )
        await conn.commit()


async def save_workout_plan(user_id: int, text: str, plan_json: Optional[str] = None):
    now = datetime.utcnow().isoformat()
    async with db() as conn:
        await conn.execute("""
            INSERT INTO workout_plans (user_id, plan_text, plan_json, updated_at)
            VALUES (?, ?, ?, ?)
            ON CONFLICT(user_id) DO UPDATE SET
                plan_text=excluded.plan_text,
                plan_json=excluded.plan_json,
                updated_at=excluded.updated_at
        """, (user_id, text, plan_json or "", now))
        await conn.commit()


async def save_nutrition_plan(user_id: int, text: str):
    now = datetime.utcnow().isoformat()
    async with db() as conn:
        await conn.execute("""
            INSERT INTO nutrition_plans (user_id, plan_text, updated_at)
            VALUES (?, ?, ?)
            ON CONFLICT(user_id) DO UPDATE SET plan_text=excluded.plan_text, updated_at=excluded.updated_at
        """, (user_id, text, now))
        await conn.commit()


async def get_workout_plan(user_id: int):
    async with db() as conn:
        async with conn.execute("SELECT plan_text, plan_json FROM workout_plans WHERE user_id=?", (user_id,)) as cur:
            row = await cur.fetchone()
    if not row:
        return None, {}
    return (row[0] or ""), loads_plan(row[1] or "")


async def get_nutrition_plan(user_id: int):
    async with db() as conn:
        async with conn.execute("SELECT plan_text FROM nutrition_plans WHERE user_id=?", (user_id,)) as cur:
            row = await cur.fetchone()
    return row[0] if row else None


async def create_payment(user_id: int, tariff: str, amount: int, last4: str, code: str, receipt_file_id: str):
    now = datetime.utcnow().isoformat()
    async with db() as conn:
        cur = await conn.execute("""
            INSERT INTO payments (user_id, tariff, amount, last4, code, status, receipt_file_id, created_at)
            VALUES (?, ?, ?, ?, ?, 'pending', ?, ?)
        """, (user_id, tariff, amount, last4, code, receipt_file_id, now))
        await conn.commit()
        return cur.lastrowid


async def get_payment(payment_id: int):
    async with db() as conn:
        async with conn.execute("""
            SELECT id, user_id, tariff, amount, last4, code, status, receipt_file_id, created_at
            FROM payments WHERE id=?
        """, (payment_id,)) as cur:
            row = await cur.fetchone()
    if not row:
        return {}
    return {
        "id": row[0], "user_id": row[1], "tariff": row[2], "amount": row[3],
        "last4": row[4], "code": row[5], "status": row[6], "receipt_file_id": row[7], "created_at": row[8]
    }


async def set_payment_status(payment_id: int, status: str):
    async with db() as conn:
        await conn.execute("UPDATE payments SET status=? WHERE id=?", (status, payment_id))
        await conn.commit()


async def has_recent_pending_payment(user_id: int) -> bool:
    since = (datetime.utcnow() - timedelta(hours=2)).isoformat()
    async with db() as conn:
        async with conn.execute("""
            SELECT COUNT(*) FROM payments
            WHERE user_id=? AND status='pending' AND created_at>=?
        """, (user_id, since)) as cur:
            row = await cur.fetchone()
    return bool(row and row[0] > 0)


async def create_diary_session(user_id: int, session_date: str, title: str):
    now = datetime.utcnow().isoformat()
    async with db() as conn:
        cur = await conn.execute("""
            INSERT INTO diary_sessions (user_id, session_date, title, created_at)
            VALUES (?, ?, ?, ?)
        """, (user_id, session_date, title, now))
        await conn.commit()
        return cur.lastrowid


async def get_or_create_today_session(user_id: int) -> int:
    today = datetime.now().strftime("%Y-%m-%d")
    async with db() as conn:
        async with conn.execute("""
            SELECT id FROM diary_sessions
            WHERE user_id=? AND session_date=?
            ORDER BY id DESC LIMIT 1
        """, (user_id, today)) as cur:
            row = await cur.fetchone()
        if row:
            return int(row[0])

        title = f"Ğ¢Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²ĞºĞ° {today}"
        cur2 = await conn.execute("""
            INSERT INTO diary_sessions (user_id, session_date, title, created_at)
            VALUES (?, ?, ?, ?)
        """, (user_id, today, title, datetime.utcnow().isoformat()))
        await conn.commit()
        return int(cur2.lastrowid)


async def add_set(session_id: int, exercise: str, set_no: int, weight: float, reps: int):
    async with db() as conn:
        await conn.execute("""
            INSERT INTO diary_sets (session_id, exercise, set_no, weight, reps)
            VALUES (?, ?, ?, ?, ?)
        """, (session_id, exercise, set_no, weight, reps))
        await conn.commit()


async def get_diary_history(user_id: int, limit_sessions: int = 10):
    async with db() as conn:
        async with conn.execute("""
            SELECT id, session_date, title
            FROM diary_sessions
            WHERE user_id=?
            ORDER BY id DESC LIMIT ?
        """, (user_id, limit_sessions)) as cur:
            sessions = await cur.fetchall()

        out = []
        for s in sessions:
            sid = s[0]
            async with conn.execute("""
                SELECT exercise, set_no, weight, reps
                FROM diary_sets
                WHERE session_id=?
                ORDER BY id ASC
            """, (sid,)) as cur2:
                sets = await cur2.fetchall()
            out.append((s, sets))
    return out


async def add_measure(user_id: int, mtype: str, value: float):
    now = datetime.utcnow().isoformat()
    async with db() as conn:
        await conn.execute(
            "INSERT INTO measurements (user_id, mtype, value, created_at) VALUES (?, ?, ?, ?)",
            (user_id, mtype, value, now)
        )
        await conn.commit()


async def get_last_measures(user_id: int, mtype: str, limit: int = 8):
    async with db() as conn:
        async with conn.execute("""
            SELECT value, created_at
            FROM measurements
            WHERE user_id=? AND mtype=?
            ORDER BY id DESC LIMIT ?
        """, (user_id, mtype, limit)) as cur:
            rows = await cur.fetchall()
    return rows or []


async def get_last_measures_any(user_id: int, limit: int = 30):
    async with db() as conn:
        async with conn.execute("""
            SELECT mtype, value, created_at
            FROM measurements
            WHERE user_id=?
            ORDER BY id DESC LIMIT ?
        """, (user_id, limit)) as cur:
            rows = await cur.fetchall()
    return rows or []


async def create_post_draft(admin_id: int, media_type: str, media_file_id: Optional[str], text: Optional[str]) -> int:
    now = datetime.utcnow().isoformat()
    async with db() as conn:
        cur = await conn.execute("""
            INSERT INTO posts (admin_id, post_media_type, post_media_file_id, post_text, status, created_at)
            VALUES (?, ?, ?, ?, 'draft', ?)
        """, (admin_id, media_type, media_file_id or "", text or "", now))
        await conn.commit()
        return cur.lastrowid


async def get_post(post_id: int):
    async with db() as conn:
        async with conn.execute("""
            SELECT id, admin_id, post_media_type, post_media_file_id, post_text, status, created_at
            FROM posts WHERE id=?
        """, (post_id,)) as cur:
            row = await cur.fetchone()
    if not row:
        return {}
    return {
        "id": row[0], "admin_id": row[1], "media_type": row[2],
        "media_file_id": row[3], "text": row[4], "status": row[5], "created_at": row[6]
    }


async def set_post_status(post_id: int, status: str):
    async with db() as conn:
        await conn.execute("UPDATE posts SET status=? WHERE id=?", (status, post_id))
        await conn.commit()


async def get_all_user_ids():
    async with db() as conn:
        async with conn.execute("SELECT user_id FROM users") as cur:
            rows = await cur.fetchall()
    return [r[0] for r in rows] if rows else []


# =========================
# Ğ¢Ğ Ğ•ĞĞ˜Ğ ĞĞ’ĞšĞ˜: Ğ¿Ñ€Ğ¾Ğ³Ñ€ĞµÑÑ Ğ´Ğ½Ñ
# =========================

EXERCISE_TECH_MAP = [
    ("Ğ³Ğ¾Ğ±Ğ»ĞµÑ‚", "goblet"),
    ("Ñ…Ğ°ĞºĞº", "hack_squat"),
    ("Ğ±Ğ¾Ğ»Ğ³Ğ°Ñ€", "bulgarian"),
    ("Ğ²Ñ‹Ğ¿Ğ°Ğ´", "lunge"),
    ("ÑĞ³Ğ¾Ğ´Ğ¸Ñ‡Ğ½Ñ‹Ğ¹ Ğ¼Ğ¾ÑÑ‚", "hinge"),
    ("Ğ³Ğ¸Ğ¿ĞµÑ€ÑĞºÑÑ‚ĞµĞ½Ğ·Ğ¸", "hyperext"),
    ("ÑĞ³Ğ¸Ğ±Ğ°Ğ½Ğ¸Ñ Ğ½Ğ¾Ğ³", "legcurl"),
    ("Ğ¿Ğ¾Ğ´ÑŠÑ‘Ğ¼ Ğ½Ğ° Ğ½Ğ¾ÑĞºĞ¸", "calves"),
    ("Ğ¿Ğ¾Ğ´ÑŠÑ‘Ğ¼Ñ‹ Ğ½Ğ° Ğ½Ğ¾ÑĞºĞ¸", "calves"),
    ("Ğ¸ĞºÑ€Ñ‹", "calves"),
    ("Ğ¿Ñ€Ğ¸ÑĞµĞ´", "squat"),
    ("Ğ¶Ğ¸Ğ¼ Ğ½Ğ¾Ğ³", "legpress"),
    ("Ğ¶Ğ¸Ğ¼ Ğ»Ñ‘Ğ¶", "bench"),
    ("Ğ¶Ğ¸Ğ¼ Ğ³Ğ°Ğ½Ñ‚ĞµĞ»", "bench"),
    ("Ğ¶Ğ¸Ğ¼ Ğ² Ñ‚Ñ€ĞµĞ½Ğ°Ğ¶", "bench"),
    ("ÑĞ²ĞµĞ´ĞµĞ½Ğ¸", "bench"),
    ("Ğ¾Ñ‚Ğ¶Ğ¸Ğ¼Ğ° ÑƒĞ·Ğº", "narrow_pushup"),
    ("ÑƒĞ·ĞºĞ¸Ğµ Ğ¾Ñ‚Ğ¶Ğ¸Ğ¼Ğ°", "narrow_pushup"),
    ("Ğ¿Ğ°Ğ¹Ğº", "pike_pushup"),
    ("Ğ¾Ñ‚Ğ¶Ğ¸Ğ¼Ğ°", "row"),
    ("Ğ²ĞµÑ€Ñ…Ğ½Ğ¸Ğ¹ Ğ±Ğ»Ğ¾Ğº", "latpulldown"),
    ("Ñ‚ÑĞ³Ğ° Ğ²ĞµÑ€Ñ…Ğ½", "latpulldown"),
    ("Ñ‚ÑĞ³Ğ° Ñ€ĞµĞ·Ğ¸Ğ½ĞºĞ¸ ÑĞ²ĞµÑ€Ñ…Ñƒ", "band_pull"),
    ("Ñ‚ÑĞ³Ğ° Ğ³Ğ¾Ñ€Ğ¸Ğ·Ğ¾Ğ½Ñ‚", "rowtrain"),
    ("Ñ‚ÑĞ³Ğ° Ğ³Ğ°Ğ½Ñ‚ĞµĞ»", "dumbbell_row"),
    ("Ñ‚ÑĞ³Ğ° Ğ² Ñ‚Ñ€ĞµĞ½Ğ°Ğ¶", "rowtrain"),
    ("Ñ‚ÑĞ³Ğ° Ñ€ĞµĞ·Ğ¸Ğ½ĞºĞ¸ Ğº Ğ¿Ğ¾ÑÑÑƒ", "band_row"),
    ("Ñ‚ÑĞ³Ğ° Ñ€ĞµĞ·Ğ¸Ğ½ĞºĞ¸", "band_row"),
    ("Ğ¿Ğ¾Ğ´Ñ‚ÑĞ³Ğ¸Ğ²Ğ°", "pullup"),
    ("Ñ€ÑƒĞ¼Ñ‹Ğ½ÑĞºĞ°Ñ Ñ‚ÑĞ³Ğ°", "rdl"),
    ("good-morning", "good_morning"),
    ("Ğ¶Ğ¸Ğ¼ Ñ€ĞµĞ·Ğ¸Ğ½ĞºĞ¸ Ğ²Ğ²ĞµÑ€Ñ…", "band_ohp"),
    ("Ğ¶Ğ¸Ğ¼ Ğ²Ğ²ĞµÑ€Ñ…", "ohp"),
    ("Ğ¶Ğ¸Ğ¼ Ğ² Ñ‚Ñ€ĞµĞ½Ğ°Ğ¶Ñ‘Ñ€Ğµ Ğ²Ğ²ĞµÑ€Ñ…", "ohp"),
    ("face pull", "face_pull"),
    ("Ñ‚ÑĞ³Ğ° Ğº Ğ»Ğ¸Ñ†Ñƒ", "face_pull"),
    ("Ğ·Ğ°Ğ´Ğ½ÑÑ Ğ´ĞµĞ»ÑŒÑ‚Ğ°", "rear_delt"),
    ("Ñ€Ğ°Ğ·Ğ²ĞµĞ´ĞµĞ½Ğ¸", "lateralraise"),
    ("Ğ¼Ğ¾Ğ»Ğ¾Ñ‚ĞºĞ¸", "hammer"),
    ("ÑĞ³Ğ¸Ğ±Ğ°Ğ½Ğ¸", "biceps"),
    ("Ñ€Ğ°Ğ·Ğ³Ğ¸Ğ±Ğ°Ğ½Ğ¸", "triceps"),
    ("Ñ‚Ñ€Ğ¸Ñ†ĞµĞ¿Ñ", "triceps"),
    ("Ñ€Ğ°Ğ·Ğ³Ğ¸Ğ±Ğ°Ğ½Ğ¸Ğµ Ğ³Ğ°Ğ½Ñ‚ĞµĞ»Ğ¸ Ğ¸Ğ·-Ğ·Ğ° Ğ³Ğ¾Ğ»Ğ¾Ğ²Ñ‹", "triceps_oh"),
    ("Ğ¿Ğ»Ğ°Ğ½ĞºĞ°", "core"),
    ("ÑĞºÑ€ÑƒÑ‡Ğ¸Ğ²Ğ°", "core"),
    ("Ğ¿Ğ¾Ğ´ÑŠÑ‘Ğ¼ Ğ½Ğ¾Ğ³", "core"),
    # ĞĞ¾Ğ²Ñ‹Ğµ ÑƒĞ¿Ñ€Ğ°Ğ¶Ğ½ĞµĞ½Ğ¸Ñ Ğ¸Ğ· Ñ€Ğ°ÑÑˆĞ¸Ñ€ĞµĞ½Ğ½Ñ‹Ñ… Ğ¿ÑƒĞ»Ğ¾Ğ²
    ("Ğ¶Ğ¸Ğ¼ ÑˆÑ‚Ğ°Ğ½Ğ³Ğ¸ Ğ»Ñ‘Ğ¶", "bench"),
    ("Ğ¶Ğ¸Ğ¼ ÑˆÑ‚Ğ°Ğ½Ğ³Ğ¸ Ğ¿Ğ¾Ğ´ ÑƒĞ³Ğ»Ğ¾Ğ¼", "bench"),
    ("Ğ¶Ğ¸Ğ¼ Ğ³Ğ°Ğ½Ñ‚ĞµĞ»ĞµĞ¹ Ğ¿Ğ¾Ğ´ ÑƒĞ³Ğ»Ğ¾Ğ¼", "bench"),
    ("Ğ¶Ğ¸Ğ¼ Ğ³Ğ°Ğ½Ñ‚ĞµĞ»ĞµĞ¹ Ğ»Ñ‘Ğ¶", "bench"),
    ("ÑĞ²ĞµĞ´ĞµĞ½Ğ¸Ñ Ğ² ĞºÑ€Ğ¾ÑÑĞ¾Ğ²ĞµÑ€Ğµ", "bench"),
    ("Ğ¾Ñ‚Ğ¶Ğ¸Ğ¼Ğ°Ğ½Ğ¸Ñ Ñ Ğ²ĞµÑĞ¾Ğ¼", "row"),
    ("Ñ‚ÑĞ³Ğ° ÑˆÑ‚Ğ°Ğ½Ğ³Ğ¸ Ğ² Ğ½Ğ°ĞºĞ»Ğ¾Ğ½Ğµ", "rowtrain"),
    ("Ñ‚ÑĞ³Ğ° Ñ‚-Ğ³Ñ€Ğ¸Ñ„", "rowtrain"),
    ("Ñ‚ÑĞ³Ğ° Ğ½Ğ¸Ğ¶Ğ½ĞµĞ³Ğ¾ Ğ±Ğ»Ğ¾ĞºĞ°", "rowtrain"),
    ("Ğ³Ğ¾Ñ€Ğ¸Ğ·Ğ¾Ğ½Ñ‚Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ¿Ğ¾Ğ´Ñ‚ÑĞ³Ğ¸Ğ²Ğ°Ğ½Ğ¸Ñ", "pullup"),
    ("Ğ½ĞµĞ³Ğ°Ñ‚Ğ¸Ğ²Ğ½Ñ‹Ğµ Ğ¿Ğ¾Ğ´Ñ‚ÑĞ³Ğ¸Ğ²Ğ°Ğ½Ğ¸Ñ", "pullup"),
    ("Ğ¿Ğ¾Ğ´Ñ‚ÑĞ³Ğ¸Ğ²Ğ°Ğ½Ğ¸Ñ Ğ½Ğ° Ğ¿ĞµÑ‚Ğ»ÑÑ…", "pullup"),
    ("Ğ¿Ğ¾Ğ´Ñ‚ÑĞ³Ğ¸Ğ²Ğ°Ğ½Ğ¸Ñ (Ğ¾Ğ±Ñ€Ğ°Ñ‚Ğ½Ñ‹Ğ¹ Ñ…Ğ²Ğ°Ñ‚)", "pullup"),
    ("Ğ¿Ğ¾Ğ´Ñ‚ÑĞ³Ğ¸Ğ²Ğ°Ğ½Ğ¸Ñ (Ğ¿Ñ€ÑĞ¼Ğ¾Ğ¹ Ñ…Ğ²Ğ°Ñ‚)", "pullup"),
    ("Ğ¶Ğ¸Ğ¼ ÑˆÑ‚Ğ°Ğ½Ğ³Ğ¸ ÑÑ‚Ğ¾Ñ", "ohp"),
    ("Ğ°Ñ€Ğ¼ĞµĞ¹ÑĞºĞ¸Ğ¹ Ğ¶Ğ¸Ğ¼", "ohp"),
    ("Ğ¶Ğ¸Ğ¼ Ğ³Ğ°Ğ½Ñ‚ĞµĞ»ĞµĞ¹ ÑÑ‚Ğ¾Ñ", "ohp"),
    ("Ğ¶Ğ¸Ğ¼ Ğ³Ğ°Ğ½Ñ‚ĞµĞ»ĞµĞ¹ ÑĞ¸Ğ´Ñ", "ohp"),
    ("Ñ‚ÑĞ³Ğ° ÑˆÑ‚Ğ°Ğ½Ğ³Ğ¸ Ğº Ğ¿Ğ¾Ğ´Ğ±Ğ¾Ñ€Ğ¾Ğ´ĞºÑƒ", "lateralraise"),
    ("Ñ‚ÑĞ³Ğ° Ñ€ĞµĞ·Ğ¸Ğ½ĞºĞ¸ Ğº Ğ¿Ğ¾Ğ´Ğ±Ğ¾Ñ€Ğ¾Ğ´ĞºÑƒ", "lateralraise"),
    ("Ñ‚ÑĞ³Ğ° Ñ€ĞµĞ·Ğ¸Ğ½ĞºĞ¸ Ğº Ğ»Ğ¸Ñ†Ñƒ", "face_pull"),
    ("Ğ·Ğ°Ğ´Ğ½ÑÑ Ğ´ĞµĞ»ÑŒÑ‚Ğ° Ğ² Ñ‚Ñ€ĞµĞ½Ğ°Ğ¶Ñ‘Ñ€Ğµ", "rear_delt"),
    ("Ñ€Ğ°Ğ·Ğ²ĞµĞ´ĞµĞ½Ğ¸Ñ Ğ³Ğ°Ğ½Ñ‚ĞµĞ»ĞµĞ¹ Ğ² Ğ½Ğ°ĞºĞ»Ğ¾Ğ½Ğµ", "rear_delt"),
    ("Ñ€Ğ°Ğ·Ğ²ĞµĞ´ĞµĞ½Ğ¸Ñ Ğ³Ğ°Ğ½Ñ‚ĞµĞ»ĞµĞ¹ Ğ² ÑÑ‚Ğ¾Ñ€Ğ¾Ğ½Ñ‹", "lateralraise"),
    ("ÑĞ³Ğ¸Ğ±Ğ°Ğ½Ğ¸Ñ Ğ½Ğ° ÑĞºĞ°Ğ¼ÑŒĞµ ÑĞºĞ¾Ñ‚Ñ‚Ğ°", "biceps"),
    ("ĞºĞ¾Ğ½Ñ†ĞµĞ½Ñ‚Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğµ ÑĞ³Ğ¸Ğ±Ğ°Ğ½Ğ¸Ñ", "biceps"),
    ("ÑĞ³Ğ¸Ğ±Ğ°Ğ½Ğ¸Ñ Ğ½Ğ° Ñ€ĞµĞ·Ğ¸Ğ½ĞºĞµ", "biceps"),
    ("Ñ„Ñ€Ğ°Ğ½Ñ†ÑƒĞ·ÑĞºĞ¸Ğ¹ Ğ¶Ğ¸Ğ¼", "triceps_oh"),
    ("Ğ¾Ğ±Ñ€Ğ°Ñ‚Ğ½Ñ‹Ğµ Ğ¾Ñ‚Ğ¶Ğ¸Ğ¼Ğ°Ğ½Ğ¸Ñ", "triceps"),
    ("Ñ€Ğ¾Ğ»Ğ¸Ğº Ğ´Ğ»Ñ Ğ¿Ñ€ĞµÑÑĞ°", "core"),
    ("Ğ±Ğ¾ĞºĞ¾Ğ²Ğ°Ñ Ğ¿Ğ»Ğ°Ğ½ĞºĞ°", "core"),
    ("Ğ²ĞµĞ»Ğ¾ÑĞ¸Ğ¿ĞµĞ´", "core"),
    ("Ğ¾Ğ±Ñ€Ğ°Ñ‚Ğ½Ñ‹Ğµ ÑĞºÑ€ÑƒÑ‡Ğ¸Ğ²Ğ°Ğ½Ğ¸Ñ", "core"),
    ("Ğ¿Ğ¾Ğ´ÑŠÑ‘Ğ¼Ñ‹ Ğ½Ğ° Ğ½Ğ¾ÑĞºĞ¸ Ğ½Ğ° Ğ¾Ğ´Ğ½Ğ¾Ğ¹ Ğ½Ğ¾Ğ³Ğµ", "calves"),
    ("Ğ¿Ğ¾Ğ´ÑŠÑ‘Ğ¼Ñ‹ Ğ½Ğ° Ğ½Ğ¾ÑĞºĞ¸ Ñ Ğ³Ğ°Ğ½Ñ‚ĞµĞ»ÑĞ¼Ğ¸", "calves"),
    ("ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ°Ñ Ñ‚ÑĞ³Ğ°", "rdl"),
    ("Ğ¿Ñ€Ğ¸ÑĞµĞ´Ğ°Ğ½Ğ¸Ñ Ğ½Ğ° Ğ¾Ğ´Ğ½Ğ¾Ğ¹ Ğ½Ğ¾Ğ³Ğµ", "squat"),
    ("Ğ¿Ñ€Ğ¸ÑĞµĞ´ ÑÑƒĞ¼Ğ¾", "squat"),
    ("Ğ²Ñ‹Ğ¿Ğ°Ğ´Ñ‹ Ñ…Ğ¾Ğ´ÑŒĞ±Ğ¾Ğ¹", "lunge"),
    ("Ğ²Ñ‹Ğ¿Ğ°Ğ´Ñ‹ Ğ½Ğ° Ğ¼ĞµÑÑ‚Ğµ", "lunge"),
    ("Ğ±Ğ¾Ğ»Ğ³Ğ°Ñ€ÑĞºĞ¸Ğµ Ğ²Ñ‹Ğ¿Ğ°Ğ´Ñ‹ Ñ Ğ³Ğ°Ğ½Ñ‚ĞµĞ»ÑĞ¼Ğ¸", "bulgarian"),
    ("Ğ±Ğ¾Ğ»Ğ³Ğ°Ñ€ÑĞºĞ¸Ğµ Ğ²Ñ‹Ğ¿Ğ°Ğ´Ñ‹", "bulgarian"),
    ("ÑĞ³Ğ¾Ğ´Ğ¸Ñ‡Ğ½Ñ‹Ğ¹ Ğ¼Ğ¾ÑÑ‚ Ğ½Ğ° Ğ¾Ğ´Ğ½Ğ¾Ğ¹ Ğ½Ğ¾Ğ³Ğµ", "hinge"),
    ("Ñ€ÑƒĞ¼Ñ‹Ğ½ÑĞºĞ°Ñ Ñ‚ÑĞ³Ğ° Ñ Ğ³Ğ°Ğ½Ñ‚ĞµĞ»ÑĞ¼Ğ¸", "rdl"),
    ("Ñ€ÑƒĞ¼Ñ‹Ğ½ÑĞºĞ°Ñ Ñ‚ÑĞ³Ğ° ÑĞ¾ ÑˆÑ‚Ğ°Ğ½Ğ³Ğ¾Ğ¹", "rdl"),
    ("ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ°Ñ Ñ‚ÑĞ³Ğ° (Ğ»Ñ‘Ğ³ĞºĞ°Ñ", "deadlift"),
    ("ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ°Ñ Ñ‚ÑĞ³Ğ° (Ñ‚ĞµÑ…Ğ½Ğ¸ĞºĞ°)", "deadlift"),
    ("ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ°Ñ Ñ‚ÑĞ³Ğ°", "deadlift"),
    ("Ñ‚ÑĞ³Ğ° ÑˆÑ‚Ğ°Ğ½Ğ³Ğ¸ Ğ² Ğ½Ğ°ĞºĞ»Ğ¾Ğ½Ğµ", "barbell_row"),
    ("Ñ‚ÑĞ³Ğ° Ñ‚-Ğ³Ñ€Ğ¸Ñ„", "barbell_row"),
    ("Ğ¶Ğ¸Ğ¼ ÑˆÑ‚Ğ°Ğ½Ğ³Ğ¸ Ğ¿Ğ¾Ğ´ ÑƒĞ³Ğ»Ğ¾Ğ¼", "incline_press"),
    ("Ğ¶Ğ¸Ğ¼ Ğ³Ğ°Ğ½Ñ‚ĞµĞ»ĞµĞ¹ Ğ¿Ğ¾Ğ´ ÑƒĞ³Ğ»Ğ¾Ğ¼", "incline_press"),
    ("Ğ¶Ğ¸Ğ¼ ÑˆÑ‚Ğ°Ğ½Ğ³Ğ¸ ÑÑ‚Ğ¾Ñ", "ohp_barbell"),
    ("Ğ°Ñ€Ğ¼ĞµĞ¹ÑĞºĞ¸Ğ¹ Ğ¶Ğ¸Ğ¼", "ohp_barbell"),
    # Ğ—Ğ°Ğ»: Ğ±Ğ°Ğ·Ğ¾Ğ²Ñ‹Ğµ, ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğµ Ğ¼Ğ¾Ğ³ÑƒÑ‚ Ğ½Ğµ Ğ¿Ğ¾Ğ¿Ğ°ÑÑ‚ÑŒ Ğ²Ñ‹ÑˆĞµ
    ("Ğ¿Ñ€Ğ¸ÑĞµĞ´ ÑĞ¾ ÑˆÑ‚Ğ°Ğ½Ğ³Ğ¾Ğ¹", "squat"),
    ("Ğ¿Ñ€Ğ¸ÑĞµĞ´ Ñ Ğ³Ğ°Ğ½Ñ‚ĞµĞ»ÑĞ¼Ğ¸", "goblet"),
    ("Ğ¶Ğ¸Ğ¼ ÑˆÑ‚Ğ°Ğ½Ğ³Ğ¸ Ğ»Ñ‘Ğ¶", "bench"),
    ("Ğ¶Ğ¸Ğ¼ Ğ³Ğ°Ğ½Ñ‚ĞµĞ»ĞµĞ¹ Ğ»Ñ‘Ğ¶", "bench"),
    ("Ğ¶Ğ¸Ğ¼ Ğ² Ñ‚Ñ€ĞµĞ½Ğ°Ğ¶Ñ‘Ñ€Ğµ (Ğ³Ñ€ÑƒĞ´ÑŒ)", "bench"),
    ("ÑĞ²ĞµĞ´ĞµĞ½Ğ¸Ñ Ğ² ĞºÑ€Ğ¾ÑÑĞ¾Ğ²ĞµÑ€Ğµ", "bench"),
    ("Ğ¿Ğ¾Ğ´Ñ‚ÑĞ³Ğ¸Ğ²Ğ°Ğ½Ğ¸Ñ (ÑˆĞ¸Ñ€Ğ¾ĞºĞ¸Ğ¹", "pullup"),
    ("Ğ¿Ğ¾Ğ´Ñ‚ÑĞ³Ğ¸Ğ²Ğ°Ğ½Ğ¸Ñ Ğ½ĞµĞ¹Ñ‚Ñ€Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¼", "pullup"),
    ("Ğ²ĞµÑ€Ñ…Ğ½Ğ¸Ğ¹ Ğ±Ğ»Ğ¾Ğº ÑˆĞ¸Ñ€Ğ¾Ğº", "latpulldown"),
    ("Ğ²ĞµÑ€Ñ…Ğ½Ğ¸Ğ¹ Ğ±Ğ»Ğ¾Ğº ÑƒĞ·Ğº", "latpulldown"),
    ("Ñ‚ÑĞ³Ğ° Ğ²ĞµÑ€Ñ…Ğ½ĞµĞ³Ğ¾ Ğ±Ğ»Ğ¾ĞºĞ°", "latpulldown"),
    ("Ğ¶Ğ¸Ğ¼ Ğ½Ğ¾Ğ³Ğ°Ğ¼Ğ¸ Ğ² Ñ‚Ñ€ĞµĞ½Ğ°Ğ¶Ñ‘Ñ€Ğµ", "legpress"),
    ("Ñ…Ğ°ĞºĞº-Ğ¿Ñ€Ğ¸ÑĞµĞ´", "hack_squat"),
    ("Ğ±Ğ¾Ğ»Ğ³Ğ°Ñ€ÑĞºĞ¸Ğµ Ğ²Ñ‹Ğ¿Ğ°Ğ´Ñ‹ Ñ Ğ³Ğ°Ğ½Ñ‚ĞµĞ»", "bulgarian"),
    ("Ğ²Ñ‹Ğ¿Ğ°Ğ´Ñ‹ Ñ Ğ³Ğ°Ğ½Ñ‚ĞµĞ»ÑĞ¼Ğ¸", "lunge"),
    ("ÑĞ³Ğ¾Ğ´Ğ¸Ñ‡Ğ½Ñ‹Ğ¹ Ğ¼Ğ¾ÑÑ‚ ÑĞ¾ ÑˆÑ‚Ğ°Ğ½Ğ³Ğ¾Ğ¹", "hinge"),
    ("Ğ³Ğ¸Ğ¿ĞµÑ€ÑĞºÑÑ‚ĞµĞ½Ğ·Ğ¸Ñ Ñ Ğ²ĞµÑĞ¾Ğ¼", "hyperext"),
    ("Ğ³Ğ¸Ğ¿ĞµÑ€ÑĞºÑÑ‚ĞµĞ½Ğ·Ğ¸Ñ Ğ½Ğ° Ğ¿Ğ¾Ğ»Ñƒ", "hyperext"),
    ("ÑĞ³Ğ¸Ğ±Ğ°Ğ½Ğ¸Ñ Ğ½Ğ¾Ğ³ Ğ² Ñ‚Ñ€ĞµĞ½Ğ°Ğ¶Ñ‘Ñ€Ğµ", "legcurl"),
    ("Ğ¿Ğ¾Ğ´ÑŠÑ‘Ğ¼Ñ‹ Ğ½Ğ° Ğ½Ğ¾ÑĞºĞ¸ ÑÑ‚Ğ¾Ñ", "calves"),
    ("Ğ¿Ğ¾Ğ´ÑŠÑ‘Ğ¼Ñ‹ Ğ½Ğ° Ğ½Ğ¾ÑĞºĞ¸ ÑĞ¸Ğ´Ñ", "calves"),
    ("ÑĞºÑ€ÑƒÑ‡Ğ¸Ğ²Ğ°Ğ½Ğ¸Ñ Ğ½Ğ° Ğ±Ğ»Ğ¾ĞºĞµ", "core"),
    ("Ğ¿Ğ¾Ğ´ÑŠÑ‘Ğ¼Ñ‹ Ğ½Ğ¾Ğ³ Ğ² Ğ²Ğ¸ÑĞµ", "core"),
    ("Ğ¿Ğ¾Ğ´ÑŠÑ‘Ğ¼Ñ‹ Ğ½Ğ¾Ğ³ Ğ² ÑƒĞ¿Ğ¾Ñ€Ğµ", "core"),
    ("Ñ€Ğ¾Ğ»Ğ¸Ğº Ğ´Ğ»Ñ Ğ¿Ñ€ĞµÑÑĞ°", "core"),
    ("Ğ±Ğ¾ĞºĞ¾Ğ²Ğ°Ñ Ğ¿Ğ»Ğ°Ğ½ĞºĞ°", "core"),
    # Ğ”Ğ¾Ğ¼Ğ°: Ğ±Ğ°Ğ·Ğ¾Ğ²Ñ‹Ğµ
    ("Ğ¿Ñ€Ğ¸ÑĞµĞ´Ğ°Ğ½Ğ¸Ñ (ÑĞ¾Ğ±ÑÑ‚Ğ²ĞµĞ½Ğ½Ñ‹Ğ¹ Ğ²ĞµÑ)", "squat"),
    ("Ğ¿Ñ€Ğ¸ÑĞµĞ´ Ñ Ğ¿Ğ°ÑƒĞ·Ğ¾Ğ¹", "squat"),
    ("Ğ¿Ñ€Ğ¸ÑĞµĞ´ ÑÑƒĞ¼Ğ¾", "squat"),
    ("Ğ±Ğ¾Ğ»Ğ³Ğ°Ñ€ÑĞºĞ¸Ğµ Ğ²Ñ‹Ğ¿Ğ°Ğ´Ñ‹ (Ğ½Ğ¾Ğ³Ğ° Ğ½Ğ° ÑÑ‚ÑƒĞ»Ğµ)", "bulgarian"),
    ("Ğ²Ñ‹Ğ¿Ğ°Ğ´Ñ‹ Ğ½Ğ° Ğ¼ĞµÑÑ‚Ğµ", "lunge"),
    ("Ğ²Ñ‹Ğ¿Ğ°Ğ´Ñ‹ Ñ…Ğ¾Ğ´ÑŒĞ±Ğ¾Ğ¹", "lunge"),
    ("Ğ¿Ñ€Ğ¸ÑĞµĞ´Ğ°Ğ½Ğ¸Ñ Ğ½Ğ° Ğ¾Ğ´Ğ½Ğ¾Ğ¹ Ğ½Ğ¾Ğ³Ğµ", "squat"),
    ("ÑĞ³Ğ¾Ğ´Ğ¸Ñ‡Ğ½Ñ‹Ğ¹ Ğ¼Ğ¾ÑÑ‚ Ğ½Ğ° Ğ¾Ğ´Ğ½Ğ¾Ğ¹ Ğ½Ğ¾Ğ³Ğµ", "hinge"),
    ("good-morning", "good_morning"),
    ("Ğ¾Ñ‚Ğ¶Ğ¸Ğ¼Ğ°Ğ½Ğ¸Ñ (ĞºĞ»Ğ°ÑÑĞ¸ĞºĞ°)", "row"),
    ("Ğ¾Ñ‚Ğ¶Ğ¸Ğ¼Ğ°Ğ½Ğ¸Ñ Ñ Ğ¿Ğ°ÑƒĞ·Ğ¾Ğ¹", "row"),
    ("Ğ¾Ñ‚Ğ¶Ğ¸Ğ¼Ğ°Ğ½Ğ¸Ñ Ğ¾Ñ‚ Ğ²Ğ¾Ğ·Ğ²Ñ‹ÑˆĞµĞ½Ğ¸Ñ", "row"),
    ("Ğ¾Ñ‚Ğ¶Ğ¸Ğ¼Ğ°Ğ½Ğ¸Ñ Ñ Ñ…Ğ»Ğ¾Ğ¿ĞºĞ¾Ğ¼", "row"),
    ("Ğ³Ğ¾Ñ€Ğ¸Ğ·Ğ¾Ğ½Ñ‚Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ¿Ğ¾Ğ´Ñ‚ÑĞ³Ğ¸Ğ²Ğ°Ğ½Ğ¸Ñ", "pullup"),
    ("Ñ‚ÑĞ³Ğ° Ñ€ĞµĞ·Ğ¸Ğ½ĞºĞ¸ Ğº Ğ¿Ğ¾ÑÑÑƒ", "band_row"),
    ("Ñ‚ÑĞ³Ğ° Ñ€ĞµĞ·Ğ¸Ğ½ĞºĞ¸ Ğ² Ğ½Ğ°ĞºĞ»Ğ¾Ğ½Ğµ", "band_row"),
    ("Ğ¿Ğ¾Ğ´Ñ‚ÑĞ³Ğ¸Ğ²Ğ°Ğ½Ğ¸Ñ (Ğ¾Ğ±Ñ€Ğ°Ñ‚Ğ½Ñ‹Ğ¹ Ñ…Ğ²Ğ°Ñ‚)", "pullup"),
    ("Ğ¿Ğ¾Ğ´Ñ‚ÑĞ³Ğ¸Ğ²Ğ°Ğ½Ğ¸Ñ (Ğ¿Ñ€ÑĞ¼Ğ¾Ğ¹ Ñ…Ğ²Ğ°Ñ‚)", "pullup"),
    ("Ğ½ĞµĞ³Ğ°Ñ‚Ğ¸Ğ²Ğ½Ñ‹Ğµ Ğ¿Ğ¾Ğ´Ñ‚ÑĞ³Ğ¸Ğ²Ğ°Ğ½Ğ¸Ñ", "pullup"),
    ("Ñ‚ÑĞ³Ğ° Ñ€ĞµĞ·Ğ¸Ğ½ĞºĞ¸ ÑĞ²ĞµÑ€Ñ…Ñƒ", "band_pull"),
    ("Ğ¿Ğ¾Ğ´Ñ‚ÑĞ³Ğ¸Ğ²Ğ°Ğ½Ğ¸Ñ Ğ½Ğ° Ğ¿ĞµÑ‚Ğ»ÑÑ…", "pullup"),
    ("Ğ¿Ğ°Ğ¹Ğº-Ğ¾Ñ‚Ğ¶Ğ¸Ğ¼Ğ°Ğ½Ğ¸Ñ", "pike_pushup"),
    ("Ğ¶Ğ¸Ğ¼ Ñ€ĞµĞ·Ğ¸Ğ½ĞºĞ¸ Ğ²Ğ²ĞµÑ€Ñ…", "band_ohp"),
    ("Ğ¾Ñ‚Ğ¶Ğ¸Ğ¼Ğ°Ğ½Ğ¸Ñ (Ğ½Ğ¾Ğ³Ğ¸ Ğ²Ñ‹ÑĞ¾ĞºĞ¾", "pike_pushup"),
    ("Ñ‚ÑĞ³Ğ° Ñ€ĞµĞ·Ğ¸Ğ½ĞºĞ¸ Ğº Ğ»Ğ¸Ñ†Ñƒ", "face_pull"),
    ("ÑĞ³Ğ¸Ğ±Ğ°Ğ½Ğ¸Ñ Ğ½Ğ° Ñ€ĞµĞ·Ğ¸Ğ½ĞºĞµ", "biceps"),
    ("Ğ¾Ñ‚Ğ¶Ğ¸Ğ¼Ğ°Ğ½Ğ¸Ñ ÑƒĞ·ĞºĞ¸Ğµ (Ñ‚Ñ€Ğ¸Ñ†ĞµĞ¿Ñ)", "narrow_pushup"),
    ("Ğ¾Ğ±Ñ€Ğ°Ñ‚Ğ½Ñ‹Ğµ Ğ¾Ñ‚Ğ¶Ğ¸Ğ¼Ğ°Ğ½Ğ¸Ñ Ğ¾Ñ‚ ÑÑ‚ÑƒĞ»Ğ°", "triceps"),
    ("Ğ¿Ğ¾Ğ´ÑŠÑ‘Ğ¼Ñ‹ Ğ½Ğ¾Ğ³ Ğ»Ñ‘Ğ¶Ğ°", "core"),
    ("Ğ²ĞµĞ»Ğ¾ÑĞ¸Ğ¿ĞµĞ´ (ÑĞºÑ€ÑƒÑ‡Ğ¸Ğ²Ğ°Ğ½Ğ¸Ñ", "core"),
    ("Ğ¾Ğ±Ñ€Ğ°Ñ‚Ğ½Ñ‹Ğµ ÑĞºÑ€ÑƒÑ‡Ğ¸Ğ²Ğ°Ğ½Ğ¸Ñ", "core"),
    ("ÑĞºÑ€ÑƒÑ‡Ğ¸Ğ²Ğ°Ğ½Ğ¸Ñ Ğ½Ğ° Ğ¿Ğ¾Ğ»Ñƒ", "core"),
    ("Ğ¿Ğ¾Ğ´ÑŠÑ‘Ğ¼Ñ‹ Ğ½Ğ° Ğ½Ğ¾ÑĞºĞ¸ Ğ½Ğ° Ğ¾Ğ´Ğ½Ğ¾Ğ¹ Ğ½Ğ¾Ğ³Ğµ", "calves"),
    ("Ğ¿Ğ¾Ğ´ÑŠÑ‘Ğ¼Ñ‹ Ğ½Ğ° Ğ½Ğ¾ÑĞºĞ¸ Ñ Ğ³Ğ°Ğ½Ñ‚ĞµĞ»ÑĞ¼Ğ¸", "calves"),
    ("Ñ€Ğ°Ğ·Ğ²ĞµĞ´ĞµĞ½Ğ¸Ñ Ğ³Ğ°Ğ½Ñ‚ĞµĞ»ĞµĞ¹ Ğ² ÑÑ‚Ğ¾Ñ€Ğ¾Ğ½Ñ‹", "lateralraise"),
    ("Ñ€Ğ°Ğ·Ğ²ĞµĞ´ĞµĞ½Ğ¸Ñ Ğ³Ğ°Ğ½Ñ‚ĞµĞ»ĞµĞ¹ Ğ² Ğ½Ğ°ĞºĞ»Ğ¾Ğ½Ğµ", "rear_delt"),
    ("Ñ‚ÑĞ³Ğ° Ñ€ĞµĞ·Ğ¸Ğ½ĞºĞ¸ Ğº Ğ¿Ğ¾Ğ´Ğ±Ğ¾Ñ€Ğ¾Ğ´ĞºÑƒ", "lateralraise"),
    ("Ğ¼Ğ¾Ğ»Ğ¾Ñ‚ĞºĞ¸ Ñ Ğ³Ğ°Ğ½Ñ‚ĞµĞ»ÑĞ¼Ğ¸", "hammer"),
    ("ÑĞ³Ğ¸Ğ±Ğ°Ğ½Ğ¸Ñ Ğ³Ğ°Ğ½Ñ‚ĞµĞ»ĞµĞ¹ ÑÑ‚Ğ¾Ñ", "biceps"),
    ("Ñ€Ğ°Ğ·Ğ³Ğ¸Ğ±Ğ°Ğ½Ğ¸Ğµ Ğ³Ğ°Ğ½Ñ‚ĞµĞ»Ğ¸ Ğ¸Ğ·-Ğ·Ğ° Ğ³Ğ¾Ğ»Ğ¾Ğ²Ñ‹", "triceps_oh"),
    ("Ğ¾Ğ±Ñ€Ğ°Ñ‚Ğ½Ñ‹Ğµ Ğ¾Ñ‚Ğ¶Ğ¸Ğ¼Ğ°Ğ½Ğ¸Ñ", "triceps"),
    ("face pull", "face_pull"),
]


def get_tech_key_for_exercise(name: str) -> Optional[str]:
    n = name.lower()
    for keyword, tech_key in EXERCISE_TECH_MAP:
        if keyword in n:
            return tech_key
    # Fallback â€” Ğ¾Ğ±Ñ‰Ğ°Ñ Ñ‚ĞµÑ…Ğ½Ğ¸ĞºĞ° Ğ¿Ğ¾ Ğ³Ñ€ÑƒĞ¿Ğ¿Ğµ Ğ¼Ñ‹ÑˆÑ†
    if any(x in n for x in ["Ğ½Ğ¾Ğ³", "ÑĞ³Ğ¾Ğ´Ğ¸Ñ†", "Ğ¸ĞºÑ€", "Ğ±ĞµĞ´Ñ€", "Ğ¿Ñ€Ğ¸ÑĞµĞ´Ğ°", "Ğ¿Ñ€Ğ¸ÑĞµĞ´Ğ°Ğ½Ğ¸", "Ğ²Ñ‹Ğ¿Ğ°Ğ´"]):
        return "squat"
    if any(x in n for x in ["Ğ³Ñ€ÑƒĞ´ÑŒ", "Ğ³Ñ€ÑƒĞ´Ğ½", "Ğ¶Ğ¸Ğ¼"]):
        return "bench"
    if any(x in n for x in ["ÑĞ¿Ğ¸Ğ½", "Ñ‚ÑĞ³", "Ğ±Ğ»Ğ¾Ğº", "Ğ¿Ğ¾Ğ´Ñ‚ÑĞ³"]):
        return "latpulldown"
    if any(x in n for x in ["Ğ¿Ğ»ĞµÑ‡", "Ğ´ĞµĞ»ÑŒÑ‚", "Ğ¶Ğ¸Ğ¼ Ğ²Ğ²ĞµÑ€Ñ…"]):
        return "ohp"
    if any(x in n for x in ["Ğ±Ğ¸Ñ†ĞµĞ¿Ñ", "ÑĞ³Ğ¸Ğ±Ğ°Ğ½"]):
        return "biceps"
    if any(x in n for x in ["Ñ‚Ñ€Ğ¸Ñ†ĞµĞ¿Ñ", "Ñ€Ğ°Ğ·Ğ³Ğ¸Ğ±Ğ°Ğ½"]):
        return "triceps"
    if any(x in n for x in ["Ğ¿Ñ€ĞµÑÑ", "Ğ¿Ğ»Ğ°Ğ½Ğº", "ÑĞºÑ€ÑƒÑ‡Ğ¸Ğ²", "Ğ¿Ğ¾Ğ´ÑŠÑ‘Ğ¼ Ğ½Ğ¾Ğ³"]):
        return "core"
    if any(x in n for x in ["Ñ€ÑƒĞ¼Ñ‹Ğ½ÑĞº", "Ğ¼ĞµÑ€Ñ‚Ğ²Ğ°Ñ", "ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ°Ñ", "hinge", "ÑĞ³Ğ¾Ğ´Ğ¸Ñ†"]):
        return "rdl"
    return "squat"  # ÑĞ°Ğ¼Ñ‹Ğ¹ Ğ±Ğ°Ğ·Ğ¾Ğ²Ñ‹Ğ¹ fallback


# =========================
# ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ´Ğ½Ñ Ğ¿Ğ¾ Ñ‚Ğ¸Ğ¿Ñƒ
# =========================
DAY_NAMES = {
    "FB-A": "Ğ¤ÑƒĞ»Ğ±Ğ°Ğ´Ğ¸ Ğ",
    "FB-B": "Ğ¤ÑƒĞ»Ğ±Ğ°Ğ´Ğ¸ Ğ‘",
    "FB-C": "Ğ¤ÑƒĞ»Ğ±Ğ°Ğ´Ğ¸ Ğ’",
    "UPPER": "Ğ’ĞµÑ€Ñ… Ñ‚ĞµĞ»Ğ°",
    "LOWER": "ĞĞ¸Ğ· Ñ‚ĞµĞ»Ğ°",
    "PUSH": "Ğ“Ñ€ÑƒĞ´ÑŒ Ğ¸ ĞŸĞ»ĞµÑ‡Ğ¸",
    "PULL": "Ğ¡Ğ¿Ğ¸Ğ½Ğ° Ğ¸ Ğ‘Ğ¸Ñ†ĞµĞ¿Ñ",
    "LEGS": "ĞĞ¾Ğ³Ğ¸",
}


def get_day_kind_from_text(day_text: str) -> str:
    """Ğ˜Ğ·Ğ²Ğ»ĞµĞºĞ°ĞµĞ¼ Ñ‚Ğ¸Ğ¿ Ğ´Ğ½Ñ Ğ¸Ğ· Ñ‚ĞµĞºÑÑ‚Ğ° Ğ¿Ğ»Ğ°Ğ½Ğ°."""
    t = day_text.lower()
    if "Ñ„ÑƒĞ»Ğ±Ğ°Ğ´Ğ¸" in t or "fullbody" in t:
        return "FB"
    if "Ğ²ĞµÑ€Ñ…" in t and "Ñ‚ĞµĞ»Ğ°" in t:
        return "UPPER"
    if "Ğ½Ğ¸Ğ·" in t or "Ğ½Ğ¾Ğ³Ğ¸" in t:
        return "LOWER"
    if "Ñ‚Ğ¾Ğ»Ñ‡Ğ¾Ğº" in t or "push" in t:
        return "PUSH"
    if "Ñ‚ÑĞ³Ğ°" in t or "pull" in t:
        return "PULL"
    return "FB"


def get_day_display_name(day_num: int, day_text: str, system: str = "") -> str:
    """Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ Ğ¿Ğ¾Ğ½ÑÑ‚Ğ½Ğ¾Ğµ Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ´Ğ½Ñ Ñ ÑƒÑ‡Ñ‘Ñ‚Ğ¾Ğ¼ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹ Ğ¸ Ğ½Ğ¾Ğ¼ĞµÑ€Ğ°."""
    t = day_text.lower()
    # PPL
    if "Ñ‚Ğ¾Ğ»Ñ‡Ğ¾Ğº" in t or "push" in t:
        return "Ğ“Ñ€ÑƒĞ´ÑŒ Ğ¸ ĞŸĞ»ĞµÑ‡Ğ¸"
    if ("Ñ‚ÑĞ³Ğ°" in t or "pull" in t) and ("ÑĞ¿Ğ¸Ğ½Ğ°" in t or "Ğ±Ğ¸Ñ†ĞµĞ¿Ñ" in t or "pull" in t):
        return "Ğ¡Ğ¿Ğ¸Ğ½Ğ° Ğ¸ Ğ‘Ğ¸Ñ†ĞµĞ¿Ñ"
    if "Ğ½Ğ¾Ğ³Ğ¸" in t and ("Ñ‚ÑĞ³Ğ°" not in t):
        return "ĞĞ¾Ğ³Ğ¸"
    # Ğ’ĞµÑ€Ñ…/ĞĞ¸Ğ·
    if "Ğ²ĞµÑ€Ñ…" in t and "Ñ‚ĞµĞ»Ğ°" in t:
        return "Ğ’ĞµÑ€Ñ… Ñ‚ĞµĞ»Ğ°"
    if "Ğ½Ğ¸Ğ·" in t:
        return "ĞĞ¸Ğ· Ñ‚ĞµĞ»Ğ°"
    # Ğ¤ÑƒĞ»Ğ±Ğ°Ğ´Ğ¸
    if "Ñ„ÑƒĞ»Ğ±Ğ°Ğ´Ğ¸" in t or "fullbody" in t:
        # A/B/C Ğ¿Ğ¾ Ğ½Ğ¾Ğ¼ĞµÑ€Ñƒ
        suffix = {1: "Ğ", 2: "Ğ‘", 3: "Ğ’"}.get(day_num, "")
        return f"Ğ¤ÑƒĞ»Ğ±Ğ°Ğ´Ğ¸ {suffix}".strip()
    return f"Ğ”ĞµĞ½ÑŒ {day_num}"


def parse_exercises_from_day_text(day_text: str) -> List[str]:
    """Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ ÑĞ¿Ğ¸ÑĞ¾Ğº Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğ¹ ÑƒĞ¿Ñ€Ğ°Ğ¶Ğ½ĞµĞ½Ğ¸Ğ¹ (Ğ±ĞµĞ· Ğ¿Ğ¾Ğ´Ñ…Ğ¾Ğ´Ğ¾Ğ²/Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€Ğ¾Ğ²)."""
    exercises = []
    for line in day_text.splitlines():
        stripped = line.strip()
        if stripped.startswith("â€¢"):
            content = stripped.lstrip("â€¢").strip()
            if " â€” " in content:
                name = content.split(" â€” ")[0].strip()
            else:
                name = content
            if name:
                exercises.append(name)
    return exercises


def parse_exercises_full(day_text: str) -> List[Tuple[str, str]]:
    """Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ ÑĞ¿Ğ¸ÑĞ¾Ğº (Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ, 'Ğ¿Ğ¾Ğ´Ñ…Ğ¾Ğ´Ñ‹Ã—Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€Ñ‹') Ğ´Ğ»Ñ Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ."""
    exercises = []
    for line in day_text.splitlines():
        stripped = line.strip()
        if stripped.startswith("â€¢"):
            content = stripped.lstrip("â€¢").strip()
            if " â€” " in content:
                parts = content.split(" â€” ", 1)
                name = parts[0].strip()
                sets_reps = parts[1].strip()
            else:
                name = content
                sets_reps = ""
            if name:
                exercises.append((name, sets_reps))
    return exercises


async def get_day_done_exercises(user_id: int, day_num: int) -> List[int]:
    async with db() as conn:
        async with conn.execute(
            "SELECT done_exercises FROM workout_day_progress WHERE user_id=? AND day_num=?",
            (user_id, day_num)
        ) as cur:
            row = await cur.fetchone()
    if not row or not row[0]:
        return []
    try:
        return json.loads(row[0])
    except Exception:
        return []


async def set_day_done_exercises(user_id: int, day_num: int, done: List[int]):
    async with db() as conn:
        await conn.execute("""
            INSERT INTO workout_day_progress (user_id, day_num, done_exercises)
            VALUES (?, ?, ?)
            ON CONFLICT(user_id, day_num) DO UPDATE SET done_exercises=excluded.done_exercises
        """, (user_id, day_num, json.dumps(done)))
        await conn.commit()


async def clear_day_progress(user_id: int, day_num: int):
    async with db() as conn:
        await conn.execute(
            "DELETE FROM workout_day_progress WHERE user_id=? AND day_num=?",
            (user_id, day_num)
        )
        await conn.commit()


async def mark_day_completed(user_id: int, day_num: int):
    today = datetime.now().strftime("%Y-%m-%d")
    now = datetime.utcnow().isoformat()
    async with db() as conn:
        await conn.execute("""
            INSERT INTO workout_completions (user_id, day_num, completed_date, created_at)
            VALUES (?, ?, ?, ?)
        """, (user_id, day_num, today, now))
        await conn.commit()


async def is_day_completed_today(user_id: int, day_num: int) -> bool:
    today = datetime.now().strftime("%Y-%m-%d")
    async with db() as conn:
        async with conn.execute("""
            SELECT COUNT(*) FROM workout_completions
            WHERE user_id=? AND day_num=? AND completed_date=?
        """, (user_id, day_num, today)) as cur:
            row = await cur.fetchone()
    return bool(row and row[0] > 0)


# =========================
# âœ… ĞŸĞ ĞĞ“Ğ Ğ•Ğ¡Ğ¡-Ğ‘ĞĞ  Ğ”Ğ›Ğ¯ Ğ¢Ğ Ğ•ĞĞ˜Ğ ĞĞ’ĞĞ§ĞĞĞ“Ğ Ğ”ĞĞ¯
# =========================
def workout_progress_bar(done: int, total: int, width: int = 10) -> str:
    """Ğ’Ğ¸Ğ·ÑƒĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ¿Ñ€Ğ¾Ğ³Ñ€ĞµÑÑ-Ğ±Ğ°Ñ€ Ñ‚Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²Ğ¾Ñ‡Ğ½Ğ¾Ğ³Ğ¾ Ğ´Ğ½Ñ."""
    if total == 0:
        return "â–¡â–¡â–¡â–¡â–¡â–¡â–¡â–¡â–¡â–¡ 0%"
    pct = int(round(done / total * 100))
    filled = int(round(done / total * width))
    filled = max(0, min(filled, width))
    bar = "â– " * filled + "â–¡" * (width - filled)
    return f"{bar} {pct}%"


def build_day_display_text(day_num: int, day_text: str, exercises: List[str],
                            done: List[int], all_done: bool = False) -> str:
    """Ğ¡Ñ‚Ñ€Ğ¾Ğ¸Ñ‚ Ñ‚ĞµĞºÑÑ‚ Ğ´Ğ½Ñ Ñ‚Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²ĞºĞ¸ Ñ Ğ·Ğ°Ğ³Ğ¾Ğ»Ğ¾Ğ²ĞºĞ¾Ğ¼ Ñ‚Ğ¸Ğ¿Ğ° Ğ´Ğ½Ñ."""
    total = len(exercises)
    done_count = len(done)

    # ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ÑĞµĞ¼ Ñ‚Ğ¸Ğ¿ Ğ´Ğ½Ñ Ğ¸Ğ· Ñ‚ĞµĞºÑÑ‚Ğ° Ğ¿Ğ»Ğ°Ğ½Ğ°
    t = day_text.lower()
    if "Ğ²ĞµÑ€Ñ… Ñ‚ĞµĞ»Ğ°" in t:
        day_type = "Ğ’ĞµÑ€Ñ… Ñ‚ĞµĞ»Ğ°"
        day_emoji = "ğŸ’ª"
        day_note = "Ğ“Ñ€ÑƒĞ´ÑŒ, ÑĞ¿Ğ¸Ğ½Ğ°, Ğ¿Ğ»ĞµÑ‡Ğ¸, Ñ€ÑƒĞºĞ¸"
    elif "Ğ½Ğ¸Ğ· Ñ‚ĞµĞ»Ğ°" in t or ("Ğ½Ğ¸Ğ¶" in t and "Ñ‚ĞµĞ»" in t):
        day_type = "ĞĞ¸Ğ· Ñ‚ĞµĞ»Ğ°"
        day_emoji = "ğŸ¦µ"
        day_note = "ĞšĞ²Ğ°Ğ´Ñ€Ğ¸Ñ†ĞµĞ¿Ñ, Ğ±Ğ¸Ñ†ĞµĞ¿Ñ Ğ±ĞµĞ´Ñ€Ğ°, ÑĞ³Ğ¾Ğ´Ğ¸Ñ†Ñ‹, Ğ¸ĞºÑ€Ñ‹"
    elif "Ñ‚Ğ¾Ğ»Ñ‡Ğ¾Ğº" in t or ("Ğ³Ñ€ÑƒĞ´ÑŒ Ğ¸ Ğ¿Ğ»ĞµÑ‡" in t):
        day_type = "Ğ¢Ğ¾Ğ»Ñ‡Ğ¾Ğº (Ğ“Ñ€ÑƒĞ´ÑŒ Ğ¸ ĞŸĞ»ĞµÑ‡Ğ¸)"
        day_emoji = "ğŸ‹ï¸"
        day_note = "Ğ“Ñ€ÑƒĞ´ÑŒ, Ğ´ĞµĞ»ÑŒÑ‚Ñ‹, Ñ‚Ñ€Ğ¸Ñ†ĞµĞ¿Ñ"
    elif ("Ñ‚ÑĞ³Ğ°" in t and "ÑĞ¿Ğ¸Ğ½Ğ°" in t) or ("ÑĞ¿Ğ¸Ğ½Ğ° Ğ¸ Ğ±Ğ¸Ñ†ĞµĞ¿Ñ" in t):
        day_type = "Ğ¢ÑĞ³Ğ° (Ğ¡Ğ¿Ğ¸Ğ½Ğ° Ğ¸ Ğ‘Ğ¸Ñ†ĞµĞ¿Ñ)"
        day_emoji = "ğŸ”™"
        day_note = "Ğ¨Ğ¸Ñ€Ğ¾Ñ‡Ğ°Ğ¹ÑˆĞ¸Ğµ, Ñ€Ğ¾Ğ¼Ğ±Ğ¾Ğ²Ğ¸Ğ´Ğ½Ñ‹Ğµ, Ğ±Ğ¸Ñ†ĞµĞ¿Ñ"
    elif "Ğ½Ğ¾Ğ³Ğ¸" in t and "ĞºĞ²Ğ°Ğ´Ñ€Ğ¸Ñ†ĞµĞ¿Ñ" in t:
        day_type = "ĞĞ¾Ğ³Ğ¸"
        day_emoji = "ğŸ¦µ"
        day_note = "ĞšĞ²Ğ°Ğ´Ñ€Ğ¸Ñ†ĞµĞ¿Ñ, Ğ±Ğ¸Ñ†ĞµĞ¿Ñ Ğ±ĞµĞ´Ñ€Ğ°, ÑĞ³Ğ¾Ğ´Ğ¸Ñ†Ñ‹, Ğ¸ĞºÑ€Ñ‹"
    elif "Ñ„ÑƒĞ»Ğ±Ğ°Ğ´Ğ¸" in t or "fullbody" in t:
        suffix_map = {1: "Ğ", 2: "Ğ‘", 3: "Ğ’"}
        s = suffix_map.get(day_num, "")
        day_type = f"Ğ¤ÑƒĞ»Ğ±Ğ°Ğ´Ğ¸ {s}".strip()
        day_emoji = "ğŸ’ª"
        day_note = "Ğ’ÑÑ‘ Ñ‚ĞµĞ»Ğ¾"
    else:
        day_type = get_day_display_name(day_num, day_text)
        day_emoji = "ğŸ’ª"
        day_note = ""

    lines = []
    lines.append(f"{day_emoji} Ğ”ĞµĞ½ÑŒ {day_num}: {day_type}")
    if day_note:
        lines.append(f"ğŸ“Œ {day_note}")
    lines.append("")
    lines.append("âš ï¸ ĞŸĞµÑ€ĞµĞ´ Ñ‚Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²ĞºĞ¾Ğ¹ Ñ€Ğ°Ğ·Ğ¾Ğ¼Ğ½Ğ¸ÑÑŒ 5â€“10 Ğ¼Ğ¸Ğ½ÑƒÑ‚")
    lines.append("â± ĞÑ‚Ğ´Ñ‹Ñ… Ğ¼ĞµĞ¶Ğ´Ñƒ Ğ¿Ğ¾Ğ´Ñ…Ğ¾Ğ´Ğ°Ğ¼Ğ¸: ~1.5â€“2 Ğ¼Ğ¸Ğ½ | ğŸ“š ĞšĞ½Ğ¾Ğ¿ĞºĞ° Â«Ğ¢ĞµÑ…Ğ½Ğ¸ĞºĞ°Â» Ğ¿Ğ¾Ğ´ ĞºĞ°Ğ¶Ğ´Ñ‹Ğ¼ ÑƒĞ¿Ñ€Ğ°Ğ¶Ğ½ĞµĞ½Ğ¸ĞµĞ¼")
    lines.append("")

    ex_full = parse_exercises_full(day_text)
    for idx, (name, sets_reps) in enumerate(ex_full):
        is_done = idx in done
        mark = "âœ…" if is_done else "ğŸ”¸"
        if sets_reps:
            lines.append(f"{mark} {name} {sets_reps}")
        else:
            lines.append(f"{mark} {name}")

    lines.append("")
    lines.append("ğŸ ĞŸĞ¾ÑĞ»Ğµ Ñ‚Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²ĞºĞ¸ â€” Ğ·Ğ°Ğ¼Ğ¸Ğ½ĞºĞ° Ğ¸ Ñ€Ğ°ÑÑ‚ÑĞ¶ĞºĞ° 5â€“10 Ğ¼Ğ¸Ğ½ÑƒÑ‚")
    lines.append("")

    bar = workout_progress_bar(done_count, total)
    if all_done:
        lines.append(f"{bar}")
        lines.append(f"âœ… {done_count}/{total} ÑƒĞ¿Ñ€Ğ°Ğ¶Ğ½ĞµĞ½Ğ¸Ğ¹ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¾")
        lines.append("")
        lines.append("ğŸ‰ ĞĞ¢Ğ›Ğ˜Ğ§ĞĞ! Ğ”ĞµĞ½ÑŒ Ğ·Ğ°ÑÑ‡Ğ¸Ñ‚Ğ°Ğ½!")
    else:
        lines.append(f"{bar}")
        lines.append(f"âœ… {done_count}/{total} ÑƒĞ¿Ñ€Ğ°Ğ¶Ğ½ĞµĞ½Ğ¸Ğ¹ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¾")

    return "\n".join(lines)


# =========================
# Ğ¢Ğ Ğ•ĞĞ˜Ğ ĞĞ’ĞšĞ˜: Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ
# =========================
def _limits_tags(limits: str) -> Dict[str, bool]:
    t = (limits or "").lower()
    return {
        "knee": any(x in t for x in ["ĞºĞ¾Ğ»ĞµĞ½", "ĞºĞ¾Ğ»ĞµĞ½Ğ¾", "Ğ¼ĞµĞ½Ğ¸ÑĞº", "ÑĞ²ÑĞ·Ğº", "ĞºÑ€ĞµÑÑ‚"]),
        "back": any(x in t for x in ["ÑĞ¿Ğ¸Ğ½", "Ğ¿Ğ¾ÑÑĞ½Ğ¸Ñ†", "Ğ³Ñ€Ñ‹Ğ¶", "Ğ¿Ñ€Ğ¾Ñ‚Ñ€ÑƒĞ·", "ÑĞºĞ¾Ğ»Ğ¸Ğ¾Ğ·"]),
        "shoulder": any(x in t for x in ["Ğ¿Ğ»ĞµÑ‡", "Ğ»Ğ¾Ğ¿Ğ°Ñ‚", "Ñ€Ğ¾Ñ‚Ğ°Ñ‚Ğ¾Ñ€", "Ğ¸Ğ¼Ğ¿Ğ¸Ğ½Ğ´Ğ¶"]),
        "elbow": any(x in t for x in ["Ğ»Ğ¾ĞºÑ‚", "Ñ‚ĞµĞ½Ğ´Ğ¸Ğ½Ğ¸Ñ‚"]),
    }


def generate_workout_plan(goal: str, place: str, exp: str, freq: int, limits: str, user_id: int = 0) -> Tuple[str, dict]:
    pl = (place or "").lower()
    is_gym = ("Ğ·Ğ°Ğ»" in pl) or (pl == "gym") or ("gym" in pl)
    where = "Ğ—ĞĞ›" if is_gym else "Ğ¡Ğ’ĞĞ™ Ğ’Ğ•Ğ¡"

    lvl = exp_level(exp)
    is_novice = (lvl == "novice")
    g = (goal or "").lower()

    is_cut = ("ÑÑƒÑˆ" in g)
    is_strength = ("ÑĞ¸Ğ»" in g)
    is_endurance = ("Ğ²Ñ‹Ğ½Ğ¾Ñ" in g)

    tags = _limits_tags(limits)

    f = int(freq or 3)
    f = max(MIN_DAYS, min(f, MAX_DAYS))

    if is_strength:
        reps_base = "3â€“6"
        reps_iso = "8â€“12"
        base_sets = "3" if is_novice else "4â€“5"
        iso_sets = "2" if is_novice else "2â€“3"
        rir = "1â€“2"
    elif is_endurance:
        reps_base = "12â€“20"
        reps_iso = "15â€“25"
        base_sets = "2â€“3"
        iso_sets = "2â€“3"
        rir = "2â€“3"
    else:
        reps_base = "6â€“10" if not is_cut else "8â€“12"
        reps_iso = "10â€“15" if not is_cut else "12â€“20"
        base_sets = "3" if is_novice else "3â€“4"
        iso_sets = "2â€“3" if is_novice else "3"
        rir = "1â€“2"

    seed = (user_id or 0) + int(datetime.utcnow().strftime("%Y%m%d"))
    rnd = random.Random(seed)

    avoid_knee = ["Ğ¿Ñ€Ğ¸ÑĞµĞ´", "Ğ¶Ğ¸Ğ¼ Ğ½Ğ¾Ğ³", "Ğ²Ñ‹Ğ¿Ğ°Ğ´", "Ğ±Ğ¾Ğ»Ğ³Ğ°Ñ€", "Ñ€Ğ°Ğ·Ğ³Ğ¸Ğ±"]
    avoid_back = ["Ñ‚ÑĞ³Ğ°", "ÑÑ‚Ğ°Ğ½Ğ¾Ğ²", "Ğ½Ğ°ĞºĞ»Ğ¾Ğ½", "Ñ€ÑƒĞ¼Ñ‹Ğ½", "Ğ³Ñ€ĞµĞ±Ğ»"]
    avoid_shoulder = ["Ğ¶Ğ¸Ğ¼ Ğ²Ğ²ĞµÑ€Ñ…", "Ğ¶Ğ¸Ğ¼ Ğ»Ñ‘Ğ¶Ğ°", "Ğ¾Ñ‚Ğ¶Ğ¸Ğ¼", "Ğ¶Ğ¸Ğ¼ Ğ² Ñ‚Ñ€ĞµĞ½Ğ°Ğ¶"]
    avoid_elbow = ["Ñ€Ğ°Ğ·Ğ³Ğ¸Ğ±", "Ñ„Ñ€Ğ°Ğ½Ñ†ÑƒĞ·", "Ñ‚Ñ€Ğ¸Ñ†ĞµĞ¿Ñ", "ÑĞ³Ğ¸Ğ±Ğ°Ğ½"]

    def avoid_keys_for_base():
        keys = []
        if tags["knee"]:
            keys += avoid_knee
        if tags["back"]:
            keys += avoid_back
        if tags["shoulder"]:
            keys += avoid_shoulder
        if tags["elbow"]:
            keys += avoid_elbow
        return keys

    def pick(pool: List[str], avoid_keys: List[str]) -> str:
        safe = [it for it in pool if not any(k in it.lower() for k in avoid_keys)]
        return rnd.choice(safe) if safe else (rnd.choice(pool) if pool else "â€”")

    avoid_keys = avoid_keys_for_base()

    if is_gym:
        # --- Ğ—ĞĞ›: Ğ¿ÑƒĞ»Ñ‹ Ñ ĞĞ‘Ğ¯Ğ—ĞĞ¢Ğ•Ğ›Ğ¬ĞĞ«ĞœĞ˜ Ğ±Ğ°Ğ·Ğ¾Ğ²Ñ‹Ğ¼Ğ¸ ÑƒĞ¿Ñ€Ğ°Ğ¶Ğ½ĞµĞ½Ğ¸ÑĞ¼Ğ¸ ---
        SQUAT = [
            "ĞŸÑ€Ğ¸ÑĞµĞ´ ÑĞ¾ ÑˆÑ‚Ğ°Ğ½Ğ³Ğ¾Ğ¹",           # Ğ‘ĞĞ—Ğ â€” Ğ²ÑĞµĞ³Ğ´Ğ° Ğ²ĞºĞ»ÑÑ‡Ñ‘Ğ½
            "Ğ–Ğ¸Ğ¼ Ğ½Ğ¾Ğ³Ğ°Ğ¼Ğ¸ Ğ² Ñ‚Ñ€ĞµĞ½Ğ°Ğ¶Ñ‘Ñ€Ğµ",
            "Ğ“Ğ¾Ğ±Ğ»ĞµÑ‚-Ğ¿Ñ€Ğ¸ÑĞµĞ´ Ñ Ğ³Ğ°Ğ½Ñ‚ĞµĞ»ĞµĞ¹",
            "Ğ¥Ğ°ĞºĞº-Ğ¿Ñ€Ğ¸ÑĞµĞ´ Ğ² Ñ‚Ñ€ĞµĞ½Ğ°Ğ¶Ñ‘Ñ€Ğµ",
            "ĞŸÑ€Ğ¸ÑĞµĞ´ Ñ Ğ³Ğ°Ğ½Ñ‚ĞµĞ»ÑĞ¼Ğ¸ (Goblet)",
            "Ğ‘Ğ¾Ğ»Ğ³Ğ°Ñ€ÑĞºĞ¸Ğµ Ğ²Ñ‹Ğ¿Ğ°Ğ´Ñ‹ Ñ Ğ³Ğ°Ğ½Ñ‚ĞµĞ»ÑĞ¼Ğ¸",
            "Ğ’Ñ‹Ğ¿Ğ°Ğ´Ñ‹ Ñ Ğ³Ğ°Ğ½Ñ‚ĞµĞ»ÑĞ¼Ğ¸ (Ñ…Ğ¾Ğ´ÑŒĞ±Ğ°)",
        ]
        HINGE = [
            "Ğ ÑƒĞ¼Ñ‹Ğ½ÑĞºĞ°Ñ Ñ‚ÑĞ³Ğ° ÑĞ¾ ÑˆÑ‚Ğ°Ğ½Ğ³Ğ¾Ğ¹",   # Ğ‘ĞĞ—Ğ
            "Ğ¡Ñ‚Ğ°Ğ½Ğ¾Ğ²Ğ°Ñ Ñ‚ÑĞ³Ğ° (Ñ‚ĞµÑ…Ğ½Ğ¸ĞºĞ°)",      # Ğ‘ĞĞ—Ğ
            "Ğ ÑƒĞ¼Ñ‹Ğ½ÑĞºĞ°Ñ Ñ‚ÑĞ³Ğ° Ñ Ğ³Ğ°Ğ½Ñ‚ĞµĞ»ÑĞ¼Ğ¸",
            "Ğ¯Ğ³Ğ¾Ğ´Ğ¸Ñ‡Ğ½Ñ‹Ğ¹ Ğ¼Ğ¾ÑÑ‚ ÑĞ¾ ÑˆÑ‚Ğ°Ğ½Ğ³Ğ¾Ğ¹",
            "Ğ¡Ğ³Ğ¸Ğ±Ğ°Ğ½Ğ¸Ñ Ğ½Ğ¾Ğ³ Ğ² Ñ‚Ñ€ĞµĞ½Ğ°Ğ¶Ñ‘Ñ€Ğµ",
            "Ğ“Ğ¸Ğ¿ĞµÑ€ÑĞºÑÑ‚ĞµĞ½Ğ·Ğ¸Ñ Ñ Ğ²ĞµÑĞ¾Ğ¼",
        ]
        HPUSH = [
            "Ğ–Ğ¸Ğ¼ ÑˆÑ‚Ğ°Ğ½Ğ³Ğ¸ Ğ»Ñ‘Ğ¶Ğ°",             # Ğ‘ĞĞ—Ğ â€” Ğ¿Ñ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚
            "Ğ–Ğ¸Ğ¼ Ğ³Ğ°Ğ½Ñ‚ĞµĞ»ĞµĞ¹ Ğ»Ñ‘Ğ¶Ğ°",           # Ğ‘ĞĞ—Ğ
            "Ğ–Ğ¸Ğ¼ ÑˆÑ‚Ğ°Ğ½Ğ³Ğ¸ Ğ¿Ğ¾Ğ´ ÑƒĞ³Ğ»Ğ¾Ğ¼ (incline)",
            "Ğ–Ğ¸Ğ¼ Ğ² Ñ‚Ñ€ĞµĞ½Ğ°Ğ¶Ñ‘Ñ€Ğµ (Ğ³Ñ€ÑƒĞ´ÑŒ)",
            "Ğ¡Ğ²ĞµĞ´ĞµĞ½Ğ¸Ñ Ğ² ĞºÑ€Ğ¾ÑÑĞ¾Ğ²ĞµÑ€Ğµ (Ğ³Ñ€ÑƒĞ´ÑŒ)",
            "Ğ–Ğ¸Ğ¼ Ğ³Ğ°Ğ½Ñ‚ĞµĞ»ĞµĞ¹ Ğ¿Ğ¾Ğ´ ÑƒĞ³Ğ»Ğ¾Ğ¼ (incline)",
            "ĞÑ‚Ğ¶Ğ¸Ğ¼Ğ°Ğ½Ğ¸Ñ Ñ Ğ²ĞµÑĞ¾Ğ¼ (Ğ¶Ğ¸Ğ»ĞµÑ‚/Ğ±Ğ»Ğ¸Ğ½)",
        ]
        HPULL = [
            "Ğ¢ÑĞ³Ğ° ÑˆÑ‚Ğ°Ğ½Ğ³Ğ¸ Ğ² Ğ½Ğ°ĞºĞ»Ğ¾Ğ½Ğµ",       # Ğ‘ĞĞ—Ğ
            "Ğ¢ÑĞ³Ğ° Ğ³Ğ¾Ñ€Ğ¸Ğ·Ğ¾Ğ½Ñ‚Ğ°Ğ»ÑŒĞ½Ğ¾Ğ³Ğ¾ Ğ±Ğ»Ğ¾ĞºĞ°",
            "Ğ¢ÑĞ³Ğ° Ğ³Ğ°Ğ½Ñ‚ĞµĞ»Ğ¸ Ğ¾Ğ´Ğ½Ğ¾Ğ¹ Ñ€ÑƒĞºĞ¾Ğ¹",
            "Ğ¢ÑĞ³Ğ° Ğ¢-Ğ³Ñ€Ğ¸Ñ„Ğ°",
            "Ğ¢ÑĞ³Ğ° Ğ² Ñ‚Ñ€ĞµĞ½Ğ°Ğ¶Ñ‘Ñ€Ğµ (Ğ³Ñ€ÑƒĞ´ÑŒ ÑƒĞ¿Ğ¾Ñ€)",
            "Ğ¢ÑĞ³Ğ° Ğ½Ğ¸Ğ¶Ğ½ĞµĞ³Ğ¾ Ğ±Ğ»Ğ¾ĞºĞ° Ğ¿Ğ°Ñ€Ğ°Ğ»Ğ»ĞµĞ»ÑŒĞ½Ñ‹Ğ¼ Ñ…Ğ²Ğ°Ñ‚Ğ¾Ğ¼",
        ]
        VPULL = [
            "ĞŸĞ¾Ğ´Ñ‚ÑĞ³Ğ¸Ğ²Ğ°Ğ½Ğ¸Ñ (ÑˆĞ¸Ñ€Ğ¾ĞºĞ¸Ğ¹ Ñ…Ğ²Ğ°Ñ‚)", # Ğ‘ĞĞ—Ğ
            "ĞŸĞ¾Ğ´Ñ‚ÑĞ³Ğ¸Ğ²Ğ°Ğ½Ğ¸Ñ Ğ½ĞµĞ¹Ñ‚Ñ€Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¼ Ñ…Ğ²Ğ°Ñ‚Ğ¾Ğ¼",
            "Ğ’ĞµÑ€Ñ…Ğ½Ğ¸Ğ¹ Ğ±Ğ»Ğ¾Ğº ÑˆĞ¸Ñ€Ğ¾ĞºĞ¸Ğ¼ Ñ…Ğ²Ğ°Ñ‚Ğ¾Ğ¼",
            "Ğ’ĞµÑ€Ñ…Ğ½Ğ¸Ğ¹ Ğ±Ğ»Ğ¾Ğº ÑƒĞ·ĞºĞ¸Ğ¼ Ñ…Ğ²Ğ°Ñ‚Ğ¾Ğ¼",
            "Ğ¢ÑĞ³Ğ° Ğ²ĞµÑ€Ñ…Ğ½ĞµĞ³Ğ¾ Ğ±Ğ»Ğ¾ĞºĞ° Ğ¿Ğ°Ñ€Ğ°Ğ»Ğ»ĞµĞ»ÑŒĞ½Ñ‹Ğ¼ Ñ…Ğ²Ğ°Ñ‚Ğ¾Ğ¼",
        ]
        VPUSH = [
            "Ğ–Ğ¸Ğ¼ ÑˆÑ‚Ğ°Ğ½Ğ³Ğ¸ ÑÑ‚Ğ¾Ñ (overhead press)",  # Ğ‘ĞĞ—Ğ
            "ĞÑ€Ğ¼ĞµĞ¹ÑĞºĞ¸Ğ¹ Ğ¶Ğ¸Ğ¼",                      # Ğ‘ĞĞ—Ğ
            "Ğ–Ğ¸Ğ¼ Ğ³Ğ°Ğ½Ñ‚ĞµĞ»ĞµĞ¹ ÑÑ‚Ğ¾Ñ/ÑĞ¸Ğ´Ñ",
            "Ğ–Ğ¸Ğ¼ Ğ² Ñ‚Ñ€ĞµĞ½Ğ°Ğ¶Ñ‘Ñ€Ğµ Ğ²Ğ²ĞµÑ€Ñ…",
        ]
        SHOULD = [
            "Ğ Ğ°Ğ·Ğ²ĞµĞ´ĞµĞ½Ğ¸Ñ Ğ³Ğ°Ğ½Ñ‚ĞµĞ»ĞµĞ¹ Ğ² ÑÑ‚Ğ¾Ñ€Ğ¾Ğ½Ñ‹",
            "Face pull Ğ½Ğ° Ğ±Ğ»Ğ¾ĞºĞµ (ĞºĞ°Ğ½Ğ°Ñ‚)",
            "Ğ—Ğ°Ğ´Ğ½ÑÑ Ğ´ĞµĞ»ÑŒÑ‚Ğ° Ğ² Ñ‚Ñ€ĞµĞ½Ğ°Ğ¶Ñ‘Ñ€Ğµ (pec deck)",
            "Ğ Ğ°Ğ·Ğ²ĞµĞ´ĞµĞ½Ğ¸Ñ Ğ³Ğ°Ğ½Ñ‚ĞµĞ»ĞµĞ¹ Ğ² Ğ½Ğ°ĞºĞ»Ğ¾Ğ½Ğµ (Ğ·Ğ°Ğ´Ğ½ÑÑ Ğ´ĞµĞ»ÑŒÑ‚Ğ°)",
            "Ğ¢ÑĞ³Ğ° ÑˆÑ‚Ğ°Ğ½Ğ³Ğ¸ Ğº Ğ¿Ğ¾Ğ´Ğ±Ğ¾Ñ€Ğ¾Ğ´ĞºÑƒ (ÑˆĞ¸Ñ€Ğ¾ĞºĞ¸Ğ¹ Ñ…Ğ²Ğ°Ñ‚)",
        ]
        BI = [
            "Ğ¡Ğ³Ğ¸Ğ±Ğ°Ğ½Ğ¸Ñ Ğ³Ğ°Ğ½Ñ‚ĞµĞ»ĞµĞ¹ ÑÑ‚Ğ¾Ñ",
            "Ğ¡Ğ³Ğ¸Ğ±Ğ°Ğ½Ğ¸Ñ Ğ½Ğ° Ğ±Ğ»Ğ¾ĞºĞµ (Ğ½Ğ¸Ğ¶Ğ½Ğ¸Ğ¹)",
            "ĞœĞ¾Ğ»Ğ¾Ñ‚ĞºĞ¸ Ñ Ğ³Ğ°Ğ½Ñ‚ĞµĞ»ÑĞ¼Ğ¸",
            "Ğ¡Ğ³Ğ¸Ğ±Ğ°Ğ½Ğ¸Ñ Ğ½Ğ° ÑĞºĞ°Ğ¼ÑŒĞµ Ğ¡ĞºĞ¾Ñ‚Ñ‚Ğ°",
            "ĞšĞ¾Ğ½Ñ†ĞµĞ½Ñ‚Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğµ ÑĞ³Ğ¸Ğ±Ğ°Ğ½Ğ¸Ñ",
        ]
        TRI = [
            "Ğ Ğ°Ğ·Ğ³Ğ¸Ğ±Ğ°Ğ½Ğ¸Ñ Ğ½Ğ° Ğ²ĞµÑ€Ñ…Ğ½ĞµĞ¼ Ğ±Ğ»Ğ¾ĞºĞµ (Ğ¿Ñ€ÑĞ¼Ğ°Ñ Ñ€ÑƒĞºĞ¾ÑÑ‚ÑŒ)",
            "Ğ Ğ°Ğ·Ğ³Ğ¸Ğ±Ğ°Ğ½Ğ¸Ñ Ğ½Ğ° Ğ±Ğ»Ğ¾ĞºĞµ (ĞºĞ°Ğ½Ğ°Ñ‚, Ğ¾Ğ´Ğ½Ğ¾Ğ¹ Ñ€ÑƒĞºĞ¾Ğ¹)",
            "Ğ¤Ñ€Ğ°Ğ½Ñ†ÑƒĞ·ÑĞºĞ¸Ğ¹ Ğ¶Ğ¸Ğ¼ Ğ»Ñ‘Ğ¶Ğ° Ñ Ğ³Ğ°Ğ½Ñ‚ĞµĞ»ÑĞ¼Ğ¸",
            "ĞÑ‚Ğ¶Ğ¸Ğ¼Ğ°Ğ½Ğ¸Ñ ÑƒĞ·ĞºĞ¸Ğµ",
            "Ğ Ğ°Ğ·Ğ³Ğ¸Ğ±Ğ°Ğ½Ğ¸Ğµ Ğ³Ğ°Ğ½Ñ‚ĞµĞ»Ğ¸ Ğ¸Ğ·-Ğ·Ğ° Ğ³Ğ¾Ğ»Ğ¾Ğ²Ñ‹",
        ]
        CALVES = [
            "ĞŸĞ¾Ğ´ÑŠÑ‘Ğ¼Ñ‹ Ğ½Ğ° Ğ½Ğ¾ÑĞºĞ¸ ÑÑ‚Ğ¾Ñ Ğ² Ñ‚Ñ€ĞµĞ½Ğ°Ğ¶Ñ‘Ñ€Ğµ",
            "ĞŸĞ¾Ğ´ÑŠÑ‘Ğ¼Ñ‹ Ğ½Ğ° Ğ½Ğ¾ÑĞºĞ¸ ÑĞ¸Ğ´Ñ Ğ² Ñ‚Ñ€ĞµĞ½Ğ°Ğ¶Ñ‘Ñ€Ğµ",
            "ĞŸĞ¾Ğ´ÑŠÑ‘Ğ¼Ñ‹ Ğ½Ğ° Ğ½Ğ¾ÑĞºĞ¸ Ñ Ğ³Ğ°Ğ½Ñ‚ĞµĞ»ÑĞ¼Ğ¸ (Ğ¾Ğ´Ğ½Ğ° Ğ½Ğ¾Ğ³Ğ°)",
        ]
        CORE = [
            "ĞŸĞ»Ğ°Ğ½ĞºĞ° (ÑÑ‚Ğ°Ñ‚Ğ¸ĞºĞ°)",
            "Ğ¡ĞºÑ€ÑƒÑ‡Ğ¸Ğ²Ğ°Ğ½Ğ¸Ñ Ğ½Ğ° Ğ±Ğ»Ğ¾ĞºĞµ",
            "ĞŸĞ¾Ğ´ÑŠÑ‘Ğ¼Ñ‹ Ğ½Ğ¾Ğ³ Ğ² Ğ²Ğ¸ÑĞµ",
            "ĞŸĞ¾Ğ´ÑŠÑ‘Ğ¼Ñ‹ Ğ½Ğ¾Ğ³ Ğ² ÑƒĞ¿Ğ¾Ñ€Ğµ Ğ½Ğ° Ğ»Ğ¾ĞºÑ‚ÑÑ…",
            "Ğ Ğ¾Ğ»Ğ¸Ğº Ğ´Ğ»Ñ Ğ¿Ñ€ĞµÑÑĞ° (ab wheel)",
        ]
    else:
        # --- Ğ”ĞĞœĞ: Ğ¿ÑƒĞ»Ñ‹ Ñ ĞĞ‘Ğ¯Ğ—ĞĞ¢Ğ•Ğ›Ğ¬ĞĞ«ĞœĞ˜ Ğ±Ğ°Ğ·Ğ¾Ğ²Ñ‹Ğ¼Ğ¸ ÑƒĞ¿Ñ€Ğ°Ğ¶Ğ½ĞµĞ½Ğ¸ÑĞ¼Ğ¸ ---
        SQUAT = [
            "ĞŸÑ€Ğ¸ÑĞµĞ´Ğ°Ğ½Ğ¸Ñ (ÑĞ¾Ğ±ÑÑ‚Ğ²ĞµĞ½Ğ½Ñ‹Ğ¹ Ğ²ĞµÑ)",  # Ğ‘ĞĞ—Ğ
            "ĞŸÑ€Ğ¸ÑĞµĞ´ Ñ Ğ¿Ğ°ÑƒĞ·Ğ¾Ğ¹ Ğ²Ğ½Ğ¸Ğ·Ñƒ",
            "ĞŸÑ€Ğ¸ÑĞµĞ´ ÑÑƒĞ¼Ğ¾",
            "Ğ‘Ğ¾Ğ»Ğ³Ğ°Ñ€ÑĞºĞ¸Ğµ Ğ²Ñ‹Ğ¿Ğ°Ğ´Ñ‹ (Ğ½Ğ¾Ğ³Ğ° Ğ½Ğ° ÑÑ‚ÑƒĞ»Ğµ)",
            "Ğ’Ñ‹Ğ¿Ğ°Ğ´Ñ‹ Ğ½Ğ° Ğ¼ĞµÑÑ‚Ğµ",
            "Ğ’Ñ‹Ğ¿Ğ°Ğ´Ñ‹ Ñ…Ğ¾Ğ´ÑŒĞ±Ğ¾Ğ¹",
            "ĞŸÑ€Ğ¸ÑĞµĞ´Ğ°Ğ½Ğ¸Ñ Ğ½Ğ° Ğ¾Ğ´Ğ½Ğ¾Ğ¹ Ğ½Ğ¾Ğ³Ğµ (Ğ¿Ğ¸ÑÑ‚Ğ¾Ğ»ĞµÑ‚, Ğ¾Ğ±Ğ»ĞµĞ³Ñ‡Ñ‘Ğ½Ğ½Ğ¾)",
        ]
        HINGE = [
            "Ğ¯Ğ³Ğ¾Ğ´Ğ¸Ñ‡Ğ½Ñ‹Ğ¹ Ğ¼Ğ¾ÑÑ‚",               # Ğ‘ĞĞ—Ğ
            "Ğ¯Ğ³Ğ¾Ğ´Ğ¸Ñ‡Ğ½Ñ‹Ğ¹ Ğ¼Ğ¾ÑÑ‚ Ğ½Ğ° Ğ¾Ğ´Ğ½Ğ¾Ğ¹ Ğ½Ğ¾Ğ³Ğµ",
            "Ğ“Ğ¸Ğ¿ĞµÑ€ÑĞºÑÑ‚ĞµĞ½Ğ·Ğ¸Ñ Ğ½Ğ° Ğ¿Ğ¾Ğ»Ñƒ",
            "Good-morning (Ğ±ĞµĞ· Ğ²ĞµÑĞ°, Ñ‚ĞµÑ…Ğ½Ğ¸ĞºĞ°)",
            "Ğ ÑƒĞ¼Ñ‹Ğ½ÑĞºĞ°Ñ Ñ‚ÑĞ³Ğ° Ñ Ğ³Ğ°Ğ½Ñ‚ĞµĞ»ÑĞ¼Ğ¸ (ĞµÑĞ»Ğ¸ ĞµÑÑ‚ÑŒ)",
        ]
        HPUSH = [
            "ĞÑ‚Ğ¶Ğ¸Ğ¼Ğ°Ğ½Ğ¸Ñ (ĞºĞ»Ğ°ÑÑĞ¸ĞºĞ°)",          # Ğ‘ĞĞ—Ğ â€” Ğ²ÑĞµĞ³Ğ´Ğ°
            "ĞÑ‚Ğ¶Ğ¸Ğ¼Ğ°Ğ½Ğ¸Ñ Ñ Ğ¿Ğ°ÑƒĞ·Ğ¾Ğ¹ 2 ÑĞµĞº",
            "ĞÑ‚Ğ¶Ğ¸Ğ¼Ğ°Ğ½Ğ¸Ñ ÑƒĞ·ĞºĞ¸Ğµ (Ñ‚Ñ€Ğ¸Ñ†ĞµĞ¿Ñ)",     # Ğ‘ĞĞ—Ğ Ğ´Ğ»Ñ Ñ‚Ñ€Ğ¸Ñ†ĞµĞ¿ÑĞ°
            "ĞÑ‚Ğ¶Ğ¸Ğ¼Ğ°Ğ½Ğ¸Ñ Ğ¾Ñ‚ Ğ²Ğ¾Ğ·Ğ²Ñ‹ÑˆĞµĞ½Ğ¸Ñ (Ğ½Ğ¾Ğ³Ğ¸ Ğ½Ğ° ÑÑ‚ÑƒĞ»Ğµ)",
            "ĞÑ‚Ğ¶Ğ¸Ğ¼Ğ°Ğ½Ğ¸Ñ Ñ Ñ…Ğ»Ğ¾Ğ¿ĞºĞ¾Ğ¼ (Ğ²Ğ·Ñ€Ñ‹Ğ²Ğ½Ñ‹Ğµ)",
        ]
        HPULL = [
            "Ğ“Ğ¾Ñ€Ğ¸Ğ·Ğ¾Ğ½Ñ‚Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ¿Ğ¾Ğ´Ñ‚ÑĞ³Ğ¸Ğ²Ğ°Ğ½Ğ¸Ñ (Ğ¿Ğ¾Ğ´ ÑÑ‚Ğ¾Ğ»Ğ¾Ğ¼)",  # Ğ‘ĞĞ—Ğ
            "Ğ¢ÑĞ³Ğ° Ñ€ĞµĞ·Ğ¸Ğ½ĞºĞ¸ Ğº Ğ¿Ğ¾ÑÑÑƒ",
            "Ğ¢ÑĞ³Ğ° Ğ³Ğ°Ğ½Ñ‚ĞµĞ»Ğ¸ Ğ¾Ğ´Ğ½Ğ¾Ğ¹ Ñ€ÑƒĞºĞ¾Ğ¹ (Ğ² Ğ½Ğ°ĞºĞ»Ğ¾Ğ½Ğµ)",
            "Ğ¢ÑĞ³Ğ° Ñ€ĞµĞ·Ğ¸Ğ½ĞºĞ¸ Ğ² Ğ½Ğ°ĞºĞ»Ğ¾Ğ½Ğµ",
        ]
        VPULL = [
            "ĞŸĞ¾Ğ´Ñ‚ÑĞ³Ğ¸Ğ²Ğ°Ğ½Ğ¸Ñ (Ğ¾Ğ±Ñ€Ğ°Ñ‚Ğ½Ñ‹Ğ¹ Ñ…Ğ²Ğ°Ñ‚)",  # Ğ‘ĞĞ—Ğ
            "ĞŸĞ¾Ğ´Ñ‚ÑĞ³Ğ¸Ğ²Ğ°Ğ½Ğ¸Ñ (Ğ¿Ñ€ÑĞ¼Ğ¾Ğ¹ Ñ…Ğ²Ğ°Ñ‚)",    # Ğ‘ĞĞ—Ğ
            "ĞĞµĞ³Ğ°Ñ‚Ğ¸Ğ²Ğ½Ñ‹Ğµ Ğ¿Ğ¾Ğ´Ñ‚ÑĞ³Ğ¸Ğ²Ğ°Ğ½Ğ¸Ñ",
            "Ğ¢ÑĞ³Ğ° Ñ€ĞµĞ·Ğ¸Ğ½ĞºĞ¸ ÑĞ²ĞµÑ€Ñ…Ñƒ",
            "ĞŸĞ¾Ğ´Ñ‚ÑĞ³Ğ¸Ğ²Ğ°Ğ½Ğ¸Ñ Ğ½Ğ° Ğ¿ĞµÑ‚Ğ»ÑÑ… (TRX-ÑÑ‚Ğ¸Ğ»ÑŒ)",
        ]
        VPUSH = [
            "ĞŸĞ°Ğ¹Ğº-Ğ¾Ñ‚Ğ¶Ğ¸Ğ¼Ğ°Ğ½Ğ¸Ñ",               # Ğ‘ĞĞ—Ğ Ğ´Ğ»Ñ Ğ¿Ğ»ĞµÑ‡ Ğ´Ğ¾Ğ¼Ğ°
            "Ğ–Ğ¸Ğ¼ Ñ€ĞµĞ·Ğ¸Ğ½ĞºĞ¸ Ğ²Ğ²ĞµÑ€Ñ… (ÑÑ‚Ğ¾Ñ)",
            "ĞÑ‚Ğ¶Ğ¸Ğ¼Ğ°Ğ½Ğ¸Ñ (Ğ½Ğ¾Ğ³Ğ¸ Ğ²Ñ‹ÑĞ¾ĞºĞ¾ Ğ½Ğ° ÑÑ‚ÑƒĞ»Ğµ)",
        ]
        SHOULD = [
            "Ğ Ğ°Ğ·Ğ²ĞµĞ´ĞµĞ½Ğ¸Ñ Ğ³Ğ°Ğ½Ñ‚ĞµĞ»ĞµĞ¹ Ğ² ÑÑ‚Ğ¾Ñ€Ğ¾Ğ½Ñ‹",
            "Ğ¢ÑĞ³Ğ° Ñ€ĞµĞ·Ğ¸Ğ½ĞºĞ¸ Ğº Ğ»Ğ¸Ñ†Ñƒ (face pull)",
            "Ğ Ğ°Ğ·Ğ²ĞµĞ´ĞµĞ½Ğ¸Ñ Ğ³Ğ°Ğ½Ñ‚ĞµĞ»ĞµĞ¹ Ğ² Ğ½Ğ°ĞºĞ»Ğ¾Ğ½Ğµ (Ğ·Ğ°Ğ´Ğ½ÑÑ Ğ´ĞµĞ»ÑŒÑ‚Ğ°)",
            "Ğ¢ÑĞ³Ğ° Ñ€ĞµĞ·Ğ¸Ğ½ĞºĞ¸ Ğº Ğ¿Ğ¾Ğ´Ğ±Ğ¾Ñ€Ğ¾Ğ´ĞºÑƒ",
        ]
        BI = [
            "Ğ¡Ğ³Ğ¸Ğ±Ğ°Ğ½Ğ¸Ñ Ğ³Ğ°Ğ½Ñ‚ĞµĞ»ĞµĞ¹ ÑÑ‚Ğ¾Ñ",
            "ĞœĞ¾Ğ»Ğ¾Ñ‚ĞºĞ¸ Ñ Ğ³Ğ°Ğ½Ñ‚ĞµĞ»ÑĞ¼Ğ¸",
            "Ğ¡Ğ³Ğ¸Ğ±Ğ°Ğ½Ğ¸Ñ Ğ½Ğ° Ñ€ĞµĞ·Ğ¸Ğ½ĞºĞµ",
        ]
        TRI = [
            "ĞÑ‚Ğ¶Ğ¸Ğ¼Ğ°Ğ½Ğ¸Ñ ÑƒĞ·ĞºĞ¸Ğµ",
            "Ğ Ğ°Ğ·Ğ³Ğ¸Ğ±Ğ°Ğ½Ğ¸Ğµ Ğ³Ğ°Ğ½Ñ‚ĞµĞ»Ğ¸ Ğ¸Ğ·-Ğ·Ğ° Ğ³Ğ¾Ğ»Ğ¾Ğ²Ñ‹",
            "ĞĞ±Ñ€Ğ°Ñ‚Ğ½Ñ‹Ğµ Ğ¾Ñ‚Ğ¶Ğ¸Ğ¼Ğ°Ğ½Ğ¸Ñ Ğ¾Ñ‚ ÑÑ‚ÑƒĞ»Ğ°/Ğ»Ğ°Ğ²ĞºĞ¸",
        ]
        CALVES = [
            "ĞŸĞ¾Ğ´ÑŠÑ‘Ğ¼Ñ‹ Ğ½Ğ° Ğ½Ğ¾ÑĞºĞ¸ ÑÑ‚Ğ¾Ñ",
            "ĞŸĞ¾Ğ´ÑŠÑ‘Ğ¼Ñ‹ Ğ½Ğ° Ğ½Ğ¾ÑĞºĞ¸ Ğ½Ğ° Ğ¾Ğ´Ğ½Ğ¾Ğ¹ Ğ½Ğ¾Ğ³Ğµ",
            "ĞŸĞ¾Ğ´ÑŠÑ‘Ğ¼Ñ‹ Ğ½Ğ° Ğ½Ğ¾ÑĞºĞ¸ Ñ Ğ³Ğ°Ğ½Ñ‚ĞµĞ»ÑĞ¼Ğ¸",
        ]
        CORE = [
            "ĞŸĞ»Ğ°Ğ½ĞºĞ° (ÑÑ‚Ğ°Ñ‚Ğ¸ĞºĞ°)",
            "Ğ‘Ğ¾ĞºĞ¾Ğ²Ğ°Ñ Ğ¿Ğ»Ğ°Ğ½ĞºĞ°",
            "Ğ¡ĞºÑ€ÑƒÑ‡Ğ¸Ğ²Ğ°Ğ½Ğ¸Ñ Ğ½Ğ° Ğ¿Ğ¾Ğ»Ñƒ",
            "ĞŸĞ¾Ğ´ÑŠÑ‘Ğ¼Ñ‹ Ğ½Ğ¾Ğ³ Ğ»Ñ‘Ğ¶Ğ°",
            "Ğ’ĞµĞ»Ğ¾ÑĞ¸Ğ¿ĞµĞ´ (ÑĞºÑ€ÑƒÑ‡Ğ¸Ğ²Ğ°Ğ½Ğ¸Ñ Ñ Ğ¿Ğ¾Ğ²Ğ¾Ñ€Ğ¾Ñ‚Ğ¾Ğ¼)",
            "ĞĞ±Ñ€Ğ°Ñ‚Ğ½Ñ‹Ğµ ÑĞºÑ€ÑƒÑ‡Ğ¸Ğ²Ğ°Ğ½Ğ¸Ñ",
        ]

    if tags["elbow"]:
        TRI = [x for x in TRI if "Ñ„Ñ€Ğ°Ğ½Ñ†ÑƒĞ·" not in x.lower()]
    if tags["knee"]:
        SQUAT = [x for x in SQUAT if "Ğ²Ñ‹Ğ¿Ğ°Ğ´" not in x.lower() and "Ğ±Ğ¾Ğ»Ğ³Ğ°Ñ€" not in x.lower()]
    if tags["back"]:
        HINGE = [x for x in HINGE if "Ñ€ÑƒĞ¼Ñ‹Ğ½" not in x.lower()]

    if f == 3:
        system = "Ğ¤ÑƒĞ»Ğ±Ğ°Ğ´Ğ¸"
        template = ["FB-A", "FB-B", "FB-C"]
    elif f == 4:
        system = "Ğ’ĞµÑ€Ñ…/ĞĞ¸Ğ·"
        template = ["UPPER", "LOWER", "UPPER", "LOWER"]
    else:
        system = "PPL + Ğ’ĞµÑ€Ñ…/ĞĞ¸Ğ·"
        template = ["PUSH", "PULL", "LEGS", "UPPER", "LOWER"]

    def fmt(name: str, sets: str, reps: str) -> str:
        return f"{name} â€” {sets}Ã—{reps}"

    def day_block(kind: str) -> List[str]:
        lines = [f"RIR: {rir}", ""]
        if kind.startswith("FB"):
            squat = pick(SQUAT, avoid_keys)
            hinge = pick(HINGE, avoid_keys)
            hpush = pick(HPUSH, avoid_keys)
            hpull = pick(HPULL, avoid_keys)
            should = pick(SHOULD, avoid_keys)
            arms = pick(BI if rnd.random() < 0.5 else TRI, avoid_keys)

            lines.append("Ğ‘Ğ°Ğ·Ğ°:")
            lines.append(f"â€¢ {fmt(squat, base_sets, reps_base)}")
            lines.append(f"â€¢ {fmt(hpush, base_sets, reps_base)}")
            lines.append(f"â€¢ {fmt(hpull, base_sets, reps_base)}")
            lines.append(f"â€¢ {fmt(hinge, base_sets, reps_base)}")
            lines.append("")
            lines.append("Ğ˜Ğ·Ğ¾Ğ»ÑÑ†Ğ¸Ñ:")
            lines.append(f"â€¢ {fmt(should, iso_sets, reps_iso)}")
            lines.append(f"â€¢ {fmt(arms, iso_sets, reps_iso)}")
            if not is_novice:
                lines.append(f"â€¢ {fmt(pick(CORE, avoid_keys), '2', '30â€“60 ÑĞµĞº')}")
            return lines

        if kind == "UPPER":
            hpush = pick(HPUSH, avoid_keys)
            hpull = pick(HPULL, avoid_keys)
            vpush = pick(VPUSH, avoid_keys)
            vpull = pick(VPULL, avoid_keys)
            should = pick(SHOULD, avoid_keys)
            bi = pick(BI, avoid_keys)
            tri = pick(TRI, avoid_keys)

            lines.append("Ğ‘Ğ°Ğ·Ğ°:")
            lines.append(f"â€¢ {fmt(hpush, base_sets, reps_base)}")
            lines.append(f"â€¢ {fmt(hpull, base_sets, reps_base)}")
            lines.append(f"â€¢ {fmt(vpull, base_sets, reps_base)}")
            if not tags["shoulder"]:
                lines.append(f"â€¢ {fmt(vpush, base_sets, reps_base)}")
            lines.append("")
            lines.append("Ğ˜Ğ·Ğ¾Ğ»ÑÑ†Ğ¸Ñ:")
            lines.append(f"â€¢ {fmt(should, iso_sets, reps_iso)}")
            lines.append(f"â€¢ {fmt(bi, iso_sets, reps_iso)}")
            lines.append(f"â€¢ {fmt(tri, iso_sets, reps_iso)}")
            return lines

        if kind == "LOWER":
            squat = pick(SQUAT, avoid_keys)
            hinge = pick(HINGE, avoid_keys)
            calves = pick(CALVES, avoid_keys)
            core = pick(CORE, avoid_keys)

            lines.append("Ğ‘Ğ°Ğ·Ğ°:")
            lines.append(f"â€¢ {fmt(squat, base_sets, reps_base)}")
            lines.append(f"â€¢ {fmt(hinge, base_sets, reps_base)}")
            lines.append("")
            lines.append("Ğ˜Ğ·Ğ¾Ğ»ÑÑ†Ğ¸Ñ:")
            lines.append(f"â€¢ {fmt(calves, iso_sets, reps_iso)}")
            lines.append(f"â€¢ {fmt(core, '2', '30â€“60 ÑĞµĞº')}")
            return lines

        if kind == "PUSH":
            hpush = pick(HPUSH, avoid_keys)
            vpush = pick(VPUSH, avoid_keys)
            should = pick(SHOULD, avoid_keys)
            tri = pick(TRI, avoid_keys)

            lines.append("Ğ‘Ğ°Ğ·Ğ°:")
            lines.append(f"â€¢ {fmt(hpush, base_sets, reps_base)}")
            if not tags["shoulder"]:
                lines.append(f"â€¢ {fmt(vpush, base_sets, reps_base)}")
            lines.append("")
            lines.append("Ğ˜Ğ·Ğ¾Ğ»ÑÑ†Ğ¸Ñ:")
            lines.append(f"â€¢ {fmt(should, iso_sets, reps_iso)}")
            lines.append(f"â€¢ {fmt(tri, iso_sets, reps_iso)}")
            return lines

        if kind == "PULL":
            vpull = pick(VPULL, avoid_keys)
            hpull = pick(HPULL, avoid_keys)
            bi = pick(BI, avoid_keys)
            rear = pick(SHOULD, avoid_keys)

            lines.append("Ğ‘Ğ°Ğ·Ğ°:")
            lines.append(f"â€¢ {fmt(vpull, base_sets, reps_base)}")
            lines.append(f"â€¢ {fmt(hpull, base_sets, reps_base)}")
            lines.append("")
            lines.append("Ğ˜Ğ·Ğ¾Ğ»ÑÑ†Ğ¸Ñ:")
            lines.append(f"â€¢ {fmt(rear, iso_sets, reps_iso)}")
            lines.append(f"â€¢ {fmt(bi, iso_sets, reps_iso)}")
            return lines

        if kind == "LEGS":
            squat = pick(SQUAT, avoid_keys)
            hinge = pick(HINGE, avoid_keys)
            calves = pick(CALVES, avoid_keys)

            lines.append("Ğ‘Ğ°Ğ·Ğ°:")
            lines.append(f"â€¢ {fmt(squat, base_sets, reps_base)}")
            lines.append(f"â€¢ {fmt(hinge, base_sets, reps_base)}")
            lines.append("")
            lines.append("Ğ˜Ğ·Ğ¾Ğ»ÑÑ†Ğ¸Ñ:")
            lines.append(f"â€¢ {fmt(calves, iso_sets, reps_iso)}")
            return lines

        return ["â€”"]

    limits_line = (limits or "").strip() or "Ğ½ĞµÑ‚"

    intro = (
        f"ğŸ‹ï¸ Ğ¢Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²ĞºĞ¸ ({where})\n"
        f"Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ°: {system}\n"
        f"Ğ§Ğ°ÑÑ‚Ğ¾Ñ‚Ğ°: {f}Ã—/Ğ½ĞµĞ´ â€¢ {weekday_schedule(f)}\n"
        f"Ğ¦ĞµĞ»ÑŒ: {goal} â€¢ Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ: {'Ğ½Ğ¾Ğ²Ğ¸Ñ‡Ğ¾Ğº' if is_novice else 'ÑÑ€ĞµĞ´Ğ½Ğ¸Ğ¹+'}\n"
        f"ĞĞ³Ñ€.: {limits_line}\n\n"
        f"ĞŸÑ€Ğ°Ğ²Ğ¸Ğ»Ğ¾: Ñ‚ĞµÑ…Ğ½Ğ¸ĞºĞ° > Ğ²ĞµÑ â€¢ RIR {rir}\n"
        "Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸ Ğ´ĞµĞ½ÑŒ ĞºĞ½Ğ¾Ğ¿ĞºĞ¾Ğ¹ ğŸ‘‡"
    )

    # ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ñ ÑĞ¸ÑÑ‚ĞµĞ¼ Ğ´Ğ»Ñ Ğ·Ğ°Ğ³Ğ¾Ğ»Ğ¾Ğ²ĞºĞ¾Ğ²
    KIND_TITLES = {
        "FB-A": ("Ğ¤ÑƒĞ»Ğ±Ğ°Ğ´Ğ¸ Ğ", "Ğ’ÑÑ‘ Ñ‚ĞµĞ»Ğ¾: Ğ°ĞºÑ†ĞµĞ½Ñ‚ Ğ½Ğ° Ğ½Ğ¾Ğ³Ğ¸ Ğ¸ Ñ‚Ğ¾Ğ»Ñ‡Ğ¾Ğº"),
        "FB-B": ("Ğ¤ÑƒĞ»Ğ±Ğ°Ğ´Ğ¸ Ğ‘", "Ğ’ÑÑ‘ Ñ‚ĞµĞ»Ğ¾: Ğ°ĞºÑ†ĞµĞ½Ñ‚ Ğ½Ğ° ÑĞ¿Ğ¸Ğ½Ñƒ Ğ¸ Ñ‚ÑĞ³Ñƒ"),
        "FB-C": ("Ğ¤ÑƒĞ»Ğ±Ğ°Ğ´Ğ¸ Ğ’", "Ğ’ÑÑ‘ Ñ‚ĞµĞ»Ğ¾: ĞºĞ¾Ğ¼Ğ¿Ğ»ĞµĞºÑĞ½Ñ‹Ğ¹ Ğ´ĞµĞ½ÑŒ"),
        "UPPER": ("Ğ’ĞµÑ€Ñ… Ñ‚ĞµĞ»Ğ°", "Ğ“Ñ€ÑƒĞ´ÑŒ, ÑĞ¿Ğ¸Ğ½Ğ°, Ğ¿Ğ»ĞµÑ‡Ğ¸, Ñ€ÑƒĞºĞ¸"),
        "LOWER": ("ĞĞ¸Ğ· Ñ‚ĞµĞ»Ğ°", "ĞšĞ²Ğ°Ğ´Ñ€Ğ¸Ñ†ĞµĞ¿Ñ, Ğ±Ğ¸Ñ†ĞµĞ¿Ñ Ğ±ĞµĞ´Ñ€Ğ°, ÑĞ³Ğ¾Ğ´Ğ¸Ñ†Ñ‹, Ğ¸ĞºÑ€Ñ‹"),
        "PUSH": ("Ğ¢Ğ¾Ğ»Ñ‡Ğ¾Ğº â€” Ğ“Ñ€ÑƒĞ´ÑŒ Ğ¸ ĞŸĞ»ĞµÑ‡Ğ¸", "Ğ“Ñ€ÑƒĞ´ÑŒ, Ğ¿ĞµÑ€ĞµĞ´Ğ½Ğ¸Ğµ/ÑÑ€ĞµĞ´Ğ½Ğ¸Ğµ Ğ´ĞµĞ»ÑŒÑ‚Ñ‹, Ñ‚Ñ€Ğ¸Ñ†ĞµĞ¿Ñ"),
        "PULL": ("Ğ¢ÑĞ³Ğ° â€” Ğ¡Ğ¿Ğ¸Ğ½Ğ° Ğ¸ Ğ‘Ğ¸Ñ†ĞµĞ¿Ñ", "Ğ¨Ğ¸Ñ€Ğ¾Ñ‡Ğ°Ğ¹ÑˆĞ¸Ğµ, Ñ€Ğ¾Ğ¼Ğ±Ğ¾Ğ²Ğ¸Ğ´Ğ½Ñ‹Ğµ, Ğ±Ğ¸Ñ†ĞµĞ¿Ñ, Ğ·Ğ°Ğ´Ğ½ÑÑ Ğ´ĞµĞ»ÑŒÑ‚Ğ°"),
        "LEGS": ("ĞĞ¾Ğ³Ğ¸", "ĞšĞ²Ğ°Ğ´Ñ€Ğ¸Ñ†ĞµĞ¿Ñ, Ğ±Ğ¸Ñ†ĞµĞ¿Ñ Ğ±ĞµĞ´Ñ€Ğ°, ÑĞ³Ğ¾Ğ´Ğ¸Ñ†Ñ‹, Ğ¸ĞºÑ€Ñ‹"),
    }

    UPPER_LOWER_SCHEDULE = {
        1: "ĞŸĞ¾Ğ½ĞµĞ´ĞµĞ»ÑŒĞ½Ğ¸Ğº",
        2: "Ğ’Ñ‚Ğ¾Ñ€Ğ½Ğ¸Ğº",
        3: "Ğ§ĞµÑ‚Ğ²ĞµÑ€Ğ³",
        4: "ĞŸÑÑ‚Ğ½Ğ¸Ñ†Ğ°",
    }

    PPL_SCHEDULE = {
        1: "ĞŸĞ¾Ğ½ĞµĞ´ĞµĞ»ÑŒĞ½Ğ¸Ğº",
        2: "Ğ’Ñ‚Ğ¾Ñ€Ğ½Ğ¸Ğº",
        3: "Ğ¡Ñ€ĞµĞ´Ğ°",
        4: "ĞŸÑÑ‚Ğ½Ğ¸Ñ†Ğ°",
        5: "Ğ¡ÑƒĞ±Ğ±Ğ¾Ñ‚Ğ°",
    }

    days: Dict[str, str] = {}
    for d in range(1, f + 1):
        kind = template[d - 1]
        kind_title, kind_desc = KIND_TITLES.get(kind, (system, ""))

        if system == "Ğ’ĞµÑ€Ñ…/ĞĞ¸Ğ·":
            day_sched = UPPER_LOWER_SCHEDULE.get(d, f"Ğ”ĞµĞ½ÑŒ {d}")
            header = (
                f"Ğ”ĞµĞ½ÑŒ {d} â€” {kind_title}\n"
                f"ğŸ“… {day_sched}\n"
                f"ğŸ’¡ {kind_desc}\n"
                f"â± ~50â€“70 Ğ¼Ğ¸Ğ½\n\n"
            )
        elif system.startswith("PPL"):
            day_sched = PPL_SCHEDULE.get(d, f"Ğ”ĞµĞ½ÑŒ {d}")
            header = (
                f"Ğ”ĞµĞ½ÑŒ {d} â€” {kind_title}\n"
                f"ğŸ“… {day_sched}\n"
                f"ğŸ’¡ {kind_desc}\n"
                f"â± ~50â€“70 Ğ¼Ğ¸Ğ½\n\n"
            )
        else:
            header = (
                f"Ğ”ĞµĞ½ÑŒ {d} â€” {kind_title}\n"
                f"ğŸ’¡ {kind_desc}\n"
                f"â± ~45â€“60 Ğ¼Ğ¸Ğ½\n\n"
            )

        body = "\n".join(day_block(kind))
        days[str(d)] = header + body

    plan_struct = {
        "system": system,
        "where": where,
        "freq": f,
        "schedule": weekday_schedule(f),
        "rir": rir,
        "days": days,
        "updated_at": datetime.utcnow().isoformat(),
    }
    return intro, plan_struct


# =========================
# âœ… ĞŸĞ˜Ğ¢ĞĞĞ˜Ğ•
# =========================

FOOD_DB = {
    "oats":      {"name": "ĞĞ²ÑÑĞ½ĞºĞ° (ÑÑƒÑ…Ğ°Ñ)",              "kcal": 352, "p": 12.0, "f": 6.2,   "c": 60.0},
    "rice":      {"name": "Ğ Ğ¸Ñ (ÑÑƒÑ…Ğ¾Ğ¹)",                  "kcal": 344, "p": 6.7,  "f": 0.7,   "c": 76.0},
    "buckwheat": {"name": "Ğ“Ñ€ĞµÑ‡ĞºĞ° (ÑÑƒÑ…Ğ°Ñ)",               "kcal": 313, "p": 12.6, "f": 3.3,   "c": 57.0},
    "pasta":     {"name": "ĞœĞ°ĞºĞ°Ñ€Ğ¾Ğ½Ñ‹ (ÑÑƒÑ…Ğ¸Ğµ)",             "kcal": 350, "p": 10.4, "f": 1.1,   "c": 73.0},
    "potato":    {"name": "ĞšĞ°Ñ€Ñ‚Ğ¾Ñ„ĞµĞ»ÑŒ",                    "kcal": 80,  "p": 2.0,  "f": 0.1,   "c": 17.0},
    "bread_rye": {"name": "Ğ¥Ğ»ĞµĞ± Ñ€Ğ¶Ğ°Ğ½Ğ¾Ğ¹",                  "kcal": 210, "p": 6.6,  "f": 1.2,   "c": 41.0},
    "veg":       {"name": "ĞĞ²Ğ¾Ñ‰Ğ¸ (Ğ¾Ğ³ÑƒÑ€ĞµÑ†/Ğ¿Ğ¾Ğ¼Ğ¸Ğ´Ğ¾Ñ€/ĞºĞ°Ğ¿ÑƒÑÑ‚Ğ°)", "kcal": 25,  "p": 1.2,  "f": 0.2,   "c": 4.5},
    "chicken":   {"name": "ĞšÑƒÑ€Ğ¸Ğ½Ğ°Ñ Ğ³Ñ€ÑƒĞ´ĞºĞ° (Ğ²Ğ°Ñ€Ñ‘Ğ½Ğ°Ñ)",     "kcal": 165, "p": 31.0, "f": 3.6,   "c": 0.0},
    "turkey":    {"name": "Ğ˜Ğ½Ğ´ĞµĞ¹ĞºĞ° (Ñ„Ğ¸Ğ»Ğµ, Ğ²Ğ°Ñ€Ñ‘Ğ½Ğ¾Ğµ)",      "kcal": 158, "p": 29.0, "f": 4.0,   "c": 0.0},
    "fish":      {"name": "Ğ Ñ‹Ğ±Ğ° Ğ±ĞµĞ»Ğ°Ñ (Ñ‚Ñ€ĞµÑĞºĞ°/Ğ¼Ğ¸Ğ½Ñ‚Ğ°Ğ¹)",   "kcal": 82,  "p": 18.0, "f": 0.7,   "c": 0.0},
    "salmon":    {"name": "Ğ›Ğ¾ÑĞ¾ÑÑŒ",                       "kcal": 208, "p": 20.0, "f": 13.0,  "c": 0.0},
    "beef":      {"name": "Ğ“Ğ¾Ğ²ÑĞ´Ğ¸Ğ½Ğ° (Ğ²Ğ°Ñ€Ñ‘Ğ½Ğ°Ñ)",           "kcal": 218, "p": 25.0, "f": 12.5,  "c": 0.0},
    "eggs":      {"name": "Ğ¯Ğ¹Ñ†Ğ°",                         "kcal": 157, "p": 12.7, "f": 11.5,  "c": 0.7},
    "egg_white": {"name": "Ğ‘ĞµĞ»Ğ¾Ğº ÑĞ¸Ñ‡Ğ½Ñ‹Ğ¹",                 "kcal": 44,  "p": 11.0, "f": 0.0,   "c": 0.0},
    "curd_0":    {"name": "Ğ¢Ğ²Ğ¾Ñ€Ğ¾Ğ³ 0%",                    "kcal": 71,  "p": 18.0, "f": 0.6,   "c": 1.8},
    "curd_5":    {"name": "Ğ¢Ğ²Ğ¾Ñ€Ğ¾Ğ³ 5%",                    "kcal": 121, "p": 17.0, "f": 5.0,   "c": 1.8},
    "greek_yog": {"name": "Ğ™Ğ¾Ğ³ÑƒÑ€Ñ‚ Ğ³Ñ€ĞµÑ‡ĞµÑĞºĞ¸Ğ¹ 2%",          "kcal": 66,  "p": 5.0,  "f": 2.0,   "c": 6.5},
    "milk":      {"name": "ĞœĞ¾Ğ»Ğ¾ĞºĞ¾ 2.5%",                  "kcal": 54,  "p": 2.8,  "f": 2.5,   "c": 4.7},
    "oil_olive": {"name": "ĞœĞ°ÑĞ»Ğ¾ Ğ¾Ğ»Ğ¸Ğ²ĞºĞ¾Ğ²Ğ¾Ğµ",              "kcal": 884, "p": 0.0,  "f": 100.0, "c": 0.0},
    "oil_linseed":{"name": "ĞœĞ°ÑĞ»Ğ¾ Ğ»ÑŒĞ½ÑĞ½Ğ¾Ğµ",               "kcal": 884, "p": 0.0,  "f": 100.0, "c": 0.0},
    "nuts_alm":  {"name": "ĞœĞ¸Ğ½Ğ´Ğ°Ğ»ÑŒ",                      "kcal": 576, "p": 21.2, "f": 49.4,  "c": 6.9},
    "cheese_20": {"name": "Ğ¡Ñ‹Ñ€ Ğ»Ñ‘Ğ³ĞºĞ¸Ğ¹ 20â€“30%",           "kcal": 260, "p": 26.0, "f": 16.0,  "c": 1.0},
    "banana":    {"name": "Ğ‘Ğ°Ğ½Ğ°Ğ½",                        "kcal": 89,  "p": 1.1,  "f": 0.3,   "c": 22.0},
    "apple":     {"name": "Ğ¯Ğ±Ğ»Ğ¾ĞºĞ¾",                       "kcal": 52,  "p": 0.3,  "f": 0.2,   "c": 12.0},
    "berries":   {"name": "Ğ¯Ğ³Ğ¾Ğ´Ñ‹ (ĞºĞ»ÑƒĞ±Ğ½Ğ¸ĞºĞ°/Ñ‡ĞµÑ€Ğ½Ğ¸ĞºĞ°)",     "kcal": 45,  "p": 0.8,  "f": 0.4,   "c": 9.5},
    "avocado":   {"name": "ĞĞ²Ğ¾ĞºĞ°Ğ´Ğ¾",                      "kcal": 160, "p": 2.0,  "f": 15.0,  "c": 2.0},
}


def _nutr_of(item_key: str, grams: float):
    it = FOOD_DB[item_key]
    k = grams / 100.0
    return {"kcal": it["kcal"] * k, "p": it["p"] * k, "f": it["f"] * k, "c": it["c"] * k}


def _sum_nutr(items: List[Tuple[str, float]]):
    tot = {"kcal": 0.0, "p": 0.0, "f": 0.0, "c": 0.0}
    for key, g in items:
        n = _nutr_of(key, g)
        for kk in tot:
            tot[kk] += n[kk]
    return tot


def _fmt_tot(t):
    return f"{int(round(t['kcal']))} ĞºĞºĞ°Ğ» | Ğ‘ {int(round(t['p']))}Ğ³ Ğ– {int(round(t['f']))}Ğ³ Ğ£ {int(round(t['c']))}Ğ³"


def _flatten(day_meals: List[List[Tuple[str, float]]]) -> List[Tuple[str, float]]:
    return [x for m in day_meals for x in m]


def _totals_of_day(day_meals: List[List[Tuple[str, float]]]) -> Dict[str, float]:
    return _sum_nutr(_flatten(day_meals))


def _add_grams(day_meals: List[List[Tuple[str, float]]], key: str, delta: float):
    if delta == 0:
        return
    for mi in range(len(day_meals)):
        for ii in range(len(day_meals[mi])):
            k, g = day_meals[mi][ii]
            if k == key:
                day_meals[mi][ii] = (k, max(0.0, g + delta))
                return
    day_meals[-1].append((key, max(0.0, float(delta))))


def _adjust_to_target(day_meals: List[List[Tuple[str, float]]], target: Dict[str, float]) -> Dict[str, float]:
    for _ in range(80):
        t = _totals_of_day(day_meals)
        dk = target["kcal"] - t["kcal"]
        dp = target["p"] - t["p"]
        df = target["f"] - t["f"]
        dc = target["c"] - t["c"]

        if abs(dk) <= 40 and abs(dp) <= 5 and abs(df) <= 4 and abs(dc) <= 8:
            return t

        if dp > 5:
            _add_grams(day_meals, "chicken", 25.0)
            continue
        if dp < -8:
            _add_grams(day_meals, "chicken", -25.0)
            continue

        if df > 4:
            _add_grams(day_meals, "oil_olive", 4.0)
            continue
        if df < -5:
            _add_grams(day_meals, "oil_olive", -4.0)
            continue

        if dc > 10 or dk > 80:
            _add_grams(day_meals, "rice", 10.0)
            continue
        if dc < -10 or dk < -80:
            _add_grams(day_meals, "rice", -10.0)
            continue

    return _totals_of_day(day_meals)


def _build_day_variant(variant: int, meals: int) -> List[List[Tuple[str, float]]]:
    meals = max(3, min(int(meals or 3), 5))

    if variant == 1:
        # ĞšĞ»Ğ°ÑÑĞ¸ĞºĞ°: Ğ¾Ğ²ÑÑĞ½ĞºĞ° + ĞºÑƒÑ€Ğ¸Ñ†Ğ° + Ğ³Ñ€ĞµÑ‡ĞºĞ°
        day = [
            [("oats", 80.0), ("eggs", 120.0), ("banana", 100.0)],
            [("rice", 90.0), ("chicken", 180.0), ("veg", 150.0), ("oil_olive", 10.0)],
            [("buckwheat", 80.0), ("fish", 180.0), ("veg", 150.0), ("oil_olive", 8.0)],
        ]
        if meals >= 4:
            day.append([("curd_0", 200.0), ("berries", 100.0)])
        if meals >= 5:
            day.append([("apple", 150.0), ("nuts_alm", 20.0)])
        return day

    if variant == 2:
        # Ğ“Ğ¾Ğ²ÑĞ´Ğ¸Ğ½Ğ° + ĞºĞ°Ñ€Ñ‚Ğ¾Ñ„ĞµĞ»ÑŒ + Ğ¿Ğ°ÑÑ‚Ğ°
        day = [
            [("eggs", 150.0), ("bread_rye", 60.0), ("cheese_20", 30.0)],
            [("potato", 250.0), ("beef", 160.0), ("veg", 150.0), ("oil_olive", 8.0)],
            [("pasta", 80.0), ("turkey", 180.0), ("veg", 150.0), ("oil_olive", 5.0)],
        ]
        if meals >= 4:
            day.append([("greek_yog", 200.0), ("banana", 100.0)])
        if meals >= 5:
            day.append([("curd_5", 150.0), ("nuts_alm", 15.0)])
        return day

    if variant == 3:
        # Ğ›Ğ¾ÑĞ¾ÑÑŒ + Ğ³Ñ€ĞµÑ‡ĞµÑĞºĞ¸Ğ¹ Ğ¹Ğ¾Ğ³ÑƒÑ€Ñ‚
        day = [
            [("oats", 70.0), ("greek_yog", 150.0), ("berries", 100.0)],
            [("rice", 90.0), ("salmon", 150.0), ("veg", 150.0), ("oil_olive", 5.0)],
            [("buckwheat", 80.0), ("turkey", 160.0), ("avocado", 60.0), ("veg", 150.0)],
        ]
        if meals >= 4:
            day.append([("curd_0", 200.0), ("apple", 120.0)])
        if meals >= 5:
            day.append([("eggs", 60.0), ("nuts_alm", 15.0)])
        return day

    if variant == 4:
        # Ğ›Ñ‘Ğ³ĞºĞ¸Ğ¹ Ğ²Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚: Ñ‚Ğ²Ğ¾Ñ€Ğ¾Ğ³ + ĞºÑƒÑ€Ğ¸Ğ½Ğ°Ñ Ğ³Ñ€ÑƒĞ´ĞºĞ° + Ñ€Ğ¸Ñ (Ğ»ĞµĞ³ĞºĞ¾ Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ğ¸Ñ‚ÑŒ)
        day = [
            [("curd_0", 250.0), ("banana", 100.0), ("berries", 80.0)],
            [("rice", 100.0), ("chicken", 200.0), ("veg", 200.0)],
            [("eggs", 180.0), ("veg", 150.0), ("bread_rye", 40.0)],
        ]
        if meals >= 4:
            day.append([("greek_yog", 200.0), ("apple", 120.0)])
        if meals >= 5:
            day.append([("curd_5", 150.0), ("berries", 80.0)])
        return day

    # Ğ’Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚ 5: Ğ»Ñ‘Ğ³ĞºĞ¸Ğ¹ Ğ±Ñ‹ÑÑ‚Ñ€Ñ‹Ğ¹ (Ğ¼Ğ¸Ğ½Ğ¸Ğ¼ÑƒĞ¼ Ğ³Ğ¾Ñ‚Ğ¾Ğ²ĞºĞ¸)
    day = [
        [("greek_yog", 200.0), ("oats", 50.0), ("banana", 100.0)],
        [("buckwheat", 90.0), ("fish", 200.0), ("veg", 200.0)],
        [("chicken", 180.0), ("potato", 200.0), ("veg", 150.0), ("oil_olive", 8.0)],
    ]
    if meals >= 4:
        day.append([("curd_0", 200.0), ("nuts_alm", 20.0)])
    if meals >= 5:
        day.append([("apple", 150.0), ("egg_white", 80.0)])
    return day


def build_meal_day_text(day_i: int, calories: int, protein_g: int, fat_g: int, carbs_g: int, meals: int) -> str:
    target = {"kcal": float(calories), "p": float(protein_g), "f": float(fat_g), "c": float(carbs_g)}
    day_meals = _build_day_variant(day_i, meals)
    tot = _adjust_to_target(day_meals, target)

    final_k = int(round(tot["kcal"]))
    final_p = int(round(tot["p"]))
    final_f = int(round(tot["f"]))
    final_c = int(round(tot["c"]))

    dk = final_k - calories
    dk_str = f"{'+' if dk >= 0 else ''}{dk}"

    meal_names = ["ğŸŒ… Ğ—Ğ°Ğ²Ñ‚Ñ€Ğ°Ğº", "ğŸŒ ĞĞ±ĞµĞ´", "ğŸŒ† Ğ£Ğ¶Ğ¸Ğ½", "ğŸ¥— ĞŸĞµÑ€ĞµĞºÑƒÑ 1", "ğŸ ĞŸĞµÑ€ĞµĞºÑƒÑ 2"]

    lines = [f"ğŸ“… ĞŸÑ€Ğ¸Ğ¼ĞµÑ€ {day_i}  (Ñ†ĞµĞ»ÑŒ: {calories} ĞºĞºĞ°Ğ»)", ""]
    for mi, m in enumerate(day_meals, start=1):
        mt = _sum_nutr(m)
        meal_name = meal_names[mi - 1] if mi <= len(meal_names) else f"ĞŸÑ€Ğ¸Ñ‘Ğ¼ {mi}"
        lines.append(f"{meal_name}  ({_fmt_tot(mt)})")
        for k, g in m:
            if k == "eggs":
                est = max(1, int(round(g / 60.0)))
                lines.append(f"â€¢ {FOOD_DB[k]['name']} â€” {est} ÑˆÑ‚ (~{int(g)}Ğ³)")
            elif k in ("oil_olive", "oil_linseed"):
                lines.append(f"â€¢ {FOOD_DB[k]['name']} â€” {int(round(g))} Ğ³ (1 ÑÑ‚.Ğ». â‰ˆ 10Ğ³)")
            elif k in ("nuts_alm",):
                lines.append(f"â€¢ {FOOD_DB[k]['name']} â€” {int(round(g))} Ğ³ (~Ğ³Ğ¾Ñ€ÑÑ‚ÑŒ)")
            else:
                lines.append(f"â€¢ {FOOD_DB[k]['name']} â€” {int(round(g))} Ğ³")
        lines.append("")

    lines.append(f"âœ… Ğ˜Ñ‚Ğ¾Ğ³ Ğ´Ğ½Ñ: {final_k} ĞºĞºĞ°Ğ» ({dk_str} Ğ¾Ñ‚ Ñ†ĞµĞ»Ğ¸)")
    lines.append(f"   Ğ‘ {final_p}Ğ³ / Ğ– {final_f}Ğ³ / Ğ£ {final_c}Ğ³")
    lines.append("")
    lines.append("ğŸ’¡ ĞĞµĞ±Ğ¾Ğ»ÑŒÑˆĞ°Ñ Ğ¿Ğ¾Ğ³Ñ€ĞµÑˆĞ½Ğ¾ÑÑ‚ÑŒ Â±5â€“10% â€” Ğ°Ğ±ÑĞ¾Ğ»ÑÑ‚Ğ½Ğ¾ Ğ½Ğ¾Ñ€Ğ¼Ğ°Ğ»ÑŒĞ½Ğ¾.")
    lines.append("   Ğ“Ğ»Ğ°Ğ²Ğ½Ğ¾Ğµ â€” Ğ´ĞµÑ€Ğ¶Ğ°Ñ‚ÑŒ Ğ¾Ğ±Ñ‰Ğ¸Ğ¹ Ğ²ĞµĞºÑ‚Ğ¾Ñ€, Ğ° Ğ½Ğµ Ğ»Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ³Ñ€Ğ°Ğ¼Ğ¼Ñ‹.")
    lines.append("")
    lines.append("âš ï¸ Ğ—Ğ°Ğ¼ĞµÑ‚ĞºĞ¸ Ğ¿Ğ¾ Ğ¿Ğ¾Ñ€Ñ†Ğ¸ÑĞ¼:")
    lines.append("   â€¢ ĞšÑ€ÑƒĞ¿Ñ‹ Ğ¸ Ğ¼Ğ°ĞºĞ°Ñ€Ğ¾Ğ½Ñ‹ â€” Ğ³Ñ€Ğ°Ğ¼Ğ¼Ñ‹ Ğ² Ğ¡Ğ£Ğ¥ĞĞœ (ÑÑ‹Ñ€Ğ¾Ğ¼) Ğ²Ğ¸Ğ´Ğµ")
    lines.append("   â€¢ Ğ Ğ¸Ñ Ğ¿Ñ€Ğ¸ Ğ²Ğ°Ñ€ĞºĞµ ÑƒĞ²ĞµĞ»Ğ¸Ñ‡Ğ¸Ğ²Ğ°ĞµÑ‚ÑÑ ~Ğ² 3 Ñ€Ğ°Ğ·Ğ°, Ğ³Ñ€ĞµÑ‡ĞºĞ° ~Ğ² 2.5")
    lines.append("   â€¢ ĞšÑƒÑ€Ğ¸Ñ†Ğ°, Ñ€Ñ‹Ğ±Ğ°, Ğ¼ÑÑĞ¾ â€” Ğ“ĞĞ¢ĞĞ’Ğ«Ğ™ (Ğ²Ğ°Ñ€Ñ‘Ğ½Ñ‹Ğ¹/Ğ¶Ğ°Ñ€ĞµĞ½Ñ‹Ğ¹) Ğ²ĞµÑ")
    lines.append("   â€¢ Ğ¯Ğ¹Ñ†Ğ°: 1 ÑÑ€ĞµĞ´Ğ½ĞµĞµ ÑĞ¹Ñ†Ğ¾ â‰ˆ 55â€“65 Ğ³")
    return "\n".join(lines)


def nutrition_examples_kb():
    return InlineKeyboardMarkup(inline_keyboard=[
        [InlineKeyboardButton(text="ğŸ¥£ Ğ’Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚ 1 (ĞºĞ»Ğ°ÑÑĞ¸ĞºĞ°)", callback_data="nutr:ex:1")],
        [InlineKeyboardButton(text="ğŸ– Ğ’Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚ 2 (Ğ³Ğ¾Ğ²ÑĞ´Ğ¸Ğ½Ğ°)", callback_data="nutr:ex:2")],
        [InlineKeyboardButton(text="ğŸŸ Ğ’Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚ 3 (Ğ»Ğ¾ÑĞ¾ÑÑŒ)", callback_data="nutr:ex:3")],
        [InlineKeyboardButton(text="ğŸ¥š Ğ’Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚ 4 (Ğ»Ñ‘Ğ³ĞºĞ¸Ğ¹)", callback_data="nutr:ex:4")],
        [InlineKeyboardButton(text="âš¡ï¸ Ğ’Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚ 5 (Ğ±Ñ‹ÑÑ‚Ñ€Ñ‹Ğ¹)", callback_data="nutr:ex:5")],
        [InlineKeyboardButton(text="ğŸ›’ ĞœĞ¾Ñ ĞºĞ¾Ñ€Ğ·Ğ¸Ğ½Ğ°", callback_data="nutr:basket")],
        [InlineKeyboardButton(text="ğŸ  ĞœĞµĞ½Ñ", callback_data="nav:menu")],
    ])


def nutrition_back_kb():
    return InlineKeyboardMarkup(inline_keyboard=[
        [InlineKeyboardButton(text="â¬…ï¸ ĞĞ°Ğ·Ğ°Ğ´ Ğº Ñ€Ğ°Ñ†Ğ¸Ğ¾Ğ½Ñƒ", callback_data="nutr:back")],
        [InlineKeyboardButton(text="ğŸ›’ ĞœĞ¾Ñ ĞºĞ¾Ñ€Ğ·Ğ¸Ğ½Ğ°", callback_data="nutr:basket")],
        [InlineKeyboardButton(text="ğŸ  ĞœĞµĞ½Ñ", callback_data="nav:menu")],
    ])


def generate_nutrition_summary(goal: str, sex: str, age: int, height: int, weight: float, exp: str,
                             freq: int = 3, place: str = "ÑĞ²Ğ¾Ğ¹ Ğ²ĞµÑ", meals_pref: Optional[int] = None) -> Tuple[str, int, int, int, int, int]:
    calories = calc_calories(height, weight, age, sex, goal, freq=freq, place=place)
    p, f, c = calc_macros(calories, weight, goal)
    meals = int(meals_pref or 0) if meals_pref else suggest_meals_count(calories)
    meals = max(3, min(meals, 5))

    p_kcal = p * 4
    f_kcal = f * 9
    c_kcal = c * 4
    total_check = p_kcal + f_kcal + c_kcal

    summary = (
        "ğŸ½ ĞŸĞ¸Ñ‚Ğ°Ğ½Ğ¸Ğµ (Ğ¿ĞµÑ€ÑĞ¾Ğ½Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ñ€Ğ°ÑÑ‡Ñ‘Ñ‚)\n\n"
        f"âš¡ï¸ ĞšĞ°Ğ»Ğ¾Ñ€Ğ¸Ğ¸: ~{calories} ĞºĞºĞ°Ğ»/Ğ´ĞµĞ½ÑŒ\n"
        f"ğŸ’ª Ğ‘ĞµĞ»Ğ¾Ğº: {p} Ğ³  ({int(round(p_kcal/total_check*100))}% ĞºĞ°Ğ»Ğ¾Ñ€Ğ¸Ğ¹)\n"
        f"ğŸ¥‘ Ğ–Ğ¸Ñ€Ñ‹: {f} Ğ³  ({int(round(f_kcal/total_check*100))}%)\n"
        f"ğŸš Ğ£Ğ³Ğ»ĞµĞ²Ğ¾Ğ´Ñ‹: {c} Ğ³  ({int(round(c_kcal/total_check*100))}%)\n"
        f"ğŸ½ ĞŸÑ€Ğ¸Ñ‘Ğ¼Ğ¾Ğ² Ğ¿Ğ¸Ñ‰Ğ¸: {meals}\n\n"
        "Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸ Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ñ‹Ğ¹ Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€ Ñ€Ğ°Ñ†Ğ¸Ğ¾Ğ½Ğ° ğŸ‘‡\n"
        "(Ğ’ÑĞµ 3 Ğ²Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚Ğ° Ğ¿Ğ¾Ğ´Ñ…Ğ¾Ğ´ÑÑ‚ Ğ¿Ğ¾Ğ´ Ñ‚Ğ²Ğ¾Ğ¸ Ñ†Ğ¸Ñ„Ñ€Ñ‹)"
    )
    return summary, calories, p, f, c, meals


# =========================
# ĞœĞ•ĞĞ® / START
# =========================
FAQ_QUESTIONS = {
    "faq:weight": {
        "q": "âš–ï¸ ĞŸĞ¾Ñ‡ĞµĞ¼Ñƒ Ğ½Ğµ Ğ¼ĞµĞ½ÑĞµÑ‚ÑÑ Ğ²ĞµÑ?",
        "a": (
            "âš–ï¸ Ğ’ĞµÑ ÑÑ‚Ğ¾Ğ¸Ñ‚ Ğ½Ğ° Ğ¼ĞµÑÑ‚Ğµ â€” Ñ‡Ñ‚Ğ¾ Ğ¿Ñ€Ğ¾Ğ¸ÑÑ…Ğ¾Ğ´Ğ¸Ñ‚?\n\n"
            "Ğ“Ğ»Ğ°Ğ²Ğ½Ğ°Ñ Ğ¿Ñ€Ğ¸Ñ‡Ğ¸Ğ½Ğ° Ğ² 95% ÑĞ»ÑƒÑ‡Ğ°ĞµĞ² â€” Ñ‚Ñ‹ ĞµÑˆÑŒ Ñ€Ğ¾Ğ²Ğ½Ğ¾ ÑÑ‚Ğ¾Ğ»ÑŒĞºĞ¾, ÑĞºĞ¾Ğ»ÑŒĞºĞ¾ Ñ‚Ñ€Ğ°Ñ‚Ğ¸ÑˆÑŒ. "
            "Ğ˜Ğ»Ğ¸ Ğ´ÑƒĞ¼Ğ°ĞµÑˆÑŒ, Ñ‡Ñ‚Ğ¾ ĞµÑˆÑŒ Ğ¼Ğ°Ğ»Ğ¾, Ğ½Ğ¾ Ğ½Ğ° ÑĞ°Ğ¼Ğ¾Ğ¼ Ğ´ĞµĞ»Ğµ Ğ½ĞµÑ‚.\n\n"
            "ğŸ” ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑŒ:\n"
            "1. Ğ¡Ñ‡Ğ¸Ñ‚Ğ°ĞµÑˆÑŒ Ğ»Ğ¸ Ñ‚Ñ‹ ĞºĞ°Ğ»Ğ¾Ñ€Ğ¸Ğ¸ Ğ Ğ•ĞĞ›Ğ¬ĞĞ â€” Ñ Ğ¼Ğ°ÑĞ»Ğ¾Ğ¼, ÑĞ¾ÑƒÑĞ°Ğ¼Ğ¸, Ğ¿ĞµÑ€ĞµĞºÑƒÑĞ°Ğ¼Ğ¸?\n"
            "   ĞĞ´Ğ¸Ğ½ Ğ½ĞµĞ·Ğ°Ğ¼ĞµÑ‡ĞµĞ½Ğ½Ñ‹Ğ¹ Ğ¿ĞµÑ€ĞµĞºÑƒÑ = 300â€“500 ĞºĞºĞ°Ğ». Ğ­Ñ‚Ğ¾ Ñ‚Ğ²Ğ¾Ğ¹ Ğ´ĞµÑ„Ğ¸Ñ†Ğ¸Ñ‚ Ğ·Ğ° Ğ´ĞµĞ½ÑŒ.\n\n"
            "2. Ğ’Ğ·Ğ²ĞµÑˆĞ¸Ğ²Ğ°ĞµÑˆÑŒÑÑ Ğ»Ğ¸ Ñ‚Ñ‹ ÑƒÑ‚Ñ€Ğ¾Ğ¼, Ğ½Ğ°Ñ‚Ğ¾Ñ‰Ğ°Ğº, Ğ¿Ğ¾ÑĞ»Ğµ Ñ‚ÑƒĞ°Ğ»ĞµÑ‚Ğ°?\n"
            "   Ğ’ĞµÑ ĞºĞ¾Ğ»ĞµĞ±Ğ»ĞµÑ‚ÑÑ Ğ½Ğ° 1â€“3 ĞºĞ³ Ğ² Ñ‚ĞµÑ‡ĞµĞ½Ğ¸Ğµ Ğ´Ğ½Ñ â€” Ğ½Ğµ Ğ¿Ğ°Ğ½Ğ¸ĞºÑƒĞ¹ Ğ¸Ğ·-Ğ·Ğ° Ğ¾Ğ´Ğ½Ğ¾Ğ¹ Ñ†Ğ¸Ñ„Ñ€Ñ‹.\n\n"
            "3. Ğ”Ğ¾ÑÑ‚Ğ°Ñ‚Ğ¾Ñ‡Ğ½Ğ¾ Ğ»Ğ¸ Ğ±ĞµĞ»ĞºĞ°? Ğ‘ĞµĞ· Ğ±ĞµĞ»ĞºĞ° Ñ‚ĞµĞ»Ğ¾ Ñ‚ĞµÑ€ÑĞµÑ‚ Ğ¼Ñ‹ÑˆÑ†Ñ‹, Ğ° Ğ½Ğµ Ğ¶Ğ¸Ñ€.\n"
            "   ĞĞ¾Ñ€Ğ¼Ğ°: 1.8â€“2.2 Ğ³ Ğ½Ğ° ĞºĞ³ Ğ²ĞµÑĞ°.\n\n"
            "4. ĞŸÑŒÑ‘ÑˆÑŒ Ğ»Ğ¸ Ğ²Ğ¾Ğ´Ñƒ? 2â€“3 Ğ»Ğ¸Ñ‚Ñ€Ğ° Ğ² Ğ´ĞµĞ½ÑŒ.\n"
            "   Ğ—Ğ°Ğ´ĞµÑ€Ğ¶ĞºĞ° Ğ²Ğ¾Ğ´Ñ‹ Ğ¼Ğ°ÑĞºĞ¸Ñ€ÑƒĞµÑ‚ Ğ¿Ğ¾Ñ‚ĞµÑ€Ñ Ğ¶Ğ¸Ñ€Ğ° Ğ½ĞµĞ´ĞµĞ»ÑĞ¼Ğ¸.\n\n"
            "ğŸ’¡ Ğ§Ñ‚Ğ¾ Ğ´ĞµĞ»Ğ°Ñ‚ÑŒ:\n"
            "â€¢ ĞšÑƒĞ¿Ğ¸ ĞºÑƒÑ…Ğ¾Ğ½Ğ½Ñ‹Ğµ Ğ²ĞµÑÑ‹ â€” Ğ²Ğ·Ğ²ĞµÑˆĞ¸Ğ²Ğ°Ğ¹ Ğ’Ğ¡Ğ Ñ‡Ñ‚Ğ¾ ĞµÑˆÑŒ 2 Ğ½ĞµĞ´ĞµĞ»Ğ¸ Ğ¿Ğ¾Ğ´Ñ€ÑĞ´\n"
            "â€¢ Ğ¡Ñ€Ğ°Ğ²Ğ½Ğ¸ Ñ†Ğ¸Ñ„Ñ€Ñƒ Ğ² ĞºĞ¾Ğ½Ñ†Ğµ Ñ Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ¾Ğ¼ â€” ĞµÑĞ»Ğ¸ Ğ½ĞµÑ‚ Ğ¼Ğ¸Ğ½ÑƒÑ 0.5â€“1 ĞºĞ³, ÑĞ½Ğ¸Ğ·ÑŒ Ğ½Ğ° 200 ĞºĞºĞ°Ğ»\n"
            "â€¢ Ğ—Ğ°Ğ¿Ğ°ÑĞ¸ÑÑŒ Ñ‚ĞµÑ€Ğ¿ĞµĞ½Ğ¸ĞµĞ¼: Ğ¶Ğ¸Ñ€ ÑƒÑ…Ğ¾Ğ´Ğ¸Ñ‚ Ğ¼ĞµĞ´Ğ»ĞµĞ½Ğ½Ğ¾, Ğ½Ğ¾ ÑƒÑ…Ğ¾Ğ´Ğ¸Ñ‚"
        )
    },
    "faq:muscle": {
        "q": "ğŸ’ª ĞŸĞ¾Ñ‡ĞµĞ¼Ñƒ Ğ½ĞµÑ‚ Ñ€Ğ¾ÑÑ‚Ğ° Ğ¼Ñ‹ÑˆÑ†?",
        "a": (
            "ğŸ’ª ĞœÑ‹ÑˆÑ†Ñ‹ Ğ½Ğµ Ñ€Ğ°ÑÑ‚ÑƒÑ‚ â€” Ñ€Ğ°Ğ·Ğ±Ğ¸Ñ€Ğ°ĞµĞ¼ Ğ¿Ñ€Ğ¸Ñ‡Ğ¸Ğ½Ñ‹\n\n"
            "Ğ Ğ¾ÑÑ‚ Ğ¼Ñ‹ÑˆÑ† Ñ‚Ñ€ĞµĞ±ÑƒĞµÑ‚ Ñ‚Ñ€Ñ‘Ñ… Ğ²ĞµÑ‰ĞµĞ¹: Ğ½Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° + Ğ¿Ğ¸Ñ‚Ğ°Ğ½Ğ¸Ğµ + Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ. "
            "Ğ•ÑĞ»Ğ¸ Ğ½ĞµÑ‚ Ñ…Ğ¾Ñ‚ÑŒ Ğ¾Ğ´Ğ½Ğ¾Ğ³Ğ¾ â€” Ñ€Ğ¾ÑÑ‚Ğ° Ğ½ĞµÑ‚.\n\n"
            "ğŸ” Ğ§Ğ°ÑÑ‚Ñ‹Ğµ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸:\n\n"
            "1. ĞĞµÑ‚ Ğ¿Ñ€Ğ¾Ğ³Ñ€ĞµÑÑĞ¸Ğ¸ Ğ½Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸\n"
            "   Ğ”ĞµĞ»Ğ°ĞµÑˆÑŒ Ğ¾Ğ´Ğ½Ğ¾ Ğ¸ Ñ‚Ğ¾ Ğ¶Ğµ Ğ¼ĞµÑÑÑ†Ğ°Ğ¼Ğ¸ â†’ Ñ‚ĞµĞ»Ğ¾ Ğ°Ğ´Ğ°Ğ¿Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ»Ğ¾ÑÑŒ.\n"
            "   Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ: ĞºĞ°Ğ¶Ğ´Ñ‹Ğµ 1â€“2 Ğ½ĞµĞ´ĞµĞ»Ğ¸ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞ¹ Ğ²ĞµÑ Ğ¸Ğ»Ğ¸ Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€ĞµĞ½Ğ¸Ñ.\n\n"
            "2. ĞœĞ°Ğ»Ğ¾ Ğ±ĞµĞ»ĞºĞ°\n"
            "   ĞœĞµĞ½ĞµĞµ 1.6 Ğ³ Ğ½Ğ° ĞºĞ³ = Ğ¼Ñ‹ÑˆÑ†Ñ‹ Ğ½Ğµ Ğ¸Ğ· Ñ‡ĞµĞ³Ğ¾ ÑÑ‚Ñ€Ğ¾Ğ¸Ñ‚ÑŒ.\n"
            "   ĞĞ° Ğ¼Ğ°ÑÑÑƒ Ğ½ÑƒĞ¶Ğ½Ğ¾ 1.8â€“2.2 Ğ³/ĞºĞ³.\n\n"
            "3. ĞœĞ°Ğ»Ğ¾ ĞºĞ°Ğ»Ğ¾Ñ€Ğ¸Ğ¹\n"
            "   ĞĞ° Ğ´ĞµÑ„Ğ¸Ñ†Ğ¸Ñ‚Ğµ Ğ¼Ñ‹ÑˆÑ†Ñ‹ Ñ€Ğ°ÑÑ‚Ğ¸ Ğ½Ğµ Ğ±ÑƒĞ´ÑƒÑ‚. Ğ”Ğ»Ñ Ğ¼Ğ°ÑÑÑ‹ Ğ½ÑƒĞ¶ĞµĞ½ +200â€“400 ĞºĞºĞ°Ğ» Ğº Ğ½Ğ¾Ñ€Ğ¼Ğµ.\n\n"
            "4. ĞŸĞ»Ğ¾Ñ…Ğ¾Ğ¹ ÑĞ¾Ğ½\n"
            "   Ğ“Ğ¾Ñ€Ğ¼Ğ¾Ğ½ Ñ€Ğ¾ÑÑ‚Ğ° Ğ²Ñ‹Ğ´ĞµĞ»ÑĞµÑ‚ÑÑ Ğ½Ğ¾Ñ‡ÑŒÑ. ĞœĞµĞ½ÑŒÑˆĞµ 7 Ñ‡Ğ°ÑĞ¾Ğ² = Ğ¼ĞµĞ´Ğ»ĞµĞ½Ğ½Ñ‹Ğ¹ Ğ¿Ñ€Ğ¾Ğ³Ñ€ĞµÑÑ.\n\n"
            "5. Ğ¡Ğ»Ğ¸ÑˆĞºĞ¾Ğ¼ Ğ¼Ğ½Ğ¾Ğ³Ğ¾ ĞºĞ°Ñ€Ğ´Ğ¸Ğ¾\n"
            "   ĞšĞ°Ñ€Ğ´Ğ¸Ğ¾ ĞºĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ğ´ĞµĞ½ÑŒ + Ğ´ĞµÑ„Ğ¸Ñ†Ğ¸Ñ‚ = Ñ‚ĞµĞ»Ğ¾ Ğ¶Ğ¶Ñ‘Ñ‚ Ğ¼Ñ‹ÑˆÑ†Ñ‹ ĞºĞ°Ğº Ñ‚Ğ¾Ğ¿Ğ»Ğ¸Ğ²Ğ¾.\n\n"
            "ğŸ’¡ ĞŸÑ€Ğ°Ğ²Ğ¸Ğ»Ğ¾: ĞµÑĞ»Ğ¸ 3 Ğ½ĞµĞ´ĞµĞ»Ğ¸ Ğ½Ğµ Ñ€Ğ°ÑÑ‚Ñ‘Ñ‚ Ğ²ĞµÑ Ğ½Ğ° ÑˆÑ‚Ğ°Ğ½Ğ³Ğµ â€” Ğ¼ĞµĞ½ÑĞ¹ Ğ¿Ñ€Ğ¾Ğ³Ñ€Ğ°Ğ¼Ğ¼Ñƒ Ğ¸Ğ»Ğ¸ Ğ¿Ğ¸Ñ‚Ğ°Ğ½Ğ¸Ğµ."
        )
    },
    "faq:plateau": {
        "q": "ğŸ“‰ ĞŸĞ¾Ñ‡ĞµĞ¼Ñƒ Ğ¿Ñ€ĞµĞºÑ€Ğ°Ñ‚Ğ¸Ğ»ÑÑ Ğ¿Ñ€Ğ¾Ğ³Ñ€ĞµÑÑ (Ğ¿Ğ»Ğ°Ñ‚Ğ¾)?",
        "a": (
            "ğŸ“‰ ĞŸĞ»Ğ°Ñ‚Ğ¾ Ğ² Ñ‚Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²ĞºĞ°Ñ… â€” ĞºĞ°Ğº Ğ²Ñ‹Ğ¹Ñ‚Ğ¸?\n\n"
            "ĞŸĞ»Ğ°Ñ‚Ğ¾ â€” Ğ½Ğ¾Ñ€Ğ¼Ğ°Ğ»ÑŒĞ½Ğ°Ñ Ñ‡Ğ°ÑÑ‚ÑŒ Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑĞ°. "
            "Ğ¢ĞµĞ»Ğ¾ ÑƒĞ¼Ğ½Ğ¾Ğµ: Ğ¾Ğ½Ğ¾ Ğ°Ğ´Ğ°Ğ¿Ñ‚Ğ¸Ñ€ÑƒĞµÑ‚ÑÑ Ğº Ğ½Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞµ Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€Ğ½Ğ¾ Ğ·Ğ° 6â€“8 Ğ½ĞµĞ´ĞµĞ»ÑŒ.\n\n"
            "ğŸ” ĞŸÑ€Ğ¸Ñ‡Ğ¸Ğ½Ñ‹ Ğ¿Ğ»Ğ°Ñ‚Ğ¾:\n"
            "â€¢ ĞĞ´Ğ½Ğ° Ğ¸ Ñ‚Ğ° Ğ¶Ğµ Ğ¿Ñ€Ğ¾Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ° Ğ±Ğ¾Ğ»ÑŒÑˆĞµ 2â€“3 Ğ¼ĞµÑÑÑ†ĞµĞ²\n"
            "â€¢ ĞĞµÑ‚ Ğ¿Ñ€Ğ¾Ğ³Ñ€ĞµÑÑĞ¸Ğ¸ Ğ²ĞµÑĞ°/Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€ĞµĞ½Ğ¸Ğ¹\n"
            "â€¢ ĞĞ°Ñ€ÑƒÑˆĞµĞ½ Ñ€ĞµĞ¶Ğ¸Ğ¼ Ğ¿Ğ¸Ñ‚Ğ°Ğ½Ğ¸Ñ (Ğ½ĞµĞ·Ğ°Ğ¼ĞµÑ‚Ğ½Ğ¾ Ğ²Ñ‹Ñ€Ğ¾ÑĞ»Ğ¸ ĞºĞ°Ğ»Ğ¾Ñ€Ğ¸Ğ¸)\n"
            "â€¢ ĞĞ°ĞºĞ¾Ğ¿Ğ¸Ğ»Ğ°ÑÑŒ ÑƒÑÑ‚Ğ°Ğ»Ğ¾ÑÑ‚ÑŒ â€” Ğ½ÑƒĞ¶Ğ½Ğ° Ñ€Ğ°Ğ·Ğ³Ñ€ÑƒĞ·Ğ¾Ñ‡Ğ½Ğ°Ñ Ğ½ĞµĞ´ĞµĞ»Ñ\n\n"
            "ğŸ’¡ Ğ¡Ğ¿Ğ¾ÑĞ¾Ğ±Ñ‹ Ğ²Ñ‹Ğ¹Ñ‚Ğ¸ Ğ¸Ğ· Ğ¿Ğ»Ğ°Ñ‚Ğ¾:\n"
            "1. ĞŸĞ¾Ğ¼ĞµĞ½ÑĞ¹ Ğ¿Ñ€Ğ¾Ğ³Ñ€Ğ°Ğ¼Ğ¼Ñƒ â€” Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ ĞºĞ½Ğ¾Ğ¿ĞºÑƒ ğŸ”„ Ğ¡Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ Ğ¿Ñ€Ğ¾Ğ³Ñ€Ğ°Ğ¼Ğ¼Ñƒ\n"
            "2. Ğ’Ğ¾Ğ·ÑŒĞ¼Ğ¸ Ñ€Ğ°Ğ·Ğ³Ñ€ÑƒĞ·Ğ¾Ñ‡Ğ½ÑƒÑ Ğ½ĞµĞ´ĞµĞ»Ñ: -30â€“40% Ğ½Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸, Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ñ‚ĞµÑ…Ğ½Ğ¸ĞºĞ°\n"
            "3. Ğ”Ğ¾Ğ±Ğ°Ğ²ÑŒ 100â€“200 ĞºĞºĞ°Ğ» Ğ² Ñ€Ğ°Ñ†Ğ¸Ğ¾Ğ½, ĞµÑĞ»Ğ¸ ÑÑ‚Ğ¾Ğ¸ÑˆÑŒ Ğ´Ğ°Ğ²Ğ½Ğ¾\n"
            "4. Ğ¡Ğ¼ĞµĞ½Ğ¸ Ğ¿Ğ¾Ñ€ÑĞ´Ğ¾Ğº ÑƒĞ¿Ñ€Ğ°Ğ¶Ğ½ĞµĞ½Ğ¸Ğ¹ Ğ¸Ğ»Ğ¸ Ğ´Ğ¾Ğ±Ğ°Ğ²ÑŒ ÑÑƒĞ¿ĞµÑ€ÑĞµÑ‚Ñ‹\n"
            "5. Ğ£Ğ»ÑƒÑ‡ÑˆĞ¸ ÑĞ¾Ğ½: 7â€“9 Ñ‡Ğ°ÑĞ¾Ğ² â€” Ğ½Ğµ Ğ¿Ğ¾Ğ¶ĞµĞ»Ğ°Ğ½Ğ¸Ğµ, Ğ° Ñ‚Ñ€ĞµĞ±Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ\n\n"
            "â³ ĞŸĞ»Ğ°Ñ‚Ğ¾ Ğ½Ğ° 2â€“3 Ğ½ĞµĞ´ĞµĞ»Ğ¸ â€” ÑÑ‚Ğ¾ Ğ½Ğ¾Ñ€Ğ¼Ğ°Ğ»ÑŒĞ½Ğ¾. "
            "ĞŸĞ»Ğ°Ñ‚Ğ¾ Ğ±Ğ¾Ğ»ÑŒÑˆĞµ Ğ¼ĞµÑÑÑ†Ğ° â€” ÑĞ¸Ğ³Ğ½Ğ°Ğ» Ñ‡Ñ‚Ğ¾-Ñ‚Ğ¾ Ğ¼ĞµĞ½ÑÑ‚ÑŒ."
        )
    },
    "faq:diet": {
        "q": "ğŸ½ ĞšĞ°Ğº Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ğ¾ Ğ¿Ğ¸Ñ‚Ğ°Ñ‚ÑŒÑÑ Ğ´Ğ»Ñ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğ°?",
        "a": (
            "ğŸ½ ĞŸĞ¸Ñ‚Ğ°Ğ½Ğ¸Ğµ Ğ´Ğ»Ñ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğ° â€” Ğ³Ğ»Ğ°Ğ²Ğ½Ñ‹Ğµ Ğ¿Ñ€Ğ¸Ğ½Ñ†Ğ¸Ğ¿Ñ‹\n\n"
            "ĞĞµ Ğ½ÑƒĞ¶Ğ½Ğ¾ Ğ¸Ğ´ĞµĞ°Ğ»ÑŒĞ½Ğ¾Ğ¹ Ğ´Ğ¸ĞµÑ‚Ñ‹. ĞÑƒĞ¶Ğ½Ğ¾ ÑÑ‚Ğ°Ğ±Ğ¸Ğ»ÑŒĞ½Ğ¾Ğ³Ğ¾ Ğ´ĞµÑ„Ğ¸Ñ†Ğ¸Ñ‚Ğ° Ğ¸Ğ»Ğ¸ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ñ†Ğ¸Ñ‚Ğ°.\n\n"
            "ğŸ“Œ ĞÑĞ½Ğ¾Ğ²Ñ‹:\n\n"
            "1. ĞšĞ°Ğ»Ğ¾Ñ€Ğ¸Ğ¸ Ñ€ĞµÑˆĞ°ÑÑ‚ Ğ²ÑÑ‘\n"
            "   ĞŸĞ¾Ñ…ÑƒĞ´ĞµĞ½Ğ¸Ğµ = Ğ´ĞµÑ„Ğ¸Ñ†Ğ¸Ñ‚ 300â€“500 ĞºĞºĞ°Ğ». ĞœĞ°ÑÑĞ° = Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ñ†Ğ¸Ñ‚ 200â€“400 ĞºĞºĞ°Ğ».\n"
            "   Ğ’ÑÑ‘ Ğ¾ÑÑ‚Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ â€” Ğ´ĞµÑ‚Ğ°Ğ»Ğ¸.\n\n"
            "2. Ğ‘ĞµĞ»Ğ¾Ğº â€” Ğ³Ğ»Ğ°Ğ²Ğ½Ñ‹Ğ¹ Ğ¿Ñ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚\n"
            "   ĞœĞ¸Ğ½Ğ¸Ğ¼ÑƒĞ¼ 1.6 Ğ³ Ğ½Ğ° ĞºĞ³ Ğ²ĞµÑĞ°. Ğ›ÑƒÑ‡ÑˆĞµ 2 Ğ³.\n"
            "   Ğ˜ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸ĞºĞ¸: ĞºÑƒÑ€Ğ¸Ñ†Ğ°, Ñ€Ñ‹Ğ±Ğ°, ÑĞ¹Ñ†Ğ°, Ñ‚Ğ²Ğ¾Ñ€Ğ¾Ğ³, Ğ³Ğ¾Ğ²ÑĞ´Ğ¸Ğ½Ğ°.\n\n"
            "3. Ğ£Ğ³Ğ»ĞµĞ²Ğ¾Ğ´Ñ‹ â€” Ñ‚Ğ¾Ğ¿Ğ»Ğ¸Ğ²Ğ¾ Ğ´Ğ»Ñ Ñ‚Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²Ğ¾Ğº\n"
            "   ĞŸĞµÑ€ĞµĞ´ Ñ‚Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²ĞºĞ¾Ğ¹ â€” ÑƒĞ³Ğ»ĞµĞ²Ğ¾Ğ´Ñ‹. ĞŸĞ¾ÑĞ»Ğµ â€” Ğ±ĞµĞ»Ğ¾Ğº + ÑƒĞ³Ğ»ĞµĞ²Ğ¾Ğ´Ñ‹.\n"
            "   ĞšÑ€ÑƒĞ¿Ñ‹, ĞºĞ°Ñ€Ñ‚Ğ¾Ñ„ĞµĞ»ÑŒ, Ñ„Ñ€ÑƒĞºÑ‚Ñ‹ â€” Ğ¾Ğº.\n\n"
            "4. Ğ–Ğ¸Ñ€Ñ‹ â€” Ğ³Ğ¾Ñ€Ğ¼Ğ¾Ğ½Ñ‹ Ğ¸ ÑÑƒÑÑ‚Ğ°Ğ²Ñ‹\n"
            "   ĞĞµ ÑƒĞ±Ğ¸Ñ€Ğ°Ğ¹ ÑĞ¾Ğ²ÑĞµĞ¼. ĞœĞ¸Ğ½Ğ¸Ğ¼ÑƒĞ¼ 0.7â€“1 Ğ³ Ğ½Ğ° ĞºĞ³.\n"
            "   ĞÑ€ĞµÑ…Ğ¸, Ğ¼Ğ°ÑĞ»Ğ¾, Ñ€Ñ‹Ğ±Ğ°.\n\n"
            "5. Ğ¡Ñ‚Ğ°Ğ±Ğ¸Ğ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ Ğ²Ğ°Ğ¶Ğ½ĞµĞµ Ğ¸Ğ´ĞµĞ°Ğ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸\n"
            "   80% Ğ¿Ğ¾ Ğ¿Ğ»Ğ°Ğ½Ñƒ ÑÑ‚Ğ°Ğ±Ğ¸Ğ»ÑŒĞ½Ğ¾ > 100% Ğ¸Ğ´ĞµĞ°Ğ»ÑŒĞ½Ğ¾ 3 Ğ´Ğ½Ñ Ğ¸ ÑÑ€Ñ‹Ğ².\n\n"
            "ğŸ’¡ ĞÑ‚ĞºÑ€Ğ¾Ğ¹ ğŸ½ ĞœĞ¾Ñ‘ Ğ¿Ğ¸Ñ‚Ğ°Ğ½Ğ¸Ğµ â€” Ñ‚Ğ°Ğ¼ Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ñ‹Ğµ Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€Ñ‹ Ñ€Ğ°Ñ†Ğ¸Ğ¾Ğ½Ğ¾Ğ² Ğ¿Ğ¾Ğ´ Ñ‚Ğ²Ğ¾Ğ¸ Ñ†Ğ¸Ñ„Ñ€Ñ‹."
        )
    },
    "faq:motivation": {
        "q": "ğŸ˜” ĞšĞ°Ğº Ğ½Ğµ Ğ±Ñ€Ğ¾ÑĞ¸Ñ‚ÑŒ Ğ¸ ÑĞ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ Ğ¼Ğ¾Ñ‚Ğ¸Ğ²Ğ°Ñ†Ğ¸Ñ?",
        "a": (
            "ğŸ˜” ĞœĞ¾Ñ‚Ğ¸Ğ²Ğ°Ñ†Ğ¸Ñ Ğ¿Ñ€Ğ¾Ğ¿Ğ°Ğ»Ğ° â€” Ñ‡Ñ‚Ğ¾ Ğ´ĞµĞ»Ğ°Ñ‚ÑŒ?\n\n"
            "ĞœĞ¾Ñ‚Ğ¸Ğ²Ğ°Ñ†Ğ¸Ñ â€” Ğ½ĞµĞ½Ğ°Ğ´Ñ‘Ğ¶Ğ½Ğ°Ñ ÑˆÑ‚ÑƒĞºĞ°. "
            "ĞŸÑ€Ğ¾Ñ„ĞµÑÑĞ¸Ğ¾Ğ½Ğ°Ğ»Ñ‹ Ğ½Ğµ Ğ¶Ğ´ÑƒÑ‚ Ğ¼Ğ¾Ñ‚Ğ¸Ğ²Ğ°Ñ†Ğ¸Ğ¸ â€” Ğ¾Ğ½Ğ¸ ÑĞ¾Ğ·Ğ´Ğ°ÑÑ‚ Ğ¿Ñ€Ğ¸Ğ²Ñ‹Ñ‡ĞºÑƒ.\n\n"
            "ğŸ” ĞŸĞ¾Ñ‡ĞµĞ¼Ñƒ Ğ»ÑĞ´Ğ¸ Ğ±Ñ€Ğ¾ÑĞ°ÑÑ‚:\n"
            "â€¢ ĞĞ¶Ğ¸Ğ´Ğ°Ğ»Ğ¸ Ğ±Ñ‹ÑÑ‚Ñ€Ğ¾Ğ³Ğ¾ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğ° (2â€“4 Ğ½ĞµĞ´ĞµĞ»Ğ¸) â€” Ğ½Ğµ ÑƒĞ²Ğ¸Ğ´ĞµĞ»Ğ¸\n"
            "â€¢ ĞŸÑ€Ğ¾Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ° ÑĞ»Ğ¸ÑˆĞºĞ¾Ğ¼ ÑĞ»Ğ¾Ğ¶Ğ½Ğ°Ñ Ğ¸Ğ»Ğ¸ ÑĞºÑƒÑ‡Ğ½Ğ°Ñ\n"
            "â€¢ ĞĞµÑ‚ Ğ¸Ğ·Ğ¼ĞµÑ€Ğ¸Ğ¼Ğ¾Ğ³Ğ¾ Ğ¿Ñ€Ğ¾Ğ³Ñ€ĞµÑÑĞ°\n"
            "â€¢ Ğ¡Ñ€Ğ°Ğ²Ğ½Ğ¸Ğ²Ğ°ÑÑ‚ ÑĞµĞ±Ñ Ñ Ğ´Ñ€ÑƒĞ³Ğ¸Ğ¼Ğ¸\n\n"
            "ğŸ’¡ Ğ§Ñ‚Ğ¾ Ñ€ĞµĞ°Ğ»ÑŒĞ½Ğ¾ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚:\n\n"
            "1. Ğ¡Ğ½Ğ¸Ğ·ÑŒ Ğ¿Ğ»Ğ°Ğ½ĞºÑƒ\n"
            "   Ğ›ÑƒÑ‡ÑˆĞµ 30 Ğ¼Ğ¸Ğ½ÑƒÑ‚ 3 Ñ€Ğ°Ğ·Ğ° Ğ² Ğ½ĞµĞ´ĞµĞ»Ñ ÑÑ‚Ğ°Ğ±Ğ¸Ğ»ÑŒĞ½Ğ¾, Ñ‡ĞµĞ¼ 2 Ñ‡Ğ°ÑĞ° Ñ€Ğ°Ğ· Ğ² Ğ´Ğ²Ğµ Ğ½ĞµĞ´ĞµĞ»Ğ¸.\n\n"
            "2. Ğ—Ğ°Ğ¿Ğ¸ÑÑ‹Ğ²Ğ°Ğ¹ Ğ¿Ñ€Ğ¾Ğ³Ñ€ĞµÑÑ\n"
            "   Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ ğŸ““ Ğ”Ğ½ĞµĞ²Ğ½Ğ¸Ğº â€” ĞºĞ¾Ğ³Ğ´Ğ° Ğ²Ğ¸Ğ´Ğ¸ÑˆÑŒ Ñ€Ğ¾ÑÑ‚ Ğ² Ñ†Ğ¸Ñ„Ñ€Ğ°Ñ…, Ğ¼Ğ¾Ñ‚Ğ¸Ğ²Ğ°Ñ†Ğ¸Ñ Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ÑÑ.\n\n"
            "3. Ğ”ĞµĞ»Ğ°Ğ¹ Ğ·Ğ°Ğ¼ĞµÑ€Ñ‹\n"
            "   Ğ’ĞµÑ Ñ‚ĞµĞ»Ğ° Ğ»Ğ¶Ñ‘Ñ‚. ĞĞ±ÑŠÑ‘Ğ¼Ñ‹ Ğ¸ Ñ„Ğ¾Ñ‚Ğ¾ Ğ½Ğµ Ğ²Ñ€ÑƒÑ‚. "
            "   Ğ”ĞµĞ»Ğ°Ğ¹ Ñ„Ğ¾Ñ‚Ğ¾ ĞºĞ°Ğ¶Ğ´Ñ‹Ğµ 4 Ğ½ĞµĞ´ĞµĞ»Ğ¸.\n\n"
            "4. Ğ¤Ğ¾ĞºÑƒÑ Ğ½Ğ° Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑĞµ, Ğ½Ğµ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğµ\n"
            "   Ğ¦ĞµĞ»ÑŒ: 'Ğ¿Ñ€Ğ¸Ğ¹Ñ‚Ğ¸ Ğ½Ğ° Ñ‚Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²ĞºÑƒ', Ğ° Ğ½Ğµ 'Ğ¿Ğ¾Ñ…ÑƒĞ´ĞµÑ‚ÑŒ Ğ½Ğ° 10 ĞºĞ³'.\n\n"
            "5. Ğ ĞµĞ°Ğ»Ğ¸ÑÑ‚Ğ¸Ñ‡Ğ½Ñ‹Ğµ ÑÑ€Ğ¾ĞºĞ¸\n"
            "   Ğ’Ğ¸Ğ´Ğ¸Ğ¼Ñ‹Ğ¹ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚: 8â€“12 Ğ½ĞµĞ´ĞµĞ»ÑŒ Ğ¿Ñ€Ğ¸ ÑÑ‚Ğ°Ğ±Ğ¸Ğ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸. "
            "   Ğ•ÑĞ»Ğ¸ Ğ¶Ğ´Ñ‘ÑˆÑŒ Ğ·Ğ° Ğ¼ĞµÑÑÑ† â€” Ğ±ÑƒĞ´ĞµÑ‚ Ñ€Ğ°Ğ·Ğ¾Ñ‡Ğ°Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ."
        )
    },
    "faq:sleep": {
        "q": "ğŸ˜´ ĞŸĞ¾Ñ‡ĞµĞ¼Ñƒ Ğ²Ğ°Ğ¶ĞµĞ½ ÑĞ¾Ğ½ Ğ¸ Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ?",
        "a": (
            "ğŸ˜´ Ğ¡Ğ¾Ğ½ Ğ¸ Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ â€” Ğ½ĞµĞ´Ğ¾Ğ¾Ñ†ĞµĞ½Ñ‘Ğ½Ğ½Ñ‹Ğ¹ Ñ„Ğ°ĞºÑ‚Ğ¾Ñ€\n\n"
            "ĞœÑ‹ÑˆÑ†Ñ‹ Ñ€Ğ°ÑÑ‚ÑƒÑ‚ ĞĞ• Ğ½Ğ° Ñ‚Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²ĞºĞµ. ĞĞ½Ğ¸ Ñ€Ğ°ÑÑ‚ÑƒÑ‚ Ğ’Ğ Ğ¡ĞĞ•.\n"
            "Ğ¢Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²ĞºĞ° â€” ÑÑ‚Ğ¾ ÑÑ‚Ğ¸Ğ¼ÑƒĞ». Ğ¡Ğ¾Ğ½ â€” ÑÑ‚Ğ¾ ĞºĞ¾Ğ³Ğ´Ğ° Ğ¿Ñ€Ğ¾Ğ¸ÑÑ…Ğ¾Ğ´Ğ¸Ñ‚ Ñ€Ğ¾ÑÑ‚.\n\n"
            "ğŸ“Œ Ğ¤Ğ°ĞºÑ‚Ñ‹:\n"
            "â€¢ ĞœĞµĞ½ÑŒÑˆĞµ 6 Ñ‡Ğ°ÑĞ¾Ğ² ÑĞ½Ğ° = Ğ½Ğ° 60% Ñ…ÑƒĞ¶Ğµ Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¼Ñ‹ÑˆÑ†\n"
            "â€¢ ĞœĞµĞ½ÑŒÑˆĞµ 7 Ñ‡Ğ°ÑĞ¾Ğ² = Ğ¿Ğ¾Ğ²Ñ‹ÑˆĞµĞ½Ğ½Ñ‹Ğ¹ ĞºĞ¾Ñ€Ñ‚Ğ¸Ğ·Ğ¾Ğ» (Ğ³Ğ¾Ñ€Ğ¼Ğ¾Ğ½ ÑÑ‚Ñ€ĞµÑÑĞ°) â†’ Ñ…ÑƒĞ¶Ğµ Ğ¶Ğ¸Ñ€Ğ¾ÑĞ¶Ğ¸Ğ³Ğ°Ğ½Ğ¸Ğµ\n"
            "â€¢ 7â€“9 Ñ‡Ğ°ÑĞ¾Ğ² = Ğ¾Ğ¿Ñ‚Ğ¸Ğ¼ÑƒĞ¼ Ğ´Ğ»Ñ ÑĞ¿Ğ¾Ñ€Ñ‚Ğ¸Ğ²Ğ½Ğ¾Ğ³Ğ¾ Ğ¿Ñ€Ğ¾Ğ³Ñ€ĞµÑÑĞ°\n\n"
            "ğŸ” ĞŸÑ€Ğ¸Ğ·Ğ½Ğ°ĞºĞ¸ Ğ½ĞµĞ´Ğ¾Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ:\n"
            "â€¢ Ğ¢Ñ‹ ÑƒÑÑ‚Ğ°Ñ‘ÑˆÑŒ Ğ±Ñ‹ÑÑ‚Ñ€ĞµĞµ Ñ‡ĞµĞ¼ Ñ€Ğ°Ğ½ÑŒÑˆĞµ\n"
            "â€¢ Ğ’ĞµÑĞ° Ğ½Ğµ Ñ€Ğ°ÑÑ‚ÑƒÑ‚ Ğ½ĞµÑĞºĞ¾Ğ»ÑŒĞºĞ¾ Ğ½ĞµĞ´ĞµĞ»ÑŒ\n"
            "â€¢ ĞŸĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ½Ğ¾ Ñ…Ğ¾Ñ‡ĞµÑ‚ÑÑ ÑĞ¿Ğ°Ñ‚ÑŒ Ğ¸Ğ»Ğ¸ Ñ€Ğ°Ğ·Ğ´Ñ€Ğ°Ğ¶Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ\n"
            "â€¢ Ğ§Ğ°ÑÑ‚Ñ‹Ğµ Ğ¿Ñ€Ğ¾ÑÑ‚ÑƒĞ´Ñ‹\n\n"
            "ğŸ’¡ Ğ§Ñ‚Ğ¾ Ğ´ĞµĞ»Ğ°Ñ‚ÑŒ:\n"
            "â€¢ Ğ›Ğ¾Ğ¶Ğ¸ÑÑŒ Ğ² Ğ¾Ğ´Ğ½Ğ¾ Ğ²Ñ€ĞµĞ¼Ñ â€” Ñ†Ğ¸ĞºĞ»Ğ¾Ğ¼ĞµĞ»Ğ°Ğ½Ğ¸Ğ½ Ğ²Ğ°Ğ¶ĞµĞ½\n"
            "â€¢ Ğ—Ğ° Ñ‡Ğ°Ñ Ğ´Ğ¾ ÑĞ½Ğ° Ğ±ĞµĞ· ÑÑ€ĞºĞ¾Ğ³Ğ¾ ÑĞºÑ€Ğ°Ğ½Ğ°\n"
            "â€¢ ĞšĞ¾Ğ¼Ğ½Ğ°Ñ‚Ğ° Ğ¿Ñ€Ğ¾Ñ…Ğ»Ğ°Ğ´Ğ½Ğ°Ñ (18â€“20Â°C) â€” Ğ»ÑƒÑ‡ÑˆĞ¸Ğ¹ ÑĞ¾Ğ½\n"
            "â€¢ ĞŸÑ€Ğ¸ 5 Ñ‚Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²ĞºĞ°Ñ… Ğ² Ğ½ĞµĞ´ĞµĞ»Ñ â€” Ñ…Ğ¾Ñ‚Ñ Ğ±Ñ‹ 1 Ğ´ĞµĞ½ÑŒ Ğ¿Ğ¾Ğ»Ğ½Ğ¾Ğ³Ğ¾ Ğ¾Ñ‚Ğ´Ñ‹Ñ…Ğ°"
        )
    },
    "faq:technique": {
        "q": "ğŸ‹ï¸ ĞŸĞ¾Ñ‡ĞµĞ¼Ñƒ Ñ‚Ğ°Ğº Ğ²Ğ°Ğ¶Ğ½Ğ° Ñ‚ĞµÑ…Ğ½Ğ¸ĞºĞ°?",
        "a": (
            "ğŸ‹ï¸ Ğ¢ĞµÑ…Ğ½Ğ¸ĞºĞ° ÑƒĞ¿Ñ€Ğ°Ğ¶Ğ½ĞµĞ½Ğ¸Ğ¹ â€” Ğ¿Ğ¾Ñ‡ĞµĞ¼Ñƒ ÑÑ‚Ğ¾ Ğ²Ğ°Ğ¶Ğ½Ğ¾\n\n"
            "ĞŸĞ»Ğ¾Ñ…Ğ°Ñ Ñ‚ĞµÑ…Ğ½Ğ¸ĞºĞ° = Ğ»Ğ¸Ğ±Ğ¾ Ñ‚Ñ€Ğ°Ğ²Ğ¼Ğ°, Ğ»Ğ¸Ğ±Ğ¾ Ğ½Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ğ¸Ğ´Ñ‘Ñ‚ Ğ½Ğµ Ñ‚ÑƒĞ´Ğ° ĞºÑƒĞ´Ğ° Ğ½Ğ°Ğ´Ğ¾.\n\n"
            "ğŸ“Œ Ğ ĞµĞ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ¿Ğ¾ÑĞ»ĞµĞ´ÑÑ‚Ğ²Ğ¸Ñ Ğ¿Ğ»Ğ¾Ñ…Ğ¾Ğ¹ Ñ‚ĞµÑ…Ğ½Ğ¸ĞºĞ¸:\n"
            "â€¢ ĞšĞ°Ñ‡Ğ°ĞµÑˆÑŒ Ñ‚Ñ€Ğ°Ğ¿ĞµÑ†Ğ¸Ñ Ğ²Ğ¼ĞµÑÑ‚Ğ¾ ÑˆĞ¸Ñ€Ğ¾Ñ‡Ğ°Ğ¹ÑˆĞ¸Ñ… (Ñ‚ÑĞ³Ğ°)\n"
            "â€¢ ĞĞ°Ğ³Ñ€ÑƒĞ·ĞºĞ° ÑƒÑ…Ğ¾Ğ´Ğ¸Ñ‚ Ğ² Ğ¿Ğ¾ÑÑĞ½Ğ¸Ñ†Ñƒ Ğ²Ğ¼ĞµÑÑ‚Ğ¾ ÑĞ³Ğ¾Ğ´Ğ¸Ñ† (Ğ¿Ñ€Ğ¸ÑĞµĞ´)\n"
            "â€¢ Ğ‘Ğ¾Ğ»ÑÑ‚ ÑÑƒÑÑ‚Ğ°Ğ²Ñ‹ â€” Ğ¿Ğ»ĞµÑ‡Ğ¸, ĞºĞ¾Ğ»ĞµĞ½Ğ¸, Ğ»Ğ¾ĞºÑ‚Ğ¸\n"
            "â€¢ Ğ§ĞµÑ€ĞµĞ· Ğ³Ğ¾Ğ´ â€” Ñ…Ñ€Ğ¾Ğ½Ğ¸Ñ‡ĞµÑĞºĞ°Ñ Ñ‚Ñ€Ğ°Ğ²Ğ¼Ğ°\n\n"
            "ğŸ’¡ ĞŸÑ€Ğ°Ğ²Ğ¸Ğ»Ğ°:\n\n"
            "1. Ğ¢ĞµÑ…Ğ½Ğ¸ĞºĞ° > Ğ²ĞµÑ\n"
            "   Ğ›ÑƒÑ‡ÑˆĞµ 40 ĞºĞ³ Ñ‡Ğ¸ÑÑ‚Ğ¾, Ñ‡ĞµĞ¼ 80 ĞºĞ³ Ñ Ñ‡Ğ¸Ñ‚Ğ¸Ğ½Ğ³Ğ¾Ğ¼.\n\n"
            "2. ĞĞ°Ñ‡Ğ¸Ğ½Ğ°Ğ¹ Ñ Ğ¼Ğ°Ğ»Ğ¾Ğ³Ğ¾\n"
            "   ĞŸĞµÑ€Ğ²Ñ‹Ğµ 2â€“4 Ğ½ĞµĞ´ĞµĞ»Ğ¸ â€” Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ñ‚ĞµÑ…Ğ½Ğ¸ĞºĞ° Ğ±ĞµĞ· Ğ±Ğ¾Ğ»ÑŒÑˆĞ¸Ñ… Ğ²ĞµÑĞ¾Ğ².\n\n"
            "3. Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ ĞºĞ½Ğ¾Ğ¿ĞºÑƒ ğŸ“š Ğ¢ĞµÑ…Ğ½Ğ¸ĞºĞ° Ğ² ĞºĞ°Ğ¶Ğ´Ğ¾Ğ¼ ÑƒĞ¿Ñ€Ğ°Ğ¶Ğ½ĞµĞ½Ğ¸Ğ¸\n"
            "   Ğ¢Ğ°Ğ¼ Ğ¿Ğ¾Ğ´Ñ€Ğ¾Ğ±Ğ½Ğ¾ Ñ ĞºĞ°Ñ€Ñ‚Ğ¸Ğ½ĞºĞ¾Ğ¹ â€” ĞºĞ°Ğº Ğ´ĞµĞ»Ğ°Ñ‚ÑŒ Ğ¸ Ñ‡Ñ‚Ğ¾ Ğ½Ğµ Ğ´ĞµĞ»Ğ°Ñ‚ÑŒ.\n\n"
            "4. RIR (Reps In Reserve)\n"
            "   Ğ—Ğ°ĞºĞ°Ğ½Ñ‡Ğ¸Ğ²Ğ°Ğ¹ Ğ¿Ğ¾Ğ´Ñ…Ğ¾Ğ´ ĞºĞ¾Ğ³Ğ´Ğ° Ğ¼Ğ¾Ğ¶ĞµÑˆÑŒ ÑĞ´ĞµĞ»Ğ°Ñ‚ÑŒ ĞµÑ‰Ñ‘ 1â€“2 Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€ĞµĞ½Ğ¸Ñ.\n"
            "   ĞĞµ Ğ´Ğ¾ Ğ¾Ñ‚ĞºĞ°Ğ·Ğ° â€” Ğ´Ğ¾ Ñ‚ĞµÑ…Ğ½Ğ¸Ñ‡ĞµÑĞºĞ¾Ğ³Ğ¾ Ğ¾Ñ‚ĞºĞ°Ğ·Ğ°.\n\n"
            "5. Ğ‘Ğ¾Ğ»ÑŒ â‰  ÑÑ„Ñ„ĞµĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚ÑŒ\n"
            "   Ğ‘Ğ¾Ğ»ÑŒ Ğ² ÑÑƒÑÑ‚Ğ°Ğ²Ğ°Ñ… â€” ÑÑ‚Ğ¾Ğ¿. Ğ–Ğ¶ĞµĞ½Ğ¸Ğµ Ğ² Ğ¼Ñ‹ÑˆÑ†Ğµ â€” Ğ¾Ğº."
        )
    },
    "faq:cardio": {
        "q": "ğŸƒ ĞÑƒĞ¶Ğ½Ğ¾ Ğ»Ğ¸ ĞºĞ°Ñ€Ğ´Ğ¸Ğ¾?",
        "a": (
            "ğŸƒ ĞšĞ°Ñ€Ğ´Ğ¸Ğ¾ â€” Ğ½ÑƒĞ¶Ğ½Ğ¾ Ğ»Ğ¸ Ğ¸ ÑĞºĞ¾Ğ»ÑŒĞºĞ¾?\n\n"
            "ĞšĞ°Ñ€Ğ´Ğ¸Ğ¾ Ğ½Ğµ Ğ¾Ğ±ÑĞ·Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ Ğ´Ğ»Ñ Ğ¿Ğ¾Ñ…ÑƒĞ´ĞµĞ½Ğ¸Ñ, Ğ½Ğ¾ Ğ¿Ğ¾Ğ¼Ğ¾Ğ³Ğ°ĞµÑ‚. "
            "Ğ’ÑÑ‘ Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ñ‚ Ğ¾Ñ‚ Ñ†ĞµĞ»Ğ¸.\n\n"
            "ğŸ“Œ ĞšĞ¾Ğ³Ğ´Ğ° ĞºĞ°Ñ€Ğ´Ğ¸Ğ¾ Ğ¿Ğ¾Ğ¼Ğ¾Ğ³Ğ°ĞµÑ‚:\n"
            "â€¢ Ğ£ÑĞºĞ¾Ñ€ÑĞµÑ‚ Ğ´ĞµÑ„Ğ¸Ñ†Ğ¸Ñ‚ ĞºĞ°Ğ»Ğ¾Ñ€Ğ¸Ğ¹ Ğ±ĞµĞ· ÑƒÑ€ĞµĞ·Ğ°Ğ½Ğ¸Ñ ĞµĞ´Ñ‹\n"
            "â€¢ Ğ£Ğ»ÑƒÑ‡ÑˆĞ°ĞµÑ‚ ÑĞµÑ€Ğ´ĞµÑ‡Ğ½Ğ¾-ÑĞ¾ÑÑƒĞ´Ğ¸ÑÑ‚ÑƒÑ ÑĞ¸ÑÑ‚ĞµĞ¼Ñƒ\n"
            "â€¢ Ğ£ÑĞºĞ¾Ñ€ÑĞµÑ‚ Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¼ĞµĞ¶Ğ´Ñƒ Ñ‚Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²ĞºĞ°Ğ¼Ğ¸ (Ğ»Ñ‘Ğ³ĞºĞ¾Ğµ ĞºĞ°Ñ€Ğ´Ğ¸Ğ¾)\n\n"
            "âš ï¸ ĞšĞ¾Ğ³Ğ´Ğ° ĞºĞ°Ñ€Ğ´Ğ¸Ğ¾ Ğ¼ĞµÑˆĞ°ĞµÑ‚:\n"
            "â€¢ Ğ¡Ğ»Ğ¸ÑˆĞºĞ¾Ğ¼ Ğ¼Ğ½Ğ¾Ğ³Ğ¾ ĞºĞ°Ñ€Ğ´Ğ¸Ğ¾ Ğ½Ğ° Ğ¼Ğ°ÑÑĞµ = Ñ‚ĞµĞ»Ğ¾ Ğ¶Ğ¶Ñ‘Ñ‚ Ğ¼Ñ‹ÑˆÑ†Ñ‹\n"
            "â€¢ ĞŸĞ¾ÑĞ»Ğµ ÑĞ¸Ğ»Ğ¾Ğ²Ğ¾Ğ¹ ÑÑ€Ğ°Ğ·Ñƒ 40+ Ğ¼Ğ¸Ğ½ ĞºĞ°Ñ€Ğ´Ğ¸Ğ¾ = Ñ…ÑƒĞ¶Ğµ Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ\n"
            "â€¢ ĞšĞ°Ñ€Ğ´Ğ¸Ğ¾ Ğ·Ğ°Ğ¼ĞµĞ½ÑĞµÑ‚ ÑĞ¸Ğ»Ğ¾Ğ²Ñ‹Ğµ = Ğ¿Ğ¾Ñ‚ĞµÑ€Ñ Ğ¼Ñ‹ÑˆÑ†\n\n"
            "ğŸ’¡ Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ğ¸:\n\n"
            "ĞĞ° ÑÑƒÑˆĞºĞµ:\n"
            "â€¢ 2â€“3 ĞºĞ°Ñ€Ğ´Ğ¸Ğ¾ Ğ¿Ğ¾ 20â€“40 Ğ¼Ğ¸Ğ½ Ğ² Ğ½ĞµĞ´ĞµĞ»Ñ\n"
            "â€¢ LISS (Ğ½Ğ¸Ğ·ĞºĞ¾Ğ¸Ğ½Ñ‚ĞµĞ½ÑĞ¸Ğ²Ğ½Ğ¾Ğµ): Ñ…Ğ¾Ğ´ÑŒĞ±Ğ°, Ğ²ĞµĞ»Ğ¾ÑĞ¸Ğ¿ĞµĞ´, Ğ»Ñ‘Ğ³ĞºĞ¸Ğ¹ Ğ±ĞµĞ³\n"
            "â€¢ Ğ’ Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½Ñ‹Ğ¹ Ğ¾Ñ‚ ÑĞ¸Ğ»Ğ¾Ğ²Ğ¾Ğ¹ Ğ´ĞµĞ½ÑŒ Ğ¸Ğ»Ğ¸ Ğ¿Ğ¾ÑĞ»Ğµ Ğ½ĞµÑ‘\n\n"
            "ĞĞ° Ğ¼Ğ°ÑÑĞµ:\n"
            "â€¢ 1â€“2 Ğ»Ñ‘Ğ³ĞºĞ¸Ğµ ĞºĞ°Ñ€Ğ´Ğ¸Ğ¾ Ğ² Ğ½ĞµĞ´ĞµĞ»Ñ Ğ´Ğ»Ñ Ğ·Ğ´Ğ¾Ñ€Ğ¾Ğ²ÑŒÑ ÑĞµÑ€Ğ´Ñ†Ğ°\n"
            "â€¢ ĞĞµ Ğ±Ğ¾Ğ»ÑŒÑˆĞµ 20â€“30 Ğ¼Ğ¸Ğ½"
        )
    },
}


def faq_kb():
    rows = [
        [InlineKeyboardButton(text="âš–ï¸ Ğ’ĞµÑ Ğ½Ğµ Ğ¼ĞµĞ½ÑĞµÑ‚ÑÑ", callback_data="faq:weight")],
        [InlineKeyboardButton(text="ğŸ’ª ĞœÑ‹ÑˆÑ†Ñ‹ Ğ½Ğµ Ñ€Ğ°ÑÑ‚ÑƒÑ‚", callback_data="faq:muscle")],
        [InlineKeyboardButton(text="ğŸ“‰ ĞŸÑ€Ğ¾Ğ³Ñ€ĞµÑÑ Ğ¾ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ğ»ÑÑ", callback_data="faq:plateau")],
        [InlineKeyboardButton(text="ğŸ½ ĞšĞ°Ğº Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ğ¾ Ğ¿Ğ¸Ñ‚Ğ°Ñ‚ÑŒÑÑ", callback_data="faq:diet")],
        [InlineKeyboardButton(text="ğŸ˜” ĞĞµÑ‚ Ğ¼Ğ¾Ñ‚Ğ¸Ğ²Ğ°Ñ†Ğ¸Ğ¸", callback_data="faq:motivation")],
        [InlineKeyboardButton(text="ğŸ˜´ Ğ¡Ğ¾Ğ½ Ğ¸ Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ", callback_data="faq:sleep")],
        [InlineKeyboardButton(text="ğŸ‹ï¸ Ğ—Ğ°Ñ‡ĞµĞ¼ Ğ½ÑƒĞ¶Ğ½Ğ° Ñ‚ĞµÑ…Ğ½Ğ¸ĞºĞ°", callback_data="faq:technique")],
        [InlineKeyboardButton(text="ğŸƒ ĞÑƒĞ¶Ğ½Ğ¾ Ğ»Ğ¸ ĞºĞ°Ñ€Ğ´Ğ¸Ğ¾", callback_data="faq:cardio")],
        [InlineKeyboardButton(text="ğŸ  ĞœĞµĞ½Ñ", callback_data="nav:menu")],
    ]
    return InlineKeyboardMarkup(inline_keyboard=rows)


def faq_back_kb():
    return InlineKeyboardMarkup(inline_keyboard=[
        [InlineKeyboardButton(text="â¬…ï¸ Ğ’ÑĞµ Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑÑ‹", callback_data="nav:faq")],
        [InlineKeyboardButton(text="ğŸ  ĞœĞµĞ½Ñ", callback_data="nav:menu")],
    ])


async def open_faq(user_id: int, chat_id: int, bot: Bot, callback: Optional[CallbackQuery] = None):
    text = (
        "â“ ĞÑ‚Ğ²ĞµÑ‚Ñ‹ Ğ½Ğ° Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑÑ‹\n\n"
        "Ğ—Ğ´ĞµÑÑŒ Ñ€Ğ°Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ½Ñ‹ ÑĞ°Ğ¼Ñ‹Ğµ Ñ‡Ğ°ÑÑ‚Ñ‹Ğµ Ğ¿Ñ€Ğ¸Ñ‡Ğ¸Ğ½Ñ‹, Ğ¿Ğ¾Ñ‡ĞµĞ¼Ñƒ Ğ½ĞµÑ‚ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğ°.\n"
        "Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸ Ñ‚ĞµĞ¼Ñƒ ğŸ‘‡"
    )
    if callback:
        await clean_edit(callback, user_id, text, reply_markup=faq_kb())
    else:
        await clean_send(bot, chat_id, user_id, text, reply_markup=faq_kb())


async def cb_faq_question(callback: CallbackQuery, bot: Bot):
    key = callback.data  # faq:weight, faq:muscle etc
    item = FAQ_QUESTIONS.get(key)
    if not item:
        await callback.answer("Ğ’Ğ¾Ğ¿Ñ€Ğ¾Ñ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½", show_alert=True)
        return
    await clean_edit(callback, callback.from_user.id, item["a"], reply_markup=faq_back_kb())
    await callback.answer()


async def show_main_menu(bot: Bot, chat_id: int, user_id: int):
    text = (
        "ğŸ  Ğ“Ğ»Ğ°Ğ²Ğ½Ğ¾Ğµ Ğ¼ĞµĞ½Ñ\n\n"
        "ğŸ“Œ ĞšĞ°Ğº Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒÑÑ Ğ±Ğ¾Ñ‚Ğ¾Ğ¼:\n"
        "1ï¸âƒ£ Ğ—Ğ°Ğ¿Ğ¾Ğ»Ğ½Ğ¸ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ (ĞºĞ½Ğ¾Ğ¿ĞºĞ° âš™ï¸ ĞŸÑ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ ÑĞ½Ğ¸Ğ·Ñƒ) â€” Ñ†ĞµĞ»ÑŒ, Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹, Ğ³Ğ´Ğµ Ñ‚Ñ€ĞµĞ½Ğ¸Ñ€ÑƒĞµÑˆÑŒÑÑ\n"
        "2ï¸âƒ£ Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸ Ñ‚Ğ°Ñ€Ğ¸Ñ„ (ğŸ’³ ĞĞ¿Ğ»Ğ°Ñ‚Ğ°) â€” Ğ±Ğ¾Ñ‚ ÑÑ€Ğ°Ğ·Ñƒ ÑÑ„Ğ¾Ñ€Ğ¼Ğ¸Ñ€ÑƒĞµÑ‚ Ñ‚Ğ²Ğ¾Ñ Ğ¿Ñ€Ğ¾Ğ³Ñ€Ğ°Ğ¼Ğ¼Ñƒ\n"
        "3ï¸âƒ£ ĞÑ‚ĞºÑ€Ğ¾Ğ¹ ğŸ‹ï¸ Ğ¢Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²ĞºĞ¸ â€” Ñ‚Ğ°Ğ¼ Ğ²ÑĞµ Ğ´Ğ½Ğ¸ Ñ ÑƒĞ¿Ñ€Ğ°Ğ¶Ğ½ĞµĞ½Ğ¸ÑĞ¼Ğ¸ Ğ¸ ĞºĞ½Ğ¾Ğ¿ĞºĞ¾Ğ¹ Ñ‚ĞµÑ…Ğ½Ğ¸ĞºĞ¸\n"
        "4ï¸âƒ£ ĞŸĞ¾ÑĞ»Ğµ Ñ‚Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²ĞºĞ¸ Ğ·Ğ°Ğ¿Ğ¾Ğ»Ğ½ÑĞ¹ ğŸ““ Ğ”Ğ½ĞµĞ²Ğ½Ğ¸Ğº â€” Ğ¾Ñ‚Ğ¼ĞµÑ‡Ğ°Ğ¹ Ğ²ĞµÑĞ° Ğ¸ Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€ĞµĞ½Ğ¸Ñ\n"
        "5ï¸âƒ£ Ğ¡Ğ»ĞµĞ´Ğ¸ Ğ·Ğ° Ğ¿Ñ€Ğ¾Ğ³Ñ€ĞµÑÑĞ¾Ğ¼ Ğ² ğŸ“ Ğ—Ğ°Ğ¼ĞµÑ€Ñ‹ â€” Ğ²ĞµÑ Ñ‚ĞµĞ»Ğ°, Ğ¾Ğ±Ñ…Ğ²Ğ°Ñ‚Ñ‹ Ñ€Ğ°Ğ· Ğ² 1â€“2 Ğ½ĞµĞ´ĞµĞ»Ğ¸\n"
        "6ï¸âƒ£ ĞŸĞ¸Ñ‚Ğ°Ğ½Ğ¸Ğµ ğŸ½ â€” Ğ¿ĞµÑ€ÑĞ¾Ğ½Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ñ€Ğ°ÑÑ‡Ñ‘Ñ‚ ĞšĞ‘Ğ–Ğ£ + Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ñ‹Ğµ Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€Ñ‹ Ñ€Ğ°Ñ†Ğ¸Ğ¾Ğ½Ğ¾Ğ²\n\n"
        "â“ ĞĞµÑ‚ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğ°? ĞĞ°Ğ¶Ğ¼Ğ¸ Â«ĞÑ‚Ğ²ĞµÑ‚Ñ‹ Ğ½Ğ° Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑÑ‹Â» â€” Ñ€Ğ°Ğ·Ğ±Ğ¸Ñ€Ğ°Ñ Ñ‡Ğ°ÑÑ‚Ñ‹Ğµ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸.\n\n"
        "Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸ Ñ€Ğ°Ğ·Ğ´ĞµĞ» ğŸ‘‡"
    )
    await clean_send(bot, chat_id, user_id, text, reply_markup=menu_main_inline_kb())


def welcome_kb():
    return InlineKeyboardMarkup(inline_keyboard=[
        [InlineKeyboardButton(text="ğŸ“‹ Ğ—Ğ°Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ÑŒ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ", callback_data="p:start_wizard")],
    ])


async def cmd_start(message: Message, bot: Bot):
    await ensure_user(message.from_user.id, message.from_user.username or "")
    await try_delete_user_message(bot, message)

    await bot.send_message(
        chat_id=message.chat.id,
        text="âœ… Ğ¯ Ğ½Ğ° Ğ¼ĞµÑÑ‚Ğµ. ĞšĞ½Ğ¾Ğ¿ĞºĞ¸ ÑĞ½Ğ¸Ğ·Ñƒ ğŸ‘‡",
        reply_markup=control_reply_kb()
    )

    welcome_text = (
        "ğŸ‘‹ ĞŸÑ€Ğ¸Ğ²ĞµÑ‚! Ğ¯ Ñ‚Ğ²Ğ¾Ğ¹ Ğ¿ĞµÑ€ÑĞ¾Ğ½Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ñ‚Ñ€ĞµĞ½ĞµÑ€-Ğ±Ğ¾Ñ‚.\n\n"
        "ğŸ‹ï¸ Ğ§Ñ‚Ğ¾ Ñ ÑƒĞ¼ĞµÑ:\n"
        "â€¢ Ğ¡Ğ¾ÑÑ‚Ğ°Ğ²Ğ»ÑÑ Ğ¿Ñ€Ğ¾Ğ³Ñ€Ğ°Ğ¼Ğ¼Ñƒ Ñ‚Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²Ğ¾Ğº Ğ¿Ğ¾Ğ´ Ñ‚ĞµĞ±Ñ â€” Ğ¿Ğ¾ ÑĞ¸ÑÑ‚ĞµĞ¼Ğµ Ğ¤ÑƒĞ»Ğ±Ğ°Ğ´Ğ¸, Ğ’ĞµÑ€Ñ…/ĞĞ¸Ğ· Ğ¸Ğ»Ğ¸ PPL, "
        "Ğ² Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ Ğ¾Ñ‚ Ñ‚Ğ²Ğ¾ĞµĞ¹ Ñ†ĞµĞ»Ğ¸, Ğ¾Ğ¿Ñ‹Ñ‚Ğ° Ğ¸ Ñ‚Ğ¾Ğ³Ğ¾, Ğ³Ğ´Ğµ Ñ‚Ñ€ĞµĞ½Ğ¸Ñ€ÑƒĞµÑˆÑŒÑÑ (Ğ·Ğ°Ğ» Ğ¸Ğ»Ğ¸ Ğ´Ğ¾Ğ¼Ğ°)\n"
        "â€¢ Ğ Ğ°ÑÑÑ‡Ğ¸Ñ‚Ñ‹Ğ²Ğ°Ñ Ğ¿Ğ¸Ñ‚Ğ°Ğ½Ğ¸Ğµ Ğ¿Ğ¾ ĞšĞ‘Ğ–Ğ£ Ğ¸Ğ½Ğ´Ğ¸Ğ²Ğ¸Ğ´ÑƒĞ°Ğ»ÑŒĞ½Ğ¾ â€” Ñ ÑƒÑ‡Ñ‘Ñ‚Ğ¾Ğ¼ Ñ†ĞµĞ»Ğ¸, Ğ²ĞµÑĞ°, Ñ€Ğ¾ÑÑ‚Ğ° Ğ¸ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚Ğ¸\n"
        "â€¢ Ğ’ĞµĞ´Ñƒ Ğ´Ğ½ĞµĞ²Ğ½Ğ¸Ğº Ñ‚Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²Ğ¾Ğº â€” Ğ·Ğ°Ğ¿Ğ¸ÑÑ‹Ğ²Ğ°Ñ Ğ²ĞµÑĞ° Ğ¸ Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€ĞµĞ½Ğ¸Ñ, ÑĞ¾Ñ…Ñ€Ğ°Ğ½ÑÑ Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ñ\n"
        "â€¢ ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°Ñ Ñ‚ĞµÑ…Ğ½Ğ¸ĞºÑƒ ÑƒĞ¿Ñ€Ğ°Ğ¶Ğ½ĞµĞ½Ğ¸Ğ¹ Ñ ĞºĞ°Ñ€Ñ‚Ğ¸Ğ½ĞºĞ°Ğ¼Ğ¸ â€” Ğ¿Ğ¾Ğ´ ĞºĞ°Ğ¶Ğ´Ñ‹Ğ¼ ÑƒĞ¿Ñ€Ğ°Ğ¶Ğ½ĞµĞ½Ğ¸ĞµĞ¼ ĞºĞ½Ğ¾Ğ¿ĞºĞ° ğŸ“š\n"
        "â€¢ ĞÑ‚Ğ²ĞµÑ‡Ğ°Ñ Ğ½Ğ° Ñ‡Ğ°ÑÑ‚Ñ‹Ğµ Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑÑ‹ â€” Ğ¿Ğ¾Ñ‡ĞµĞ¼Ñƒ Ğ½ĞµÑ‚ Ğ¿Ñ€Ğ¾Ğ³Ñ€ĞµÑÑĞ°, ĞºĞ°Ğº Ğ¿Ğ¸Ñ‚Ğ°Ñ‚ÑŒÑÑ, ĞºĞ°Ğº Ğ½Ğµ Ğ±Ñ€Ğ¾ÑĞ¸Ñ‚ÑŒ\n\n"
        "ğŸ“‹ ĞšĞ°Ğº Ğ½Ğ°Ñ‡Ğ°Ñ‚ÑŒ:\n"
        "1ï¸âƒ£ ĞĞ°Ğ¶Ğ¼Ğ¸ âš™ï¸ ĞŸÑ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ (ĞºĞ½Ğ¾Ğ¿ĞºĞ° ÑĞ½Ğ¸Ğ·Ñƒ) â€” Ğ·Ğ°Ğ¿Ğ¾Ğ»Ğ½Ğ¸ Ñ†ĞµĞ»ÑŒ, Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹, Ğ¼ĞµÑÑ‚Ğ¾ Ñ‚Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²Ğ¾Ğº\n"
        "2ï¸âƒ£ Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸ Ñ‚Ğ°Ñ€Ğ¸Ñ„ (ğŸ’³ ĞĞ¿Ğ»Ğ°Ñ‚Ğ°) â€” Ğ±Ğ¾Ñ‚ ÑÑ€Ğ°Ğ·Ñƒ ÑÑ„Ğ¾Ñ€Ğ¼Ğ¸Ñ€ÑƒĞµÑ‚ Ñ‚Ğ²Ğ¾Ñ Ğ¿ĞµÑ€ÑĞ¾Ğ½Ğ°Ğ»ÑŒĞ½ÑƒÑ Ğ¿Ñ€Ğ¾Ğ³Ñ€Ğ°Ğ¼Ğ¼Ñƒ\n"
        "3ï¸âƒ£ ĞÑ‚ĞºÑ€Ğ¾Ğ¹ ğŸ  ĞœĞµĞ½Ñ â€” Ñ‚Ğ°Ğ¼ Ğ²ÑĞµ Ñ€Ğ°Ğ·Ğ´ĞµĞ»Ñ‹: Ñ‚Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²ĞºĞ¸, Ğ¿Ğ¸Ñ‚Ğ°Ğ½Ğ¸Ğµ, Ğ´Ğ½ĞµĞ²Ğ½Ğ¸Ğº, Ğ·Ğ°Ğ¼ĞµÑ€Ñ‹\n\n"
        "ĞĞ°Ğ¶Ğ¼Ğ¸ ĞºĞ½Ğ¾Ğ¿ĞºÑƒ Ğ½Ğ¸Ğ¶Ğµ â€” Ğ¸ Ğ¿Ğ¾ĞµÑ…Ğ°Ğ»Ğ¸ ğŸ‘‡"
    )

    if os.path.exists(WELCOME_IMAGE):
        photo = FSInputFile(WELCOME_IMAGE)
        await bot.send_photo(
            chat_id=message.chat.id,
            photo=photo,
            caption=welcome_text,
            reply_markup=welcome_kb()
        )
    else:
        await bot.send_message(
            chat_id=message.chat.id,
            text=welcome_text,
            reply_markup=welcome_kb()
        )


async def open_upgrade(user_id: int, chat_id: int, bot: Bot, callback: Optional[CallbackQuery] = None):
    text = (
        "ğŸ”¥ Ğ£Ğ»ÑƒÑ‡ÑˆĞ¸Ñ‚ÑŒ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿\n\n"
        "Ğ’Ñ‹Ğ±Ğ¸Ñ€Ğ°Ğ¹ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚:\n\n"
        f"ğŸŸ© 1 Ğ¼ĞµÑÑÑ† â€” {TARIFFS['t1']['price']}â‚½\n"
        "â€¢ Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ¿Ğ¾Ğ¿Ñ€Ğ¾Ğ±Ğ¾Ğ²Ğ°Ñ‚ÑŒ\n\n"
        f"ğŸ”¥ 3 Ğ¼ĞµÑÑÑ†Ğ° â€” {TARIFFS['t3']['price']}â‚½ (Ğ›Ğ£Ğ§Ğ¨Ğ˜Ğ™ Ğ’Ğ«Ğ‘ĞĞ )\n"
        "â€¢ Ñ€ĞµĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚ Ğ·Ğ° 90 Ğ´Ğ½ĞµĞ¹\n"
        "â€¢ Ğ¿Ğ¸Ñ‚Ğ°Ğ½Ğ¸Ğµ + Ğ²ÑĞµ Ñ†ĞµĞ»Ğ¸ + Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ\n\n"
        f"ğŸ† ĞĞ°Ğ²ÑĞµĞ³Ğ´Ğ° â€” {TARIFFS['life']['price']}â‚½\n"
        "â€¢ Ğ¾Ğ´Ğ¸Ğ½ Ñ€Ğ°Ğ· Ğ¾Ğ¿Ğ»Ğ°Ñ‚Ğ¸Ğ» Ğ¸ Ğ·Ğ°Ğ±Ñ‹Ğ»\n"
        "â€¢ Ğ²ÑĞµ Ğ±ÑƒĞ´ÑƒÑ‰Ğ¸Ğµ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ\n"
    )

    kb = InlineKeyboardMarkup(inline_keyboard=[
        [InlineKeyboardButton(text=f"ğŸ”¥ 3 Ğ¼ĞµÑÑÑ†Ğ° â€” {TARIFFS['t3']['price']}â‚½ (Ğ²Ñ‹Ğ³Ğ¾Ğ´Ğ½Ğ¾)", callback_data="tariff:t3")],
        [InlineKeyboardButton(text=f"ğŸ† ĞĞ°Ğ²ÑĞµĞ³Ğ´Ğ° â€” {TARIFFS['life']['price']}â‚½", callback_data="tariff:life")],
        [InlineKeyboardButton(text=f"ğŸŸ© 1 Ğ¼ĞµÑÑÑ† â€” {TARIFFS['t1']['price']}â‚½", callback_data="tariff:t1")],
        [InlineKeyboardButton(text="ğŸ  ĞœĞµĞ½Ñ", callback_data="nav:menu")],
    ])

    if callback:
        await clean_edit(callback, user_id, text, reply_markup=kb)
    else:
        await clean_send(bot, chat_id, user_id, text, reply_markup=kb)


# =========================
# ĞĞ°Ğ²Ğ¸Ğ³Ğ°Ñ†Ğ¸Ñ
# =========================
async def cb_nav(callback: CallbackQuery, state: FSMContext, bot: Bot):
    await ensure_user(callback.from_user.id, callback.from_user.username or "")
    await state.clear()

    key = callback.data.split(":", 1)[1]
    uid = callback.from_user.id
    chat_id = callback.message.chat.id

    if key == "menu":
        await show_main_menu(bot, chat_id, uid)
    elif key == "workouts":
        await open_workouts(user_id=uid, chat_id=chat_id, bot=bot, callback=callback)
    elif key == "nutrition":
        await open_nutrition(user_id=uid, chat_id=chat_id, bot=bot, callback=callback)
    elif key == "measures":
        await open_measures(user_id=uid, chat_id=chat_id, bot=bot, state=state, callback=callback)
    elif key == "diary":
        await open_diary(user_id=uid, chat_id=chat_id, bot=bot, state=state, callback=callback)
    elif key == "faq":
        await open_faq(user_id=uid, chat_id=chat_id, bot=bot, callback=callback)
    elif key == "upgrade":
        await open_upgrade(user_id=uid, chat_id=chat_id, bot=bot, callback=callback)
    else:
        await show_main_menu(bot, chat_id, uid)

    await callback.answer()


# =========================
# ĞŸĞ°Ğ½ĞµĞ»ÑŒ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ (ReplyKeyboard)
# =========================
async def open_payment_from_reply(message: Message, state: FSMContext, bot: Bot):
    await ensure_user(message.from_user.id, message.from_user.username or "")
    await state.clear()

    uid = message.from_user.id
    a = await get_access(uid)

    if await is_access_active(uid):
        tariff = a.get("tariff", "")
        if tariff in FULL_ACCESS_TARIFFS:
            text = f"âœ… Ğ£ Ñ‚ĞµĞ±Ñ Ğ¿Ğ¾Ğ»Ğ½Ñ‹Ğ¹ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿.\n{access_status_str(a)}"
            await clean_send(bot, message.chat.id, uid, text)
        else:
            # Ğ‘Ğ°Ğ·Ğ¾Ğ²Ñ‹Ğ¹ Ñ‚Ğ°Ñ€Ğ¸Ñ„ (trial Ğ¸Ğ»Ğ¸ t1) â€” Ğ¿Ñ€ĞµĞ´Ğ»Ğ°Ğ³Ğ°ĞµĞ¼ Ğ°Ğ¿Ğ³Ñ€ĞµĞ¹Ğ´
            text = (
                f"âœ… Ğ£ Ñ‚ĞµĞ±Ñ Ğ±Ğ°Ğ·Ğ¾Ğ²Ñ‹Ğ¹ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿.\n{access_status_str(a)}\n\n"
                "ğŸ”¥ Ğ¥Ğ¾Ñ‡ĞµÑˆÑŒ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ¿Ğ¸Ñ‚Ğ°Ğ½Ğ¸Ğµ, ÑĞ¼ĞµĞ½Ñƒ Ğ¿Ñ€Ğ¾Ğ³Ñ€Ğ°Ğ¼Ğ¼Ñ‹ Ğ¸ Ğ¿Ğ¾Ğ»Ğ½Ñ‹Ğ¹ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿?\n"
                "Ğ£Ğ»ÑƒÑ‡ÑˆĞ¸ Ñ‚Ğ°Ñ€Ğ¸Ñ„ Ğ´Ğ¾ 3 Ğ¼ĞµÑÑÑ†ĞµĞ² Ğ¸Ğ»Ğ¸ ĞĞ°Ğ²ÑĞµĞ³Ğ´Ğ° ğŸ‘‡"
            )
            upgrade_kb = InlineKeyboardMarkup(inline_keyboard=[
                [InlineKeyboardButton(text="ğŸ”¥ Ğ£Ğ»ÑƒÑ‡ÑˆĞ¸Ñ‚ÑŒ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿", callback_data="nav:upgrade")],
                [InlineKeyboardButton(text="ğŸ  ĞœĞµĞ½Ñ", callback_data="nav:menu")],
            ])
            await clean_send(bot, message.chat.id, uid, text, reply_markup=upgrade_kb)
    else:
        text = (
            "ğŸ’³ ĞĞ¿Ğ»Ğ°Ñ‚Ğ° / Ğ”Ğ¾ÑÑ‚ÑƒĞ¿\n\n"
            f"{access_status_str(a)}\n\n"
            "Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸ Ñ‚Ğ°Ñ€Ğ¸Ñ„ â€” Ğ¿ĞµÑ€ĞµĞ¹Ğ´Ñ‘ÑˆÑŒ Ğ½Ğ° ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ñƒ Ğ®ĞšĞ°ÑÑĞ°.\n"
            "ĞĞ¿Ğ»Ğ°Ñ‚Ğ° Ğ±Ğ°Ğ½ĞºĞ¾Ğ²ÑĞºĞ¾Ğ¹ ĞºĞ°Ñ€Ñ‚Ğ¾Ğ¹ Ğ¸Ğ»Ğ¸ Ğ®Money ğŸ‘‡"
        )
        await clean_send(bot, message.chat.id, uid, text, reply_markup=pay_tariff_kb())

    await try_delete_user_message(bot, message)


def _profile_summary_text(u: dict) -> str:
    return (
        "âš™ï¸ ĞŸÑ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ\n\n"
        f"Ğ¦ĞµĞ»ÑŒ: {u.get('goal')}\n"
        f"ĞŸĞ¾Ğ»: {u.get('sex')}\n"
        f"Ğ’Ğ¾Ğ·Ñ€Ğ°ÑÑ‚: {u.get('age')}\n"
        f"Ğ Ğ¾ÑÑ‚: {u.get('height')}\n"
        f"Ğ’ĞµÑ: {u.get('weight')}\n"
        f"Ğ“Ğ´Ğµ Ñ‚Ñ€ĞµĞ½Ğ¸Ñ€ÑƒĞµÑˆÑŒÑÑ: {u.get('place')}\n"
        f"ĞĞ¿Ñ‹Ñ‚: {u.get('exp')}\n"
        f"Ğ¢Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²ĞºĞ¸: {u.get('freq')}Ã—/Ğ½ĞµĞ´\n"
        f"Ğ•Ğ´Ğ°: {u.get('meals')}Ã—/Ğ´ĞµĞ½ÑŒ\n"
        f"ĞĞ³Ñ€Ğ°Ğ½Ğ¸Ñ‡ĞµĞ½Ğ¸Ñ: {(u.get('limits') or 'Ğ½ĞµÑ‚')}"
    )


async def open_profile_from_reply(message: Message, state: FSMContext, bot: Bot):
    await ensure_user(message.from_user.id, message.from_user.username or "")
    await try_delete_user_message(bot, message)
    await state.clear()

    u = await get_user(message.from_user.id)
    if await ensure_profile_ready(message.from_user.id):
        await clean_send(bot, message.chat.id, message.from_user.id, _profile_summary_text(u), reply_markup=profile_ready_kb())
        return

    await state.set_state(ProfileWizard.goal)
    text = _profile_header(1) + "ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¸Ğ¼ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ.\n\nğŸ¯ Ğ¦ĞµĞ»ÑŒ?"
    await clean_send(bot, message.chat.id, message.from_user.id, text, reply_markup=kb_goal())


async def cb_profile_edit(callback: CallbackQuery, state: FSMContext):
    """ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ Ğ¼ĞµĞ½Ñ Ğ²Ñ‹Ğ±Ğ¾Ñ€Ğ° â€” Ñ‡Ñ‚Ğ¾ Ğ¸Ğ¼ĞµĞ½Ğ½Ğ¾ Ğ¼ĞµĞ½ÑÑ‚ÑŒ Ğ² Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»Ğµ."""
    await state.clear()
    u = await get_user(callback.from_user.id)
    text = (
        "âœï¸ Ğ ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»Ñ\n\n"
        "Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸ Ğ¿ÑƒĞ½ĞºÑ‚ â€” Ñ Ğ·Ğ°Ğ´Ğ°Ğ¼ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¾Ğ´Ğ¸Ğ½ Ğ²Ğ¾Ğ¿Ñ€Ğ¾Ñ Ğ¸ ÑĞ¾Ñ…Ñ€Ğ°Ğ½Ñ.\n"
        "ĞŸĞ¾ÑĞ»Ğµ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹ Ğ½Ğ°Ğ¶Ğ¼Ğ¸ ğŸš€ Ğ¡Ğ³ĞµĞ½ĞµÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ½Ğ¾Ğ²Ñ‹Ğ¹ Ğ¿Ğ»Ğ°Ğ½."
    )
    await clean_edit(callback, callback.from_user.id, text, reply_markup=profile_edit_field_kb(u))
    await callback.answer()


async def cb_rebuild_plan(callback: CallbackQuery, bot: Bot):
    """Ğ“ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒĞµÑ‚ Ğ½Ğ¾Ğ²Ñ‹Ğ¹ Ğ¿Ğ»Ğ°Ğ½ Ñ‚Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²Ğ¾Ğº Ğ½Ğ° Ğ¾ÑĞ½Ğ¾Ğ²Ğµ Ñ‚ĞµĞºÑƒÑ‰ĞµĞ³Ğ¾ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»Ñ."""
    uid = callback.from_user.id
    if not await is_full_access_active(uid):
        await callback.answer(
            "ğŸ”’ Ğ¡Ğ¼ĞµĞ½Ğ° Ğ¿Ñ€Ğ¾Ğ³Ñ€Ğ°Ğ¼Ğ¼Ñ‹ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ğ° Ğ½Ğ° Ñ‚Ğ°Ñ€Ğ¸Ñ„Ğ°Ñ… 3 Ğ¼ĞµÑÑÑ†Ğ° Ğ¸ ĞĞ°Ğ²ÑĞµĞ³Ğ´Ğ°.",
            show_alert=True
        )
        return

    if not await ensure_profile_ready(uid):
        await clean_edit(callback, uid, "âš ï¸ Ğ¡Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ° Ğ·Ğ°Ğ¿Ğ¾Ğ»Ğ½Ğ¸ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ Ğ¿Ğ¾Ğ»Ğ½Ğ¾ÑÑ‚ÑŒÑ.")
        await callback.answer()
        return

    await callback.answer("ğŸ”„ Ğ“ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒÑ Ğ½Ğ¾Ğ²ÑƒÑ Ğ¿Ñ€Ğ¾Ğ³Ñ€Ğ°Ğ¼Ğ¼Ñƒâ€¦")

    import random as _rnd
    shift = _rnd.randint(1, 9999)
    varied_id = uid + shift * 100

    u = await get_user(uid)
    intro, plan_struct = generate_workout_plan(
        u["goal"], u["place"], u["exp"], int(u["freq"] or 3),
        limits=u.get("limits") or "",
        user_id=varied_id
    )
    await save_workout_plan(uid, intro, dumps_plan(plan_struct))

    # Ğ¡Ğ±Ñ€Ğ°ÑÑ‹Ğ²Ğ°ĞµĞ¼ Ğ¿Ñ€Ğ¾Ğ³Ñ€ĞµÑÑ Ğ´Ğ½ĞµĞ¹
    async with db() as conn:
        await conn.execute("DELETE FROM workout_day_progress WHERE user_id=?", (uid,))
        await conn.commit()

    full_access = await is_full_access_active(uid)
    kb = workout_days_kb(int(u.get("freq") or plan_struct.get("freq") or 3), has_full_access=full_access)
    await clean_edit(callback, uid,
        intro + "\n\nâœ… ĞŸÑ€Ğ¾Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ° Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ° Ğ¿Ğ¾Ğ´ Ñ‚Ğ²Ğ¾Ğ¹ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ!",
        reply_markup=kb
    )


async def cb_profile_start_wizard(callback: CallbackQuery, state: FSMContext):
    """Ğ—Ğ°Ğ¿ÑƒÑĞº Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ-Ğ¼Ğ°ÑÑ‚ĞµÑ€Ğ° Ğ¸Ğ· Ğ¿Ñ€Ğ¸Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾Ğ³Ğ¾ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ."""
    await ensure_user(callback.from_user.id, callback.from_user.username or "")
    await state.clear()

    u = await get_user(callback.from_user.id)
    if await ensure_profile_ready(callback.from_user.id):
        text = _profile_summary_text(u) + "\n\nâœ… ĞŸÑ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ ÑƒĞ¶Ğµ Ğ·Ğ°Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½!"
        await clean_edit(callback, callback.from_user.id, text,
                         reply_markup=profile_ready_kb())
        await callback.answer()
        return

    await state.set_state(ProfileWizard.goal)
    text = _profile_header(1) + "ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¸Ğ¼ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ.\n\nğŸ¯ Ğ¦ĞµĞ»ÑŒ?"
    await clean_edit(callback, callback.from_user.id, text, reply_markup=kb_goal())
    await callback.answer()


async def open_support_from_reply(message: Message, state: FSMContext, bot: Bot):
    await ensure_user(message.from_user.id, message.from_user.username or "")
    await state.clear()
    text = "ğŸ†˜ ĞŸĞ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ°\n\nĞĞ°Ğ¿Ğ¸ÑˆĞ¸ Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼Ñƒ Ğ¾Ğ´Ğ½Ğ¸Ğ¼ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸ĞµĞ¼ (Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ ÑĞºÑ€Ğ¸Ğ½/Ğ¾ÑˆĞ¸Ğ±ĞºÑƒ)."
    await clean_send(bot, message.chat.id, message.from_user.id, text)
    await try_delete_user_message(bot, message)


async def open_menu_from_reply(message: Message, state: FSMContext, bot: Bot):
    await ensure_user(message.from_user.id, message.from_user.username or "")
    await state.clear()
    await show_main_menu(bot, message.chat.id, message.from_user.id)
    await try_delete_user_message(bot, message)


# =========================
# ĞŸĞ ĞĞ¤Ğ˜Ğ›Ğ¬-ĞœĞĞ¡Ğ¢Ğ•Ğ 
# =========================
async def cb_build_program(callback: CallbackQuery, state: FSMContext, bot: Bot):
    """ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ Ñ‚Ğ°Ñ€Ğ¸Ñ„Ñ‹ Ğ¿Ğ¾ÑĞ»Ğµ Ğ·Ğ°Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ñ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»Ñ."""
    await state.clear()
    uid = callback.from_user.id

    if not await ensure_profile_ready(uid):
        await clean_edit(callback, uid,
                         "âš ï¸ Ğ¡Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ° Ğ·Ğ°Ğ¿Ğ¾Ğ»Ğ½Ğ¸ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ Ğ¿Ğ¾Ğ»Ğ½Ğ¾ÑÑ‚ÑŒÑ.",
                         reply_markup=profile_done_kb())
        await callback.answer()
        return

    text = (
        "ğŸš€ ĞÑ‚Ğ»Ğ¸Ñ‡Ğ½Ğ¾! ĞŸÑ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ Ğ³Ğ¾Ñ‚Ğ¾Ğ².\n\n"
        "Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸ Ñ‚Ğ°Ñ€Ğ¸Ñ„ â€” Ğ¸ Ñ ÑÑ€Ğ°Ğ·Ñƒ ÑĞ¾Ğ±ĞµÑ€Ñƒ Ğ¿Ñ€Ğ¾Ğ³Ñ€Ğ°Ğ¼Ğ¼Ñƒ Ñ‚Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²Ğ¾Ğº Ğ¿Ğ¾Ğ´ Ñ‚ĞµĞ±Ñ:\n\n"
        f"ğŸŸ¢ ĞŸÑ€Ğ¾Ğ±Ğ½Ñ‹Ğ¹ â€” {TARIFFS['trial']['price']}â‚½\n"
        "   â€¢ 3 Ğ´Ğ½Ñ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ°\n"
        "   â€¢ Ğ‘Ğ»Ğ¾Ğº Ñ‚Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²Ğ¾Ğº + Ğ¾Ñ‚Ğ²ĞµÑ‚Ñ‹ Ğ½Ğ° Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑÑ‹\n"
        "   â€¢ ĞŸĞ¸Ñ‚Ğ°Ğ½Ğ¸Ğµ Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ğ¾\n\n"
        f"ğŸŸ© ĞœĞµÑÑÑ‡Ğ½Ñ‹Ğ¹ â€” {TARIFFS['t1']['price']}â‚½\n"
        "   â€¢ 30 Ğ´Ğ½ĞµĞ¹ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ°\n"
        "   â€¢ Ğ¢Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²ĞºĞ¸ + Ğ¿Ğ¸Ñ‚Ğ°Ğ½Ğ¸Ğµ + Ğ´Ğ½ĞµĞ²Ğ½Ğ¸Ğº + Ğ·Ğ°Ğ¼ĞµÑ€Ñ‹\n"
        "   â€¢ ĞŸĞ¾Ğ»Ğ½Ñ‹Ğ¹ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿ ĞºĞ¾ Ğ²ÑĞµĞ¼Ñƒ\n\n"
        "ğŸ‘‡ Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸:"
    )
    await clean_edit(callback, uid, text, reply_markup=build_program_tariff_kb())
    await callback.answer()


async def cb_profile_field_edit(callback: CallbackQuery, state: FSMContext):
    """ĞĞ±Ñ€Ğ°Ğ±Ğ°Ñ‚Ñ‹Ğ²Ğ°ĞµĞ¼ Ğ½Ğ°Ğ¶Ğ°Ñ‚Ğ¸Ğµ Ğ½Ğ° ĞºĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½Ğ¾Ğµ Ğ¿Ğ¾Ğ»Ğµ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»Ñ Ğ´Ğ»Ñ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ."""
    field = callback.data.split("pf:", 1)[1]
    uid = callback.from_user.id
    u = await get_user(uid)

    await state.update_data(editing_field=field)

    if field == "goal":
        await state.set_state(ProfileWizard.goal)
        text = "ğŸ¯ Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸ Ğ½Ğ¾Ğ²ÑƒÑ Ñ†ĞµĞ»ÑŒ:"
        await clean_edit(callback, uid, text, reply_markup=kb_goal())
    elif field == "sex":
        await state.set_state(ProfileWizard.sex)
        text = "ğŸ‘¤ Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸ Ğ¿Ğ¾Ğ»:"
        await clean_edit(callback, uid, text, reply_markup=kb_sex())
    elif field == "age":
        await state.set_state(ProfileFieldEdit.age)
        text = f"ğŸ‚ Ğ¢ĞµĞºÑƒÑ‰Ğ¸Ğ¹ Ğ²Ğ¾Ğ·Ñ€Ğ°ÑÑ‚: {u.get('age')}\nĞ’Ğ²ĞµĞ´Ğ¸ Ğ½Ğ¾Ğ²Ñ‹Ğ¹:"
        await clean_edit(callback, uid, text, reply_markup=InlineKeyboardMarkup(inline_keyboard=[
            [InlineKeyboardButton(text="â¬…ï¸ ĞĞ°Ğ·Ğ°Ğ´", callback_data="p:edit")]
        ]))
    elif field == "height":
        await state.set_state(ProfileFieldEdit.height)
        text = f"ğŸ“ Ğ¢ĞµĞºÑƒÑ‰Ğ¸Ğ¹ Ñ€Ğ¾ÑÑ‚: {u.get('height')} ÑĞ¼\nĞ’Ğ²ĞµĞ´Ğ¸ Ğ½Ğ¾Ğ²Ñ‹Ğ¹:"
        await clean_edit(callback, uid, text, reply_markup=InlineKeyboardMarkup(inline_keyboard=[
            [InlineKeyboardButton(text="â¬…ï¸ ĞĞ°Ğ·Ğ°Ğ´", callback_data="p:edit")]
        ]))
    elif field == "weight":
        await state.set_state(ProfileFieldEdit.weight)
        text = f"âš–ï¸ Ğ¢ĞµĞºÑƒÑ‰Ğ¸Ğ¹ Ğ²ĞµÑ: {u.get('weight')} ĞºĞ³\nĞ’Ğ²ĞµĞ´Ğ¸ Ğ½Ğ¾Ğ²Ñ‹Ğ¹:"
        await clean_edit(callback, uid, text, reply_markup=InlineKeyboardMarkup(inline_keyboard=[
            [InlineKeyboardButton(text="â¬…ï¸ ĞĞ°Ğ·Ğ°Ğ´", callback_data="p:edit")]
        ]))
    elif field == "place":
        await state.set_state(ProfileWizard.place)
        text = "ğŸ  Ğ“Ğ´Ğµ Ñ‚Ñ€ĞµĞ½Ğ¸Ñ€ÑƒĞµÑˆÑŒÑÑ?"
        await clean_edit(callback, uid, text, reply_markup=kb_place())
    elif field == "exp":
        await state.set_state(ProfileWizard.exp)
        text = "ğŸ“ˆ ĞĞ¿Ñ‹Ñ‚ Ñ‚Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²Ğ¾Ğº?"
        await clean_edit(callback, uid, text, reply_markup=kb_exp())
    elif field == "freq":
        await state.set_state(ProfileWizard.freq)
        text = "ğŸ“… Ğ¡ĞºĞ¾Ğ»ÑŒĞºĞ¾ Ñ‚Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²Ğ¾Ğº Ğ² Ğ½ĞµĞ´ĞµĞ»Ñ?"
        await clean_edit(callback, uid, text, reply_markup=kb_freq())
    elif field == "meals":
        await state.set_state(ProfileWizard.meals)
        text = "ğŸ½ Ğ¡ĞºĞ¾Ğ»ÑŒĞºĞ¾ Ñ€Ğ°Ğ· Ğ² Ğ´ĞµĞ½ÑŒ ÑƒĞ´Ğ¾Ğ±Ğ½Ğ¾ ĞµÑÑ‚ÑŒ?"
        await clean_edit(callback, uid, text, reply_markup=kb_meals())
    elif field == "limits":
        await state.set_state(ProfileFieldEdit.limits)
        text = f"â›”ï¸ Ğ¢ĞµĞºÑƒÑ‰Ğ¸Ğµ Ğ¾Ğ³Ñ€Ğ°Ğ½Ğ¸Ñ‡ĞµĞ½Ğ¸Ñ: {u.get('limits') or 'Ğ½ĞµÑ‚'}\nĞ’Ğ²ĞµĞ´Ğ¸ Ğ½Ğ¾Ğ²Ñ‹Ğµ (Ğ¸Ğ»Ğ¸ Â«Ğ½ĞµÑ‚Â»):"
        await clean_edit(callback, uid, text, reply_markup=InlineKeyboardMarkup(inline_keyboard=[
            [InlineKeyboardButton(text="â¬…ï¸ ĞĞ°Ğ·Ğ°Ğ´", callback_data="p:edit")]
        ]))

    await callback.answer()


async def _finish_field_edit(bot: Bot, chat_id: int, user_id: int):
    """ĞŸĞ¾ÑĞ»Ğµ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ Ğ¾Ğ´Ğ½Ğ¾Ğ³Ğ¾ Ğ¿Ğ¾Ğ»Ñ â€” Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ Ğ¿Ğ»Ğ°Ğ½ Ğ¸ Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ."""
    await build_plans_if_needed(user_id, force=True)
    u = await get_user(user_id)
    text = _profile_summary_text(u) + "\n\nâœ… Ğ˜Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğµ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¾, Ğ¿Ğ»Ğ°Ğ½ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»Ñ‘Ğ½."
    await clean_send(bot, chat_id, user_id, text, reply_markup=profile_ready_kb())


async def profile_field_age(message: Message, state: FSMContext, bot: Bot):
    age = _parse_int_from_text(message.text or "")
    if age is None or age < 10 or age > 90:
        await message.answer("Ğ’Ğ¾Ğ·Ñ€Ğ°ÑÑ‚ Ñ‡Ğ¸ÑĞ»Ğ¾Ğ¼ ğŸ™‚ ĞĞ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€: 23")
        await try_delete_user_message(bot, message)
        return
    await update_user(message.from_user.id, age=age)
    await state.clear()
    await try_delete_user_message(bot, message)
    await _finish_field_edit(bot, message.chat.id, message.from_user.id)


async def profile_field_height(message: Message, state: FSMContext, bot: Bot):
    h = _parse_int_from_text(message.text or "")
    if h is None or h < 120 or h > 230:
        await message.answer("Ğ Ğ¾ÑÑ‚ Ğ² ÑĞ¼ ğŸ™‚ ĞĞ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€: 178")
        await try_delete_user_message(bot, message)
        return
    await update_user(message.from_user.id, height=h)
    await state.clear()
    await try_delete_user_message(bot, message)
    await _finish_field_edit(bot, message.chat.id, message.from_user.id)


async def profile_field_weight(message: Message, state: FSMContext, bot: Bot):
    w = _parse_float_from_text(message.text or "")
    if w is None or w < 30 or w > 250:
        await message.answer("Ğ’ĞµÑ Ğ² ĞºĞ³ ğŸ™‚ ĞĞ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€: 72.5")
        await try_delete_user_message(bot, message)
        return
    await update_user(message.from_user.id, weight=w)
    await state.clear()
    await try_delete_user_message(bot, message)
    await _finish_field_edit(bot, message.chat.id, message.from_user.id)


async def profile_field_limits(message: Message, state: FSMContext, bot: Bot):
    limits = (message.text or "").strip()
    if not limits:
        await message.answer("ĞĞ°Ğ¿Ğ¸ÑˆĞ¸ Ñ‚ĞµĞºÑÑ‚Ğ¾Ğ¼ Ğ¸Ğ»Ğ¸ Â«Ğ½ĞµÑ‚Â».")
        await try_delete_user_message(bot, message)
        return
    if limits.lower() in ("Ğ½ĞµÑ‚", "Ğ½ĞµÑ‚Ñƒ", "Ğ½Ğ¸ĞºĞ°ĞºĞ¸Ñ…", "no"):
        limits = ""
    await update_user(message.from_user.id, limits=limits)
    await state.clear()
    await try_delete_user_message(bot, message)
    await _finish_field_edit(bot, message.chat.id, message.from_user.id)


async def cb_profile_back(callback: CallbackQuery, state: FSMContext):
    step = callback.data.split(":")[2]
    uid = callback.from_user.id

    if step == "goal":
        await state.set_state(ProfileWizard.goal)
        text = _profile_header(1) + "ğŸ¯ Ğ¦ĞµĞ»ÑŒ?"
        await clean_edit(callback, uid, text, reply_markup=kb_goal())
    elif step == "sex":
        await state.set_state(ProfileWizard.sex)
        text = _profile_header(2) + "ğŸ‘¤ ĞŸĞ¾Ğ»?"
        await clean_edit(callback, uid, text, reply_markup=kb_sex())
    elif step == "age":
        await state.set_state(ProfileWizard.age)
        text = _profile_header(3) + "ğŸ‚ Ğ’Ğ¾Ğ·Ñ€Ğ°ÑÑ‚ (Ñ‡Ğ¸ÑĞ»Ğ¾Ğ¼):"
        await clean_edit(callback, uid, text, reply_markup=kb_text_step("sex"))
    elif step == "height":
        await state.set_state(ProfileWizard.height)
        text = _profile_header(4) + "ğŸ“ Ğ Ğ¾ÑÑ‚ Ğ² ÑĞ¼:"
        await clean_edit(callback, uid, text, reply_markup=kb_text_step("age"))
    elif step == "weight":
        await state.set_state(ProfileWizard.weight)
        text = _profile_header(5) + "âš–ï¸ Ğ’ĞµÑ Ğ² ĞºĞ³:"
        await clean_edit(callback, uid, text, reply_markup=kb_text_step("height"))
    elif step == "place":
        await state.set_state(ProfileWizard.place)
        text = _profile_header(6) + "ğŸ  Ğ“Ğ´Ğµ Ñ‚Ñ€ĞµĞ½Ğ¸Ñ€ÑƒĞµÑˆÑŒÑÑ?"
        await clean_edit(callback, uid, text, reply_markup=kb_place())
    elif step == "exp":
        await state.set_state(ProfileWizard.exp)
        text = _profile_header(7) + "ğŸ“ˆ ĞĞ¿Ñ‹Ñ‚?"
        await clean_edit(callback, uid, text, reply_markup=kb_exp())
    elif step == "freq":
        await state.set_state(ProfileWizard.freq)
        text = _profile_header(8) + "ğŸ“… Ğ¡ĞºĞ¾Ğ»ÑŒĞºĞ¾ Ñ‚Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²Ğ¾Ğº Ğ² Ğ½ĞµĞ´ĞµĞ»Ñ?"
        await clean_edit(callback, uid, text, reply_markup=kb_freq())
    elif step == "meals":
        await state.set_state(ProfileWizard.meals)
        text = _profile_header(9) + "ğŸ½ Ğ¡ĞºĞ¾Ğ»ÑŒĞºĞ¾ Ñ€Ğ°Ğ· Ğ² Ğ´ĞµĞ½ÑŒ ÑƒĞ´Ğ¾Ğ±Ğ½Ğ¾ ĞµÑÑ‚ÑŒ?"
        await clean_edit(callback, uid, text, reply_markup=kb_meals())
    elif step == "limits":
        await state.set_state(ProfileWizard.limits)
        text = _profile_header(10) + "â›”ï¸ ĞĞ³Ñ€Ğ°Ğ½Ğ¸Ñ‡ĞµĞ½Ğ¸Ñ/Ñ‚Ñ€Ğ°Ğ²Ğ¼Ñ‹? (Ğ¸Ğ»Ğ¸ Â«Ğ½ĞµÑ‚Â»):"
        await clean_edit(callback, uid, text, reply_markup=kb_text_step("meals"))
    else:
        await clean_send(callback.bot, callback.message.chat.id, uid, "ğŸ  ĞœĞµĞ½Ñ", reply_markup=menu_main_inline_kb())

    await callback.answer()


async def cb_profile_goal(callback: CallbackQuery, state: FSMContext, bot: Bot):
    v = callback.data.split(":")[2]
    goal = {
        "mass": "Ğ¼Ğ°ÑÑĞ°",
        "cut": "ÑÑƒÑˆĞºĞ°",
        "strength": "ÑĞ¸Ğ»Ğ°",
        "endurance": "Ğ²Ñ‹Ğ½Ğ¾ÑĞ»Ğ¸Ğ²Ğ¾ÑÑ‚ÑŒ",
    }.get(v, v)

    await update_user(callback.from_user.id, goal=goal)

    data = await state.get_data()
    if data.get("editing_field") == "goal":
        await state.clear()
        await _finish_field_edit(bot, callback.message.chat.id, callback.from_user.id)
        await callback.answer()
        return

    await state.set_state(ProfileWizard.sex)
    text = _profile_header(2) + "ğŸ‘¤ ĞŸĞ¾Ğ»?"
    await clean_edit(callback, callback.from_user.id, text, reply_markup=kb_sex())
    await callback.answer()


async def cb_profile_sex(callback: CallbackQuery, state: FSMContext, bot: Bot):
    v = callback.data.split(":")[2]
    sex = "Ğ¼" if v == "m" else "Ğ¶"
    await update_user(callback.from_user.id, sex=sex)

    data = await state.get_data()
    if data.get("editing_field") == "sex":
        await state.clear()
        await _finish_field_edit(bot, callback.message.chat.id, callback.from_user.id)
        await callback.answer()
        return

    await state.set_state(ProfileWizard.age)
    text = _profile_header(3) + "ğŸ‚ Ğ’Ğ¾Ğ·Ñ€Ğ°ÑÑ‚ (Ñ‡Ğ¸ÑĞ»Ğ¾Ğ¼):"
    await clean_edit(callback, callback.from_user.id, text, reply_markup=kb_text_step("sex"))
    await callback.answer()


def _parse_int_from_text(s: str) -> Optional[int]:
    s = (s or "").strip()
    m = re.search(r"(\d+)", s)
    if not m:
        return None
    try:
        return int(m.group(1))
    except Exception:
        return None


def _parse_float_from_text(s: str) -> Optional[float]:
    s = (s or "").strip().replace(",", ".")
    m = re.search(r"(\d+(\.*\d+)?)", s)
    if not m:
        return None
    try:
        return float(m.group(1))
    except Exception:
        return None


async def profile_age_text(message: Message, state: FSMContext, bot: Bot):
    age = _parse_int_from_text(message.text or "")
    if age is None or age < 10 or age > 90:
        await message.answer("Ğ’Ğ¾Ğ·Ñ€Ğ°ÑÑ‚ Ñ‡Ğ¸ÑĞ»Ğ¾Ğ¼ ğŸ™‚ ĞĞ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€: 23")
        await try_delete_user_message(bot, message)
        return
    await update_user(message.from_user.id, age=age)

    await state.set_state(ProfileWizard.height)
    text = _profile_header(4) + "ğŸ“ Ğ Ğ¾ÑÑ‚ Ğ² ÑĞ¼:"
    await clean_send(bot, message.chat.id, message.from_user.id, text, reply_markup=kb_text_step("age"))
    await try_delete_user_message(bot, message)


async def profile_height_text(message: Message, state: FSMContext, bot: Bot):
    h = _parse_int_from_text(message.text or "")
    if h is None or h < 120 or h > 230:
        await message.answer("Ğ Ğ¾ÑÑ‚ Ğ² ÑĞ¼ ğŸ™‚ ĞĞ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€: 178")
        await try_delete_user_message(bot, message)
        return
    await update_user(message.from_user.id, height=h)

    await state.set_state(ProfileWizard.weight)
    text = _profile_header(5) + "âš–ï¸ Ğ’ĞµÑ Ğ² ĞºĞ³:"
    await clean_send(bot, message.chat.id, message.from_user.id, text, reply_markup=kb_text_step("height"))
    await try_delete_user_message(bot, message)


async def profile_weight_text(message: Message, state: FSMContext, bot: Bot):
    w = _parse_float_from_text(message.text or "")
    if w is None or w < 30 or w > 250:
        await message.answer("Ğ’ĞµÑ Ğ² ĞºĞ³ ğŸ™‚ ĞĞ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€: 72.5")
        await try_delete_user_message(bot, message)
        return
    await update_user(message.from_user.id, weight=w)

    await state.set_state(ProfileWizard.place)
    text = _profile_header(6) + "ğŸ  Ğ“Ğ´Ğµ Ñ‚Ñ€ĞµĞ½Ğ¸Ñ€ÑƒĞµÑˆÑŒÑÑ?"
    await clean_send(bot, message.chat.id, message.from_user.id, text, reply_markup=kb_place())
    await try_delete_user_message(bot, message)


async def cb_profile_place(callback: CallbackQuery, state: FSMContext, bot: Bot):
    v = callback.data.split(":")[2]
    place = "Ğ´Ğ¾Ğ¼Ğ°" if v == "bodyweight" else "Ğ·Ğ°Ğ»"
    await update_user(callback.from_user.id, place=place)

    data = await state.get_data()
    if data.get("editing_field") == "place":
        await state.clear()
        await _finish_field_edit(bot, callback.message.chat.id, callback.from_user.id)
        await callback.answer()
        return

    await state.set_state(ProfileWizard.exp)
    text = _profile_header(7) + "ğŸ“ˆ ĞĞ¿Ñ‹Ñ‚?"
    await clean_edit(callback, callback.from_user.id, text, reply_markup=kb_exp())
    await callback.answer()


async def cb_profile_exp(callback: CallbackQuery, state: FSMContext, bot: Bot):
    v = callback.data.split(":")[2]
    if v == "0":
        await update_user(callback.from_user.id, exp="0", freq=3)

        data = await state.get_data()
        if data.get("editing_field") in ("exp", "freq"):
            await state.clear()
            await _finish_field_edit(bot, callback.message.chat.id, callback.from_user.id)
            await callback.answer()
            return

        await state.set_state(ProfileWizard.meals)
        text = _profile_header(9) + "ğŸ½ Ğ¡ĞºĞ¾Ğ»ÑŒĞºĞ¾ Ñ€Ğ°Ğ· Ğ² Ğ´ĞµĞ½ÑŒ ÑƒĞ´Ğ¾Ğ±Ğ½Ğ¾ ĞµÑÑ‚ÑŒ?"
        await clean_edit(callback, callback.from_user.id, text, reply_markup=kb_meals())
        await callback.answer()
        return

    exp_text = "1-2 Ğ³Ğ¾Ğ´Ğ°" if v == "mid" else "2+ Ğ³Ğ¾Ğ´Ğ°"
    await update_user(callback.from_user.id, exp=exp_text)

    data = await state.get_data()
    if data.get("editing_field") == "exp":
        await state.clear()
        await _finish_field_edit(bot, callback.message.chat.id, callback.from_user.id)
        await callback.answer()
        return

    await state.set_state(ProfileWizard.freq)
    text = _profile_header(8) + "ğŸ“… Ğ¡ĞºĞ¾Ğ»ÑŒĞºĞ¾ Ñ‚Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²Ğ¾Ğº Ğ² Ğ½ĞµĞ´ĞµĞ»Ñ?"
    await clean_edit(callback, callback.from_user.id, text, reply_markup=kb_freq())
    await callback.answer()


async def cb_profile_freq(callback: CallbackQuery, state: FSMContext, bot: Bot):
    f = int(callback.data.split(":")[2])
    await update_user(callback.from_user.id, freq=f)

    data = await state.get_data()
    if data.get("editing_field") == "freq":
        await state.clear()
        await _finish_field_edit(bot, callback.message.chat.id, callback.from_user.id)
        await callback.answer()
        return

    await state.set_state(ProfileWizard.meals)
    text = _profile_header(9) + "ğŸ½ Ğ¡ĞºĞ¾Ğ»ÑŒĞºĞ¾ Ñ€Ğ°Ğ· Ğ² Ğ´ĞµĞ½ÑŒ ÑƒĞ´Ğ¾Ğ±Ğ½Ğ¾ ĞµÑÑ‚ÑŒ?"
    await clean_edit(callback, callback.from_user.id, text, reply_markup=kb_meals())
    await callback.answer()


async def cb_profile_meals(callback: CallbackQuery, state: FSMContext, bot: Bot):
    m = int(callback.data.split(":")[2])
    m = max(3, min(m, 5))
    await update_user(callback.from_user.id, meals=m)

    data = await state.get_data()
    if data.get("editing_field") == "meals":
        await state.clear()
        await _finish_field_edit(bot, callback.message.chat.id, callback.from_user.id)
        await callback.answer()
        return

    await state.set_state(ProfileWizard.limits)
    text = _profile_header(10) + "â›”ï¸ ĞĞ³Ñ€Ğ°Ğ½Ğ¸Ñ‡ĞµĞ½Ğ¸Ñ/Ñ‚Ñ€Ğ°Ğ²Ğ¼Ñ‹? (Ğ¸Ğ»Ğ¸ Â«Ğ½ĞµÑ‚Â»):"
    await clean_edit(callback, callback.from_user.id, text, reply_markup=kb_text_step("meals"))
    await callback.answer()


async def profile_limits_text(message: Message, state: FSMContext, bot: Bot):
    limits = (message.text or "").strip()
    if not limits:
        await message.answer("ĞĞ°Ğ¿Ğ¸ÑˆĞ¸ Ñ‚ĞµĞºÑÑ‚Ğ¾Ğ¼ Ğ¸Ğ»Ğ¸ Â«Ğ½ĞµÑ‚Â».")
        await try_delete_user_message(bot, message)
        return
    if limits.lower() in ("Ğ½ĞµÑ‚", "Ğ½ĞµÑ‚Ñƒ", "Ğ½Ğ¸ĞºĞ°ĞºĞ¸Ñ…", "no"):
        limits = ""

    await update_user(message.from_user.id, limits=limits)
    await state.clear()

    u = await get_user(message.from_user.id)
    summary = (
        "âœ… ĞŸÑ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ ÑĞ¾Ñ…Ñ€Ğ°Ğ½Ñ‘Ğ½!\n\n"
        f"Ğ¦ĞµĞ»ÑŒ: {u.get('goal')} â€¢ {u.get('freq')}Ã—/Ğ½ĞµĞ´\n"
        f"Ğ“Ğ´Ğµ Ñ‚Ñ€ĞµĞ½Ğ¸Ñ€ÑƒĞµÑˆÑŒÑÑ: {u.get('place')}\n"
        f"Ğ•Ğ´Ğ°: {u.get('meals')}Ã—/Ğ´ĞµĞ½ÑŒ\n"
        f"ĞĞ³Ñ€Ğ°Ğ½Ğ¸Ñ‡ĞµĞ½Ğ¸Ñ: {(u.get('limits') or 'Ğ½ĞµÑ‚')}\n\n"
        "Ğ¢ĞµĞ¿ĞµÑ€ÑŒ Ğ²Ñ‹Ğ±ĞµÑ€Ğ¸ Ñ‚Ğ°Ñ€Ğ¸Ñ„ Ğ¸ Ñ ÑĞ¾Ğ±ĞµÑ€Ñƒ Ñ‚Ğ²Ğ¾Ñ Ğ¿Ñ€Ğ¾Ğ³Ñ€Ğ°Ğ¼Ğ¼Ñƒ ğŸ‘‡"
    )
    await clean_send(bot, message.chat.id, message.from_user.id, summary, reply_markup=profile_done_kb())
    await try_delete_user_message(bot, message)


# =========================
# âœ… ĞĞŸĞ›ĞĞ¢Ğ Ğ§Ğ•Ğ Ğ•Ğ— Ğ®ĞšĞĞ¡Ğ¡Ğ REST API
# =========================
def access_status_str(a: dict) -> str:
    if not a or a.get("paid") != 1:
        return "Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ: âŒ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ° Ğ½ĞµÑ‚"
    if a.get("tariff") == "life":
        return "Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ: âœ… Ğ´Ğ¾ÑÑ‚ÑƒĞ¿ Ğ½Ğ°Ğ²ÑĞµĞ³Ğ´Ğ°"
    exp = a.get("expires_at")
    return f"Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ: âœ… Ğ´Ğ¾ {exp[:10]}" if exp else "Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ: âœ… Ğ°ĞºÑ‚Ğ¸Ğ²ĞµĞ½"


async def yukassa_create_payment(tariff_code: str, user_id: int):
    """
    Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‘Ğ¼ Ğ¿Ğ»Ğ°Ñ‚Ñ‘Ğ¶ Ñ‡ĞµÑ€ĞµĞ· Ğ®ĞšĞ°ÑÑĞ° REST API.
    Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ (data_dict, error_str). ĞŸÑ€Ğ¸ ÑƒÑĞ¿ĞµÑ…Ğµ error_str == None.
    """
    import uuid
    import base64
    import aiohttp

    t = TARIFFS[tariff_code]
    amount_str = f"{t['price']:.2f}"
    idempotence_key = str(uuid.uuid4())

    credentials = base64.b64encode(
        f"{YUKASSA_SHOP_ID}:{YUKASSA_SECRET}".encode()
    ).decode()

    return_url = BOT_PUBLIC_URL if BOT_PUBLIC_URL else "https://t.me/"

    payload = {
        "amount": {"value": amount_str, "currency": "RUB"},
        "confirmation": {"type": "redirect", "return_url": return_url},
        "capture": True,
        "description": f"Tarif {tariff_code} user_id={user_id}",
        "metadata": {"tariff": tariff_code, "user_id": str(user_id)},
    }

    try:
        logger.info(f"YooKassa: creating payment user={user_id} tariff={tariff_code} amount={amount_str}")
        logger.info(f"YooKassa: shop_id={YUKASSA_SHOP_ID[:4]}**** return_url={return_url}")
        async with aiohttp.ClientSession() as session:
            async with session.post(
                "https://api.yookassa.ru/v3/payments",
                json=payload,
                headers={
                    "Authorization": f"Basic {credentials}",
                    "Idempotence-Key": idempotence_key,
                    "Content-Type": "application/json",
                },
                timeout=aiohttp.ClientTimeout(total=20),
            ) as resp:
                data = await resp.json()
                if resp.status == 200:
                    logger.info(f"YooKassa: payment created id={data.get('id')}")
                    return data, None
                else:
                    err_code = data.get("code", "?")
                    err_desc = data.get("description", "?")
                    err_msg = f"HTTP {resp.status} | code={err_code} | {err_desc}"
                    logger.error(f"YooKassa API error: {err_msg} | full={data}")
                    return None, err_msg
    except Exception as e:
        err_msg = f"{type(e).__name__}: {e}"
        logger.error(f"YooKassa request failed: {err_msg}")
        return None, err_msg


async def yukassa_get_payment(payment_id: str) -> Optional[dict]:
    """ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ ÑÑ‚Ğ°Ñ‚ÑƒÑ Ğ¿Ğ»Ğ°Ñ‚ĞµĞ¶Ğ° Ğ¸Ğ· Ğ®ĞšĞ°ÑÑĞ°."""
    import base64
    import aiohttp

    credentials = base64.b64encode(
        f"{YUKASSA_SHOP_ID}:{YUKASSA_SECRET}".encode()
    ).decode()

    try:
        async with aiohttp.ClientSession() as session:
            async with session.get(
                f"https://api.yookassa.ru/v3/payments/{payment_id}",
                headers={"Authorization": f"Basic {credentials}"},
                timeout=aiohttp.ClientTimeout(total=10),
            ) as resp:
                if resp.status == 200:
                    return await resp.json()
                return None
    except Exception as e:
        logger.error(f"YooKassa get_payment failed: {e}")
        return None


async def save_yukassa_payment_id(payment_db_id: int, yukassa_id: str):
    """Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµĞ¼ Ğ®ĞšĞ°ÑÑĞ° payment_id Ğ² ĞºĞ¾Ğ»Ğ¾Ğ½ĞºÑƒ receipt_file_id."""
    async with db() as conn:
        await conn.execute(
            "UPDATE payments SET receipt_file_id=? WHERE id=?",
            (yukassa_id, payment_db_id)
        )
        await conn.commit()


async def cb_tariff(callback: CallbackQuery, state: FSMContext, bot: Bot):
    """
    Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‘Ğ¼ Ğ¿Ğ»Ğ°Ñ‚Ñ‘Ğ¶ Ñ‡ĞµÑ€ĞµĞ· Ğ®ĞšĞ°ÑÑĞ° REST API Ğ¸ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµĞ¼ ĞºĞ½Ğ¾Ğ¿ĞºÑƒ ÑĞ¾ ÑÑÑ‹Ğ»ĞºĞ¾Ğ¹.
    ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ¾Ğ¿Ğ»Ğ°Ñ‡Ğ¸Ğ²Ğ°ĞµÑ‚ Ğ½Ğ° ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğµ Ğ®ĞšĞ°ÑÑĞ°, Ğ±Ğ¾Ñ‚ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚ ÑÑ‚Ğ°Ñ‚ÑƒÑ.
    """
    tariff_code = callback.data.split(":")[1]
    if tariff_code not in TARIFFS:
        await callback.answer("ĞĞµ Ğ¿Ğ¾Ğ½ÑĞ» Ñ‚Ğ°Ñ€Ğ¸Ñ„ ğŸ˜…", show_alert=True)
        return

    t = TARIFFS[tariff_code]
    uid = callback.from_user.id

    if not YUKASSA_SHOP_ID or not YUKASSA_SECRET:
        await callback.message.answer(
            "âš ï¸ ĞĞ¿Ğ»Ğ°Ñ‚Ğ° Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ğ¾ Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ğ°.\n"
            "Ğ¡Ğ²ÑĞ¶Ğ¸Ñ‚ĞµÑÑŒ Ñ Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ¾Ğ¹."
        )
        await callback.answer()
        return

    # ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ "ÑĞ¾Ğ·Ğ´Ğ°Ñ‘Ğ¼ Ğ¿Ğ»Ğ°Ñ‚Ñ‘Ğ¶"
    await callback.answer("â³ Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ ÑÑÑ‹Ğ»ĞºÑƒ Ğ½Ğ° Ğ¾Ğ¿Ğ»Ğ°Ñ‚Ñƒâ€¦")

    # Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‘Ğ¼ Ğ¿Ğ»Ğ°Ñ‚Ñ‘Ğ¶ Ğ² Ğ®ĞšĞ°ÑÑĞ°
    yk_data, yk_err = await yukassa_create_payment(tariff_code, uid)

    if not yk_data:
        # ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ Ğ´ĞµÑ‚Ğ°Ğ»Ğ¸ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸ Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ±Ñ‹Ğ»Ğ¾ Ğ´Ğ¸Ğ°Ğ³Ğ½Ğ¾ÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ
        err_detail = f"\n\nğŸ” Ğ”ĞµÑ‚Ğ°Ğ»Ğ¸: {yk_err}" if yk_err else ""
        # Ğ£Ğ²ĞµĞ´Ğ¾Ğ¼Ğ»ÑĞµĞ¼ Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ° Ğ¾Ğ± Ğ¾ÑˆĞ¸Ğ±ĞºĞµ
        if ADMIN_ID:
            try:
                await bot.send_message(
                    ADMIN_ID,
                    f"âš ï¸ ĞÑˆĞ¸Ğ±ĞºĞ° ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ñ Ğ¿Ğ»Ğ°Ñ‚ĞµĞ¶Ğ°\nuser={uid} tariff={tariff_code}\n{yk_err}"
                )
            except Exception:
                pass
        await clean_edit(callback, uid,
            f"âŒ ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ ÑĞ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ ÑÑ‡Ñ‘Ñ‚ Ğ½Ğ° Ğ¾Ğ¿Ğ»Ğ°Ñ‚Ñƒ.{err_detail}\n\n"
            "ĞĞ°Ğ¿Ğ¸ÑˆĞ¸ Ğ² Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºÑƒ Ğ¸Ğ»Ğ¸ Ğ¿Ğ¾Ğ¿Ñ€Ğ¾Ğ±ÑƒĞ¹ Ğ¿Ğ¾Ğ·Ğ¶Ğµ.",
            reply_markup=InlineKeyboardMarkup(inline_keyboard=[
                [InlineKeyboardButton(text="â¬…ï¸ ĞĞ°Ğ·Ğ°Ğ´", callback_data="nav:menu")]
            ])
        )
        return

    yk_payment_id = yk_data.get("id", "")
    confirmation_url = (yk_data.get("confirmation") or {}).get("confirmation_url", "")

    if not confirmation_url:
        await clean_edit(callback, uid,
            "âŒ ĞĞµ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ğ» ÑÑÑ‹Ğ»ĞºÑƒ Ğ½Ğ° Ğ¾Ğ¿Ğ»Ğ°Ñ‚Ñƒ.\nĞŸĞ¾Ğ¿Ñ€Ğ¾Ğ±ÑƒĞ¹ Ğ¿Ğ¾Ğ·Ğ¶Ğµ.",
            reply_markup=InlineKeyboardMarkup(inline_keyboard=[
                [InlineKeyboardButton(text="â¬…ï¸ ĞĞ°Ğ·Ğ°Ğ´", callback_data="nav:menu")]
            ])
        )
        return

    # Ğ—Ğ°Ğ¿Ğ¸ÑÑ‹Ğ²Ğ°ĞµĞ¼ Ğ² Ğ‘Ğ” Ğ´Ğ»Ñ Ğ¿Ğ¾ÑĞ»ĞµĞ´ÑƒÑÑ‰ĞµĞ¹ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸
    now = datetime.utcnow().isoformat()
    async with db() as conn:
        cur = await conn.execute("""
            INSERT INTO payments (user_id, tariff, amount, last4, code, status, receipt_file_id, created_at)
            VALUES (?, ?, ?, ?, ?, 'pending', ?, ?)
        """, (uid, tariff_code, t["price"], "yukassa", yk_payment_id, yk_payment_id, now))
        await conn.commit()
        payment_db_id = cur.lastrowid

    # Ğ¢ĞµĞºÑÑ‚ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ
    desc = (
        "Ğ¢Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²ĞºĞ¸ + Ğ¿Ğ¸Ñ‚Ğ°Ğ½Ğ¸Ğµ + Ğ´Ğ½ĞµĞ²Ğ½Ğ¸Ğº + Ğ·Ğ°Ğ¼ĞµÑ€Ñ‹"
        if tariff_code in FULL_ACCESS_TARIFFS
        else "Ğ¢Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²ĞºĞ¸ Ğ¸ Ğ¾Ñ‚Ğ²ĞµÑ‚Ñ‹ Ğ½Ğ° Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑÑ‹"
    )
    days_str = f"{t['days']} Ğ´Ğ½." if t["days"] else "Ğ½Ğ°Ğ²ÑĞµĞ³Ğ´Ğ°"

    text = (
        f"ğŸ’³ ĞĞ¿Ğ»Ğ°Ñ‚Ğ°: {t['title']}\n\n"
        f"ğŸ’° Ğ¡ÑƒĞ¼Ğ¼Ğ°: {t['price']}â‚½\n"
        f"ğŸ“¦ Ğ’ĞºĞ»ÑÑ‡Ğ°ĞµÑ‚: {desc}\n"
        f"â³ Ğ”Ğ¾ÑÑ‚ÑƒĞ¿: {days_str}\n\n"
        "ĞĞ°Ğ¶Ğ¼Ğ¸ ĞºĞ½Ğ¾Ğ¿ĞºÑƒ Ğ½Ğ¸Ğ¶Ğµ Ğ´Ğ»Ñ Ğ¿ĞµÑ€ĞµÑ…Ğ¾Ğ´Ğ° Ğ½Ğ° ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ñƒ Ğ¾Ğ¿Ğ»Ğ°Ñ‚Ñ‹.\n"
        "ĞŸĞ¾ÑĞ»Ğµ Ğ¾Ğ¿Ğ»Ğ°Ñ‚Ñ‹ Ğ²ĞµÑ€Ğ½Ğ¸ÑÑŒ Ğ² Ğ±Ğ¾Ñ‚ â€” Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞºĞ° Ğ°ĞºÑ‚Ğ¸Ğ²Ğ¸Ñ€ÑƒĞµÑ‚ÑÑ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸."
    )

    pay_kb = InlineKeyboardMarkup(inline_keyboard=[
        [InlineKeyboardButton(text="ğŸ’³ ĞŸĞµÑ€ĞµĞ¹Ñ‚Ğ¸ Ğº Ğ¾Ğ¿Ğ»Ğ°Ñ‚Ğµ", url=confirmation_url)],
        [InlineKeyboardButton(text="âœ… Ğ¯ Ğ¾Ğ¿Ğ»Ğ°Ñ‚Ğ¸Ğ»", callback_data=f"check_pay:{yk_payment_id}:{tariff_code}")],
        [InlineKeyboardButton(text="â¬…ï¸ ĞĞ°Ğ·Ğ°Ğ´", callback_data="nav:menu")],
    ])

    await clean_edit(callback, uid, text, reply_markup=pay_kb)


async def cb_check_payment(callback: CallbackQuery, bot: Bot):
    """
    ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ½Ğ°Ğ¶Ğ°Ğ» Â«Ğ¯ Ğ¾Ğ¿Ğ»Ğ°Ñ‚Ğ¸Ğ»Â» â€” Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ ÑÑ‚Ğ°Ñ‚ÑƒÑ Ğ² Ğ®ĞšĞ°ÑÑĞ° API.
    """
    parts = callback.data.split(":")
    yk_payment_id = parts[1]
    tariff_code = parts[2] if len(parts) > 2 else ""
    uid = callback.from_user.id

    await callback.answer("ğŸ” ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑÑ Ğ¾Ğ¿Ğ»Ğ°Ñ‚Ñƒâ€¦")

    yk_data = await yukassa_get_payment(yk_payment_id)

    if not yk_data:
        await callback.message.answer(
            "âŒ ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ ÑÑ‚Ğ°Ñ‚ÑƒÑ.\nĞŸĞ¾Ğ¿Ñ€Ğ¾Ğ±ÑƒĞ¹ Ñ‡ĞµÑ€ĞµĞ· Ğ¼Ğ¸Ğ½ÑƒÑ‚Ñƒ Ğ¸Ğ»Ğ¸ Ğ½Ğ°Ğ¿Ğ¸ÑˆĞ¸ Ğ² Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºÑƒ."
        )
        return

    status = yk_data.get("status", "")
    metadata = yk_data.get("metadata") or {}

    if not tariff_code:
        tariff_code = metadata.get("tariff", "")

    if status == "succeeded":
        # ĞĞ¿Ğ»Ğ°Ñ‚Ğ° Ğ¿Ñ€Ğ¾ÑˆĞ»Ğ° â€” Ğ²Ñ‹Ğ´Ğ°Ñ‘Ğ¼ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿
        if tariff_code and tariff_code in TARIFFS:
            await set_paid_tariff(uid, tariff_code)
            # ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ ÑÑ‚Ğ°Ñ‚ÑƒÑ Ğ² Ğ‘Ğ”
            async with db() as conn:
                await conn.execute(
                    "UPDATE payments SET status='approved' WHERE receipt_file_id=? AND user_id=?",
                    (yk_payment_id, uid)
                )
                await conn.commit()

            t = TARIFFS[tariff_code]
            a = await get_access(uid)

            await clean_edit(callback, uid,
                f"âœ… ĞĞ¿Ğ»Ğ°Ñ‚Ğ° Ğ¿Ğ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ¶Ğ´ĞµĞ½Ğ°!\n"
                f"Ğ¢Ğ°Ñ€Ğ¸Ñ„: {t['title']}\n"
                f"{access_status_str(a)}\n\n"
                "Ğ¢ĞµĞ¿ĞµÑ€ÑŒ Ğ¸Ğ´Ğ¸ Ñ‚Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒÑÑ ğŸ’ª",
                reply_markup=menu_main_inline_kb()
            )

            # Ğ£Ğ²ĞµĞ´Ğ¾Ğ¼Ğ»ÑĞµĞ¼ Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ°
            if ADMIN_ID:
                try:
                    await bot.send_message(
                        chat_id=ADMIN_ID,
                        text=(
                            f"ğŸ’° ĞĞ¿Ğ»Ğ°Ñ‚Ğ° Ğ¿Ğ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ¶Ğ´ĞµĞ½Ğ° (Ğ®ĞšĞ°ÑÑĞ°)\n"
                            f"user_id: {uid}\n"
                            f"tariff: {tariff_code} ({t['title']})\n"
                            f"amount: {t['price']}â‚½\n"
                            f"yukassa_id: {yk_payment_id}"
                        )
                    )
                except Exception:
                    pass
        else:
            await clean_edit(callback, uid,
                "âœ… ĞĞ¿Ğ»Ğ°Ñ‚Ğ° Ğ¿Ñ€Ğ¾ÑˆĞ»Ğ°! Ğ¡Ğ²ÑĞ¶Ğ¸Ñ‚ĞµÑÑŒ Ñ Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ¾Ğ¹ Ğ´Ğ»Ñ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ°Ñ†Ğ¸Ğ¸.",
                reply_markup=menu_main_inline_kb()
            )

    elif status == "pending":
        await callback.message.answer(
            "â³ ĞŸĞ»Ğ°Ñ‚Ñ‘Ğ¶ ĞµÑ‰Ñ‘ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ°Ñ‚Ñ‹Ğ²Ğ°ĞµÑ‚ÑÑ.\n"
            "ĞŸĞ¾Ğ´Ğ¾Ğ¶Ğ´Ğ¸ 1â€“2 Ğ¼Ğ¸Ğ½ÑƒÑ‚Ñ‹ Ğ¸ Ğ½Ğ°Ğ¶Ğ¼Ğ¸ Â«Ğ¯ Ğ¾Ğ¿Ğ»Ğ°Ñ‚Ğ¸Ğ»Â» ÑĞ½Ğ¾Ğ²Ğ°."
        )
    elif status in ("canceled", "cancelled"):
        await callback.message.answer(
            "âŒ ĞŸĞ»Ğ°Ñ‚Ñ‘Ğ¶ Ğ¾Ñ‚Ğ¼ĞµĞ½Ñ‘Ğ½.\n"
            "ĞĞ°Ğ¶Ğ¼Ğ¸ Â«â¬…ï¸ ĞĞ°Ğ·Ğ°Ğ´Â» Ğ¸ Ğ¿Ğ¾Ğ¿Ñ€Ğ¾Ğ±ÑƒĞ¹ ÑĞ½Ğ¾Ğ²Ğ°."
        )
    else:
        await callback.message.answer(
            f"âš ï¸ Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ Ğ¿Ğ»Ğ°Ñ‚ĞµĞ¶Ğ°: {status}\n"
            "Ğ•ÑĞ»Ğ¸ Ğ´ĞµĞ½ÑŒĞ³Ğ¸ ÑĞ¿Ğ¸ÑĞ°Ğ»Ğ¸ÑÑŒ â€” Ğ½Ğ°Ğ¿Ğ¸ÑˆĞ¸ Ğ² Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºÑƒ."
        )


async def admin_actions(callback: CallbackQuery, bot: Bot):
    """Ğ ÑƒÑ‡Ğ½Ğ¾Ğµ Ğ¾Ğ´Ğ¾Ğ±Ñ€ĞµĞ½Ğ¸Ğµ/Ğ¾Ñ‚ĞºĞ»Ğ¾Ğ½ĞµĞ½Ğ¸Ğµ (Ğ´Ğ»Ñ ÑĞ»ÑƒÑ‡Ğ°ĞµĞ² Ğ±ĞµĞ· Ğ®ĞšĞ°ÑÑĞ°)."""
    if callback.from_user.id != ADMIN_ID:
        await callback.answer("ĞĞµÑ‚ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ°", show_alert=True)
        return

    action, pid = callback.data.split(":")
    pid = int(pid)

    p = await get_payment(pid)
    if not p:
        await callback.answer("ĞŸĞ»Ğ°Ñ‚Ñ‘Ğ¶ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½", show_alert=True)
        return
    if p["status"] != "pending":
        await callback.answer(f"Ğ£Ğ¶Ğµ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ğ½Ğ¾: {p['status']}", show_alert=True)
        return

    user_id = p["user_id"]
    tariff = p.get("tariff")

    if action == "admin_approve":
        if tariff not in TARIFFS:
            await callback.answer("Ğ£ Ğ¿Ğ»Ğ°Ñ‚ĞµĞ¶Ğ° Ğ½ĞµÑ‚ Ñ‚Ğ°Ñ€Ğ¸Ñ„Ğ°", show_alert=True)
            return
        await set_payment_status(pid, "approved")
        await set_paid_tariff(user_id, tariff)

        a = await get_access(user_id)
        await bot.send_message(
            chat_id=user_id,
            text=f"âœ… ĞĞ¿Ğ»Ğ°Ñ‚Ğ° Ğ¿Ğ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ¶Ğ´ĞµĞ½Ğ°.\nĞ¢Ğ°Ñ€Ğ¸Ñ„: {TARIFFS[tariff]['title']}\n{access_status_str(a)}",
            reply_markup=menu_main_inline_kb()
        )
        await callback.answer("ĞŸĞ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ¶Ğ´ĞµĞ½Ğ¾ âœ…")
    else:
        await set_payment_status(pid, "rejected")
        await bot.send_message(
            chat_id=user_id,
            text="âŒ ĞÑ‚ĞºĞ»Ğ¾Ğ½Ğ¸Ğ». ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑŒ Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´/ÑĞºÑ€Ğ¸Ğ½ Ğ¸ Ğ¿Ğ¾Ğ¿Ñ€Ğ¾Ğ±ÑƒĞ¹ ĞµÑ‰Ñ‘ Ñ€Ğ°Ğ· (ğŸ’³ ĞĞ¿Ğ»Ğ°Ñ‚Ğ°/Ğ´Ğ¾ÑÑ‚ÑƒĞ¿)."
        )
        await callback.answer("ĞÑ‚ĞºĞ»Ğ¾Ğ½ĞµĞ½Ğ¾ âŒ")


# =========================
# Ğ ĞĞ—Ğ”Ğ•Ğ›Ğ«
# =========================
async def ensure_profile_ready(user_id: int) -> bool:
    u = await get_user(user_id)
    need = ["goal", "sex", "age", "height", "weight", "place", "exp", "freq", "meals"]
    return not any(not u.get(k) for k in need)


async def build_plans_if_needed(user_id: int, force: bool = False):
    u = await get_user(user_id)

    intro, plan_struct = generate_workout_plan(
        u["goal"], u["place"], u["exp"], int(u["freq"]),
        limits=u.get("limits") or "",
        user_id=user_id
    )

    summary, cal, p, f, c, meals = generate_nutrition_summary(
        u["goal"], u["sex"], int(u["age"]), int(u["height"]), float(u["weight"]), u["exp"],
        freq=int(u["freq"]), place=u["place"], meals_pref=int(u.get("meals") or 0)
    )

    nutrition_full = (
        summary
        + "\n\nĞ—Ğ°Ğ¼ĞµĞ½Ñ‹ (Ñ€Ğ°Ğ²Ğ½Ğ¾Ñ†ĞµĞ½Ğ½Ñ‹Ğµ):\n"
          "â€¢ ĞºÑƒÑ€Ğ¸Ñ†Ğ° â†” Ğ¸Ğ½Ğ´ĞµĞ¹ĞºĞ° â†” Ñ€Ñ‹Ğ±Ğ° Ğ±ĞµĞ»Ğ°Ñ\n"
          "â€¢ Ñ€Ğ¸Ñ â†” Ğ³Ñ€ĞµÑ‡ĞºĞ° â†” Ğ¼Ğ°ĞºĞ°Ñ€Ğ¾Ğ½Ñ‹\n"
          "â€¢ Ñ‚Ğ²Ğ¾Ñ€Ğ¾Ğ³ 0% â†” Ğ³Ñ€ĞµÑ‡ĞµÑĞºĞ¸Ğ¹ Ğ¹Ğ¾Ğ³ÑƒÑ€Ñ‚\n"
          "â€¢ Ğ±Ğ°Ğ½Ğ°Ğ½ â†” ÑĞ±Ğ»Ğ¾ĞºĞ¾ â†” ÑĞ³Ğ¾Ğ´Ñ‹"
    )

    if force:
        await save_workout_plan(user_id, intro, dumps_plan(plan_struct))
        await save_nutrition_plan(user_id, nutrition_full)
        return

    plan_text, plan_json = await get_workout_plan(user_id)
    nutr_text = await get_nutrition_plan(user_id)

    if not plan_text or not plan_json:
        await save_workout_plan(user_id, intro, dumps_plan(plan_struct))
    if not nutr_text:
        await save_nutrition_plan(user_id, nutrition_full)


TRACK_EXERCISES = [
    "Ğ–Ğ¸Ğ¼ Ğ»Ñ‘Ğ¶Ğ°",
    "ĞŸÑ€Ğ¸ÑĞµĞ´",
    "ĞÑ‚Ğ¶Ğ¸Ğ¼Ğ°Ğ½Ğ¸Ñ",
    "Ğ’ĞµÑ€Ñ…Ğ½Ğ¸Ğ¹ Ğ±Ğ»Ğ¾Ğº",
    "ĞŸĞ¾Ğ´Ñ‚ÑĞ³Ğ¸Ğ²Ğ°Ğ½Ğ¸Ñ",
    "Ğ ÑƒĞ¼Ñ‹Ğ½ÑĞºĞ°Ñ Ñ‚ÑĞ³Ğ°",
    "Ğ–Ğ¸Ğ¼ Ğ²Ğ²ĞµÑ€Ñ…",
    "Ğ–Ğ¸Ğ¼ Ğ½Ğ¾Ğ³Ğ°Ğ¼Ğ¸",
]


def diary_exercises_kb():
    rows = []
    for i in range(0, len(TRACK_EXERCISES), 2):
        left = InlineKeyboardButton(text=TRACK_EXERCISES[i], callback_data=f"d:ex:{TRACK_EXERCISES[i]}")
        if i + 1 < len(TRACK_EXERCISES):
            right = InlineKeyboardButton(text=TRACK_EXERCISES[i+1], callback_data=f"d:ex:{TRACK_EXERCISES[i+1]}")
            rows.append([left, right])
        else:
            rows.append([left])

    rows.append([InlineKeyboardButton(text="ğŸ“œ Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ", callback_data="d:history")])
    rows.append([InlineKeyboardButton(text="ğŸ  ĞœĞµĞ½Ñ", callback_data="nav:menu")])
    return InlineKeyboardMarkup(inline_keyboard=rows)


MEASURE_TYPES = [
    ("weight", "Ğ’ĞµÑ (ĞºĞ³)"),
    ("waist", "Ğ¢Ğ°Ğ»Ğ¸Ñ (ÑĞ¼)"),
    ("arm", "Ğ ÑƒĞºĞ° (ÑĞ¼)"),
    ("chest", "Ğ“Ñ€ÑƒĞ´ÑŒ (ÑĞ¼)"),
    ("thigh", "Ğ‘ĞµĞ´Ñ€Ğ¾ (ÑĞ¼)"),
]


def measures_kb():
    rows = []
    for i in range(0, len(MEASURE_TYPES), 2):
        k1, t1 = MEASURE_TYPES[i]
        b1 = InlineKeyboardButton(text=t1, callback_data=f"mtype:{k1}")
        if i + 1 < len(MEASURE_TYPES):
            k2, t2 = MEASURE_TYPES[i+1]
            b2 = InlineKeyboardButton(text=t2, callback_data=f"mtype:{k2}")
            rows.append([b1, b2])
        else:
            rows.append([b1])

    rows.append([InlineKeyboardButton(text="ğŸ“œ Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ", callback_data="m:history")])
    rows.append([InlineKeyboardButton(text="ğŸ  ĞœĞµĞ½Ñ", callback_data="nav:menu")])
    return InlineKeyboardMarkup(inline_keyboard=rows)


async def open_workouts(user_id: int, chat_id: int, bot: Bot, callback: Optional[CallbackQuery] = None):
    if not await is_access_active(user_id):
        await clean_send(bot, chat_id, user_id, locked_text())
        return

    if not await ensure_profile_ready(user_id):
        await clean_send(bot, chat_id, user_id, "âš ï¸ Ğ¡Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ° Ğ·Ğ°Ğ¿Ğ¾Ğ»Ğ½Ğ¸ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ (âš™ï¸ ĞŸÑ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ).")
        return

    plan_text, plan_struct = await get_workout_plan(user_id)
    if not plan_text or not plan_struct:
        await build_plans_if_needed(user_id, force=True)
        plan_text, plan_struct = await get_workout_plan(user_id)

    u = await get_user(user_id)
    full_access = await is_full_access_active(user_id)
    kb = workout_days_kb(int(u.get("freq") or plan_struct.get("freq") or 3), has_full_access=full_access)

    if callback:
        await clean_edit(callback, user_id, plan_text or "ğŸ‹ï¸ ĞŸĞ»Ğ°Ğ½ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½.", reply_markup=kb)
    else:
        await clean_send(bot, chat_id, user_id, plan_text or "ğŸ‹ï¸ ĞŸĞ»Ğ°Ğ½ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½.", reply_markup=kb)


# =========================
# âœ… ĞšĞ»Ğ°Ğ²Ğ¸Ğ°Ñ‚ÑƒÑ€Ğ° Ğ´Ğ½Ñ Ñ‚Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²ĞºĞ¸ â€” Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¸ Ñ‚ĞµÑ…Ğ½Ğ¸ĞºĞ¸
# ÑƒĞ±Ñ€Ğ°Ğ½Ñ‹ ĞºĞ½Ğ¾Ğ¿ĞºĞ¸ Â«Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ°Â» Ğ¸ Â«ĞœĞµĞ½ÑÂ»
# =========================
def workout_day_exercises_kb(day: int, exercises: List[str], done: List[int]) -> InlineKeyboardMarkup:
    """ĞšĞ»Ğ°Ğ²Ğ¸Ğ°Ñ‚ÑƒÑ€Ğ° ÑƒĞ¿Ñ€Ğ°Ğ¶Ğ½ĞµĞ½Ğ¸Ğ¹ Ğ´Ğ½Ñ Ñ Ñ‡ĞµĞºĞ±Ğ¾ĞºÑĞ°Ğ¼Ğ¸ Ğ¸ ĞºĞ½Ğ¾Ğ¿ĞºĞ¾Ğ¹ Ñ‚ĞµÑ…Ğ½Ğ¸ĞºĞ¸."""
    rows = []
    for idx, name in enumerate(exercises):
        is_done = idx in done
        short_name = name[:22] + "â€¦" if len(name) > 22 else name
        if is_done:
            btn_text = f"âœ… {short_name}"
        else:
            btn_text = f"â¬œï¸ {short_name}"

        done_btn = InlineKeyboardButton(
            text=btn_text,
            callback_data=f"wex:done:{day}:{idx}"
        )
        tech_key = get_tech_key_for_exercise(name)
        if tech_key:
            tech_btn = InlineKeyboardButton(
                text="ğŸ“š Ğ¢ĞµÑ…Ğ½Ğ¸ĞºĞ°",
                callback_data=f"wex:tech:{day}:{tech_key}"
            )
            rows.append([done_btn, tech_btn])
        else:
            rows.append([done_btn])

    # Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ ĞºĞ½Ğ¾Ğ¿ĞºĞ° Â«ĞĞ°Ğ·Ğ°Ğ´ Ğº Ğ¿Ñ€Ğ¾Ğ³Ñ€Ğ°Ğ¼Ğ¼ĞµÂ»
    rows.append([InlineKeyboardButton(text="ğŸ“‹ ĞŸÑ€Ğ¾Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ°", callback_data="nav:workouts")])
    return InlineKeyboardMarkup(inline_keyboard=rows)


async def cb_workout_day(callback: CallbackQuery, bot: Bot):
    # ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° ĞºĞ½Ğ¾Ğ¿ĞºĞ¸ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ¸ (Ğ¸Ğ· Ğ³Ğ»Ğ°Ğ²Ğ½Ğ¾Ğ³Ğ¾ ÑĞºÑ€Ğ°Ğ½Ğ° Ñ‚Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²Ğ¾Ğº)
    parts = callback.data.split(":")
    if len(parts) == 3 and parts[1] == "stats":
        await cb_workout_stats(callback, bot)
        return

    if not await is_access_active(callback.from_user.id):
        await clean_edit(callback, callback.from_user.id, locked_text())
        await callback.answer()
        return

    plan_text, plan_struct = await get_workout_plan(callback.from_user.id)
    if not plan_struct:
        await build_plans_if_needed(callback.from_user.id, force=True)
        plan_text, plan_struct = await get_workout_plan(callback.from_user.id)

    day = callback.data.split(":", 1)[1]
    day_text = (plan_struct.get("days") or {}).get(str(day))
    if not day_text:
        await callback.answer("Ğ”ĞµĞ½ÑŒ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½ ğŸ˜…", show_alert=True)
        return

    day_num = int(day)
    uid = callback.from_user.id

    exercises = parse_exercises_from_day_text(day_text)
    if not exercises:
        u = await get_user(uid)
        full_access = await is_full_access_active(uid)
        kb = workout_days_kb(int(u.get("freq") or plan_struct.get("freq") or 3), has_full_access=full_access)
        await clean_edit(callback, uid, day_text, reply_markup=kb)
        await callback.answer()
        return

    done = await get_day_done_exercises(uid, day_num)
    already_done_today = await is_day_completed_today(uid, day_num)

    text = build_day_display_text(day_num, day_text, exercises, done)
    if already_done_today:
        text += "\n\nğŸ‰ Ğ”ĞµĞ½ÑŒ ÑƒĞ¶Ğµ Ğ·Ğ°ÑÑ‡Ğ¸Ñ‚Ğ°Ğ½ ÑĞµĞ³Ğ¾Ğ´Ğ½Ñ! ĞœĞ¾Ğ¶ĞµÑˆÑŒ Ğ¿Ñ€Ğ¾Ğ¹Ñ‚Ğ¸ ÑĞ½Ğ¾Ğ²Ğ°."
    kb = workout_day_exercises_kb(day_num, exercises, done)
    await clean_edit(callback, uid, text, reply_markup=kb)
    await callback.answer()


async def cb_workout_ex_done(callback: CallbackQuery, bot: Bot):
    """ĞÑ‚Ğ¼ĞµÑ‡Ğ°ĞµĞ¼/ÑĞ½Ğ¸Ğ¼Ğ°ĞµĞ¼ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ğµ ÑƒĞ¿Ñ€Ğ°Ğ¶Ğ½ĞµĞ½Ğ¸Ñ."""
    parts = callback.data.split(":")
    day_num = int(parts[2])
    ex_idx = int(parts[3])
    uid = callback.from_user.id

    if not await is_access_active(uid):
        await callback.answer("ĞĞµÑ‚ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ°", show_alert=True)
        return

    plan_text, plan_struct = await get_workout_plan(uid)
    if not plan_struct:
        await callback.answer("ĞĞµÑ‚ Ğ¿Ğ»Ğ°Ğ½Ğ° ğŸ˜…", show_alert=True)
        return

    day_text = (plan_struct.get("days") or {}).get(str(day_num))
    if not day_text:
        await callback.answer("Ğ”ĞµĞ½ÑŒ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½", show_alert=True)
        return

    exercises = parse_exercises_from_day_text(day_text)
    done = await get_day_done_exercises(uid, day_num)

    if ex_idx in done:
        done.remove(ex_idx)
    else:
        done.append(ex_idx)

    await set_day_done_exercises(uid, day_num, done)

    total = len(exercises)
    done_count = len(done)
    all_done = total > 0 and done_count == total

    if all_done:
        await mark_day_completed(uid, day_num)
        await clear_day_progress(uid, day_num)
        text = build_day_display_text(day_num, day_text, exercises, list(range(total)), all_done=True)
        kb = workout_day_exercises_kb(day_num, exercises, list(range(total)))
        await clean_edit(callback, uid, text, reply_markup=kb)
        await callback.answer("ğŸ‰ Ğ”ĞµĞ½ÑŒ Ğ·Ğ°Ğ²ĞµÑ€ÑˆÑ‘Ğ½!", show_alert=True)
    else:
        text = build_day_display_text(day_num, day_text, exercises, done)
        kb = workout_day_exercises_kb(day_num, exercises, done)
        await clean_edit(callback, uid, text, reply_markup=kb)
        await callback.answer(f"{'âœ…' if ex_idx in done else 'â†©ï¸'} {done_count}/{total}")


async def cb_workout_stats(callback: CallbackQuery, bot: Bot):
    """Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ° Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ½Ñ‹Ñ… Ñ‚Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²Ğ¾Ğº â€” Ñ‚ĞµĞ¿ĞµÑ€ÑŒ Ğ² Ğ³Ğ»Ğ°Ğ²Ğ½Ğ¾Ğ¼ ÑĞºÑ€Ğ°Ğ½Ğµ Ñ‚Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²Ğ¾Ğº."""
    uid = callback.from_user.id
    async with db() as conn:
        async with conn.execute("""
            SELECT day_num, completed_date, created_at
            FROM workout_completions
            WHERE user_id=?
            ORDER BY id DESC LIMIT 30
        """, (uid,)) as cur:
            rows = await cur.fetchall()

    if not rows:
        await callback.answer("ĞŸĞ¾ĞºĞ° Ğ½ĞµÑ‚ Ğ·Ğ°Ğ²ĞµÑ€ÑˆÑ‘Ğ½Ğ½Ñ‹Ñ… Ñ‚Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²Ğ¾Ğº ğŸ’ª", show_alert=True)
        return

    total = len(rows)
    plan_text, plan_struct = await get_workout_plan(uid)

    lines = ["ğŸ“Š Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ° Ñ‚Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²Ğ¾Ğº\n"]
    lines.append(f"Ğ’ÑĞµĞ³Ğ¾ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¾: {total} Ñ‚Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²Ğ¾Ğº\n")

    lines.append("ğŸ—“ ĞŸĞ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğµ Ñ‚Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²ĞºĞ¸:")
    for day_num, completed_date, _ in rows[:10]:
        day_label = f"Ğ”ĞµĞ½ÑŒ {day_num}"
        if plan_struct:
            day_text = (plan_struct.get("days") or {}).get(str(day_num), "")
            day_name = get_day_display_name(day_num, day_text)
            day_label = f"Ğ”ĞµĞ½ÑŒ {day_num} â€¢ {day_name}"
        lines.append(f"âœ… {completed_date}  â€”  {day_label}")

    # Ğ¡ĞµÑ€Ğ¸Ñ (streak)
    dates = sorted(set(r[1] for r in rows), reverse=True)
    streak = 0
    prev = None
    for d in dates:
        try:
            dt = datetime.strptime(d, "%Y-%m-%d").date()
        except Exception:
            continue
        if prev is None:
            streak = 1
        elif (prev - dt).days == 1:
            streak += 1
        else:
            break
        prev = dt

    lines.append(f"\nğŸ”¥ Ğ¢ĞµĞºÑƒÑ‰Ğ°Ñ ÑĞµÑ€Ğ¸Ñ: {streak} Ğ´Ğ½. Ğ¿Ğ¾Ğ´Ñ€ÑĞ´")

    text = "\n".join(lines)
    back_kb = InlineKeyboardMarkup(inline_keyboard=[
        [InlineKeyboardButton(text="â¬…ï¸ ĞĞ°Ğ·Ğ°Ğ´ Ğº Ñ‚Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²ĞºĞ°Ğ¼", callback_data="nav:workouts")],
    ])
    await clean_edit(callback, uid, text, reply_markup=back_kb)
    await callback.answer()


async def cb_workout_ex_tech(callback: CallbackQuery, bot: Bot):
    """ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ Ñ‚ĞµÑ…Ğ½Ğ¸ĞºÑƒ ÑƒĞ¿Ñ€Ğ°Ğ¶Ğ½ĞµĞ½Ğ¸Ñ Ñ ĞºĞ°Ñ€Ñ‚Ğ¸Ğ½ĞºĞ¾Ğ¹ (Ğ¸Ğ· Ğ¿Ñ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€Ğ° Ğ´Ğ½Ñ)."""
    parts = callback.data.split(":")
    tech_key = parts[3]
    day_num = parts[2]

    item = TECH.get(tech_key)
    if not item:
        await callback.answer("Ğ¢ĞµÑ…Ğ½Ğ¸ĞºĞ° Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ° ğŸ˜…", show_alert=True)
        return

    text = item["text"]
    img_path = item["img"]

    back_kb = InlineKeyboardMarkup(inline_keyboard=[
        [InlineKeyboardButton(text=f"â¬…ï¸ ĞĞ°Ğ·Ğ°Ğ´ Ğº Ğ”Ğ½Ñ {day_num}", callback_data=f"wday:{day_num}")]
    ])

    last_id = await get_last_bot_msg_id(callback.from_user.id)
    if last_id:
        try:
            await bot.delete_message(chat_id=callback.message.chat.id, message_id=last_id)
        except Exception:
            pass

    if os.path.exists(img_path):
        photo = FSInputFile(img_path)
        caption = text[:1020] + ("â€¦" if len(text) > 1020 else "")
        m = await bot.send_photo(
            chat_id=callback.message.chat.id,
            photo=photo,
            caption=caption,
            reply_markup=back_kb
        )
        rest = text[1020:].strip()
        if rest:
            m2 = await bot.send_message(
                chat_id=callback.message.chat.id,
                text=rest,
                reply_markup=back_kb
            )
            await set_last_bot_msg_id(callback.from_user.id, m2.message_id)
        else:
            await set_last_bot_msg_id(callback.from_user.id, m.message_id)
    else:
        m = await bot.send_message(
            chat_id=callback.message.chat.id,
            text=text,
            reply_markup=back_kb
        )
        await set_last_bot_msg_id(callback.from_user.id, m.message_id)

    await callback.answer()


async def open_nutrition(user_id: int, chat_id: int, bot: Bot, callback: Optional[CallbackQuery] = None):
    if not await is_access_active(user_id):
        text = locked_text()
        if callback:
            await clean_edit(callback, user_id, text)
        else:
            await clean_send(bot, chat_id, user_id, text)
        return

    if not await is_full_access_active(user_id):
        text = (
            "ğŸ½ ĞœĞ¾Ñ‘ Ğ¿Ğ¸Ñ‚Ğ°Ğ½Ğ¸Ğµ\n\n"
            "ĞŸĞ¸Ñ‚Ğ°Ğ½Ğ¸Ğµ Ğ¾Ñ‚ĞºÑ€Ñ‹Ğ²Ğ°ĞµÑ‚ÑÑ Ğ½Ğ° Ñ‚Ğ°Ñ€Ğ¸Ñ„Ğ°Ñ… 3 Ğ¼ĞµÑÑÑ†Ğ° Ğ¸ ĞĞ°Ğ²ÑĞµĞ³Ğ´Ğ°.\n"
            "90 Ğ´Ğ½ĞµĞ¹ â€” Ğ¼Ğ¸Ğ½Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ ÑÑ€Ğ¾Ğº, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ñ€ĞµĞ°Ğ»ÑŒĞ½Ğ¾ ÑƒĞ²Ğ¸Ğ´ĞµÑ‚ÑŒ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚.\n\n"
            "Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸ Ñ‚Ğ°Ñ€Ğ¸Ñ„ ğŸ‘‡"
        )
        upgrade_kb = InlineKeyboardMarkup(inline_keyboard=[
            [InlineKeyboardButton(text=f"ğŸ”¥ 3 Ğ¼ĞµÑÑÑ†Ğ° â€” {TARIFFS['t3']['price']}â‚½", callback_data="tariff:t3")],
            [InlineKeyboardButton(text=f"ğŸ† ĞĞ°Ğ²ÑĞµĞ³Ğ´Ğ° â€” {TARIFFS['life']['price']}â‚½", callback_data="tariff:life")],
            [InlineKeyboardButton(text="ğŸ  ĞœĞµĞ½Ñ", callback_data="nav:menu")],
        ])
        if callback:
            await clean_edit(callback, user_id, text, reply_markup=upgrade_kb)
        else:
            await clean_send(bot, chat_id, user_id, text, reply_markup=upgrade_kb)
        return

    if not await ensure_profile_ready(user_id):
        text = "âš ï¸ Ğ¡Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ° Ğ·Ğ°Ğ¿Ğ¾Ğ»Ğ½Ğ¸ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ (âš™ï¸ ĞŸÑ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ)."
        if callback:
            await clean_edit(callback, user_id, text)
        else:
            await clean_send(bot, chat_id, user_id, text)
        return

    u = await get_user(user_id)
    summary, _, _, _, _, _ = generate_nutrition_summary(
        u["goal"], u["sex"], int(u["age"]), int(u["height"]), float(u["weight"]), u["exp"],
        freq=int(u["freq"]), place=u["place"], meals_pref=int(u.get("meals") or 0)
    )

    if callback:
        await clean_edit(callback, user_id, summary, reply_markup=nutrition_examples_kb())
    else:
        await clean_send(bot, chat_id, user_id, summary, reply_markup=nutrition_examples_kb())


async def open_measures(user_id: int, chat_id: int, bot: Bot, state: FSMContext, callback: Optional[CallbackQuery] = None):
    if not await is_access_active(user_id):
        if callback:
            await clean_edit(callback, user_id, locked_text())
        else:
            await clean_send(bot, chat_id, user_id, locked_text())
        return

    await state.set_state(MeasureFlow.choose_type)
    text = "ğŸ“ Ğ—Ğ°Ğ¼ĞµÑ€Ñ‹\n\nĞ’Ñ‹Ğ±Ğ¸Ñ€Ğ°Ğ¹ Ğ·Ğ°Ğ¼ĞµÑ€ â€” Ğ´Ğ°Ñ‚Ñƒ Ğ¿Ğ¾ÑÑ‚Ğ°Ğ²Ğ»Ñ ÑĞ°Ğ¼."
    if callback:
        await clean_edit(callback, user_id, text, reply_markup=measures_kb())
    else:
        await clean_send(bot, chat_id, user_id, text, reply_markup=measures_kb())


async def open_diary(user_id: int, chat_id: int, bot: Bot, state: FSMContext, callback: Optional[CallbackQuery] = None):
    if not await is_access_active(user_id):
        if callback:
            await clean_edit(callback, user_id, locked_text())
        else:
            await clean_send(bot, chat_id, user_id, locked_text())
        return

    await state.set_state(DiaryFlow.choosing_exercise)
    text = (
        "ğŸ““ Ğ”Ğ½ĞµĞ²Ğ½Ğ¸Ğº Ñ‚Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²Ğ¾Ğº\n\n"
        "ğŸ“Œ ĞšĞ°Ğº Ğ²ĞµÑÑ‚Ğ¸ Ğ´Ğ½ĞµĞ²Ğ½Ğ¸Ğº:\n"
        "â€¢ Ğ’Ñ‹Ğ±Ğ¸Ñ€Ğ°Ğ¹ ÑƒĞ¿Ñ€Ğ°Ğ¶Ğ½ĞµĞ½Ğ¸Ğµ ĞºĞ½Ğ¾Ğ¿ĞºĞ¾Ğ¹ Ğ½Ğ¸Ğ¶Ğµ\n"
        "â€¢ Ğ’Ğ²Ğ¾Ğ´Ğ¸ Ğ¿Ğ¾Ğ´Ñ…Ğ¾Ğ´Ñ‹ Ğ² Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğµ: Ğ²ĞµÑÃ—Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€Ñ‹\n"
        "  ĞŸÑ€Ğ¸Ğ¼ĞµÑ€: 60x8, 62x8, 65x6\n"
        "â€¢ Ğ”Ğ°Ñ‚Ñƒ ÑÑ‚Ğ°Ğ²Ğ»Ñ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸\n\n"
        "â“ ĞŸĞ¾Ñ‡ĞµĞ¼Ñƒ Ğ·Ğ´ĞµÑÑŒ Ğ½Ğµ Ğ²ÑĞµ ÑƒĞ¿Ñ€Ğ°Ğ¶Ğ½ĞµĞ½Ğ¸Ñ?\n"
        "Ğ”Ğ½ĞµĞ²Ğ½Ğ¸Ğº ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ñ‚ Ğ±Ğ°Ğ·Ğ¾Ğ²Ñ‹Ğµ ÑƒĞ¿Ñ€Ğ°Ğ¶Ğ½ĞµĞ½Ğ¸Ñ Ğ´Ğ»Ñ Ğ¾Ñ‚ÑĞ»ĞµĞ¶Ğ¸Ğ²Ğ°Ğ½Ğ¸Ñ Ğ¿Ñ€Ğ¾Ğ³Ñ€ĞµÑÑĞ° â€” "
        "Ğ¸Ğ¼ĞµĞ½Ğ½Ğ¾ Ğ¿Ğ¾ Ğ½Ğ¸Ğ¼ Ğ»ĞµĞ³Ñ‡Ğµ Ğ²ÑĞµĞ³Ğ¾ Ğ²Ğ¸Ğ´ĞµÑ‚ÑŒ Ñ€Ğ¾ÑÑ‚ ÑĞ¸Ğ»Ñ‹. "
        "Ğ¢Ñ€ĞµĞ½Ğ¸Ñ€ÑƒĞ¹ Ğ²ÑĞµ ÑƒĞ¿Ñ€Ğ°Ğ¶Ğ½ĞµĞ½Ğ¸Ñ Ğ¸Ğ· Ğ¿Ñ€Ğ¾Ğ³Ñ€Ğ°Ğ¼Ğ¼Ñ‹, Ğ° Ğ² Ğ´Ğ½ĞµĞ²Ğ½Ğ¸Ğº Ğ·Ğ°Ğ¿Ğ¸ÑÑ‹Ğ²Ğ°Ğ¹ ĞºĞ»ÑÑ‡ĞµĞ²Ñ‹Ğµ â€” "
        "Ğ¶Ğ¸Ğ¼, Ğ¿Ñ€Ğ¸ÑĞµĞ´, Ñ‚ÑĞ³Ñƒ, Ğ¿Ğ¾Ğ´Ñ‚ÑĞ³Ğ¸Ğ²Ğ°Ğ½Ğ¸Ñ. "
        "ĞŸÑ€Ğ¾Ğ³Ñ€ĞµÑÑ Ğ² Ğ±Ğ°Ğ·Ğµ = Ğ¿Ñ€Ğ¾Ğ³Ñ€ĞµÑÑ Ğ²Ğ¾ Ğ²ÑÑ‘Ğ¼ Ğ¾ÑÑ‚Ğ°Ğ»ÑŒĞ½Ğ¾Ğ¼.\n\n"
        "ğŸ’¡ Ğ¡Ğ¾Ğ²ĞµÑ‚: Ğ·Ğ°Ğ¿Ğ¸ÑÑ‹Ğ²Ğ°Ğ¹ ĞºĞ°Ğ¶Ğ´ÑƒÑ Ñ‚Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²ĞºÑƒ â€” "
        "Ñ‡ĞµÑ€ĞµĞ· 4â€“8 Ğ½ĞµĞ´ĞµĞ»ÑŒ ÑƒĞ²Ğ¸Ğ´Ğ¸ÑˆÑŒ Ñ€Ğ¾ÑÑ‚ Ğ² Ñ†Ğ¸Ñ„Ñ€Ğ°Ñ… ğŸ’ª"
    )
    if callback:
        await clean_edit(callback, user_id, text, reply_markup=diary_exercises_kb())
    else:
        await clean_send(bot, chat_id, user_id, text, reply_markup=diary_exercises_kb())


# =========================
# Ğ”ĞĞ•Ğ’ĞĞ˜Ğš
# =========================
async def diary_pick_ex(callback: CallbackQuery, state: FSMContext, bot: Bot):
    exercise = callback.data.split("d:ex:", 1)[1].strip()
    await state.update_data(exercise=exercise)
    await state.set_state(DiaryFlow.enter_sets)

    old_prompt_id = await get_diary_prompt_msg_id(callback.from_user.id)
    if old_prompt_id:
        try:
            await bot.delete_message(chat_id=callback.message.chat.id, message_id=old_prompt_id)
        except Exception:
            pass

    today = datetime.now().strftime("%Y-%m-%d")
    text = (
        f"ğŸ—“ {today}\n"
        f"âœ… {exercise}\n\n"
        "ĞĞ°Ğ¿Ğ¸ÑˆĞ¸ Ğ¿Ğ¾Ğ´Ñ…Ğ¾Ğ´Ñ‹: Ğ²ĞµÑxĞ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€Ñ‹\n"
        "ĞŸÑ€Ğ¸Ğ¼ĞµÑ€: 60x8, 60x8, 60x7"
    )

    m = await bot.send_message(chat_id=callback.message.chat.id, text=text)
    await set_diary_prompt_msg_id(callback.from_user.id, m.message_id)
    await callback.answer()


async def diary_enter_sets(message: Message, state: FSMContext, bot: Bot):
    txt = (message.text or "").strip()
    data = await state.get_data()
    exercise = (data.get("exercise") or "").strip()
    if not exercise:
        await clean_send(bot, message.chat.id, message.from_user.id, "Ğ¡Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ° Ğ²Ñ‹Ğ±ĞµÑ€Ğ¸ ÑƒĞ¿Ñ€Ğ°Ğ¶Ğ½ĞµĞ½Ğ¸Ğµ Ğ² Â«Ğ”Ğ½ĞµĞ²Ğ½Ğ¸ĞºĞµÂ».")
        await try_delete_user_message(bot, message)
        await state.clear()
        return

    parts = [p.strip() for p in txt.split(",") if p.strip()]
    if not parts:
        await message.answer("Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚: 60x8, 60x8")
        await try_delete_user_message(bot, message)
        return

    session_id = await get_or_create_today_session(message.from_user.id)

    parsed = []
    for p in parts:
        m = re.match(r"^(\d+(\.\d+)?)\s*[xÑ…]\s*(\d+)$", p.lower())
        if not m:
            await message.answer(f"ĞĞµ Ğ¿Ğ¾Ğ½ÑĞ»: '{p}'. ĞŸÑ€Ğ¸Ğ¼ĞµÑ€: 60x8")
            await try_delete_user_message(bot, message)
            return
        w = float(m.group(1))
        r = int(m.group(3))
        parsed.append((w, r))

    for i, (w, r) in enumerate(parsed, start=1):
        await add_set(session_id, exercise, i, w, r)

    today = datetime.now().strftime("%Y-%m-%d")
    msg = f"âœ… Ğ—Ğ°Ğ¿Ğ¸ÑĞ°Ğ».\nğŸ—“ {today}\nğŸ· {exercise}\nĞŸĞ¾Ğ´Ñ…Ğ¾Ğ´Ğ¾Ğ²: {len(parsed)}"
    await clean_send(bot, message.chat.id, message.from_user.id, msg, reply_markup=diary_exercises_kb())
    await try_delete_user_message(bot, message)

    prompt_id = await get_diary_prompt_msg_id(message.from_user.id)
    if prompt_id:
        try:
            await bot.delete_message(chat_id=message.chat.id, message_id=prompt_id)
        except Exception:
            pass
        await set_diary_prompt_msg_id(message.from_user.id, None)

    await state.set_state(DiaryFlow.choosing_exercise)


async def diary_history(callback: CallbackQuery):
    history = await get_diary_history(callback.from_user.id, 10)
    if not history:
        await callback.message.answer("Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ğ¸ Ğ¿Ğ¾ĞºĞ° Ğ½ĞµÑ‚ ğŸ™‚")
        await callback.answer()
        return

    msg = "ğŸ“œ ĞŸĞ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğµ Ñ‚Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²ĞºĞ¸:\n\n"
    for (s, sets) in history:
        sid, session_date, title = s
        msg += f"ğŸ—“ {session_date}\n"
        cur_ex = None
        line = ""
        for ex, set_no, w, reps in sets:
            if cur_ex != ex:
                if line:
                    msg += line + "\n"
                cur_ex = ex
                line = f"â€¢ {ex}: "
            line += f"{w:g}x{reps}  "
        if line:
            msg += line + "\n"
        msg += "\n"

    await safe_send(callback.message, msg, reply_markup=simple_back_to_menu_inline_kb())
    await callback.answer()


# =========================
# Ğ—ĞĞœĞ•Ğ Ğ«
# =========================
async def cb_measure_type(callback: CallbackQuery, state: FSMContext):
    mtype = callback.data.split(":")[1]
    await state.update_data(mtype=mtype)
    await state.set_state(MeasureFlow.enter_value)

    name = dict(MEASURE_TYPES).get(mtype, mtype)
    await callback.message.answer(f"Ğ’Ğ¿Ğ¸ÑˆĞ¸ Â«{name}Â» Ñ‡Ğ¸ÑĞ»Ğ¾Ğ¼:")
    await callback.answer()


async def measure_value(message: Message, state: FSMContext, bot: Bot):
    txt = (message.text or "").strip().replace(",", ".")
    try:
        val = float(txt)
    except Exception:
        await message.answer("ĞÑƒĞ¶Ğ½Ğ¾ Ñ‡Ğ¸ÑĞ»Ğ¾ ğŸ™‚")
        await try_delete_user_message(bot, message)
        return

    data = await state.get_data()
    mtype = data.get("mtype")

    await add_measure(message.from_user.id, mtype, val)
    rows = await get_last_measures(message.from_user.id, mtype, 6)

    name = dict(MEASURE_TYPES).get(mtype, mtype)
    hist = "\n".join([f"â€¢ {r[0]:g} ({r[1][:10]})" for r in rows])
    out = f"âœ… {name}: {val:g}\n\nĞŸĞ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğµ:\n{hist}"
    await clean_send(bot, message.chat.id, message.from_user.id, out, reply_markup=measures_kb())
    await state.set_state(MeasureFlow.choose_type)
    await try_delete_user_message(bot, message)


async def measures_history(callback: CallbackQuery):
    rows = await get_last_measures_any(callback.from_user.id, 30)
    if not rows:
        await callback.message.answer("Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ğ¸ Ğ¿Ğ¾ĞºĞ° Ğ½ĞµÑ‚ ğŸ™‚")
        await callback.answer()
        return

    name_map = dict(MEASURE_TYPES)
    grouped: Dict[str, List[Tuple[float, str]]] = {}
    for mtype, val, created_at in rows:
        grouped.setdefault(mtype, []).append((val, created_at))

    msg = "ğŸ“œ Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ·Ğ°Ğ¼ĞµÑ€Ğ¾Ğ²:\n\n"
    for mtype, items in grouped.items():
        msg += f"{name_map.get(mtype, mtype)}:\n"
        for val, ts in items[:6]:
            msg += f"â€¢ {val:g} ({ts[:10]})\n"
        msg += "\n"

    await safe_send(callback.message, msg, reply_markup=measures_kb())
    await callback.answer()


# =========================
# ĞŸĞ˜Ğ¢ĞĞĞ˜Ğ•: 3 Ğ²Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚Ğ°
# =========================
def build_shopping_basket(goal: str, calories: int, protein_g: int, fat_g: int, carbs_g: int, meals: int) -> str:
    """Ğ“ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒĞµÑ‚ ÑĞ¿Ğ¸ÑĞ¾Ğº Ğ¿Ñ€Ğ¾Ğ´ÑƒĞºÑ‚Ğ¾Ğ² Ğ½Ğ° Ğ½ĞµĞ´ĞµĞ»Ñ Ğ¿Ğ¾Ğ´ Ñ†ĞµĞ»ÑŒ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ."""
    g = (goal or "").lower()
    is_cut = "ÑÑƒÑˆ" in g
    is_mass = "Ğ¼Ğ°Ñ" in g

    # Ğ‘Ğ°Ğ·Ğ¾Ğ²Ñ‹Ğµ Ğ½ĞµĞ´ĞµĞ»ÑŒĞ½Ñ‹Ğµ ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ° (Ğ½Ğ° 7 Ğ´Ğ½ĞµĞ¹)
    # Ğ‘ĞµĞ»Ğ¾Ğº: Ğ¾ÑĞ½Ğ¾Ğ²Ğ½Ğ¾Ğ¹ Ğ¸ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸Ğº
    chicken_week = int(round(protein_g * 0.45 * 7 / 0.31))   # 45% Ğ±ĞµĞ»ĞºĞ° Ğ¸Ğ· ĞºÑƒÑ€Ğ¸Ñ†Ñ‹
    fish_week    = int(round(protein_g * 0.25 * 7 / 0.18))   # 25% Ğ¸Ğ· Ñ€Ñ‹Ğ±Ñ‹
    eggs_week    = max(7, int(round(protein_g * 0.15 * 7 / 0.127 / 60)))  # ~15% Ğ¸Ğ· ÑĞ¸Ñ† (ÑˆÑ‚)
    curd_week    = int(round(protein_g * 0.15 * 7 / 0.18))   # ~15% Ğ¸Ğ· Ñ‚Ğ²Ğ¾Ñ€Ğ¾Ğ³Ğ°

    # Ğ£Ğ³Ğ»ĞµĞ²Ğ¾Ğ´Ñ‹
    rice_week    = int(round(carbs_g * 0.35 * 7 / 0.76))
    buckwheat_w  = int(round(carbs_g * 0.25 * 7 / 0.57))
    oats_week    = int(round(carbs_g * 0.15 * 7 / 0.60))
    potato_week  = int(round(carbs_g * 0.10 * 7 / 0.17))
    fruit_week   = int(round(carbs_g * 0.15 * 7 / 0.17))   # Ñ„Ñ€ÑƒĞºÑ‚Ñ‹ ~17% ÑƒĞ³Ğ»ĞµĞ²Ğ¾Ğ´Ğ¾Ğ²

    # Ğ–Ğ¸Ñ€Ñ‹
    oil_week     = int(round(fat_g * 0.4 * 7 / 1.0))         # Ğ¼Ğ°ÑĞ»Ğ¾ 40% Ğ¶Ğ¸Ñ€Ğ¾Ğ²
    nuts_week    = int(round(fat_g * 0.3 * 7 / 0.5))         # Ğ¾Ñ€ĞµÑ…Ğ¸ ~50% Ğ¶Ğ¸Ñ€Ğ¾Ğ²

    # ĞĞ²Ğ¾Ñ‰Ğ¸ â€” Ğ²ÑĞµĞ³Ğ´Ğ°
    veg_week     = 1400  # 200Ğ³ Ğ² Ğ´ĞµĞ½ÑŒ Ã— 7

    lines = [
        f"ğŸ›’ ĞšĞ¾Ñ€Ğ·Ğ¸Ğ½Ğ° Ğ½Ğ° Ğ½ĞµĞ´ĞµĞ»Ñ",
        f"Ğ¦ĞµĞ»ÑŒ: {goal} | {calories} ĞºĞºĞ°Ğ»/Ğ´ĞµĞ½ÑŒ",
        f"Ğ‘ {protein_g}Ğ³ / Ğ– {fat_g}Ğ³ / Ğ£ {carbs_g}Ğ³",
        "",
        "ğŸ¥© Ğ‘Ğ•Ğ›ĞĞš:",
        f"â€¢ ĞšÑƒÑ€Ğ¸Ğ½Ğ°Ñ Ğ³Ñ€ÑƒĞ´ĞºĞ° â€” {chicken_week} Ğ³ (~{chicken_week//1000:.1f} ĞºĞ³)" if chicken_week >= 1000 else f"â€¢ ĞšÑƒÑ€Ğ¸Ğ½Ğ°Ñ Ğ³Ñ€ÑƒĞ´ĞºĞ° â€” {chicken_week} Ğ³",
        f"â€¢ Ğ Ñ‹Ğ±Ğ° Ğ±ĞµĞ»Ğ°Ñ (Ñ‚Ñ€ĞµÑĞºĞ°/Ğ¼Ğ¸Ğ½Ñ‚Ğ°Ğ¹) â€” {fish_week} Ğ³" + (" (~{:.1f} ĞºĞ³)".format(fish_week/1000) if fish_week >= 1000 else ""),
        f"â€¢ Ğ¯Ğ¹Ñ†Ğ° â€” {eggs_week} ÑˆÑ‚",
        f"â€¢ Ğ¢Ğ²Ğ¾Ñ€Ğ¾Ğ³ 0â€“5% â€” {curd_week} Ğ³",
    ]

    if is_mass:
        beef_week = int(round(protein_g * 0.10 * 7 / 0.25))
        lines.append(f"â€¢ Ğ“Ğ¾Ğ²ÑĞ´Ğ¸Ğ½Ğ° (Ğ²Ğ°Ñ€Ñ‘Ğ½Ğ°Ñ) â€” {beef_week} Ğ³  (Ğ´Ğ»Ñ Ñ€Ğ°Ğ·Ğ½Ğ¾Ğ¾Ğ±Ñ€Ğ°Ğ·Ğ¸Ñ)")

    lines += [
        "",
        "ğŸš Ğ£Ğ“Ğ›Ğ•Ğ’ĞĞ”Ğ«:",
        f"â€¢ Ğ Ğ¸Ñ (ÑÑƒÑ…Ğ¾Ğ¹) â€” {rice_week} Ğ³",
        f"â€¢ Ğ“Ñ€ĞµÑ‡ĞºĞ° (ÑÑƒÑ…Ğ°Ñ) â€” {buckwheat_w} Ğ³",
        f"â€¢ ĞĞ²ÑÑĞ½ĞºĞ° (ÑÑƒÑ…Ğ°Ñ) â€” {oats_week} Ğ³",
        f"â€¢ ĞšĞ°Ñ€Ñ‚Ğ¾Ñ„ĞµĞ»ÑŒ â€” {potato_week} Ğ³" if not is_cut else f"â€¢ ĞšĞ°Ñ€Ñ‚Ğ¾Ñ„ĞµĞ»ÑŒ â€” {potato_week//2} Ğ³  (Ğ½Ğ° ÑÑƒÑˆĞºĞµ Ğ¼ĞµĞ½ÑŒÑˆĞµ)",
        f"â€¢ Ğ¤Ñ€ÑƒĞºÑ‚Ñ‹ (ÑĞ±Ğ»Ğ¾ĞºĞ¾/Ğ±Ğ°Ğ½Ğ°Ğ½/ÑĞ³Ğ¾Ğ´Ñ‹) â€” ~{fruit_week} Ğ³/Ğ½ĞµĞ´",
        "",
        "ğŸ¥¦ ĞĞ’ĞĞ©Ğ˜:",
        f"â€¢ ĞĞ²Ğ¾Ñ‰Ğ¸ (Ğ¾Ğ³ÑƒÑ€ĞµÑ†, Ğ¿Ğ¾Ğ¼Ğ¸Ğ´Ğ¾Ñ€, ĞºĞ°Ğ¿ÑƒÑÑ‚Ğ°) â€” ~{veg_week} Ğ³/Ğ½ĞµĞ´",
        "  (Ğ¿Ğ¾ĞºÑƒĞ¿Ğ°Ğ¹ Ğ»ÑĞ±Ñ‹Ğµ ÑĞ²ĞµĞ¶Ğ¸Ğµ Ğ¸Ğ»Ğ¸ Ğ·Ğ°Ğ¼Ğ¾Ñ€Ğ¾Ğ¶ĞµĞ½Ğ½Ñ‹Ğµ)",
        "",
        "ğŸ«’ Ğ–Ğ˜Ğ Ğ«:",
        f"â€¢ ĞœĞ°ÑĞ»Ğ¾ Ğ¾Ğ»Ğ¸Ğ²ĞºĞ¾Ğ²Ğ¾Ğµ/Ğ¿Ğ¾Ğ´ÑĞ¾Ğ»Ğ½ĞµÑ‡Ğ½Ğ¾Ğµ â€” {oil_week} Ğ³  (~{oil_week//10} ÑÑ‚.Ğ».)",
        f"â€¢ ĞÑ€ĞµÑ…Ğ¸ (Ğ¼Ğ¸Ğ½Ğ´Ğ°Ğ»ÑŒ/Ğ³Ñ€ĞµÑ†ĞºĞ¸Ğ¹) â€” {nuts_week} Ğ³",
    ]

    if not is_cut:
        lines += [
            f"â€¢ Ğ“Ñ€ĞµÑ‡ĞµÑĞºĞ¸Ğ¹ Ğ¹Ğ¾Ğ³ÑƒÑ€Ñ‚ 2% â€” 500â€“700 Ğ³",
        ]

    lines += [
        "",
        "ğŸ’¡ Ğ—Ğ°Ğ¼ĞµĞ½Ñ‹:",
        "  ĞºÑƒÑ€Ğ¸Ñ†Ğ° â†” Ğ¸Ğ½Ğ´ĞµĞ¹ĞºĞ° â†” Ñ€Ñ‹Ğ±Ğ°",
        "  Ñ€Ğ¸Ñ â†” Ğ³Ñ€ĞµÑ‡ĞºĞ° â†” Ğ¼Ğ°ĞºĞ°Ñ€Ğ¾Ğ½Ñ‹",
        "  Ñ‚Ğ²Ğ¾Ñ€Ğ¾Ğ³ â†” Ğ³Ñ€ĞµÑ‡ĞµÑĞºĞ¸Ğ¹ Ğ¹Ğ¾Ğ³ÑƒÑ€Ñ‚",
        "",
        "âš ï¸ Ğ­Ñ‚Ğ¾ Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€Ğ½Ñ‹Ğ¹ ÑĞ¿Ğ¸ÑĞ¾Ğº. ĞšĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ¸Ñ€ÑƒĞ¹ Ğ¿Ğ¾Ğ´",
        "   ÑĞ²Ğ¾Ğ¹ Ğ²ĞºÑƒÑ Ğ¸ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ğ¾ÑÑ‚ÑŒ Ğ¿Ñ€Ğ¾Ğ´ÑƒĞºÑ‚Ğ¾Ğ².",
    ]

    return "\n".join(lines)


async def cb_nutr_example(callback: CallbackQuery, bot: Bot):
    if not await is_full_access_active(callback.from_user.id):
        text = (
            "ğŸ½ ĞŸĞ¸Ñ‚Ğ°Ğ½Ğ¸Ğµ Ğ¾Ñ‚ĞºÑ€Ñ‹Ğ²Ğ°ĞµÑ‚ÑÑ Ğ½Ğ° Ñ‚Ğ°Ñ€Ğ¸Ñ„Ğ°Ñ… 3 Ğ¼ĞµÑÑÑ†Ğ° Ğ¸ ĞĞ°Ğ²ÑĞµĞ³Ğ´Ğ°.\n\n"
            f"Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸ Ñ‚Ğ°Ñ€Ğ¸Ñ„ ğŸ‘‡"
        )
        upgrade_kb = InlineKeyboardMarkup(inline_keyboard=[
            [InlineKeyboardButton(text=f"ğŸ”¥ 3 Ğ¼ĞµÑÑÑ†Ğ° â€” {TARIFFS['t3']['price']}â‚½", callback_data="tariff:t3")],
            [InlineKeyboardButton(text=f"ğŸ† ĞĞ°Ğ²ÑĞµĞ³Ğ´Ğ° â€” {TARIFFS['life']['price']}â‚½", callback_data="tariff:life")],
            [InlineKeyboardButton(text="ğŸ  ĞœĞµĞ½Ñ", callback_data="nav:menu")],
        ])
        await clean_edit(callback, callback.from_user.id, text, reply_markup=upgrade_kb)
        await callback.answer()
        return

    if not await ensure_profile_ready(callback.from_user.id):
        await clean_edit(callback, callback.from_user.id, "âš ï¸ Ğ¡Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ° Ğ·Ğ°Ğ¿Ğ¾Ğ»Ğ½Ğ¸ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ (âš™ï¸ ĞŸÑ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ).")
        await callback.answer()
        return

    day_i = int(callback.data.split(":")[2])
    u = await get_user(callback.from_user.id)
    summary, calories, p, f, c, meals = generate_nutrition_summary(
        u["goal"], u["sex"], int(u["age"]), int(u["height"]), float(u["weight"]), u["exp"],
        freq=int(u["freq"]), place=u["place"], meals_pref=int(u.get("meals") or 0)
    )
    day_text = build_meal_day_text(day_i, calories, p, f, c, meals)
    await clean_edit(callback, callback.from_user.id, day_text, reply_markup=nutrition_back_kb())
    await callback.answer()


async def cb_nutr_back(callback: CallbackQuery, bot: Bot):
    await open_nutrition(callback.from_user.id, callback.message.chat.id, bot, callback=callback)
    await callback.answer()


async def cb_nutr_basket(callback: CallbackQuery, bot: Bot):
    """ĞšĞ¾Ñ€Ğ·Ğ¸Ğ½Ğ° Ğ¿Ñ€Ğ¾Ğ´ÑƒĞºÑ‚Ğ¾Ğ² Ğ½Ğ° Ğ½ĞµĞ´ĞµĞ»Ñ."""
    if not await is_full_access_active(callback.from_user.id):
        await callback.answer("ğŸ”’ Ğ”Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ğ¾ Ğ½Ğ° Ñ‚Ğ°Ñ€Ğ¸Ñ„Ğ°Ñ… 3 Ğ¼ĞµÑÑÑ†Ğ° Ğ¸ ĞĞ°Ğ²ÑĞµĞ³Ğ´Ğ°.", show_alert=True)
        return

    if not await ensure_profile_ready(callback.from_user.id):
        await clean_edit(callback, callback.from_user.id, "âš ï¸ Ğ¡Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ° Ğ·Ğ°Ğ¿Ğ¾Ğ»Ğ½Ğ¸ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ.")
        await callback.answer()
        return

    u = await get_user(callback.from_user.id)
    _, calories, p, f, c, meals = generate_nutrition_summary(
        u["goal"], u["sex"], int(u["age"]), int(u["height"]), float(u["weight"]), u["exp"],
        freq=int(u["freq"]), place=u["place"], meals_pref=int(u.get("meals") or 0)
    )

    basket_text = build_shopping_basket(u["goal"], calories, p, f, c, meals)
    back_kb = InlineKeyboardMarkup(inline_keyboard=[
        [InlineKeyboardButton(text="â¬…ï¸ ĞĞ°Ğ·Ğ°Ğ´ Ğº Ñ€Ğ°Ñ†Ğ¸Ğ¾Ğ½Ñƒ", callback_data="nutr:back")],
        [InlineKeyboardButton(text="ğŸ  ĞœĞµĞ½Ñ", callback_data="nav:menu")],
    ])
    await clean_edit(callback, callback.from_user.id, basket_text, reply_markup=back_kb)
    await callback.answer()


# =========================
# âœ… Ğ¢Ğ•Ğ¥ĞĞ˜ĞšĞ˜: Ğ¥Ğ•ĞĞ”Ğ›Ğ•Ğ Ğ« (Ñ ĞºĞ°Ñ€Ñ‚Ğ¸Ğ½ĞºĞ°Ğ¼Ğ¸)
# =========================
async def cb_tech_list(callback: CallbackQuery, state: FSMContext):
    await state.clear()
    await clean_edit(callback, callback.from_user.id, "ğŸ“š Ğ¢ĞµÑ…Ğ½Ğ¸ĞºĞ¸ â€” Ğ²Ñ‹Ğ±ĞµÑ€Ğ¸ ÑƒĞ¿Ñ€Ğ°Ğ¶Ğ½ĞµĞ½Ğ¸Ğµ:", reply_markup=tech_kb())
    await callback.answer()


async def cb_tech_show(callback: CallbackQuery, bot: Bot):
    """ĞŸĞ¾ĞºĞ°Ğ· Ñ‚ĞµÑ…Ğ½Ğ¸ĞºĞ¸ Ñ ĞºĞ°Ñ€Ñ‚Ğ¸Ğ½ĞºĞ¾Ğ¹ Ğ¸Ğ· ÑĞ¿Ğ¸ÑĞºĞ° Ñ‚ĞµÑ…Ğ½Ğ¸Ğº."""
    key = callback.data.split("tech:", 1)[1]
    item = TECH.get(key)
    if not item:
        await callback.answer("ĞĞµ Ğ½Ğ°ÑˆÑ‘Ğ» ğŸ˜…", show_alert=True)
        return

    text = item["text"]
    img_path = item["img"]
    caption = text[:1020] + ("â€¦" if len(text) > 1020 else "")
    rest = text[1020:].strip()

    last_id = await get_last_bot_msg_id(callback.from_user.id)
    if last_id:
        try:
            await bot.delete_message(chat_id=callback.message.chat.id, message_id=last_id)
        except Exception:
            pass

    if os.path.exists(img_path):
        photo = FSInputFile(img_path)
        m = await bot.send_photo(
            chat_id=callback.message.chat.id,
            photo=photo,
            caption=caption,
            reply_markup=tech_back_kb()
        )
        await set_last_bot_msg_id(callback.from_user.id, m.message_id)
        if rest:
            m2 = await bot.send_message(
                chat_id=callback.message.chat.id,
                text=rest,
                reply_markup=tech_back_kb()
            )
            await set_last_bot_msg_id(callback.from_user.id, m2.message_id)
    else:
        m = await bot.send_message(
            chat_id=callback.message.chat.id,
            text=text,
            reply_markup=tech_back_kb()
        )
        await set_last_bot_msg_id(callback.from_user.id, m.message_id)

    await callback.answer()


# =========================
# ĞŸĞĞ¡Ğ¢Ğ« Ğ¡ ĞšĞĞ Ğ¢Ğ˜ĞĞšĞĞœĞ˜ (ĞĞ”ĞœĞ˜Ğ)
# =========================
def admin_posts_kb():
    return InlineKeyboardMarkup(inline_keyboard=[
        [InlineKeyboardButton(text="â• Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ¿Ğ¾ÑÑ‚", callback_data="post:new")],
        [InlineKeyboardButton(text="ğŸ  ĞœĞµĞ½Ñ", callback_data="nav:menu")],
    ])


def post_confirm_kb(post_id: int):
    return InlineKeyboardMarkup(inline_keyboard=[
        [InlineKeyboardButton(text="âœ… ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ²ÑĞµĞ¼", callback_data=f"post:send:{post_id}")],
        [InlineKeyboardButton(text="âŒ ĞÑ‚Ğ¼ĞµĞ½Ğ°", callback_data="post:cancel")],
    ])


async def cmd_posts(message: Message, state: FSMContext):
    if message.from_user.id != ADMIN_ID:
        return
    await state.clear()
    await message.answer("ğŸ— ĞŸĞ¾ÑÑ‚Ñ‹ (Ğ°Ğ´Ğ¼Ğ¸Ğ½):", reply_markup=admin_posts_kb())


async def cb_post_new(callback: CallbackQuery, state: FSMContext):
    if callback.from_user.id != ADMIN_ID:
        await callback.answer("ĞĞµÑ‚ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ°", show_alert=True)
        return

    await state.clear()
    txt = (
        "ğŸ“ Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ¿Ğ¾ÑÑ‚Ğ°\n\n"
        "ĞŸÑ€Ğ¸ÑˆĞ»Ğ¸ Ñ‚ĞµĞºÑÑ‚\n"
        "Ğ¸Ğ»Ğ¸ Ñ„Ğ¾Ñ‚Ğ¾/Ğ²Ğ¸Ğ´ĞµĞ¾ Ñ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑÑŒÑ.\n\n"
        "ĞŸĞ¾Ñ‚Ğ¾Ğ¼ Ğ¿Ğ¾ĞºĞ°Ğ¶Ñƒ Ğ¿Ñ€ĞµĞ²ÑŒÑ."
    )
    await callback.message.answer(txt, reply_markup=InlineKeyboardMarkup(inline_keyboard=[
        [InlineKeyboardButton(text="âŒ ĞÑ‚Ğ¼ĞµĞ½Ğ°", callback_data="post:cancel")]
    ]))
    await state.set_state(PostFlow.waiting_content)
    await callback.answer()


async def cb_post_cancel(callback: CallbackQuery, state: FSMContext):
    if callback.from_user.id != ADMIN_ID:
        await callback.answer()
        return
    await state.clear()
    await callback.message.answer("ĞĞº.", reply_markup=admin_posts_kb())
    await callback.answer()


async def post_waiting_content(message: Message, state: FSMContext, bot: Bot):
    if message.from_user.id != ADMIN_ID:
        return

    media_type = "none"
    media_file_id = ""
    text = ""

    if message.photo:
        media_type = "photo"
        media_file_id = message.photo[-1].file_id
        text = (message.caption or "").strip()
    elif message.video:
        media_type = "video"
        media_file_id = message.video.file_id
        text = (message.caption or "").strip()
    else:
        text = (message.text or "").strip()
        if not text:
            await message.answer("ĞÑƒĞ¶Ğ½Ğ¾ Ñ‚ĞµĞºÑÑ‚ Ğ¸Ğ»Ğ¸ Ğ¼ĞµĞ´Ğ¸Ğ° ğŸ™‚")
            return

    post_id = await create_post_draft(ADMIN_ID, media_type, media_file_id, text)
    await state.update_data(post_id=post_id)
    await state.set_state(PostFlow.waiting_confirm)

    preview_title = f"âœ… ĞŸÑ€ĞµĞ²ÑŒÑ (id={post_id})\n\n"
    chat_id = message.chat.id
    uid = message.from_user.id

    caption = (preview_title + (text or "")).strip()
    if len(caption) > 1024:
        caption = caption[:1020] + "â€¦"

    last_id = await get_last_bot_msg_id(uid)
    if last_id:
        try:
            await bot.delete_message(chat_id=chat_id, message_id=last_id)
        except Exception:
            pass

    if media_type == "photo":
        m = await bot.send_photo(chat_id=chat_id, photo=media_file_id, caption=caption, reply_markup=post_confirm_kb(post_id))
        await set_last_bot_msg_id(uid, m.message_id)
    elif media_type == "video":
        m = await bot.send_video(chat_id=chat_id, video=media_file_id, caption=caption, reply_markup=post_confirm_kb(post_id))
        await set_last_bot_msg_id(uid, m.message_id)
    else:
        mid = await clean_send(bot, chat_id, uid, preview_title + text, reply_markup=post_confirm_kb(post_id))
        await set_last_bot_msg_id(uid, mid)

    await try_delete_user_message(bot, message)


async def cb_post_send(callback: CallbackQuery, bot: Bot, state: FSMContext):
    if callback.from_user.id != ADMIN_ID:
        await callback.answer("ĞĞµÑ‚ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ°", show_alert=True)
        return

    post_id = int(callback.data.split(":")[2])

    post = await get_post(post_id)
    if not post:
        await callback.answer("ĞŸĞ¾ÑÑ‚ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½", show_alert=True)
        return
    if post.get("status") == "sent":
        await callback.answer("Ğ£Ğ¶Ğµ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½", show_alert=True)
        return

    await callback.message.answer("ğŸ“¤ Ğ Ğ°ÑÑÑ‹Ğ»Ğ°Ñâ€¦")
    await callback.answer()

    user_ids = await get_all_user_ids()
    ok = 0
    fail = 0

    caption = (post.get("text") or "").strip()
    if len(caption) > 1024:
        caption = caption[:1020] + "â€¦"

    for uid in user_ids:
        try:
            if post["media_type"] == "photo":
                await bot.send_photo(chat_id=uid, photo=post["media_file_id"], caption=caption if caption else None)
            elif post["media_type"] == "video":
                await bot.send_video(chat_id=uid, video=post["media_file_id"], caption=caption if caption else None)
            else:
                await bot.send_message(chat_id=uid, text=post.get("text") or "")
            ok += 1
        except Exception as e:
            fail += 1
            try:
                async with db() as conn:
                    await conn.execute("""
                        INSERT INTO post_sends (post_id, user_id, status, error, created_at)
                        VALUES (?, ?, 'fail', ?, ?)
                    """, (post_id, uid, str(e)[:500], datetime.utcnow().isoformat()))
                    await conn.commit()
            except Exception:
                pass

        await asyncio.sleep(0.03)

    await set_post_status(post_id, "sent")
    await callback.message.answer(f"âœ… Ğ“Ğ¾Ñ‚Ğ¾Ğ²Ğ¾. ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¾: {ok} â€¢ ĞÑˆĞ¸Ğ±Ğ¾Ğº: {fail}", reply_markup=admin_posts_kb())
    await state.clear()


# =========================
# ĞŸĞĞ”Ğ”Ğ•Ğ Ğ–ĞšĞ: Ğ»ÑĞ±Ğ¾Ğ¹ Ñ‚ĞµĞºÑÑ‚ -> Ğ°Ğ´Ğ¼Ğ¸Ğ½Ñƒ
# =========================
async def forward_to_admin(message: Message, bot: Bot):
    if message.from_user.id == ADMIN_ID:
        return
    if not message.text or message.text.startswith("/"):
        return

    await bot.send_message(
        chat_id=ADMIN_ID,
        text=f"ğŸ“© ĞŸĞ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ° Ğ¾Ñ‚ @{message.from_user.username or 'no_username'} (id={message.from_user.id}):\n\n{message.text}"
    )
    await try_delete_user_message(bot, message)
    await clean_send(bot, message.chat.id, message.from_user.id, "âœ… ĞŸÑ€Ğ¸Ğ½ÑĞ». ĞÑ‚Ğ²ĞµÑ‡Ñƒ Ñ‚ÑƒÑ‚.")


# =========================
# âœ… Ğ¡ĞœĞ•ĞĞ ĞŸĞ ĞĞ“Ğ ĞĞœĞœĞ« Ğ¢Ğ Ğ•ĞĞ˜Ğ ĞĞ’ĞĞš (Ğ´Ğ»Ñ full access)
# =========================
async def cb_workout_rebuild(callback: CallbackQuery, bot: Bot):
    """ĞŸĞµÑ€ĞµÑĞ¾Ğ±Ğ¸Ñ€Ğ°ĞµÑ‚ Ğ¿Ğ»Ğ°Ğ½ Ñ‚Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²Ğ¾Ğº (Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ´Ğ»Ñ Ğ¼ĞµÑÑÑ‡Ğ½Ğ¾Ğ¹ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞºĞ¸ Ğ¸ Ğ²Ñ‹ÑˆĞµ)."""
    uid = callback.from_user.id
    if not await is_full_access_active(uid):
        await callback.answer(
            "ğŸ”’ Ğ¡Ğ¼ĞµĞ½Ğ° Ğ¿Ñ€Ğ¾Ğ³Ñ€Ğ°Ğ¼Ğ¼Ñ‹ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ğ° Ğ½Ğ° Ñ‚Ğ°Ñ€Ğ¸Ñ„Ğ°Ñ… 3 Ğ¼ĞµÑÑÑ†Ğ° Ğ¸ ĞĞ°Ğ²ÑĞµĞ³Ğ´Ğ°.",
            show_alert=True
        )
        return

    await callback.answer("ğŸ”„ ĞŸĞµÑ€ĞµÑĞ¾Ğ±Ğ¸Ñ€Ğ°Ñ Ğ¿Ñ€Ğ¾Ğ³Ñ€Ğ°Ğ¼Ğ¼Ñƒâ€¦")

    # ĞœĞµĞ½ÑĞµĞ¼ seed (ÑĞ´Ğ²Ğ¸Ğ³Ğ°ĞµĞ¼ Ğ½Ğ° ÑĞ»ÑƒÑ‡Ğ°Ğ¹Ğ½Ğ¾Ğµ Ñ‡Ğ¸ÑĞ»Ğ¾) Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ´Ñ€ÑƒĞ³Ğ¾Ğ¹ Ñ€Ğ°Ğ½Ğ´Ğ¾Ğ¼
    u = await get_user(uid)
    import random as _rnd
    shift = _rnd.randint(1, 9999)
    # Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµĞ¼ ÑĞ´Ğ²Ğ¸Ğ³ Ğ² Ğ¿Ğ¾Ğ»Ğµ state (Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ğ¾), Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ gen Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ğ»Ğ° Ğ´Ñ€ÑƒĞ³Ğ¾Ğ¹ seed
    original_id = uid
    # Ğ“ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒĞµĞ¼ Ñ Ğ¸Ğ·Ğ¼ĞµĞ½Ñ‘Ğ½Ğ½Ñ‹Ğ¼ user_id (seed) Ğ´Ğ»Ñ Ñ€Ğ°Ğ·Ğ½Ğ¾Ğ¾Ğ±Ñ€Ğ°Ğ·Ğ¸Ñ
    varied_id = uid + shift * 100

    intro, plan_struct = generate_workout_plan(
        u["goal"], u["place"], u["exp"], int(u["freq"] or 3),
        limits=u.get("limits") or "",
        user_id=varied_id
    )
    await save_workout_plan(uid, intro, dumps_plan(plan_struct))

    # Ğ¡Ğ±Ñ€Ğ°ÑÑ‹Ğ²Ğ°ĞµĞ¼ Ğ¿Ñ€Ğ¾Ğ³Ñ€ĞµÑÑ Ğ´Ğ½ĞµĞ¹
    async with db() as conn:
        await conn.execute("DELETE FROM workout_day_progress WHERE user_id=?", (uid,))
        await conn.commit()

    full_access = await is_full_access_active(uid)
    kb = workout_days_kb(int(u.get("freq") or plan_struct.get("freq") or 3), has_full_access=full_access)
    await clean_edit(callback, uid,
        intro + "\n\nâœ… ĞŸÑ€Ğ¾Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ° Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ°! ĞŸÑ€Ğ¾Ğ³Ñ€ĞµÑÑ Ğ´Ğ½ĞµĞ¹ ÑĞ±Ñ€Ğ¾ÑˆĞµĞ½.",
        reply_markup=kb
    )


# =========================
# Ğ”Ğ˜ĞĞ“ĞĞĞ¡Ğ¢Ğ˜ĞšĞ ĞĞŸĞ›ĞĞ¢Ğ« (ĞĞ”ĞœĞ˜Ğ)
# =========================
async def cmd_testpay(message: Message, bot: Bot):
    """ĞšĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ° /testpay â€” Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚ ÑĞ¾ĞµĞ´Ğ¸Ğ½ĞµĞ½Ğ¸Ğµ Ñ Ğ®ĞšĞ°ÑÑĞ° API (Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ´Ğ»Ñ Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ°)."""
    if message.from_user.id != ADMIN_ID:
        return

    lines = ["ğŸ” Ğ”Ğ¸Ğ°Ğ³Ğ½Ğ¾ÑÑ‚Ğ¸ĞºĞ° Ğ®ĞšĞ°ÑÑĞ°\n"]
    lines.append(f"YUKASSA_SHOP_ID: {'âœ… ' + YUKASSA_SHOP_ID[:4] + '****' if YUKASSA_SHOP_ID else 'âŒ Ğ½Ğµ Ğ·Ğ°Ğ´Ğ°Ğ½'}")
    lines.append(f"YUKASSA_SECRET: {'âœ… Ğ·Ğ°Ğ´Ğ°Ğ½' if YUKASSA_SECRET else 'âŒ Ğ½Ğµ Ğ·Ğ°Ğ´Ğ°Ğ½'}")
    lines.append(f"BOT_PUBLIC_URL: {BOT_PUBLIC_URL or 'âŒ Ğ½Ğµ Ğ·Ğ°Ğ´Ğ°Ğ½'}\n")

    if not YUKASSA_SHOP_ID or not YUKASSA_SECRET:
        lines.append("âŒ ĞŸĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ñ Ğ½Ğµ Ğ·Ğ°Ğ´Ğ°Ğ½Ñ‹!")
        await message.answer("\n".join(lines))
        return

    lines.append("â³ ĞŸÑ€Ğ¾Ğ±ÑƒÑ ÑĞ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ñ‚ĞµÑÑ‚Ğ¾Ğ²Ñ‹Ğ¹ Ğ¿Ğ»Ğ°Ñ‚Ñ‘Ğ¶ (1â‚½)...")
    await message.answer("\n".join(lines))

    yk_data, yk_err = await yukassa_create_payment("trial", message.from_user.id)

    if yk_data:
        pay_id = yk_data.get("id", "?")
        conf_url = (yk_data.get("confirmation") or {}).get("confirmation_url", "?")
        await message.answer(
            f"âœ… Ğ£ÑĞ¿ĞµÑˆĞ½Ğ¾! ĞŸĞ»Ğ°Ñ‚Ñ‘Ğ¶ ÑĞ¾Ğ·Ğ´Ğ°Ğ½.\n"
            f"ID: {pay_id}\n"
            f"URL: {conf_url[:60]}..."
        )
    else:
        await message.answer(
            f"âŒ ĞÑˆĞ¸Ğ±ĞºĞ° ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ñ Ğ¿Ğ»Ğ°Ñ‚ĞµĞ¶Ğ°:\n{yk_err}\n\n"
            "ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑŒ:\n"
            "1. YUKASSA_SHOP_ID Ğ¸ YUKASSA_SECRET Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ñ‹Ğµ\n"
            "2. ĞœĞ°Ğ³Ğ°Ğ·Ğ¸Ğ½ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½ Ğ² yukassa.ru\n"
            "3. IP ÑĞµÑ€Ğ²ĞµÑ€Ğ° Ğ½Ğµ Ğ·Ğ°Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½ Ğ®ĞšĞ°ÑÑĞ°"
        )


# =========================
# ğŸ“¸ ĞšĞĞ›ĞĞ Ğ˜Ğ˜ ĞŸĞ Ğ¤ĞĞ¢Ğ â€” Ğ±Ğ°Ğ·Ğ° Ğ¿Ñ€Ğ¾Ğ´ÑƒĞºÑ‚Ğ¾Ğ² (Ğ½Ğ° 100Ğ³)
# =========================
FOOD_DB: Dict[str, Dict[str, float]] = {
    "rice":           {"kcal": 344, "protein": 7.0,  "fat": 0.6, "carbs": 76.0},
    "buckwheat":      {"kcal": 313, "protein": 12.6, "fat": 3.3, "carbs": 57.1},
    "oats":           {"kcal": 389, "protein": 16.9, "fat": 6.9, "carbs": 66.3},
    "chicken breast": {"kcal": 165, "protein": 31.0, "fat": 3.6, "carbs": 0.0},
    "turkey":         {"kcal": 189, "protein": 29.0, "fat": 7.4, "carbs": 0.0},
    "eggs":           {"kcal": 155, "protein": 13.0, "fat": 11.0,"carbs": 1.1},
    "banana":         {"kcal": 89,  "protein": 1.1,  "fat": 0.3, "carbs": 23.0},
    "apple":          {"kcal": 52,  "protein": 0.3,  "fat": 0.2, "carbs": 14.0},
    "bread":          {"kcal": 265, "protein": 9.0,  "fat": 3.2, "carbs": 49.0},
    "cheese":         {"kcal": 402, "protein": 25.0, "fat": 33.0,"carbs": 1.3},
    "cottage cheese": {"kcal": 98,  "protein": 11.0, "fat": 4.3, "carbs": 3.4},
    "milk":           {"kcal": 61,  "protein": 3.2,  "fat": 3.3, "carbs": 4.8},
    "potato":         {"kcal": 77,  "protein": 2.0,  "fat": 0.1, "carbs": 17.0},
    "olive oil":      {"kcal": 884, "protein": 0.0,  "fat": 100.0,"carbs": 0.0},
    "salad":          {"kcal": 15,  "protein": 1.3,  "fat": 0.2, "carbs": 2.9},
    "pasta":          {"kcal": 371, "protein": 13.0, "fat": 1.5, "carbs": 74.0},
    "salmon":         {"kcal": 208, "protein": 20.0, "fat": 13.0,"carbs": 0.0},
    "beef":           {"kcal": 250, "protein": 26.0, "fat": 15.0,"carbs": 0.0},
    "pork":           {"kcal": 297, "protein": 25.0, "fat": 21.0,"carbs": 0.0},
    "tomato":         {"kcal": 18,  "protein": 0.9,  "fat": 0.2, "carbs": 3.9},
}

FOOD_DB_RU: Dict[str, str] = {
    "rice": "Ñ€Ğ¸Ñ", "buckwheat": "Ğ³Ñ€ĞµÑ‡ĞºĞ°", "oats": "Ğ¾Ğ²ÑÑĞ½ĞºĞ°",
    "chicken breast": "ĞºÑƒÑ€Ğ¸Ğ½Ğ°Ñ Ğ³Ñ€ÑƒĞ´ĞºĞ°", "turkey": "Ğ¸Ğ½Ğ´ĞµĞ¹ĞºĞ°", "eggs": "ÑĞ¹Ñ†Ğ°",
    "banana": "Ğ±Ğ°Ğ½Ğ°Ğ½", "apple": "ÑĞ±Ğ»Ğ¾ĞºĞ¾", "bread": "Ñ…Ğ»ĞµĞ±", "cheese": "ÑÑ‹Ñ€",
    "cottage cheese": "Ñ‚Ğ²Ğ¾Ñ€Ğ¾Ğ³", "milk": "Ğ¼Ğ¾Ğ»Ğ¾ĞºĞ¾", "potato": "ĞºĞ°Ñ€Ñ‚Ğ¾Ñ„ĞµĞ»ÑŒ",
    "olive oil": "Ğ¾Ğ»Ğ¸Ğ²ĞºĞ¾Ğ²Ğ¾Ğµ Ğ¼Ğ°ÑĞ»Ğ¾", "salad": "ÑĞ°Ğ»Ğ°Ñ‚/Ğ·ĞµĞ»ĞµĞ½ÑŒ", "pasta": "Ğ¿Ğ°ÑÑ‚Ğ°/Ğ¼Ğ°ĞºĞ°Ñ€Ğ¾Ğ½Ñ‹",
    "salmon": "Ğ»Ğ¾ÑĞ¾ÑÑŒ", "beef": "Ğ³Ğ¾Ğ²ÑĞ´Ğ¸Ğ½Ğ°", "pork": "ÑĞ²Ğ¸Ğ½Ğ¸Ğ½Ğ°", "tomato": "Ñ‚Ğ¾Ğ¼Ğ°Ñ‚",
}


def food_name_ru(name: str) -> str:
    return FOOD_DB_RU.get(name.lower(), name)


def calc_food_macros(items: list) -> Dict[str, float]:
    """Ğ¡Ñ‡Ğ¸Ñ‚Ğ°ĞµÑ‚ ÑÑƒĞ¼Ğ¼Ğ°Ñ€Ğ½Ñ‹Ğµ ĞšĞ‘Ğ–Ğ£ Ğ¿Ğ¾ ÑĞ¿Ğ¸ÑĞºÑƒ {name, grams}."""
    total = {"kcal": 0.0, "protein": 0.0, "fat": 0.0, "carbs": 0.0}
    for item in items:
        name = (item.get("name") or "").lower().strip()
        grams = float(item.get("grams") or 0)
        factor = grams / 100.0
        db_entry = FOOD_DB.get(name)
        if db_entry:
            for k in total:
                total[k] += db_entry[k] * factor
        elif item.get("kcal_per100"):
            kcal_per100 = float(item["kcal_per100"])
            total["kcal"] += kcal_per100 * factor
            total["protein"] += float(item.get("protein_per100") or 0) * factor
            total["fat"] += float(item.get("fat_per100") or 0) * factor
            total["carbs"] += float(item.get("carbs_per100") or 0) * factor
    return {k: round(v, 1) for k, v in total.items()}


# =========================
# ğŸ“¸ ĞšĞĞ›ĞĞ Ğ˜Ğ˜ ĞŸĞ Ğ¤ĞĞ¢Ğ â€” DB
# =========================
async def db_init_food():
    """Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‘Ñ‚ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñƒ food_diary ĞµÑĞ»Ğ¸ Ğ½ĞµÑ‚."""
    async with db() as conn:
        await conn.execute("""
            CREATE TABLE IF NOT EXISTS food_diary (
                id INTEGER PRIMARY KEY AUTOINCREMENT,
                user_id INTEGER,
                date TEXT,
                item_name TEXT,
                grams REAL,
                kcal REAL,
                protein REAL,
                fat REAL,
                carbs REAL,
                created_at TEXT
            )
        """)
        await conn.commit()


async def db_add_food_entry(user_id: int, date: str, item_name: str,
                             grams: float, kcal: float, protein: float,
                             fat: float, carbs: float):
    now = datetime.utcnow().isoformat()
    async with db() as conn:
        await conn.execute("""
            INSERT INTO food_diary (user_id, date, item_name, grams, kcal, protein, fat, carbs, created_at)
            VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)
        """, (user_id, date, item_name, grams, kcal, protein, fat, carbs, now))
        await conn.commit()


async def db_get_day_total(user_id: int, date: str) -> Dict[str, float]:
    async with db() as conn:
        async with conn.execute("""
            SELECT SUM(kcal), SUM(protein), SUM(fat), SUM(carbs)
            FROM food_diary WHERE user_id=? AND date=?
        """, (user_id, date)) as cur:
            row = await cur.fetchone()
    if not row or row[0] is None:
        return {"kcal": 0.0, "protein": 0.0, "fat": 0.0, "carbs": 0.0}
    return {
        "kcal": round(row[0] or 0, 1),
        "protein": round(row[1] or 0, 1),
        "fat": round(row[2] or 0, 1),
        "carbs": round(row[3] or 0, 1),
    }


# =========================
# ğŸ“¸ ĞšĞĞ›ĞĞ Ğ˜Ğ˜ ĞŸĞ Ğ¤ĞĞ¢Ğ â€” OpenAI Vision
# =========================
async def openai_analyze_food(image_bytes: bytes) -> Tuple[Optional[list], Optional[str]]:
    """ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµÑ‚ Ñ„Ğ¾Ñ‚Ğ¾ Ğ² OpenAI Vision, Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ (items, error)."""
    import base64
    import aiohttp as _aiohttp

    if not OPENAI_API_KEY:
        return None, "OPENAI_API_KEY Ğ½Ğµ Ğ·Ğ°Ğ´Ğ°Ğ½. Ğ”Ğ¾Ğ±Ğ°Ğ²ÑŒ ĞµĞ³Ğ¾ Ğ² Ğ¿ĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ñ."

    b64 = base64.b64encode(image_bytes).decode()

    prompt = (
        "You are a food calorie estimator. Look at this food photo and identify all food items.\n"
        "Return ONLY a valid JSON object with no extra text, no markdown, no explanation:\n"
        '{"items": [{"name": "chicken breast", "grams": 150}, {"name": "rice", "grams": 180}], "notes": ""}\n'
        "Rules:\n"
        "- name must be in English, lowercase\n"
        "- grams is your best estimate (integer)\n"
        "- if you see a dish, break it into ingredients\n"
        "- return ONLY the JSON, nothing else"
    )

    payload = {
        "model": "gpt-4o-mini",
        "max_tokens": 500,
        "messages": [
            {
                "role": "user",
                "content": [
                    {"type": "text", "text": prompt},
                    {"type": "image_url", "image_url": {"url": f"data:image/jpeg;base64,{b64}", "detail": "low"}},
                ]
            }
        ]
    }

    headers = {
        "Authorization": f"Bearer {OPENAI_API_KEY}",
        "Content-Type": "application/json",
    }

    for attempt in range(2):
        try:
            async with _aiohttp.ClientSession() as session:
                async with session.post(
                    "https://api.openai.com/v1/chat/completions",
                    json=payload,
                    headers=headers,
                    timeout=_aiohttp.ClientTimeout(total=30),
                ) as resp:
                    if resp.status != 200:
                        err_text = await resp.text()
                        if attempt == 0:
                            continue
                        return None, f"OpenAI Ğ¾ÑˆĞ¸Ğ±ĞºĞ° {resp.status}: {err_text[:200]}"
                    data = await resp.json()
                    raw = data["choices"][0]["message"]["content"].strip()
                    # Ğ£Ğ±Ğ¸Ñ€Ğ°ĞµĞ¼ Ğ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ñ‹Ğµ markdown-Ğ¾Ğ±Ñ‘Ñ€Ñ‚ĞºĞ¸
                    raw = re.sub(r"^```[a-z]*\n?", "", raw)
                    raw = re.sub(r"\n?```$", "", raw)
                    parsed = json.loads(raw)
                    items = parsed.get("items", [])
                    if not isinstance(items, list) or len(items) == 0:
                        if attempt == 0:
                            continue
                        return None, "ĞœĞ¾Ğ´ĞµĞ»ÑŒ Ğ½Ğµ Ğ½Ğ°ÑˆĞ»Ğ° Ğ¿Ñ€Ğ¾Ğ´ÑƒĞºÑ‚Ñ‹ Ğ½Ğ° Ñ„Ğ¾Ñ‚Ğ¾. ĞŸĞ¾Ğ¿Ñ€Ğ¾Ğ±ÑƒĞ¹ Ğ´Ñ€ÑƒĞ³Ğ¾Ğµ Ñ„Ğ¾Ñ‚Ğ¾."
                    return items, None
        except json.JSONDecodeError:
            if attempt == 0:
                continue
            return None, "ĞœĞ¾Ğ´ĞµĞ»ÑŒ Ğ²ĞµÑ€Ğ½ÑƒĞ»Ğ° Ğ½ĞµĞ²Ğ°Ğ»Ğ¸Ğ´Ğ½Ñ‹Ğ¹ JSON. ĞŸĞ¾Ğ¿Ñ€Ğ¾Ğ±ÑƒĞ¹ ÑĞ½Ğ¾Ğ²Ğ°."
        except Exception as e:
            if attempt == 0:
                continue
            return None, f"ĞÑˆĞ¸Ğ±ĞºĞ° ÑĞµÑ‚Ğ¸: {type(e).__name__}: {e}"

    return None, "ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ¾Ñ‚Ğ²ĞµÑ‚ Ğ¾Ñ‚ OpenAI. ĞŸĞ¾Ğ¿Ñ€Ğ¾Ğ±ÑƒĞ¹ ÑĞ½Ğ¾Ğ²Ğ°."


# =========================
# ğŸ“¸ ĞšĞĞ›ĞĞ Ğ˜Ğ˜ ĞŸĞ Ğ¤ĞĞ¢Ğ â€” ĞšĞ›ĞĞ’Ğ˜ĞĞ¢Ğ£Ğ Ğ«
# =========================
def food_confirm_kb(items: list) -> InlineKeyboardMarkup:
    """ĞšĞ»Ğ°Ğ²Ğ¸Ğ°Ñ‚ÑƒÑ€Ğ° Ğ¿Ğ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ¶Ğ´ĞµĞ½Ğ¸Ñ Ğ¿Ğ¾ÑĞ»Ğµ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ° Ñ„Ğ¾Ñ‚Ğ¾."""
    rows = [
        [InlineKeyboardButton(text="âœ… Ğ—Ğ°Ğ¿Ğ¸ÑĞ°Ñ‚ÑŒ Ğ² Ğ´Ğ½ĞµĞ²Ğ½Ğ¸Ğº", callback_data="food:save")],
        [InlineKeyboardButton(text="âœï¸ Ğ˜Ğ·Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ Ğ¿Ğ¾Ñ€Ñ†Ğ¸Ğ¸", callback_data="food:edit_menu")],
        [InlineKeyboardButton(text="ğŸ” Ğ”Ñ€ÑƒĞ³Ğ¾Ğµ Ñ„Ğ¾Ñ‚Ğ¾", callback_data="food:retry")],
        [InlineKeyboardButton(text="ğŸ  ĞœĞµĞ½Ñ", callback_data="nav:menu")],
    ]
    return InlineKeyboardMarkup(inline_keyboard=rows)


def food_edit_items_kb(items: list) -> InlineKeyboardMarkup:
    """Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº Ğ¿Ñ€Ğ¾Ğ´ÑƒĞºÑ‚Ğ¾Ğ² Ğ´Ğ»Ñ Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ¾Ğ²ĞºĞ¸."""
    rows = []
    for i, item in enumerate(items):
        name_display = food_name_ru(item["name"])
        rows.append([InlineKeyboardButton(
            text=f"âœï¸ {name_display} â€” {item['grams']}Ğ³",
            callback_data=f"food:edit_item:{i}"
        )])
    rows.append([InlineKeyboardButton(text="â—€ï¸ ĞĞ°Ğ·Ğ°Ğ´", callback_data="food:back_confirm")])
    return InlineKeyboardMarkup(inline_keyboard=rows)


def food_unknown_kb(item_idx: int, item_name: str) -> InlineKeyboardMarkup:
    """ĞšĞ»Ğ°Ğ²Ğ¸Ğ°Ñ‚ÑƒÑ€Ğ° Ğ´Ğ»Ñ Ğ½ĞµĞ¸Ğ·Ğ²ĞµÑÑ‚Ğ½Ğ¾Ğ³Ğ¾ Ğ¿Ñ€Ğ¾Ğ´ÑƒĞºÑ‚Ğ° â€” Ğ²Ñ‹Ğ±Ñ€Ğ°Ñ‚ÑŒ Ğ±Ğ»Ğ¸Ğ¶Ğ°Ğ¹ÑˆĞ¸Ğ¹ Ğ¸Ğ»Ğ¸ Ğ²Ğ²ĞµÑÑ‚Ğ¸ Ğ²Ñ€ÑƒÑ‡Ğ½ÑƒÑ."""
    rows = []
    # ĞŸÑ€ĞµĞ´Ğ»Ğ°Ğ³Ğ°ĞµĞ¼ 4 Ğ½Ğ°Ğ¸Ğ±Ğ¾Ğ»ĞµĞµ Ğ¿Ğ¾Ñ…Ğ¾Ğ¶Ğ¸Ñ… Ğ¸Ğ· Ğ±Ğ°Ğ·Ñ‹
    candidates = list(FOOD_DB.keys())[:8]
    for i in range(0, len(candidates), 2):
        row = []
        for c in candidates[i:i+2]:
            row.append(InlineKeyboardButton(
                text=food_name_ru(c),
                callback_data=f"food:map:{item_idx}:{c}"
            ))
        rows.append(row)
    rows.append([InlineKeyboardButton(text="âœï¸ Ğ’Ğ²ĞµÑÑ‚Ğ¸ ĞºĞºĞ°Ğ» Ğ²Ñ€ÑƒÑ‡Ğ½ÑƒÑ", callback_data=f"food:manual:{item_idx}")])
    rows.append([InlineKeyboardButton(text="â—€ï¸ ĞĞ°Ğ·Ğ°Ğ´", callback_data="food:back_confirm")])
    return InlineKeyboardMarkup(inline_keyboard=rows)


def _items_text(items: list) -> str:
    """Ğ¢ĞµĞºÑÑ‚ Ñ Ñ€Ğ°ÑĞ¿Ğ¾Ğ·Ğ½Ğ°Ğ½Ğ½Ñ‹Ğ¼Ğ¸ Ğ¿Ñ€Ğ¾Ğ´ÑƒĞºÑ‚Ğ°Ğ¼Ğ¸ Ğ¸ ĞšĞ‘Ğ–Ğ£."""
    lines = ["ğŸ½ Ğ Ğ°ÑĞ¿Ğ¾Ğ·Ğ½Ğ°Ğ½Ğ¾:\n"]
    for item in items:
        name_display = food_name_ru(item["name"])
        grams = item.get("grams", 0)
        macros = calc_food_macros([item])
        if item.get("unknown"):
            lines.append(f"â€¢ â“ {name_display} â€” {grams}Ğ³  (Ğ½ĞµĞ¸Ğ·Ğ²ĞµÑÑ‚Ğ½Ñ‹Ğ¹ Ğ¿Ñ€Ğ¾Ğ´ÑƒĞºÑ‚)")
        else:
            lines.append(f"â€¢ {name_display} â€” {grams}Ğ³  ({macros['kcal']} ĞºĞºĞ°Ğ»)")
    total = calc_food_macros(items)
    lines.append(f"\nğŸ“Š Ğ˜Ñ‚Ğ¾Ğ³Ğ¾: {total['kcal']} ĞºĞºĞ°Ğ»")
    lines.append(f"Ğ‘ {total['protein']}Ğ³  Ğ– {total['fat']}Ğ³  Ğ£ {total['carbs']}Ğ³")
    return "\n".join(lines)


# =========================
# ğŸ“¸ ĞšĞĞ›ĞĞ Ğ˜Ğ˜ ĞŸĞ Ğ¤ĞĞ¢Ğ â€” Ğ¥Ğ•ĞĞ”Ğ›Ğ•Ğ Ğ«
# =========================
async def cb_food_photo_start(callback: CallbackQuery, state: FSMContext, bot: Bot):
    """ĞĞ°Ğ¶Ğ°Ğ»Ğ¸ ĞºĞ½Ğ¾Ğ¿ĞºÑƒ ğŸ“¸ ĞšĞ°Ğ»Ğ¾Ñ€Ğ¸Ğ¸ Ğ¿Ğ¾ Ñ„Ğ¾Ñ‚Ğ¾."""
    uid = callback.from_user.id
    await state.clear()

    if not await is_access_active(uid):
        await clean_edit(callback, uid, locked_text())
        await callback.answer()
        return

    if not OPENAI_API_KEY:
        await clean_edit(callback, uid,
            "âš ï¸ Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ñ Â«ĞšĞ°Ğ»Ğ¾Ñ€Ğ¸Ğ¸ Ğ¿Ğ¾ Ñ„Ğ¾Ñ‚Ğ¾Â» Ñ‚Ñ€ĞµĞ±ÑƒĞµÑ‚ OPENAI_API_KEY.\n"
            "ĞĞ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€ Ğ´Ğ¾Ğ»Ğ¶ĞµĞ½ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ ĞºĞ»ÑÑ‡ OpenAI Ğ² Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸.",
            reply_markup=InlineKeyboardMarkup(inline_keyboard=[
                [InlineKeyboardButton(text="ğŸ  ĞœĞµĞ½Ñ", callback_data="nav:menu")]
            ])
        )
        await callback.answer()
        return

    await state.set_state(FoodPhotoFlow.waiting_photo)
    await clean_edit(callback, uid,
        "ğŸ“¸ ĞÑ‚Ğ¿Ñ€Ğ°Ğ²ÑŒ Ñ„Ğ¾Ñ‚Ğ¾ ĞµĞ´Ñ‹\n\n"
        "Ğ¡Ñ„Ğ¾Ñ‚Ğ¾Ğ³Ñ€Ğ°Ñ„Ğ¸Ñ€ÑƒĞ¹ Ñ‚Ğ°Ñ€ĞµĞ»ĞºÑƒ â€” Ğ¿Ğ¾ÑÑ‚Ğ°Ñ€Ğ°ÑÑÑŒ Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»Ğ¸Ñ‚ÑŒ Ğ¿Ñ€Ğ¾Ğ´ÑƒĞºÑ‚Ñ‹ Ğ¸ Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ¾Ğ²ĞºÑƒ.\n"
        "Ğ›ÑƒÑ‡ÑˆĞµ Ğ²ÑĞµĞ³Ğ¾ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚ Ñ Ğ¾Ğ´Ğ½Ğ¸Ğ¼ Ğ±Ğ»ÑĞ´Ğ¾Ğ¼ Ğ¸Ğ»Ğ¸ Ğ½Ğ°Ğ±Ğ¾Ñ€Ğ¾Ğ¼ Ğ¿Ñ€Ğ¾Ğ´ÑƒĞºÑ‚Ğ¾Ğ² Ğ½Ğ° Ñ‚Ğ°Ñ€ĞµĞ»ĞºĞµ.",
        reply_markup=InlineKeyboardMarkup(inline_keyboard=[
            [InlineKeyboardButton(text="ğŸ  ĞœĞµĞ½Ñ", callback_data="nav:menu")]
        ])
    )
    await callback.answer()


async def food_receive_photo(message: Message, state: FSMContext, bot: Bot):
    """ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ğ»Ğ¸ Ñ„Ğ¾Ñ‚Ğ¾ ĞµĞ´Ñ‹ â€” Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€ÑƒĞµĞ¼ Ñ‡ĞµÑ€ĞµĞ· OpenAI Vision."""
    uid = message.from_user.id

    if not message.photo:
        await clean_send(bot, message.chat.id, uid,
            "ĞÑƒĞ¶Ğ½Ğ¾ Ğ¸Ğ¼ĞµĞ½Ğ½Ğ¾ Ñ„Ğ¾Ñ‚Ğ¾ ğŸ“¸\nĞÑ‚Ğ¿Ñ€Ğ°Ğ²ÑŒ Ñ„Ğ¾Ñ‚Ğ¾Ğ³Ñ€Ğ°Ñ„Ğ¸Ñ ĞµĞ´Ñ‹.",
            reply_markup=InlineKeyboardMarkup(inline_keyboard=[
                [InlineKeyboardButton(text="ğŸ  ĞœĞµĞ½Ñ", callback_data="nav:menu")]
            ])
        )
        await try_delete_user_message(bot, message)
        return

    # Ğ£Ğ´Ğ°Ğ»ÑĞµĞ¼ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
    await try_delete_user_message(bot, message)

    # ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ "Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€ÑƒÑ..."
    wait_msg_id = await clean_send(bot, message.chat.id, uid,
        "ğŸ” ĞĞ½Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€ÑƒÑ Ñ„Ğ¾Ñ‚Ğ¾, Ğ¿Ğ¾Ğ´Ğ¾Ğ¶Ğ´Ğ¸ ÑĞµĞºÑƒĞ½Ğ´Ñƒâ€¦"
    )

    # Ğ¡ĞºĞ°Ñ‡Ğ¸Ğ²Ğ°ĞµĞ¼ Ñ„Ğ¾Ñ‚Ğ¾ (Ğ±ĞµÑ€Ñ‘Ğ¼ Ğ½Ğ°Ğ¸Ğ±Ğ¾Ğ»ÑŒÑˆĞ¸Ğ¹ Ñ€Ğ°Ğ·Ğ¼ĞµÑ€)
    photo = message.photo[-1]
    file = await bot.get_file(photo.file_id)
    file_bytes = await bot.download_file(file.file_path)
    image_bytes = file_bytes.read() if hasattr(file_bytes, "read") else bytes(file_bytes)

    # ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµĞ¼ Ğ² OpenAI
    items, error = await openai_analyze_food(image_bytes)

    if error or not items:
        await clean_send(bot, message.chat.id, uid,
            f"âŒ {error or 'ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ñ€Ğ°ÑĞ¿Ğ¾Ğ·Ğ½Ğ°Ñ‚ÑŒ Ğ¿Ñ€Ğ¾Ğ´ÑƒĞºÑ‚Ñ‹.'}\n\nĞŸĞ¾Ğ¿Ñ€Ğ¾Ğ±ÑƒĞ¹ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ´Ñ€ÑƒĞ³Ğ¾Ğµ Ñ„Ğ¾Ñ‚Ğ¾.",
            reply_markup=InlineKeyboardMarkup(inline_keyboard=[
                [InlineKeyboardButton(text="ğŸ” ĞŸĞ¾Ğ¿Ñ€Ğ¾Ğ±Ğ¾Ğ²Ğ°Ñ‚ÑŒ ÑĞ½Ğ¾Ğ²Ğ°", callback_data="food:start")],
                [InlineKeyboardButton(text="ğŸ  ĞœĞµĞ½Ñ", callback_data="nav:menu")],
            ])
        )
        await state.clear()
        return

    # ĞŸĞ¾Ğ¼ĞµÑ‡Ğ°ĞµĞ¼ Ğ½ĞµĞ¸Ğ·Ğ²ĞµÑÑ‚Ğ½Ñ‹Ğµ Ğ¿Ñ€Ğ¾Ğ´ÑƒĞºÑ‚Ñ‹
    for item in items:
        name = (item.get("name") or "").lower().strip()
        item["name"] = name
        if name not in FOOD_DB:
            item["unknown"] = True

    # Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµĞ¼ items Ğ² FSM
    await state.update_data(items=items)
    await state.set_state(FoodPhotoFlow.confirm_items)

    text = _items_text(items)

    # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼: ĞµÑÑ‚ÑŒ Ğ»Ğ¸ Ğ½ĞµĞ¸Ğ·Ğ²ĞµÑÑ‚Ğ½Ñ‹Ğµ
    has_unknown = any(item.get("unknown") for item in items)
    if has_unknown:
        text += "\n\nâ“ Ğ•ÑÑ‚ÑŒ Ğ½ĞµĞ¸Ğ·Ğ²ĞµÑÑ‚Ğ½Ñ‹Ğµ Ğ¿Ñ€Ğ¾Ğ´ÑƒĞºÑ‚Ñ‹ â€” Ğ½Ğ°Ğ¶Ğ¼Ğ¸ Â«Ğ˜Ğ·Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ Ğ¿Ğ¾Ñ€Ñ†Ğ¸Ğ¸Â» Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ ÑƒÑ‚Ğ¾Ñ‡Ğ½Ğ¸Ñ‚ÑŒ."

    await clean_send(bot, message.chat.id, uid, text, reply_markup=food_confirm_kb(items))


async def cb_food_save(callback: CallbackQuery, state: FSMContext, bot: Bot):
    """Ğ—Ğ°Ğ¿Ğ¸ÑÑ‹Ğ²Ğ°ĞµĞ¼ Ğ¿Ñ€Ğ¸Ñ‘Ğ¼ Ğ¿Ğ¸Ñ‰Ğ¸ Ğ² Ğ´Ğ½ĞµĞ²Ğ½Ğ¸Ğº."""
    uid = callback.from_user.id
    data = await state.get_data()
    items = data.get("items", [])

    if not items:
        await clean_edit(callback, uid, "ĞĞµÑ‚ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…. ĞÑ‚Ğ¿Ñ€Ğ°Ğ²ÑŒ Ñ„Ğ¾Ñ‚Ğ¾ ÑĞ½Ğ¾Ğ²Ğ°.",
            reply_markup=InlineKeyboardMarkup(inline_keyboard=[
                [InlineKeyboardButton(text="ğŸ  ĞœĞµĞ½Ñ", callback_data="nav:menu")]
            ])
        )
        await callback.answer()
        await state.clear()
        return

    today = datetime.now().strftime("%Y-%m-%d")

    # Ğ—Ğ°Ğ¿Ğ¸ÑÑ‹Ğ²Ğ°ĞµĞ¼ ĞºĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ğ¿Ñ€Ğ¾Ğ´ÑƒĞºÑ‚ Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½Ğ¾Ğ¹ ÑÑ‚Ñ€Ğ¾ĞºĞ¾Ğ¹
    for item in items:
        macros = calc_food_macros([item])
        await db_add_food_entry(
            user_id=uid,
            date=today,
            item_name=item.get("name", "unknown"),
            grams=float(item.get("grams", 0)),
            kcal=macros["kcal"],
            protein=macros["protein"],
            fat=macros["fat"],
            carbs=macros["carbs"],
        )

    # Ğ˜Ñ‚Ğ¾Ğ³Ğ¸ Ğ·Ğ° Ğ¿Ñ€Ğ¸Ñ‘Ğ¼
    meal_macros = calc_food_macros(items)
    # Ğ˜Ñ‚Ğ¾Ğ³Ğ¸ Ğ·Ğ° Ğ´ĞµĞ½ÑŒ
    day_total = await db_get_day_total(uid, today)

    text = (
        f"âœ… Ğ—Ğ°Ğ¿Ğ¸ÑĞ°Ğ½Ğ¾!\n\n"
        f"ğŸ½ Ğ­Ñ‚Ğ¾Ñ‚ Ğ¿Ñ€Ğ¸Ñ‘Ğ¼:\n"
        f"â€¢ {meal_macros['kcal']} ĞºĞºĞ°Ğ»\n"
        f"â€¢ Ğ‘ {meal_macros['protein']}Ğ³  Ğ– {meal_macros['fat']}Ğ³  Ğ£ {meal_macros['carbs']}Ğ³\n\n"
        f"ğŸ“… Ğ—Ğ° ÑĞµĞ³Ğ¾Ğ´Ğ½Ñ ({today}):\n"
        f"â€¢ {day_total['kcal']} ĞºĞºĞ°Ğ»\n"
        f"â€¢ Ğ‘ {day_total['protein']}Ğ³  Ğ– {day_total['fat']}Ğ³  Ğ£ {day_total['carbs']}Ğ³"
    )

    await clean_edit(callback, uid, text,
        reply_markup=InlineKeyboardMarkup(inline_keyboard=[
            [InlineKeyboardButton(text="ğŸ“¸ Ğ•Ñ‰Ñ‘ Ñ„Ğ¾Ñ‚Ğ¾", callback_data="food:start")],
            [InlineKeyboardButton(text="ğŸ  ĞœĞµĞ½Ñ", callback_data="nav:menu")],
        ])
    )
    await state.clear()
    await callback.answer("âœ… Ğ—Ğ°Ğ¿Ğ¸ÑĞ°Ğ½Ğ¾!")


async def cb_food_retry(callback: CallbackQuery, state: FSMContext, bot: Bot):
    """Ğ”Ñ€ÑƒĞ³Ğ¾Ğµ Ñ„Ğ¾Ñ‚Ğ¾."""
    uid = callback.from_user.id
    await state.clear()
    await state.set_state(FoodPhotoFlow.waiting_photo)
    await clean_edit(callback, uid,
        "ğŸ“¸ ĞÑ‚Ğ¿Ñ€Ğ°Ğ²ÑŒ Ğ´Ñ€ÑƒĞ³Ğ¾Ğµ Ñ„Ğ¾Ñ‚Ğ¾ ĞµĞ´Ñ‹:",
        reply_markup=InlineKeyboardMarkup(inline_keyboard=[
            [InlineKeyboardButton(text="ğŸ  ĞœĞµĞ½Ñ", callback_data="nav:menu")]
        ])
    )
    await callback.answer()


async def cb_food_edit_menu(callback: CallbackQuery, state: FSMContext, bot: Bot):
    """ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ ÑĞ¿Ğ¸ÑĞ¾Ğº Ğ¿Ñ€Ğ¾Ğ´ÑƒĞºÑ‚Ğ¾Ğ² Ğ´Ğ»Ñ Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ."""
    uid = callback.from_user.id
    data = await state.get_data()
    items = data.get("items", [])
    if not items:
        await callback.answer("ĞĞµÑ‚ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…", show_alert=True)
        return

    await clean_edit(callback, uid,
        "âœï¸ Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸ Ğ¿Ñ€Ğ¾Ğ´ÑƒĞºÑ‚ Ğ´Ğ»Ñ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ¾Ğ²ĞºĞ¸:",
        reply_markup=food_edit_items_kb(items)
    )
    await callback.answer()


async def cb_food_edit_item(callback: CallbackQuery, state: FSMContext, bot: Bot):
    """Ğ’Ñ‹Ğ±Ñ€Ğ°Ğ»Ğ¸ ĞºĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½Ñ‹Ğ¹ Ğ¿Ñ€Ğ¾Ğ´ÑƒĞºÑ‚ Ğ´Ğ»Ñ Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ¾Ğ²ĞºĞ¸."""
    uid = callback.from_user.id
    idx = int(callback.data.split(":")[2])
    data = await state.get_data()
    items = data.get("items", [])

    if idx >= len(items):
        await callback.answer("ĞĞµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½", show_alert=True)
        return

    item = items[idx]
    name_display = food_name_ru(item["name"])

    # Ğ•ÑĞ»Ğ¸ Ğ¿Ñ€Ğ¾Ğ´ÑƒĞºÑ‚ Ğ½ĞµĞ¸Ğ·Ğ²ĞµÑÑ‚Ğ½Ñ‹Ğ¹ â€” Ğ¿Ñ€ĞµĞ´Ğ»Ğ°Ğ³Ğ°ĞµĞ¼ ÑĞ½Ğ°Ñ‡Ğ°Ğ»Ğ° Ğ²Ñ‹Ğ±Ñ€Ğ°Ñ‚ÑŒ Ğ¸Ğ· Ğ±Ğ°Ğ·Ñ‹
    if item.get("unknown"):
        await clean_edit(callback, uid,
            f"â“ Â«{name_display}Â» Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½ Ğ² Ğ±Ğ°Ğ·Ğµ.\n\n"
            "Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸ Ğ±Ğ»Ğ¸Ğ¶Ğ°Ğ¹ÑˆĞ¸Ğ¹ Ğ¿Ñ€Ğ¾Ğ´ÑƒĞºÑ‚ Ğ¸Ğ· ÑĞ¿Ğ¸ÑĞºĞ° Ğ¸Ğ»Ğ¸ Ğ²Ğ²ĞµĞ´Ğ¸ ĞºĞ°Ğ»Ğ¾Ñ€Ğ¸Ğ¹Ğ½Ğ¾ÑÑ‚ÑŒ Ğ²Ñ€ÑƒÑ‡Ğ½ÑƒÑ:",
            reply_markup=food_unknown_kb(idx, item["name"])
        )
        await callback.answer()
        return

    await state.update_data(edit_idx=idx)
    await state.set_state(FoodPhotoFlow.edit_item_grams)

    await clean_edit(callback, uid,
        f"âœï¸ {name_display}\n\nĞ¡ĞµĞ¹Ñ‡Ğ°Ñ: {item['grams']}Ğ³\n\nĞ’Ğ²ĞµĞ´Ğ¸ Ğ½Ğ¾Ğ²Ğ¾Ğµ ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ¾Ğ² (Ñ‡Ğ¸ÑĞ»Ğ¾Ğ¼):",
        reply_markup=InlineKeyboardMarkup(inline_keyboard=[
            [InlineKeyboardButton(text="â—€ï¸ ĞĞ°Ğ·Ğ°Ğ´", callback_data="food:edit_menu")]
        ])
    )
    await callback.answer()


async def cb_food_map_unknown(callback: CallbackQuery, state: FSMContext, bot: Bot):
    """ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ²Ñ‹Ğ±Ñ€Ğ°Ğ» Ğ±Ğ»Ğ¸Ğ¶Ğ°Ğ¹ÑˆĞ¸Ğ¹ Ğ¿Ñ€Ğ¾Ğ´ÑƒĞºÑ‚ Ğ´Ğ»Ñ Ğ½ĞµĞ¸Ğ·Ğ²ĞµÑÑ‚Ğ½Ğ¾Ğ³Ğ¾."""
    parts = callback.data.split(":")
    idx = int(parts[2])
    mapped_name = parts[3]

    data = await state.get_data()
    items = data.get("items", [])
    if idx >= len(items):
        await callback.answer("ĞĞµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½", show_alert=True)
        return

    items[idx]["name"] = mapped_name
    items[idx].pop("unknown", None)
    await state.update_data(items=items)

    await clean_edit(callback, callback.from_user.id,
        _items_text(items),
        reply_markup=food_confirm_kb(items)
    )
    await callback.answer(f"âœ… Ğ—Ğ°Ğ¼ĞµĞ½ĞµĞ½Ğ¾ Ğ½Ğ° {food_name_ru(mapped_name)}")


async def cb_food_manual_kcal_start(callback: CallbackQuery, state: FSMContext, bot: Bot):
    """ĞĞ°Ñ‡Ğ°Ğ»Ğ¾ Ğ²Ğ²Ğ¾Ğ´Ğ° ĞºĞºĞ°Ğ» Ğ²Ñ€ÑƒÑ‡Ğ½ÑƒÑ Ğ´Ğ»Ñ Ğ½ĞµĞ¸Ğ·Ğ²ĞµÑÑ‚Ğ½Ğ¾Ğ³Ğ¾ Ğ¿Ñ€Ğ¾Ğ´ÑƒĞºÑ‚Ğ°."""
    idx = int(callback.data.split(":")[2])
    await state.update_data(edit_idx=idx, manual_kcal=True)
    await state.set_state(FoodPhotoFlow.edit_item_grams)

    data = await state.get_data()
    items = data.get("items", [])
    name_display = food_name_ru(items[idx]["name"]) if idx < len(items) else "Ğ¿Ñ€Ğ¾Ğ´ÑƒĞºÑ‚"

    await clean_edit(callback, callback.from_user.id,
        f"âœï¸ {name_display}\n\n"
        "Ğ’Ğ²ĞµĞ´Ğ¸ ĞºĞ°Ğ»Ğ¾Ñ€Ğ¸Ğ¹Ğ½Ğ¾ÑÑ‚ÑŒ Ğ½Ğ° 100Ğ³ (Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ñ‡Ğ¸ÑĞ»Ğ¾).\n"
        "ĞĞ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€: 250\n\n"
        "Ğ˜Ğ»Ğ¸ Ğ² Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğµ: 250 5 10 30 (ĞºĞºĞ°Ğ» Ğ±ĞµĞ»Ğ¾Ğº Ğ¶Ğ¸Ñ€ ÑƒĞ³Ğ»ĞµĞ²Ğ¾Ğ´Ñ‹ Ğ½Ğ° 100Ğ³)",
        reply_markup=InlineKeyboardMarkup(inline_keyboard=[
            [InlineKeyboardButton(text="â—€ï¸ ĞĞ°Ğ·Ğ°Ğ´", callback_data="food:edit_menu")]
        ])
    )
    await callback.answer()


async def food_enter_grams(message: Message, state: FSMContext, bot: Bot):
    """ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ²Ğ²Ñ‘Ğ» Ğ³Ñ€Ğ°Ğ¼Ğ¼Ñ‹ (Ğ¸Ğ»Ğ¸ ĞºĞºĞ°Ğ» Ğ²Ñ€ÑƒÑ‡Ğ½ÑƒÑ)."""
    uid = message.from_user.id
    await try_delete_user_message(bot, message)

    fsm_data = await state.get_data()
    idx = fsm_data.get("edit_idx", 0)
    is_manual = fsm_data.get("manual_kcal", False)
    items = fsm_data.get("items", [])

    txt = (message.text or "").strip()

    if is_manual:
        # ĞŸĞ°Ñ€ÑĞ¸Ğ¼ "250" Ğ¸Ğ»Ğ¸ "250 5 10 30"
        parts = txt.split()
        try:
            kcal_per100 = float(parts[0].replace(",", "."))
        except ValueError:
            await clean_send(bot, message.chat.id, uid, "Ğ’Ğ²ĞµĞ´Ğ¸ Ñ‡Ğ¸ÑĞ»Ğ¾ (ĞºĞ°Ğ»Ğ¾Ñ€Ğ¸Ğ¹Ğ½Ğ¾ÑÑ‚ÑŒ Ğ½Ğ° 100Ğ³):")
            return

        items[idx]["kcal_per100"] = kcal_per100
        items[idx]["protein_per100"] = float(parts[1].replace(",", ".")) if len(parts) > 1 else 0.0
        items[idx]["fat_per100"] = float(parts[2].replace(",", ".")) if len(parts) > 2 else 0.0
        items[idx]["carbs_per100"] = float(parts[3].replace(",", ".")) if len(parts) > 3 else 0.0
        items[idx].pop("unknown", None)
        await state.update_data(items=items, manual_kcal=False, edit_idx=None)
    else:
        # ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ Ğ³Ñ€Ğ°Ğ¼Ğ¼Ñ‹
        try:
            grams = float(txt.replace(",", "."))
            if grams <= 0:
                raise ValueError
        except ValueError:
            await clean_send(bot, message.chat.id, uid, "Ğ’Ğ²ĞµĞ´Ğ¸ Ğ¿Ğ¾Ğ»Ğ¾Ğ¶Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾Ğµ Ñ‡Ğ¸ÑĞ»Ğ¾ (Ğ³Ñ€Ğ°Ğ¼Ğ¼Ñ‹):")
            return
        items[idx]["grams"] = grams
        await state.update_data(items=items, edit_idx=None)

    await state.set_state(FoodPhotoFlow.confirm_items)

    await clean_send(bot, message.chat.id, uid,
        _items_text(items),
        reply_markup=food_confirm_kb(items)
    )


async def cb_food_back_confirm(callback: CallbackQuery, state: FSMContext, bot: Bot):
    """Ğ’ĞµÑ€Ğ½ÑƒÑ‚ÑŒÑÑ Ğº ÑĞºÑ€Ğ°Ğ½Ñƒ Ğ¿Ğ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ¶Ğ´ĞµĞ½Ğ¸Ñ."""
    uid = callback.from_user.id
    data = await state.get_data()
    items = data.get("items", [])
    await state.set_state(FoodPhotoFlow.confirm_items)
    await clean_edit(callback, uid,
        _items_text(items),
        reply_markup=food_confirm_kb(items)
    )
    await callback.answer()


# =========================
# Ğ Ğ•Ğ“Ğ˜Ğ¡Ğ¢Ğ ĞĞ¦Ğ˜Ğ¯ Ğ¥Ğ•ĞĞ”Ğ›Ğ•Ğ ĞĞ’
# =========================
def setup_handlers(dp: Dispatcher):
    from aiogram.types import PreCheckoutQuery

    dp.message.register(cmd_start, CommandStart())

    dp.callback_query.register(cb_nav, F.data.startswith("nav:"))

    dp.callback_query.register(cb_profile_edit, F.data == "p:edit")
    dp.callback_query.register(cb_rebuild_plan, F.data == "p:rebuild_plan")
    dp.callback_query.register(cb_profile_start_wizard, F.data == "p:start_wizard")
    dp.callback_query.register(cb_build_program, F.data == "p:build_program")
    dp.callback_query.register(cb_profile_field_edit, F.data.startswith("pf:"))
    dp.callback_query.register(cb_profile_back, F.data.startswith("p:back:"))
    dp.callback_query.register(cb_profile_goal, F.data.startswith("p:goal:"))
    dp.callback_query.register(cb_profile_sex, F.data.startswith("p:sex:"))
    dp.callback_query.register(cb_profile_place, F.data.startswith("p:place:"))
    dp.callback_query.register(cb_profile_exp, F.data.startswith("p:exp:"))
    dp.callback_query.register(cb_profile_freq, F.data.startswith("p:freq:"))
    dp.callback_query.register(cb_profile_meals, F.data.startswith("p:meals:"))

    dp.message.register(profile_age_text, ProfileWizard.age)
    dp.message.register(profile_height_text, ProfileWizard.height)
    dp.message.register(profile_weight_text, ProfileWizard.weight)
    dp.message.register(profile_limits_text, ProfileWizard.limits)

    # ĞĞ´Ğ¸Ğ½Ğ¾Ñ‡Ğ½Ğ¾Ğµ Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¿Ğ¾Ğ»ĞµĞ¹
    dp.message.register(profile_field_age, ProfileFieldEdit.age)
    dp.message.register(profile_field_height, ProfileFieldEdit.height)
    dp.message.register(profile_field_weight, ProfileFieldEdit.weight)
    dp.message.register(profile_field_limits, ProfileFieldEdit.limits)

    # Ğ®ĞšĞ°ÑÑĞ° REST API
    dp.callback_query.register(cb_tariff, F.data.startswith("tariff:"))
    dp.callback_query.register(cb_check_payment, F.data.startswith("check_pay:"))

    # Ğ ÑƒÑ‡Ğ½Ğ¾Ğµ Ğ¾Ğ´Ğ¾Ğ±Ñ€ĞµĞ½Ğ¸Ğµ (Ğ·Ğ°Ğ¿Ğ°ÑĞ½Ğ¾Ğ¹ Ğ²Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚)
    dp.callback_query.register(admin_actions, F.data.startswith("admin_approve:") | F.data.startswith("admin_reject:"))

    dp.callback_query.register(cb_measure_type, F.data.startswith("mtype:"))
    dp.callback_query.register(measures_history, F.data == "m:history")
    dp.message.register(measure_value, MeasureFlow.enter_value)

    dp.callback_query.register(diary_pick_ex, F.data.startswith("d:ex:"))
    dp.callback_query.register(diary_history, F.data == "d:history")
    dp.message.register(diary_enter_sets, DiaryFlow.enter_sets)

    dp.callback_query.register(cb_tech_list, F.data == "tech:list")
    dp.callback_query.register(cb_tech_show, F.data.startswith("tech:"))

    dp.callback_query.register(cb_nutr_example, F.data.startswith("nutr:ex:"))
    dp.callback_query.register(cb_nutr_back, F.data == "nutr:back")
    dp.callback_query.register(cb_nutr_basket, F.data == "nutr:basket")

    dp.callback_query.register(cb_faq_question, F.data.startswith("faq:"))

    dp.callback_query.register(cb_workout_day, F.data.startswith("wday:"))
    dp.callback_query.register(cb_workout_ex_done, F.data.startswith("wex:done:"))
    dp.callback_query.register(cb_workout_ex_tech, F.data.startswith("wex:tech:"))
    dp.callback_query.register(cb_workout_rebuild, F.data == "workout:rebuild")

    dp.message.register(cmd_testpay, Command("testpay"))
    dp.message.register(cmd_posts, Command("posts"))
    dp.callback_query.register(cb_post_new, F.data == "post:new")
    dp.callback_query.register(cb_post_cancel, F.data == "post:cancel")
    dp.callback_query.register(cb_post_send, F.data.startswith("post:send:"))
    dp.message.register(post_waiting_content, PostFlow.waiting_content)

    dp.message.register(open_payment_from_reply, F.text == "ğŸ’³ ĞĞ¿Ğ»Ğ°Ñ‚Ğ°/Ğ´Ğ¾ÑÑ‚ÑƒĞ¿")
    dp.message.register(open_profile_from_reply, F.text == "âš™ï¸ ĞŸÑ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ")
    dp.message.register(open_support_from_reply, F.text == "ğŸ†˜ ĞŸĞ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ°")
    dp.message.register(open_menu_from_reply, F.text == "ğŸ  ĞœĞµĞ½Ñ")

    # ğŸ“¸ ĞšĞ°Ğ»Ğ¾Ñ€Ğ¸Ğ¸ Ğ¿Ğ¾ Ñ„Ğ¾Ñ‚Ğ¾
    dp.callback_query.register(cb_food_photo_start, F.data == "food:start")
    dp.callback_query.register(cb_food_save, F.data == "food:save")
    dp.callback_query.register(cb_food_retry, F.data == "food:retry")
    dp.callback_query.register(cb_food_edit_menu, F.data == "food:edit_menu")
    dp.callback_query.register(cb_food_back_confirm, F.data == "food:back_confirm")
    dp.callback_query.register(cb_food_edit_item, F.data.startswith("food:edit_item:"))
    dp.callback_query.register(cb_food_map_unknown, F.data.startswith("food:map:"))
    dp.callback_query.register(cb_food_manual_kcal_start, F.data.startswith("food:manual:"))
    dp.message.register(food_receive_photo, FoodPhotoFlow.waiting_photo, F.photo)
    dp.message.register(food_receive_photo, FoodPhotoFlow.waiting_photo)  # fallback Ğ´Ğ»Ñ Ğ½Ğµ-Ñ„Ğ¾Ñ‚Ğ¾
    dp.message.register(food_enter_grams, FoodPhotoFlow.edit_item_grams)

    dp.message.register(forward_to_admin)


# =========================
# WEB SERVER (Render/health)
# =========================
async def run_web_server():
    app = web.Application()

    async def health(request):
        return web.Response(text="ok")

    app.router.add_get("/", health)

    runner = web.AppRunner(app)
    await runner.setup()

    port = int(os.getenv("PORT", 10000))
    site = web.TCPSite(runner, "0.0.0.0", port)
    await site.start()

    print(f"Web server started on port {port}")

    while True:
        await asyncio.sleep(3600)


# =========================
# MAIN
# =========================
async def main():
    if "PASTE_NEW_TOKEN_HERE" in BOT_TOKEN or not BOT_TOKEN or BOT_TOKEN == "0":
        raise RuntimeError("ĞÑƒĞ¶Ğ½Ğ¾ Ğ·Ğ°Ğ´Ğ°Ñ‚ÑŒ BOT_TOKEN Ñ‡ĞµÑ€ĞµĞ· ENV.")

    if ADMIN_ID == 0:
        logger.warning("ADMIN_ID Ğ½Ğµ Ğ·Ğ°Ğ´Ğ°Ğ½. Ğ£Ğ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ñ Ğ¾Ğ± Ğ¾Ğ¿Ğ»Ğ°Ñ‚Ğ°Ñ… Ğ½Ğµ Ğ±ÑƒĞ´ÑƒÑ‚ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑÑ‚ÑŒÑÑ.")

    if not YUKASSA_SHOP_ID or not YUKASSA_SECRET:
        logger.warning("YUKASSA_SHOP_ID Ğ¸Ğ»Ğ¸ YUKASSA_SECRET Ğ½Ğµ Ğ·Ğ°Ğ´Ğ°Ğ½Ñ‹. ĞĞ¿Ğ»Ğ°Ñ‚Ğ° Ñ‡ĞµÑ€ĞµĞ· Ğ®ĞšĞ°ÑÑĞ° Ğ½Ğµ Ğ±ÑƒĞ´ĞµÑ‚ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ñ‚ÑŒ.")

    await init_db()

    bot = Bot(token=BOT_TOKEN)
    await bot.delete_webhook(drop_pending_updates=True)
    logger.info("Webhook cleared, starting polling...")

    dp = Dispatcher()
    setup_handlers(dp)

    async def bot_loop():
        backoff = 2
        while True:
            try:
                logger.info("Bot polling started.")
                await dp.start_polling(bot, allowed_updates=dp.resolve_used_update_types())
            except Exception:
                logger.exception("Polling crashed. Restarting...")
                await asyncio.sleep(backoff)
                backoff = min(backoff * 2, 60)
            else:
                backoff = 2
                await asyncio.sleep(2)

    await asyncio.gather(
        bot_loop(),
        run_web_server(),
    )

if __name__ == "__main__":
    try:
        asyncio.run(main())
    except KeyboardInterrupt:
        pass
